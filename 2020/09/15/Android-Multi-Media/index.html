<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="学习和了解 Android 音视频开发相关的一些总结和梳理，有了一个基础和感性的认识。有哪些点以及用这些点可以做些什么有了一个大概的了解，简单列一下。">
<meta property="og:type" content="article">
<meta property="og:title" content="Android-Multi-Media">
<meta property="og:url" content="http://yoursite.com/2020/09/15/Android-Multi-Media/index.html">
<meta property="og:site_name" content="诗与远方">
<meta property="og:description" content="学习和了解 Android 音视频开发相关的一些总结和梳理，有了一个基础和感性的认识。有哪些点以及用这些点可以做些什么有了一个大概的了解，简单列一下。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2020/09/15/Android-Multi-Media/multi-media.jpg">
<meta property="og:image" content="http://yoursite.com/2020/09/15/Android-Multi-Media/videoview.png">
<meta property="og:image" content="http://yoursite.com/2020/09/15/Android-Multi-Media/mediaplayer-life.gif">
<meta property="og:image" content="http://yoursite.com/2020/09/15/Android-Multi-Media/mediacodec1.png">
<meta property="og:image" content="http://yoursite.com/2020/09/15/Android-Multi-Media/mediacodec2.image">
<meta property="og:image" content="http://yoursite.com/2020/09/15/Android-Multi-Media/all.image">
<meta property="article:published_time" content="2020-09-15T12:33:33.000Z">
<meta property="article:modified_time" content="2021-03-14T11:47:15.981Z">
<meta property="article:author" content="九尾灵狐">
<meta property="article:tag" content="音视频">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/09/15/Android-Multi-Media/multi-media.jpg">

<link rel="canonical" href="http://yoursite.com/2020/09/15/Android-Multi-Media/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Android-Multi-Media | 诗与远方</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">诗与远方</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/REBOOTERS" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/15/Android-Multi-Media/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="九尾灵狐">
      <meta itemprop="description" content="人生不止眼前的苟且，还有诗与远方和田野">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诗与远方">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Android-Multi-Media
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-15 20:33:33" itemprop="dateCreated datePublished" datetime="2020-09-15T20:33:33+08:00">2020-09-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-14 19:47:15" itemprop="dateModified" datetime="2021-03-14T19:47:15+08:00">2021-03-14</time>
              </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>8 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <img src="/2020/09/15/Android-Multi-Media/multi-media.jpg">

<p>学习和了解 Android 音视频开发相关的一些总结和梳理，有了一个基础和感性的认识。有哪些点以及用这些点可以做些什么有了一个大概的了解，简单列一下。</p>
<a id="more"></a>

<h2 id="基础知识概念相关"><a href="#基础知识概念相关" class="headerlink" title="基础知识概念相关"></a>基础知识概念相关</h2><p>音视频基础参见<a href="/2020/02/01/%E9%9F%B3%E8%A7%86%E9%A2%91%E7%9F%A5%E8%AF%86/" title="音视频入门">音视频入门</a>,不再赘述。</p>
<h2 id="在-Android-中如何播放一个音频-视频"><a href="#在-Android-中如何播放一个音频-视频" class="headerlink" title="在 Android 中如何播放一个音频/视频"></a>在 Android 中如何播放一个音频/视频</h2><h3 id="音频播放"><a href="#音频播放" class="headerlink" title="音频播放"></a>音频播放</h3><p>有句话叫做没声音再好的戏也出不来。因此，音频播放的好坏（尤其是对于一个视频来说）是非常关键的。在 Android 中根据播放场景的不同，在加上手机上有铃声、电话声音、音乐播放的声音等不同的音源，音频播放有以下几种选择。</p>
<h4 id="MediaPlayer"><a href="#MediaPlayer" class="headerlink" title="MediaPlayer"></a>MediaPlayer</h4><p>这个可能是最常用的。它非常强大。具体使用后面会详细分析，这里简单说一下他的缺点： <strong>资源占用量较高、延迟时间较长、不支持多个音频同时播放等</strong></p>
<h4 id="SoundPool"><a href="#SoundPool" class="headerlink" title="SoundPool"></a>SoundPool</h4><p>针对上述 MediaPlayer 的缺点，如果我们只是播放一些简单的音乐片段，比如游戏音效，音频特效的场景下是比较合适的。SoundPool支持多个音频文件同时播放(组合音频也是有上限的)，延时短，比较适合短促、密集的场景，是游戏开发中音效播放的福音。</p>
<h4 id="AudioTrack"><a href="#AudioTrack" class="headerlink" title="AudioTrack"></a>AudioTrack</h4><blockquote>
<p>AudioTrack属于更偏底层的音频播放，MediaPlayerService的内部就是使用了AudioTrack。</p>
</blockquote>
<blockquote>
<p>AudioTrack用于单个音频播放和管理，相比于MediaPlayer具有：精炼、高效的优点。<br>更适合实时产生播放数据的情况，如加密的音频，<br>MediaPlayer是束手无策的，AudioTrack却可以。</p>
</blockquote>
<blockquote>
<p>AudioTrack用于播放PCM(PCM无压缩的音频格式)音乐流的回放，如果需要播放其它格式音频，需要响应的解码器，这也是AudioTrack用的比较少的原因，需要自己解码音频。</p>
</blockquote>
<p>如上介绍, AudioTrack 使用门槛较高，但是的确可以解决一些特殊场景的问题。</p>
<p>以上三种播放音频的具体实现方式，可以参考文末的 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/Im-Victor/p/9760629.html">Android中播放音乐的几种方式</a>。</p>
<h3 id="播放视频"><a href="#播放视频" class="headerlink" title="播放视频"></a>播放视频</h3><h4 id="VideoView"><a href="#VideoView" class="headerlink" title="VideoView"></a>VideoView</h4><p>Android 系统提供了 VideoView 这样封装好的组件，可以直接用来播放视频，使用方式非常简单。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.ui.SimpleVideoViewActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;VideoView</span><br><span class="line">        android:id=&quot;@+id/video_view&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleVideoViewActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> viewBinding: ActivitySimpleVideoViewBinding</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        viewBinding = ActivitySimpleVideoViewBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(viewBinding.root)</span><br><span class="line">        viewBinding.videoView.setVideoPath(Constant.originalPath)</span><br><span class="line">        <span class="keyword">val</span> control = MediaController(<span class="keyword">this</span>)</span><br><span class="line">        viewBinding.videoView.setMediaController(control)</span><br><span class="line">        viewBinding.videoView.requestFocus()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如上代码即可实现一个带进度条及快进、快退、播放和暂停功能的视频播放功能。</p>
<img src="/2020/09/15/Android-Multi-Media/videoview.png" width="30%">

<p>如图，底部控制视频播放的工具栏是系统提供的 MediaController 组件，VideoView 整体是通过继承 SurfaceView 并组合 MediaPlayer,MediaController 等相关组件将视频播放的生命周期相关的细节在内部进行了封装，方便开发者使用。但是，他内部添加 MediaController 组件的方式不够灵活，无论视频高度是什么样的，播放控制的组件永远在屏幕底部。失去了一些灵活性，因此在大部分场景需要我们自己去定制播放器。</p>
<h4 id="MediaPlayer-SurfaceView"><a href="#MediaPlayer-SurfaceView" class="headerlink" title="MediaPlayer + SurfaceView"></a>MediaPlayer + SurfaceView</h4><p>MediaPlayer 的使用整体来说比较简单，重点是理解下面这幅图中他的生命周期，在正确时候做正确事，否则就会发生 Exception.</p>
<img src="/2020/09/15/Android-Multi-Media/mediaplayer-life.gif" width="40%/">

<p>通过合理使用设计模式，我们可以对 MediaPlayer 进行二次封装，将其接口调用和播放转态的回调按照自己的需求进行设计。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PlayerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">loadMedia</span><span class="params">(Object mediaRes)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">loadMedia</span><span class="params">(String path)</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">release</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isPlaying</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>比如设计如上接口用于上层业务调用。通过桥接模式，将 MediaPlayer 内各种判断隐藏在内。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MediaPlayerHolder</span> <span class="keyword">implements</span> <span class="title">PlayerAdapter</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initializeMediaPlayer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mMediaPlayer == <span class="keyword">null</span>) &#123;</span><br><span class="line">            mMediaPlayer = <span class="keyword">new</span> MediaPlayer();</span><br><span class="line">            mMediaPlayer.setAudioStreamType(AudioManager.STREAM_MUSIC);</span><br><span class="line">            mMediaPlayer.setOnCompletionListener(mediaPlayer -&gt; &#123;</span><br><span class="line">                stopUpdatingCallbackWithPosition(<span class="keyword">true</span>);</span><br><span class="line">                ....</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Implements PlaybackControl.</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadMedia</span><span class="params">(Object resource)</span> </span>&#123;</span><br><span class="line">        mResourceObj = resource;</span><br><span class="line"></span><br><span class="line">        initializeMediaPlayer();</span><br><span class="line">        <span class="keyword">if</span> (mResourceObj <span class="keyword">instanceof</span> Integer) &#123;</span><br><span class="line">            <span class="keyword">int</span> id = (<span class="keyword">int</span>) mResourceObj;</span><br><span class="line">            AssetFileDescriptor assetFileDescriptor =</span><br><span class="line">                    mContext.getResources().openRawResourceFd(id);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                mMediaPlayer.setDataSource(assetFileDescriptor);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mResourceObj <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            String path = (String) mResourceObj;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                mMediaPlayer.setDataSource(path);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;           </span><br><span class="line">            mMediaPlayer.prepare();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;&#125;</span><br><span class="line"></span><br><span class="line">        initializeProgressCallback();</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mMediaPlayer != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mMediaPlayer.release();</span><br><span class="line">            mMediaPlayer = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPlaying</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mMediaPlayer != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> mMediaPlayer.isPlaying();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mMediaPlayer != <span class="keyword">null</span> &amp;&amp; !mMediaPlayer.isPlaying()) &#123;</span><br><span class="line">            mMediaPlayer.start();</span><br><span class="line">            <span class="keyword">if</span> (mPlaybackInfoListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                mPlaybackInfoListener.onStateChanged(PlaybackInfoListener.State.PLAYING);</span><br><span class="line">            &#125;</span><br><span class="line">            startUpdatingCallbackWithPosition();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .....</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>比如这里将播放器设置资源、初始化的细节及异常处理的逻辑进行封装。播放器转态的切换在内部进行处理，最大程度的方便上层业务聚焦于具体的逻辑而不是这些细节。</p>
<p>最后，在具体的 View 层使用就比价简单了。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">    viewBinding = ActivitySimpleMediaPlayerBinding.inflate(layoutInflater)</span><br><span class="line">    setContentView(viewBinding.root)</span><br><span class="line">    surfaceHolder = viewBinding.surfaceView.holder</span><br><span class="line">            viewBinding.buttonPlay.setOnClickListener &#123;</span><br><span class="line">        <span class="keyword">if</span> (playVideo) &#123;</span><br><span class="line">            mPlayerAdapter.setDisplay(surfaceHolder)</span><br><span class="line">        &#125;</span><br><span class="line">        mPlayerAdapter.play()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>具体细节可以参考 GitHub 源码     <a target="_blank" rel="noopener" href="https://github.com/REBOOTERS/Android-Multi-Media/blob/master/media/src/main/java/com/engineer/android/media/ui/SimpleMediaPlayerActivity.kt">SimpleMediaPlayerActivity</a></p>
<h2 id="为啥还要了解音视频编解码？"><a href="#为啥还要了解音视频编解码？" class="headerlink" title="为啥还要了解音视频编解码？"></a>为啥还要了解音视频编解码？</h2><p>MediaPlayer 只是提供了音视频的播放功能。对于音视频来说还有数据的采集、二次创作、数据的传输等很多事情。因此，了解 MediaPlayer 后可能连 Android 音视频开发的大门还没打开。我们需要更深入的去了解音视频编解码的功能。 </p>
<h3 id="为什么要编解码？"><a href="#为什么要编解码？" class="headerlink" title="为什么要编解码？"></a>为什么要编解码？</h3><p>总的来说，编码是为了<strong>多快好省</strong>，这里的编码广义的来说就是压缩编码，用更合理的方式去除冗余信息，将物理设备采集的音视频数据进行压缩，做到又高清体积又小（当然，这两这必须找到平衡点），这样存储占的体积小，传输起来快，岂不就是多快好省。</p>
<blockquote>
<p>我们知道，在计算机的世界中，一切都是0和1组成的，音频和视频数据也不例外。由于音视频的数据量庞大，如果按照裸流数据存储的话，那将需要耗费非常大的存储空间，也不利于传送。而音视频中，其实包含了大量0和1的重复数据，因此可以通过一定的算法来压缩这些0和1的数据。</p>
<p>特别在视频中，由于画面是逐渐过渡的，因此整个视频中，包含了大量画面/像素的重复，这正好提供了非常大的压缩空间。</p>
<p>因此，编码可以大大减小音视频数据的大小，让音视频更容易存储和传送。</p>
</blockquote>
<p>mp4、rmvb、avi、mkv、mov…些我们熟悉的视频格式，其实是包裹了音视频编码数据的容器，用来把以特定编码标准编码的视频流和音频流混在一起，成为一个文件。</p>
<p>例如：mp4支持H264、H265等视频编码和AAC、MP3等音频编码</p>
<p>编码和解码其实是两个相对来说互逆的过程，其实本质上我们用电子产品处理数据都是在做编解码。</p>
<p>下面就来梳理一下如何实现编解码</p>
<h2 id="音视频编解码-MediaCodec-和-FFmpeg"><a href="#音视频编解码-MediaCodec-和-FFmpeg" class="headerlink" title="音视频编解码 MediaCodec 和 FFmpeg"></a>音视频编解码 MediaCodec 和 FFmpeg</h2><h3 id="MediaCodec-硬解码"><a href="#MediaCodec-硬解码" class="headerlink" title="MediaCodec(硬解码)"></a>MediaCodec(硬解码)</h3><p>视频编解码，首先要提到的就是官方提供的 MediaCodec。</p>
<p>MediaCodec是一个Codec，通过硬件加速解码和编码。它为芯片厂商和应用开发者搭建了一个统一接口。MediaCodec几乎是所有安卓播放器硬解的标配。</p>
<img src="/2020/09/15/Android-Multi-Media/mediacodec1.png">

<p>MediaCodec 作为编码器/解码器时数据流向的示意图。</p>
<img src="/2020/09/15/Android-Multi-Media/mediacodec2.image">

<p>MediaCodec 的状态图。</p>
<p>MediaCodec有两种工作模式，分别为异步模式和同步模式。具体使用方式可以参考</p>
<ol>
<li><strong><a target="_blank" rel="noopener" href="https://juejin.im/post/5d89fa02518825095879d5b6">音视频硬解码流程：封装基础解码框架</a></strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://juejin.im/post/5d9c69b351882539ee4b0eea">音视频播放：音视频同步</a>。</strong></li>
</ol>
<p>通过同步解码的方式，对 API 的使用做了非常详细的介绍。</p>
<h4 id="MediaExtractor"><a href="#MediaExtractor" class="headerlink" title="MediaExtractor"></a>MediaExtractor</h4><p>总结来说，就是使用 MediaExtractor 获取视频、音频的各类信息，结合上面两幅图的状态不断读取数据然后通过 SurfaceView 进行显示。</p>
<h4 id="MediaMuxer"><a href="#MediaMuxer" class="headerlink" title="MediaMuxer"></a>MediaMuxer</h4><p>MediaMuxer 和 MediaExtractor 可以说两个功能刚好对立的工具，MediaExtractor 负责对视频资源进行解封装，以获取音视频资源的各类参数信息，MediaMuxer 则是将现有的音视频数据通过各类配置再次打包成为一个音视频文件的过程。</p>
<p>具体实现可以参考 <strong><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903966535319560">音视频解封和封装：生成一个MP4</a></strong></p>
<h3 id="FFmpeg-软解码"><a href="#FFmpeg-软解码" class="headerlink" title="FFmpeg (软解码)"></a>FFmpeg (软解码)</h3><p><strong>这里的软解码只是相对于其自身的解码实现来说,他本身是使用 CPU 的能力来编解码</strong>，但是我们也可以通过其他方式让 ffmpeg 间接的使用 GPU 进行硬解码。当然，编解码只是其一部分功能。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/FFmpeg/FFmpeg">FFmpeg GitHub 仓库</a> 官方介绍</p>
<blockquote>
<p>FFmpeg is a collection of libraries and tools to process multimedia content such as audio, video, subtitles and related metadata.</p>
</blockquote>
<h3 id="FFmpeg-使用"><a href="#FFmpeg-使用" class="headerlink" title="FFmpeg 使用"></a>FFmpeg 使用</h3><p>从 FFmpeg 的定位就可以看到，ffmpeg 可以做很多事情，非常的灵活，可以自由定制。对外使用提供了强大的接口或者是命令行工具，这也是使得其学习成本非常的陡峭，需要耗费大量的时间去实践和了解具体的细节。关于 ffmpeg 的具体我们可以学习按照自己的需求去编译 ffmpeg 的本库库和共享库的代码之后集成到项目中去，也可以了解一些第三方在此基础上的一些框架之类的。这里简单列一些可以拓展的方向。</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://juejin.cn/user/3175045310197255/post">FFmpeg 自己编译、NDK 到视频编解码最佳实践</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/search?q=ffmpeg">GitHub FFmpge 关键结果</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/FFmpeg/FFmpeg">FFmpeg Official</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/xufuji456/FFmpegAndroid">FFmpegAndroid</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/lipangit/JiaoZiVideoPlayer">JiaoZiVideoPlayer</a></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/bilibili/ijkplayer">B站开源的基于 ffmpeg 的 ijkplayer 播放器</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/google/ExoPlayer">Google 官方的 exoplayer</a></p>
</li>
</ul>
<h3 id="MediaCodec-VS-FFmpeg"><a href="#MediaCodec-VS-FFmpeg" class="headerlink" title="MediaCodec VS FFmpeg"></a>MediaCodec VS FFmpeg</h3><blockquote>
<p><strong>FFmpeg</strong>：FFmpeg本质上可以看做是媒体处理工具的集合，包含了很多的媒体文件处理工具，例如媒体文件格式解析工具、编解码器等，这些工具实际上就是一个个的库，而FFmpeg的命令行程序实际上就是对这些库的一种包装，在调用命令行程序时也是通过底下的这些库来完成操作。这些库有的是编译时可选的，而且FFmpeg也支持一些外部的库，例如x264、MediaCodec。FFmpeg由于提供了很多的编解码器，而且它的媒体操作也很丰富，所以可以支持非常多的媒体类型，同时很多的处理功能也已经由FFmpeg提供，使用者只需要去调用即可，所以不少的编辑处理功能可以相对简单地完成开发。缺点就是如果通过其自带的软编解码来完成移动端上的任务的话效率会比较低。</p>
</blockquote>
<blockquote>
<p><strong>MediaCodec</strong>：MediaCodec提供的功能就相对单一，它基本上只用来完成编解码相关的功能。以整个视频转码流程举例，大致需要几个步骤：解封装-&gt;解码-&gt;滤镜处理等操作-&gt;编码-&gt;封装，MediaCodec只提供编解码功能，而其它的功能则需要其它组件，如MediaExtractor以及MediaMuxer来完成。但是MediaCodec在编解码时提供硬件编解码功能，其好处是非常明显的，效率很高，且CPU占用大幅降低。说实话如果不使用硬件编解码的话，很多的转码过程的时长实在长得是令人无法忍受，放到APP上简直就是无法使用的功能。毕竟一段很短的视频，转码要好几分钟，发烫还严重，体验肯定是不行的。MediaCodec的缺点就是一定程度上会依赖于设备，由于MediaCodec的硬解码实际上是由厂商所提供的，同时安卓设备的硬件相互之间差异很大，所以在硬解码实现上自然也有所差别，就导致了一样的程序，一些设备上可以正常跑，而在另一些设备上则可能会出问题，此时就需要自行提供兼容性上的支持。</p>
</blockquote>
<p>作一个简单的比喻：FFmpeg就像一个工具箱，而MediaCodec就像一类功能强大，但是使用范围相对受限且不够灵活的工具。</p>
<p>有几个需要注意的点：<br>1.FFmpeg也有对MediaCodec的支持，在编译出合适的库后，可以通过FFmpeg的api来调用MediaCodec，但只能使用解码功能。<br>2.MediaCodec并非只代表硬编解码，它事实上可以看做是一种服务，厂商将自己的编解码方案预先注册于服务中，而用户在需要时再通过服务去调用相应的编解码器来完成任务。MediaCodec支持硬件编解码以及软件编解码，可以自行选择需要使用的编解码器。<br>3.FFmpeg在使用MediaCodec时，使用的方式和JAVA调用是类似的，FFmpeg会通过JNI的callXXmethod去调用MediaCodec的方法，这个过程其实和JAVA中的调用没有区别，但是FFmpeg通过封装MediaCodec的操作，使得MediaCodec可以按照FFmpeg的编解码流程进行调用。</p>
<p><strong>结合上面的对比，可以简单的认为 ffmepg 可以在兼顾效率的同时实现比较好的兼容性。同时由于 Android 在国内变成了安卓，各类厂商对解码器的魔改等因素导致 MediaCodec 可能无法做到很稳定。因此，实现一套非常完美的播放器是一个工业级的项目，在使用了这些已有方案踩过坑之后，结合使用经验再去实现一套自己的播放器才是有可能的</strong>，所以说，基础很重要啊。</p>
<h2 id="OpenGL"><a href="#OpenGL" class="headerlink" title="OpenGL"></a>OpenGL</h2><p>说到音视频开发，就不得不了解一下 OpenGL，对于移动端来说就是 OpenGL ES。 </p>
<blockquote>
<p>OpenGL（Open Graphics Library）则是间接操作GPU的工具，是一组定义好的跨平台和跨语言的图形API，是可用于2D和3D画面渲染的底层图形库，是由各个硬件厂家具体实现的编程接口</p>
</blockquote>
<blockquote>
<p>OpenGL ES 全称：OpenGL for Embedded Systems，是OpenGL 的子集，是针对手机 PAD等小型设备设计的，删减了不必须的方法、数据类型、功能，减少了体积，优化了效率。</p>
</blockquote>
<h3 id="OpenGL-ES"><a href="#OpenGL-ES" class="headerlink" title="OpenGL ES"></a>OpenGL ES</h3><p>OpenGL 整体来说还是有一定的学习曲线，有很多新的概念需要去理解和掌握，有些还是比较抽象的。</p>
<ul>
<li>OpenGL ES 坐标系</li>
<li>OpenGL 着色器语言 GLSL <ul>
<li>顶点着色器</li>
<li>片元着色器</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/junzia/article/details/52830604">着色器语言</a></li>
</ul>
</li>
</ul>
<h3 id="Android-中-OpenGL-ES-渲染流程"><a href="#Android-中-OpenGL-ES-渲染流程" class="headerlink" title="Android 中 OpenGL ES 渲染流程"></a>Android 中 OpenGL ES 渲染流程</h3><p>在Android中，OpenGL通常配合GLSurfaceView使用，在GLSurfraceView中，Google已经封装好了渲染的基础流程。</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903975267860494">Android OpenGL ES 最佳实践</a></p>
<h3 id="OpenGL-ES-可以做什么？"><a href="#OpenGL-ES-可以做什么？" class="headerlink" title="OpenGL ES 可以做什么？"></a>OpenGL ES 可以做什么？</h3><ul>
<li>滤镜<br>回归到本质，视频就是一帧帧的图片，因此使用 OpenGL 可以实现滤镜。</li>
<li>透明视频<br>视频本身不透明的，但是我们可以通过 OpenGL 将两个视频叠加在一起渲染，实现视频叠加的效果，也可以认为是画中画的效果。</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><img src="/2020/09/15/Android-Multi-Media/all.image">

<p><em>图源自水印</em></p>
<p>上图对音视频开发中的几个重要模块做了很好的划分。总体来说，编码器、解码器是永恒的话题。但凡涉及对视频的再次操作，都会涉及得到编解码的操作。而这里就看选择用什么方式实现了，MediaCodec 和 FFmpeg 都有各自的优缺点，需要我们根据实际的业务选择合适的技术方案。</p>
<p>OpenGL 就是用来对视频数据进行各类差异化的操作，比如滤镜、水印等。其实可以理解为对 view 进行动画。当然，其中要考虑的细节就特别多了，更是有很多新的概念和抽象的思考，需要我们去探索。比如着色器、比如坐标变换、内容投影等非常复杂的概念。</p>
<p>好了，以上就是对音视频相关内容的一个大概梳理。当然只是现阶段的认知和思考，后面如果有了新的了解，可以再次更新现在的一些观点。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Im-Victor/p/9760629.html">Android中播放音乐的几种方式</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/android/media-samples">Google 官方音视频样例 GitHub 仓库</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://juejin.im/post/5d89fa02518825095879d5b6">音视频硬解码流程：封装基础解码框架</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://juejin.im/post/5d9c69b351882539ee4b0eea">音视频播放：音视频同步</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903966535319560">音视频解封和封装：生成一个MP4</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903975267860494">Android OpenGL ES 最佳实践</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/FFmpeg/FFmpeg">FFmpeg GitHub 仓库</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/xufuji456/FFmpegAndroid">FFmpegAndroid</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/lipangit/JiaoZiVideoPlayer">JiaoZiVideoPlayer</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/bilibili/ijkplayer">B站开源的基于 ffmpeg 的 ijkplayer 播放器</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/google/ExoPlayer">Google 官方的 exoplayer</a></p>
</li>
</ul>

    </div>

    
    
    
        <div class="reward-container">
  <div>加个鸡腿呗.</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.jpg" alt="九尾灵狐 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="九尾灵狐 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/" rel="tag"># 音视频</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/07/28/%E6%96%87%E4%BB%B6%E5%8A%A0%E5%AF%86%E8%AF%BB%E5%86%99/" rel="prev" title="文件编解码及加密读写">
      <i class="fa fa-chevron-left"></i> 文件编解码及加密读写
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/12/28/%E4%BA%8C%E8%BF%9B%E5%88%B6/" rel="next" title="二进制">
      二进制 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%A6%82%E5%BF%B5%E7%9B%B8%E5%85%B3"><span class="nav-number">1.</span> <span class="nav-text">基础知识概念相关</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8-Android-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%92%AD%E6%94%BE%E4%B8%80%E4%B8%AA%E9%9F%B3%E9%A2%91-%E8%A7%86%E9%A2%91"><span class="nav-number">2.</span> <span class="nav-text">在 Android 中如何播放一个音频&#x2F;视频</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9F%B3%E9%A2%91%E6%92%AD%E6%94%BE"><span class="nav-number">2.1.</span> <span class="nav-text">音频播放</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MediaPlayer"><span class="nav-number">2.1.1.</span> <span class="nav-text">MediaPlayer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SoundPool"><span class="nav-number">2.1.2.</span> <span class="nav-text">SoundPool</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AudioTrack"><span class="nav-number">2.1.3.</span> <span class="nav-text">AudioTrack</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91"><span class="nav-number">2.2.</span> <span class="nav-text">播放视频</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#VideoView"><span class="nav-number">2.2.1.</span> <span class="nav-text">VideoView</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MediaPlayer-SurfaceView"><span class="nav-number">2.2.2.</span> <span class="nav-text">MediaPlayer + SurfaceView</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E5%95%A5%E8%BF%98%E8%A6%81%E4%BA%86%E8%A7%A3%E9%9F%B3%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81%EF%BC%9F"><span class="nav-number">3.</span> <span class="nav-text">为啥还要了解音视频编解码？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%BC%96%E8%A7%A3%E7%A0%81%EF%BC%9F"><span class="nav-number">3.1.</span> <span class="nav-text">为什么要编解码？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9F%B3%E8%A7%86%E9%A2%91%E7%BC%96%E8%A7%A3%E7%A0%81-MediaCodec-%E5%92%8C-FFmpeg"><span class="nav-number">4.</span> <span class="nav-text">音视频编解码 MediaCodec 和 FFmpeg</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MediaCodec-%E7%A1%AC%E8%A7%A3%E7%A0%81"><span class="nav-number">4.1.</span> <span class="nav-text">MediaCodec(硬解码)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MediaExtractor"><span class="nav-number">4.1.1.</span> <span class="nav-text">MediaExtractor</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MediaMuxer"><span class="nav-number">4.1.2.</span> <span class="nav-text">MediaMuxer</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FFmpeg-%E8%BD%AF%E8%A7%A3%E7%A0%81"><span class="nav-number">4.2.</span> <span class="nav-text">FFmpeg (软解码)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FFmpeg-%E4%BD%BF%E7%94%A8"><span class="nav-number">4.3.</span> <span class="nav-text">FFmpeg 使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MediaCodec-VS-FFmpeg"><span class="nav-number">4.4.</span> <span class="nav-text">MediaCodec VS FFmpeg</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenGL"><span class="nav-number">5.</span> <span class="nav-text">OpenGL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OpenGL-ES"><span class="nav-number">5.1.</span> <span class="nav-text">OpenGL ES</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Android-%E4%B8%AD-OpenGL-ES-%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B"><span class="nav-number">5.2.</span> <span class="nav-text">Android 中 OpenGL ES 渲染流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OpenGL-ES-%E5%8F%AF%E4%BB%A5%E5%81%9A%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="nav-number">5.3.</span> <span class="nav-text">OpenGL ES 可以做什么？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">6.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">7.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="九尾灵狐"
      src="/uploads/avatar.jpg">
  <p class="site-author-name" itemprop="name">九尾灵狐</p>
  <div class="site-description" itemprop="description">人生不止眼前的苟且，还有诗与远方和田野</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">85</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">59</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/REBOOTERS" title="GitHub → https://github.com/REBOOTERS" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yingkongshi11@gmail.com" title="E-Mail → mailto:yingkongshi11@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">九尾灵狐</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">591k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">8:57</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
