[{"title":"ARouter API ç®€å•åˆ†æ","url":"%2F2019%2F07%2F20%2FARouter-API-%E5%88%86%E6%9E%90%2F","content":"\n<img src=\"ARouter-API-åˆ†æ/contruct.png\" width=40%>\n\n## å‰è¨€\n\nARouter ä½¿ç”¨å·²ä¹…ï¼Œåœ¨ç»„ä»¶åŒ–ä¸­éå¸¸æœ‰ç”¨ï¼Œæ—¢è§£å†³äº†é¡µé¢è·³è½¬çš„é—®é¢˜ï¼ŒåŒæ—¶è¿˜è§£å†³äº†åŒç­‰çº§ç»„ä»¶ä¹‹é—´çš„ä¾èµ–é—®é¢˜ã€‚è¿™é‡Œç»“åˆæºç åˆ†æä¸€ä¸‹å…¶æ ¸å¿ƒå®ç°é€»è¾‘ï¼Œæœ¬èŠ‚ä¸»è¦åˆ†æå…¶ API çš„å®ç°ã€‚åŒæ—¶ç»“åˆä¹‹å‰[ä¸€ä¸ªç®€å•çš„è·¯ç”±](https://rebooters.github.io/2019/06/22/%E4%B8%80%E4%B8%AA%E8%B7%AF%E7%94%B1%E7%9A%84%E8%AF%9E%E7%94%9F/) ä¸­æˆ‘ä»¬å¯¹è·¯ç”±çš„æ€è€ƒæ¥çœ‹çœ‹ ARouter æ˜¯æ€ä¹ˆåšçš„ã€‚\n\n<!--more-->\n\n\n\n## åŸºæœ¬åŠŸèƒ½\n\nå¯¹äº ARouter æ¥è¯´ï¼Œå…¶æœ€åŸºæœ¬çš„ç”¨æ³•ä¾¿æ˜¯å…¶**åˆå§‹åŒ–**å’Œåˆçº§ **navigation** çš„ä½¿ç”¨ã€‚è¿™é‡Œå°±ä» init å’Œ navigation çš„åŸºæœ¬ç”¨æ³•å‡ºå‘ï¼Œçœ‹çœ‹å…¶ä¸­çš„å¥¥ç§˜ã€‚\n\n*åŸºäº [ARouter GitHub æºç ](https://github.com/alibaba/ARouter) arouter-api 1.5.0 ç‰ˆæœ¬åˆ†æ*\n\n\n### init \n\nARouter ä½¿ç”¨äº†é—¨é¢æ¨¡å¼ï¼ŒçœŸæ­£çš„å®ç°éƒ½åœ¨ _ARoutre é‡Œã€‚å…¶åˆå§‹åŒ–çš„æ–¹æ³•è°ƒç”¨é“¾å¦‚ä¸‹\n\n<img src=\"ARouter-API-åˆ†æ/init.png\" width=70%>\n\næ ¸å¿ƒé€»è¾‘åœ¨ LogisticsCenter.init(mContext, executor) ä¸­\n\nexecutor æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„çº¿ç¨‹æ± ï¼Œå…³äºå¦‚ä½•ä½¿ç”¨ ThreadPoolExecutor æ„å»ºçº¿ç¨‹æ± ï¼Œäº†è§£è¿‡ AsyncTask çš„åŒå­¦ä¸€å®šä¸é™Œç”Ÿï¼Œè€ç”Ÿå¸¸è°ˆäº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚\n\n<details>\n\n<summary>\nThreadPoolExecutor executor = DefaultPoolExecutor.getInstance();\n</summary>\n\n\n```java\npublic class DefaultPoolExecutor extends ThreadPoolExecutor {\n    //    Thread args\n    private static final int CPU_COUNT = Runtime.getRuntime().availableProcessors();\n    private static final int INIT_THREAD_COUNT = CPU_COUNT + 1;\n    private static final int MAX_THREAD_COUNT = INIT_THREAD_COUNT;\n    private static final long SURPLUS_THREAD_LIFE = 30L;\n\n    private static volatile DefaultPoolExecutor instance;\n\n    public static DefaultPoolExecutor getInstance() {\n        if (null == instance) {\n            synchronized (DefaultPoolExecutor.class) {\n                if (null == instance) {\n                    instance = new DefaultPoolExecutor(\n                            INIT_THREAD_COUNT,\n                            MAX_THREAD_COUNT,\n                            SURPLUS_THREAD_LIFE,\n                            TimeUnit.SECONDS,\n                            new ArrayBlockingQueue<Runnable>(64),\n                            new DefaultThreadFactory());\n                }\n            }\n        }\n        return instance;\n    }\n}\n```\n</details>\n\n#### LogisticsCenter.init\n\n<details>\n<summary>\ninit \n</summary>\n\n\n```java\npublic synchronized static void init(Context context, ThreadPoolExecutor tpe) throws HandlerException {\n        mContext = context;\n        executor = tpe;\n\n        try {\n            long startInit = System.currentTimeMillis();\n            //billy.qi modified at 2017-12-06\n            //load by plugin first\n            loadRouterMap();\n            if (registerByPlugin) {\n                logger.info(TAG, \"Load router map by arouter-auto-register plugin.\");\n            } else {\n                Set<String> routerMap;\n\n                // It will rebuild router map every times when debuggable.\n                if (ARouter.debuggable() || PackageUtils.isNewVersion(context)) {\n                    logger.info(TAG, \"Run with debug mode or new install, rebuild router map.\");\n                    // These class was generated by arouter-compiler.\n                    routerMap = ClassUtils.getFileNameByPackageName(mContext, ROUTE_ROOT_PAKCAGE);\n                    if (!routerMap.isEmpty()) {\n                        context.getSharedPreferences(AROUTER_SP_CACHE_KEY, Context.MODE_PRIVATE).edit().putStringSet(AROUTER_SP_KEY_MAP, routerMap).apply();\n                    }\n\n                    PackageUtils.updateVersion(context);    // Save new version name when router map update finishes.\n                } else {\n                    logger.info(TAG, \"Load router map from cache.\");\n                    routerMap = new HashSet<>(context.getSharedPreferences(AROUTER_SP_CACHE_KEY, Context.MODE_PRIVATE).getStringSet(AROUTER_SP_KEY_MAP, new HashSet<String>()));\n                }\n\n                logger.info(TAG, \"Find router map finished, map size = \" + routerMap.size() + \", cost \" + (System.currentTimeMillis() - startInit) + \" ms.\");\n                startInit = System.currentTimeMillis();\n\n                for (String className : routerMap) {\n                    if (className.startsWith(ROUTE_ROOT_PAKCAGE + DOT + SDK_NAME + SEPARATOR + SUFFIX_ROOT)) {\n                        // This one of root elements, load root.\n                        ((IRouteRoot) (Class.forName(className).getConstructor().newInstance())).loadInto(Warehouse.groupsIndex);\n                    } else if (className.startsWith(ROUTE_ROOT_PAKCAGE + DOT + SDK_NAME + SEPARATOR + SUFFIX_INTERCEPTORS)) {\n                        // Load interceptorMeta\n                        ((IInterceptorGroup) (Class.forName(className).getConstructor().newInstance())).loadInto(Warehouse.interceptorsIndex);\n                    } else if (className.startsWith(ROUTE_ROOT_PAKCAGE + DOT + SDK_NAME + SEPARATOR + SUFFIX_PROVIDERS)) {\n                        // Load providerIndex\n                        ((IProviderGroup) (Class.forName(className).getConstructor().newInstance())).loadInto(Warehouse.providersIndex);\n                    }\n                }\n            }\n\n            logger.info(TAG, \"Load root element finished, cost \" + (System.currentTimeMillis() - startInit) + \" ms.\");\n\n            if (Warehouse.groupsIndex.size() == 0) {\n                logger.error(TAG, \"No mapping files were found, check your configuration please!\");\n            }\n\n            if (ARouter.debuggable()) {\n                logger.debug(TAG, String.format(Locale.getDefault(), \"LogisticsCenter has already been loaded, GroupIndex[%d], InterceptorIndex[%d], ProviderIndex[%d]\", Warehouse.groupsIndex.size(), Warehouse.interceptorsIndex.size(), Warehouse.providersIndex.size()));\n            }\n        } catch (Exception e) {\n            throw new HandlerException(TAG + \"ARouter init logistics center exception! [\" + e.getMessage() + \"]\");\n        }\n    }\n```\n</details>\n\nåœ¨ init æ–¹æ³•ä¸­ï¼Œä¼˜å…ˆä¼šè°ƒç”¨ loadRouterMap ,åœ¨è¿™é‡Œä¼šç”± arouter-auto-register æ’ä»¶åœ¨ç¼–è¯‘æœŸæ’å…¥çš„ä»£ç è‡ªåŠ¨æ³¨å†Œè·¯ç”±è¡¨,è¿™æ · registerByPlugin = true ï¼Œä¸Šè¿°ä»£ç ä¸­æ•´ä¸ª else åˆ†æ”¯å°±ä¸ä¼šæ‰§è¡Œäº†ã€‚ç°åœ¨å‡è®¾æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ arouter-auto-register æ’ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œä¸‹é¢çš„åŠ è½½é€»è¾‘äº†ã€‚æ•´ä¸ªåŠ è½½é€»è¾‘å¾ˆç®€å•ï¼Œåœ¨ debug æ¨¡å¼æˆ–è€…æ˜¯ç‰ˆæœ¬æ›´æ–°çš„æƒ…å†µä¸‹ï¼Œä¼šæ¯æ¬¡é‡æ–°åŠ è½½ä¸€ä»½æ–°çš„ class ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¿å­˜åœ¨ä¸€ä¸ª map ä¸­ï¼›å¹¶æŠŠè¿™ä»½ä¿¡æ¯ç”¨ sp ç›´æ¥å­˜èµ·æ¥ï¼ˆæ„Ÿè§‰æœ‰ç‚¹ç²—æš´ï¼‰ï¼›å¦åˆ™çš„è¯å°±æ¯æ¬¡ä» sp é‡Œè¯»å–ç±»çš„ä¿¡æ¯ã€‚å…³é”®æ–¹æ³•å°±æ˜¯\n\n```java\nrouterMap = ClassUtils.getFileNameByPackageName(mContext, ROUTE_ROOT_PAKCAGE);\n```\nè¿™ä¸ª ClassUtils å¾ˆæœ‰æ„æ€,æ˜¯ç›´æ¥ä» galaxy çš„ SDK copy çš„ ğŸ¶ğŸ¶ã€‚\n\n```java\npackage com.alibaba.android.arouter.utils;\n\n// Copy from galaxy sdk ${com.alibaba.android.galaxy.utils.ClassUtils}\n\npublic class ClassUtils {\n}\n```\n>è¿™é‡Œ **getFileNameByPackageName()** è¿™ä¸ªæ–¹æ³•é¡¾åæ€ä¹‰å°±æ˜¯æŒ‰æŒ‰ç…§åŒ…åè·å–æ–‡ä»¶åã€‚ è¿™ä¸ªå®ç°å…¶å®å¾ˆæœ‰æ„æ€ï¼Œä»–æ˜¯**ç›´æ¥ä» dex æ–‡ä»¶è·å– class åç§°çš„ï¼Œè¿™é‡Œç»†èŠ‚å¾ˆç®€å•å°±ä¸å±•å¼€äº†,å¯ä»¥å‚è€ƒ[æºç  ClassUtils](https://github.com/alibaba/ARouter/blob/master/arouter-api/src/main/java/com/alibaba/android/arouter/utils/ClassUtils.java) ã€‚DexFile ç±»å·²ç» Deprecated äº†ï¼Œä½†æ˜¯ä¾æ—§å¯ä»¥äº†è§£ä¸€ä¸‹ï¼Œåœ¨è¿è¡Œæ—¶å¦‚ä½•è¯»è·å– apk åœ¨æ‰‹æœºä¸Šçš„ä½ç½®ï¼Œä»¥åŠå¦‚ä½•å»è·å– dex**.\n\nè¿™é‡Œçš„ ROUTE_ROOT_PAKCAGE=â€œcom.alibaba.android.arouter.routesâ€ï¼Œæœ€ç»ˆè·å–çš„ç»“æœå¦‚ä¸‹ï¼š\n\n<img src=\"ARouter-API-åˆ†æ/routeMap.png\" width=70%>\n\nå…¶å®å°±æ˜¯è·å–äº†æ‰€æœ‰ç”±æ³¨è§£ç”Ÿæˆå™¨ç”Ÿæˆçš„ class ï¼Œå› ä¸ºè¿™äº› class åŒ…å«äº†æ‰€æœ‰çš„è·¯ç”±ä¿¡æ¯ã€‚\n\næœ€åæ ¹æ®å®Œæ•´ç±»åï¼Œå¯¹æ‰€æœ‰ class ç®€å•åšäº†ä¸€ä¸‹å½’ç±»ã€‚\n\n```java\n                for (String className : routerMap) {\n                    if (className.startsWith(ROUTE_ROOT_PAKCAGE + DOT + SDK_NAME + SEPARATOR + SUFFIX_ROOT)) {\n                        // This one of root elements, load root.\n                        ((IRouteRoot) (Class.forName(className).getConstructor().newInstance())).loadInto(Warehouse.groupsIndex);\n                    } \n                    ...else condition...\n                }\n```\nå½’ç±»ä¿¡æ¯ï¼Œå­˜å‚¨åœ¨äº† WareHouse ä¸­ã€‚**å¯ä»¥å†å›é¡¾ä¸€ä¸‹ä¸Šå›¾ä¸­ç”Ÿæˆçš„ class ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ªç±»çš„ classname ä¸­ï¼Œ com.alibaba.android.arouter.routes.$$.xxx ,åœ¨ $$ ç¬¦åé¢æœ‰å››ç±» packagenameï¼ŒåŒ…æ‹¬ Groupï¼ŒRoot,Interceptors å’Œ Providersã€‚è¿™äº›ç±»ä¹‹é—´çš„å…³ç³»ï¼Œç®€å•æ¥è¯´ï¼Œ Group æ˜¯ Root,Interceptors , Providers çš„å­é›†ã€‚**\n\n<details>\n\n<summary>WareHouse</summary>\n\n```java\n\nclass Warehouse {\n    // Cache route and metas\n    static Map<String, Class<? extends IRouteGroup>> groupsIndex = new HashMap<>();\n    static Map<String, RouteMeta> routes = new HashMap<>();\n\n    // Cache provider\n    static Map<Class, IProvider> providers = new HashMap<>();\n    static Map<String, RouteMeta> providersIndex = new HashMap<>();\n\n    // Cache interceptor\n    static Map<Integer, Class<? extends IInterceptor>> interceptorsIndex = new UniqueKeyTreeMap<>(\"More than one interceptors use same priority [%s]\");\n    static List<IInterceptor> interceptors = new ArrayList<>();\n\n    static void clear() {\n        routes.clear();\n        groupsIndex.clear();\n        providers.clear();\n        providersIndex.clear();\n        interceptors.clear();\n        interceptorsIndex.clear();\n    }\n}\n\n```\n\n</details>\n\nå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„å±æ€§åŠæ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼Œä½ å¯ä»¥è®¤ä¸º WareHouse å°±æ˜¯ä¸€ä¸ªè¿è¡ŒæœŸçš„å…¨å±€ä»“åº“ï¼Œå­˜å‚¨äº†æ‰€æœ‰è·¯ç”±ç›¸å…³çš„ä¿¡æ¯ã€‚\n\n<img src=\"ARouter-API-åˆ†æ/groupsIndex.png\" >\n\n**è¿™é‡Œä»¥ groupsIndex ä¸ºä¾‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œåªæ˜¯åˆ›å»ºäº† IRouteRoot è¿™ä¸ªæ¥å£çš„å®ç°ç±»çš„å®ä¾‹ï¼Œå¹¶æ·»åŠ åˆ°äº†ç›¸åº”çš„é›†åˆä¸­ã€‚ä½†æ˜¯ Group è¿™ä¸ªç±»å¹¶æ²¡æœ‰è¢«å®ä¾‹è¯ï¼Œè¿™æ ·è¿™ä¸ªæ¥å£çš„ loadInto æ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ ARouter åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šåˆå§‹åŒ–æ‰€æœ‰çš„è·¯ç”±è¡¨ä¸­ç”Ÿæˆçš„ classã€‚å¦‚ä¸Šå›¾ WareHouse ä¸­ç°åœ¨å­˜çš„éƒ½æ˜¯ä¸€äº›*è™šæ‹Ÿç»„*ï¼ŒçœŸæ­£çš„ RouteMate è¿˜æ²¡æœ‰è¢«æ·»åŠ  WareHouse ä¸­ã€‚**\n\n<details>\n\n<summary> ä¸¾ä¸ªä¾‹å­ </summary>\n\nIRouteRoot çš„æŸä¸€ä¸ªå®ç°ç±»\n\n```java\npublic class ARouter$$Root$$app implements IRouteRoot {\n  @Override\n  public void loadInto(Map<String, Class<? extends IRouteGroup>> routes) {\n    routes.put(\"test\", ARouter$$Group$$test.class);\n    routes.put(\"yourservicegroupname\", ARouter$$Group$$yourservicegroupname.class);\n  }\n}\n```\nARouter$$Group$$test.class\n\n```java\npublic class ARouter$$Group$$test implements IRouteGroup {\n  @Override\n  public void loadInto(Map<String, RouteMeta> atlas) {\n    atlas.put(\"/test/activity1\", RouteMeta.build(RouteType.ACTIVITY, Test1Activity.class, \"/test/activity1\", \"test\", new java.util.HashMap<String, Integer>(){{put(\"ser\", 9); put(\"ch\", 5); put(\"fl\", 6); put(\"dou\", 7); put(\"boy\", 0); put(\"url\", 8); put(\"pac\", 10); put(\"obj\", 11); put(\"name\", 8); put(\"objList\", 11); put(\"map\", 11); put(\"age\", 3); put(\"height\", 3); }}, -1, -2147483648));\n    atlas.put(\"/test/activity2\", RouteMeta.build(RouteType.ACTIVITY, Test2Activity.class, \"/test/activity2\", \"test\", new java.util.HashMap<String, Integer>(){{put(\"key1\", 8); }}, -1, -2147483648));\n    atlas.put(\"/test/activity3\", RouteMeta.build(RouteType.ACTIVITY, Test3Activity.class, \"/test/activity3\", \"test\", new java.util.HashMap<String, Integer>(){{put(\"name\", 8); put(\"boy\", 0); put(\"age\", 3); }}, -1, -2147483648));\n    atlas.put(\"/test/activity4\", RouteMeta.build(RouteType.ACTIVITY, Test4Activity.class, \"/test/activity4\", \"test\", null, -1, -2147483648));\n    atlas.put(\"/test/fragment\", RouteMeta.build(RouteType.FRAGMENT, BlankFragment.class, \"/test/fragment\", \"test\", null, -1, -2147483648));\n    atlas.put(\"/test/webview\", RouteMeta.build(RouteType.ACTIVITY, TestWebview.class, \"/test/webview\", \"test\", null, -1, -2147483648));\n  }\n}\n```\n</details>\n\n**å±•å¼€ä¸Šè¿°ä»£ç ï¼Œç»“åˆä¸Šé¢æ‰€å™è¿°çš„å†…å®¹ã€‚ç»è¿‡ init å½’ç±»ä¹‹åï¼ŒIRouteRoot çš„æŸä¸€ä¸ªå®ç°ç±»ï¼ˆå®é™…æƒ…å†µå¯èƒ½æœ‰å¤šä¸ªï¼Œæ˜¯ç”±æ³¨è§£å†³å®šçš„ï¼‰ARouter$$Root$$app è¢«æ·»åŠ åˆ°äº† WareHouse.groupsIndex é›†åˆä¸­ã€‚ä½†æ˜¯ ARouter$$Root$$app å†…éƒ¨æ‰¿è½½ç€å¦ä¸€ä¸ªé›†åˆï¼Œè¿™ä¸ªé›†åˆæ‰æ˜¯æœ€é‡è¦çš„ï¼ŒåŒ…å«æ‰€æœ‰çš„ path å’Œ RouteMate ä¿¡æ¯ï¼Œä½†æ˜¯è¿™äº›ä¿¡æ¯å¹¶æ²¡æœ‰è¢«åŠ è½½ã€‚**\n\n#### å¦‚ä½•æŠŠæ‰€æœ‰å…ƒç´ éƒ½æ”¾åˆ°ä¸€ä¸ªé›†åˆé‡Œ ï¼Ÿ\n\n>å…³äºè¿™é‡Œçš„ä»£ç ï¼Œè¿˜æœ‰ä¸€ä¸ªæœ‰æ„æ€çš„ç‚¹ï¼Œå°±æ˜¯å¦‚ä½•å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ã€‚\n\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¾€é›†åˆé‡Œæ·»åŠ å…ƒç´ ä¸€èˆ¬éƒ½æ˜¯è¿™ä¹ˆå†™\n\n```java\nlist.add(element)\n\nmap.put(\"key\",\"value\")\n```\nä½†æ˜¯æˆ‘ä»¬çœ‹ä¸Šé¢ class åˆ†ç»„åæ·»åŠ åˆ° WareHouse ä»“åº“ä¸­çš„å†™æ³•å°±å¾ˆæœ‰æ„æ€äº†ï¼Œç®€å•ç¿»è¯‘ä¸€ä¸‹å°±æ˜¯\n\n```java\n// è¿™é‡Œ new IRouteRoot è¡¨è¾¾çš„æ„æ€æ˜¯ IRouteRoot è¿™ä¸ªæ¥å£çš„å®ç°ç±»\n// çš„ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸æ˜¯è¿™ä¸ªæ¥å£æœ¬èº«çš„å®ä¾‹ï¼Œæ¥å£çš„å®ä¾‹æœ¬èº«ä¹Ÿæ²¡æœ‰æ„ä¹‰ã€‚\n\nnew IRouteRoot().loadInto(hashmap) \n```\n\n\nçœ‹ä¸€ä¸‹ IRouteRoot \n\n```java\npublic interface IRouteRoot {\n\n    void loadInto(Map<String, Class<? extends IRouteGroup>> routes);\n}\n```\n\nä»–çš„ä¸€ä¸ªå®ç°ç±» ARouter$$Root$$appï¼ˆæ˜¯ç¼–è¯‘æœŸ APT ç”Ÿæˆçš„ç±»ï¼Œå¯ä»¥æš‚æ—¶å¿½ç•¥ç»†èŠ‚)\n\n<details>\n\n<summary>ARouter$$Root$$app</summary>\n\n```java\npublic class ARouter$$Root$$app implements IRouteRoot {\n  @Override\n  public void loadInto(Map<String, Class<? extends IRouteGroup>> routes) {\n    routes.put(\"test\", ARouter$$Group$$test.class);\n    routes.put(\"yourservicegroupname\", ARouter$$Group$$yourservicegroupname.class);\n  }\n}\n```\n\n</details>\n\nå…¶å®æœ¬è´¨éƒ½æ˜¯ä¸€æ ·ï¼Œå°±æ˜¯æŠŠ IRouteGroup æ·»åŠ åˆ°ä¸€ä¸ª map ä¸­ã€‚è¿™é‡Œå¯ä»¥ç†è§£ä¸ºé€šè¿‡ IRouteRoot æŠŠ**é›†åˆå®¹å™¨**æ³¨å…¥åˆ°å…·ä½“å®ç°ä¸­ï¼Œè¿™é‡Œè¿™ä¹ˆåšæ˜¯å› ä¸ºè¿™ä¸ª map çš„ key æ˜¯è·¯ç”±åˆ†ç»„çš„ç»„åï¼ˆå…³äºè¿™ä¸ªåˆ†ç»„çš„æ¦‚å¿µï¼Œå¯ä»¥å‚è€ƒ ARouter çš„ä½¿ç”¨ï¼‰ï¼Œè¿™ä¸ªç»„åæ˜¯å®šä¹‰åœ¨æ³¨è§£ä¸Šçš„ï¼Œæ˜¯åœ¨ç¼–è¯‘æœŸè·å–çš„ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ç¼–è¯‘æœŸç›´æ¥æŒ‰ç…§ç»„åæŠŠæ‰€æœ‰å…ƒç´ æ·»åŠ åˆ° map ä¸­ ,å°½ç®¡æ­¤æ—¶ map åªæ˜¯ä¸€ä¸ªæ–¹æ³•å‚æ•°ï¼Œå¹¶æ²¡æœ‰çœŸæ­£çš„ map è¢«åˆ›å»ºã€‚ç„¶ååœ¨è¿è¡ŒæœŸæ³¨å…¥è¿™ä¸ª map å®¹å™¨ï¼Œå°±å®Œæˆäº†å¯¹ WareHouse è¿™ä¸ªä»“åº“çš„çœŸæ­£åˆ›å»ºã€‚\n\nå½“ç„¶ï¼Œè¿™é‡Œå®Œå…¨å¯ä»¥ä¸è¿™ä¹ˆåšï¼Œç¼–è¯‘æœŸç”Ÿæˆæ–‡ä»¶æ—¶ï¼Œæ¯ä¸ªæ–‡ä»¶è‡ªå·±åˆ›å»º mapï¼Œ è‡ªå·±å­˜æ•°æ®ï¼Œç„¶åè¿è¡ŒæœŸæŠŠæ‰€æœ‰ map ä¸­çš„æ•°æ®åœ¨ç»Ÿä¸€æ”¶é›†åˆ° WareHouse ä»“åº“ä¸­ç†è®ºä¸Šä¹Ÿæ˜¯å¯ä»¥çš„ã€‚\n\nä¸ªäººæ„Ÿè§‰ï¼Œä½¿ç”¨å®¹å™¨æ³¨å…¥çš„æ–¹å¼å®ç°èµ·æ¥æ›´åŠ çš„å‹å¥½å’Œé«˜æ•ˆã€‚æœ¬è´¨æ¥è¯´ï¼Œç›®æ ‡å°±æ˜¯æŠŠæ‰€æœ‰ç±»ååŠ è½½åˆ°åŒä¸€ä¸ªé›†åˆä¸­ã€‚\n\n##### æ€è€ƒ\n\nå‡è®¾ç°åœ¨éœ€è¦è®¸å¤šåŒç­‰çº§ä¸šåŠ¡ç»„ä»¶æŠŠæŸä¸ªå…ƒç´ ç»Ÿä¸€æ·»åŠ åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼Œä½†æ˜¯è¿™ä¸ªé›†åˆå±äºä¸Šå±‚ä¸šåŠ¡ï¼Œåº•å±‚ä¸šåŠ¡æ— æ³•ç›´æ¥ä¾èµ–æ•´ä¸ªé›†åˆçš„å¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ç›´æ¥ list.add(xxx),å› ä¸º list åœ¨ä¸Šå±‚ï¼Œä¸èƒ½è¢«ä¸‹å±‚åå‘ä¾èµ–ã€‚\n\n```java\npublic final class BusinessGod {\n    private List<String> allBusiness = new ArrayList<>();\n    private BusinessBlue mBusinessBlue;\n    private BusinessGreen mBusinessGreen;\n    private BusinessRed mBusinessRed;\n\n    ........\n}\n```\nå¦‚ä¸Š BusinessGod ä½œä¸ºé¡¶çº§ä¸šåŠ¡ï¼Œä¾èµ–äº† BusinessBlueï¼ŒBusinessGreenï¼ŒBusinessRed è¿™äº›åº•å±‚ä¸šåŠ¡ã€‚ç°åœ¨éœ€è¦æŠŠä¸€äº›æ ¸å¿ƒä¿¡æ¯æ”¶é›†åˆ° allBusiness è¿™ä¸ªé›†åˆä¸­æ—¶ï¼Œç”±äºè¿™ä¸ª å¼•ç”¨æ— æ³•è¢«ä¸‹å±‚ä¾èµ–ï¼Œé‚£ä¹ˆä¸€ç§å¯è¡Œçš„åšæ³•ä¾¿æ˜¯ä¾èµ–æ¥å£ã€‚æˆ‘ä»¬å®šä¹‰æ¥å£\n\n\n```java\npublic interface IContainerInterface<T> {\n\n    void loadInto(List<? super T> list);\n}\n```\nç„¶åè®©æ‰€æœ‰ä¸šåŠ¡å®ç°è¿™ä¸ªæ¥å£å³å¯\n\n<details>\n\n<summary> ç»†èŠ‚</summary>\n\n```java\npublic class BusinessBlue implements IContainerInterface<String>{\n\n    @Override\n    public void loadInto(List<? super String> list) {\n        list.add(\"this is blue\");\n    }\n}\n\npublic class BusinessRed implements IContainerInterface<String>{\n\n    @Override\n    public void loadInto(List<? super String> list) {\n        list.add(\"this is red\");\n    }\n}\n\npublic class BusinessGreen implements IContainerInterface<String> {\n\n    @Override\n    public void loadInto(List<? super String> list) {\n        list.add(\"this is green\");\n    }\n}\n```\n\n</details>\n\nè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨é¡¶å±‚ä¸šåŠ¡ä¸­ï¼Œé€šè¿‡æ³¨å…¥é›†åˆåˆ°åº•å±‚ä¸šåŠ¡çš„æ–¹å¼æ”¶é›†æ ¸å¿ƒä¿¡æ¯äº†\n\n```java\n    public List<String> getAllBusiness() {\n        mBusinessBlue.loadInto(allBusiness);\n        mBusinessGreen.loadInto(allBusiness);\n        mBusinessRed.loadInto(allBusiness);\n        return allBusiness;\n    }\n```\nè¿™æ˜¯ä¸€ä¸ªå…³äºå¦‚ä½•æŠŠå…ƒç´ æ·»åŠ åˆ°ä¸€ä¸ªé›†åˆçš„ç®€å•æ€è€ƒã€‚\n\n\n### navigation \n\nè¯´å®Œäº† init ä¸‹é¢çœ‹çœ‹ navigationã€‚åœ¨ ARouter é‡Œç”¨ navigation å…¶å®å¯ä»¥åšè®¸å¤šäº‹æƒ…ï¼Œè¿™é‡Œç®€ç­”çœ‹ä¸€ä¸‹ï¼Œä»–æ˜¯å¦‚ä½•å®ç° Activity è·³è½¬å’Œ Fragment è·å–çš„ã€‚\n\n#### Activity è·³è½¬çš„å®ç°\n\nç®€å•èµ·è§ï¼Œå°±ä»¥ä»¥ä¸‹ä»£ç ä¸ºä¾‹\n\n```java\n ARouter.getInstance()\n        .build(\"/test/activity2\")\n        .navigation();\n```\n\ngetInstance å°±æ˜¯è·å– ARouter çš„å•ä¾‹ã€‚\n\n##### build \n\n<img src=\"ARouter-API-åˆ†æ/build.png\" width=40%>\n\né€šè¿‡ build æ–¹æ³•è¿”å›äº†ä¸€ä¸ª PostCard å®ä¾‹ã€‚PostCard çš„å¯ä»¥ç†è§£ä¸ºæ˜¯åŒ…å«æ•´ä¸ªè·¯ç”±ä¿¡æ¯çš„ä¸€ä¸ªåŒ…è£…ç±»ã€‚\n\n#### navigation \n\nnavigation æ€»çš„æµç¨‹å¦‚ä¸‹\n\n<img src=\"ARouter-API-åˆ†æ/navigation.png\" >\n\nè¿™é‡Œæ ¸å¿ƒé€»è¾‘æœ‰ä¸¤å¤„ LogisticsCenter.completion(postcard) å’Œ _navigation(context, postcard, requestCode, callback)\n\n\n##### LogisticsCenter.completion(postcard)\n\n<details>\n\n<summary>completion</summary>\n\n```java\npublic synchronized static void completion(Postcard postcard) {\n        if (null == postcard) {\n            throw new NoRouteFoundException(TAG + \"No postcard!\");\n        }\n\n        RouteMeta routeMeta = Warehouse.routes.get(postcard.getPath());\n        if (null == routeMeta) {    // Maybe its does't exist, or didn't load.\n            Class<? extends IRouteGroup> groupMeta = Warehouse.groupsIndex.get(postcard.getGroup());  // Load route meta.\n            if (null == groupMeta) {\n                throw new NoRouteFoundException(TAG + \"There is no route match the path [\" + postcard.getPath() + \"], in group [\" + postcard.getGroup() + \"]\");\n            } else {\n                // Load route and cache it into memory, then delete from metas.\n                try {\n                    if (ARouter.debuggable()) {\n                        logger.debug(TAG, String.format(Locale.getDefault(), \"The group [%s] starts loading, trigger by [%s]\", postcard.getGroup(), postcard.getPath()));\n                    }\n\n                    IRouteGroup iGroupInstance = groupMeta.getConstructor().newInstance();\n                    iGroupInstance.loadInto(Warehouse.routes);\n                    Warehouse.groupsIndex.remove(postcard.getGroup());\n\n                    if (ARouter.debuggable()) {\n                        logger.debug(TAG, String.format(Locale.getDefault(), \"The group [%s] has already been loaded, trigger by [%s]\", postcard.getGroup(), postcard.getPath()));\n                    }\n                } catch (Exception e) {\n                    throw new HandlerException(TAG + \"Fatal exception when loading group meta. [\" + e.getMessage() + \"]\");\n                }\n\n                completion(postcard);   // Reload\n            }\n        } else {\n            postcard.setDestination(routeMeta.getDestination());\n            postcard.setType(routeMeta.getType());\n            postcard.setPriority(routeMeta.getPriority());\n            postcard.setExtra(routeMeta.getExtra());\n\n            Uri rawUri = postcard.getUri();\n            if (null != rawUri) {   // Try to set params into bundle.\n                Map<String, String> resultMap = TextUtils.splitQueryParameters(rawUri);\n                Map<String, Integer> paramsType = routeMeta.getParamsType();\n\n                if (MapUtils.isNotEmpty(paramsType)) {\n                    // Set value by its type, just for params which annotation by @Param\n                    for (Map.Entry<String, Integer> params : paramsType.entrySet()) {\n                        setValue(postcard,\n                                params.getValue(),\n                                params.getKey(),\n                                resultMap.get(params.getKey()));\n                    }\n\n                    // Save params name which need auto inject.\n                    postcard.getExtras().putStringArray(ARouter.AUTO_INJECT, paramsType.keySet().toArray(new String[]{}));\n                }\n\n                // Save raw uri\n                postcard.withString(ARouter.RAW_URI, rawUri.toString());\n            }\n\n            switch (routeMeta.getType()) {\n                case PROVIDER:  // if the route is provider, should find its instance\n                    // Its provider, so it must implement IProvider\n                    Class<? extends IProvider> providerMeta = (Class<? extends IProvider>) routeMeta.getDestination();\n                    IProvider instance = Warehouse.providers.get(providerMeta);\n                    if (null == instance) { // There's no instance of this provider\n                        IProvider provider;\n                        try {\n                            provider = providerMeta.getConstructor().newInstance();\n                            provider.init(mContext);\n                            Warehouse.providers.put(providerMeta, provider);\n                            instance = provider;\n                        } catch (Exception e) {\n                            throw new HandlerException(\"Init provider failed! \" + e.getMessage());\n                        }\n                    }\n                    postcard.setProvider(instance);\n                    postcard.greenChannel();    // Provider should skip all of interceptors\n                    break;\n                case FRAGMENT:\n                    postcard.greenChannel();    // Fragment needn't interceptors\n                default:\n                    break;\n            }\n        }\n    }\n```\n\n</details>\n\n\nå‰é¢å¼ºè°ƒè¿‡ï¼Œåœ¨ init æ–¹æ³•é‡Œï¼Œåªæ˜¯åˆå§‹åŒ–äº†æ‰€æœ‰ç»„çš„ class ä¿¡æ¯ï¼Œä½†ç»„æ‰€åœ¨ class ä¸­æ¯ä¸€ä¸ªå…ƒç´ æ˜¯æ²¡æœ‰è¢«åˆå§‹åŒ–çš„ã€‚å› æ­¤è¿™é‡Œå¦‚æœç›´æ¥é€šè¿‡ path å»æŸ¥æ‰¾ç›®æ ‡ç±»æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œå› æ­¤å¯ä»¥ç†è§£ä¸ºï¼Œæ¯ä¸ªç»„ä¸­ç¬¬ä¸€æ¬¡è¢«ä½¿ç”¨çš„è·¯ç”±ï¼Œè‚©è´Ÿç€æ•´ä¸ªç»„æ‰€æœ‰è·¯ç”±ä¿¡æ¯è¢«åŠ è½½åˆ° WareHouse ä»“åº“çš„é‡ä»»ï¼Œè¿™ä¸ªç»„çš„ä¿¡æ¯æ‰€æœ‰ä¿¡æ¯ä¼šè¢«åŠ è½½åˆ° WareHouse.routes è¿™ä¸ªé›†åˆä¸­ï¼ˆå‡†ç¡®æ¥è¯´æ˜¯ä¸€ä¸ª map,path ä¸º keyï¼ŒRouteMate ä¸ºå€¼çš„ä¸€ä¸ª HashMap)ã€‚åŒæ—¶ä¼šä» WareHouse.groupsIndex ä¸­ç§»é™¤å½“å‰ç»„ï¼Œæ¯•ç«Ÿè¿™ä¸€é¡¹å·²ç»æ²¡ç”¨äº†ã€‚ç„¶åå†æ¬¡é€’å½’è°ƒç”¨ä¸€ä¸‹è‡ªå·±ï¼Œè¿™ä¸€æ¬¡å°±å¯ä»¥ç›´æ¥ä» WareHouse.routes è¿™ä¸ªé›†åˆä¸­ç›´æ¥æ‰¾åˆ° path å¯¹åº”çš„ RouteMate äº†ã€‚å¦‚æœå†æ‰¾ä¸åˆ°ï¼Œé‚£å°±æ˜¯ä»€ä¹ˆåœ°æ–¹å‡ºé—®é¢˜äº†ï¼Œå°±æŠ¥é”™äº†ã€‚\n\n**åœ¨åˆå§‹åŒ–æ—¶åªåŠ è½½ç»„ä¿¡æ¯çš„åšæ³•ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸å·§å¦™ï¼Œç®—çš„ä¸Šæ˜¯ä¸€ç§åˆ†æ²»çš„æ€æƒ³ã€‚å°†æ‰€æœ‰è·¯ç”± RouteMate åˆ†ç»„ï¼Œå‡å°‘åˆå§‹åŒ–çš„å‹åŠ›ï¼Œç„¶åç”¨åˆ°æŸä¸ªç»„çš„æ—¶å€™ï¼Œæ‰å»åˆå§‹åŒ–æ•´ä¸ªç»„å†…æ‰€æœ‰çš„ RouteMate ã€‚è¿™æ ·ï¼Œè™½ç„¶å¯èƒ½ä¼šå½±å“ç»„å†…ç¬¬ä¸€ä¸ªä½¿ç”¨çš„è·¯ç”±ï¼Œä½†æ˜¯æ€»ä½“æ¥è¯´è¿˜æ˜¯å€¼å¾—çš„ï¼Œæ¯•ç«Ÿå‡å°‘äº†åˆå§‹åŒ–çš„å‹åŠ›ã€‚ç”šè‡³å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä½¿ç”¨æ—¶ï¼Œå¸¸è§„çš„è·³è½¬å¯èƒ½ä¹Ÿå°±é‚£ä¹ˆå‡ ä¸ªï¼Œå®Œå…¨æ²¡æœ‰å¿…è¦åœ¨åˆå§‹åŒ–æ˜¯åŠ è½½æ‰€æœ‰çš„ä¿¡æ¯ã€‚å½“ç„¶ï¼Œè¿™ç§é—®é¢˜è§ä»è§æ™ºï¼Œä¹Ÿè®¸å…¨éƒ¨åˆå§‹åŒ–ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„ç­–ç•¥ã€‚**\n\n\n\nå¦‚æœæ­£ç¡®æ‰¾åˆ°äº†ç›®æ ‡ RouteMetaï¼Œåœ¨ else åˆ†æ”¯é‡Œå°±ä¼šå°†ç›®æ ‡ç±»çš„æ‰€æœ‰ä¿¡æ¯ä¼ é€’åˆ°å½“å‰çš„ postcard å®ä¾‹ä¸­ã€‚è¿™é‡Œä¼ é€’çš„ä¿¡æ¯åŒ…æ‹¬ç›®æ ‡ç±»ç±»åï¼Œè·¯ç”±ä¼˜å…ˆçº§ï¼Œè·¯ç”±ç±»å‹ï¼Œä»¥åŠä¸€äº›é¢å¤–çš„å‚æ•°ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å°±åŒ…æ‹¬æˆ‘ä»¬åœ¨ä½¿ç”¨è·¯ç”±æ—¶æ‰§è¡Œ putInt,putString,putObject ä¼ é€’çš„å‚æ•°ã€‚ARouter è¿™é‡Œå¯¹å¯¹è±¡çš„ä¼ é€’å¹¶æ²¡æœ‰ç›´æ¥ä¼ é€’å¯¹è±¡ï¼Œè€Œæ˜¯æŠŠå¯¹è±¡ååºåˆ—åŒ–ä¸º Json ,å½“åšæ™®é€šçš„ String è¿›è¡Œä¼ é€’å’Œé€šä¿¡ã€‚\n\n**æ€»çš„æ¥è¯´ï¼ŒæˆåŠŸè°ƒç”¨ completion æ–¹æ³•ä¹‹åï¼Œpostcard ä»ç¼–è¯‘æœŸç”Ÿæˆçš„ç±»ä¸­è·å¾—äº†å®Œæ•´çš„ä¿¡æ¯ï¼Œå¹¶ä¸”è¡¥å……äº†é¢å¤–çš„ä¿¡æ¯ã€‚å¯ä»¥è¯´ï¼Œæ­¤æ—¶ postcard å·²ç»å®Œæ•´äº†ï¼Œ\bè¯¥æœ‰çš„ä¿¡æ¯éƒ½æœ‰äº†**ï¼Œå°±å¯ä»¥ä¸ºæ‰€æ¬²ä¸ºäº† ğŸ˜ğŸ˜ğŸ˜ã€‚\n\n \nåœ¨è¿›è¡Œä¸‹ä¸€æ­¥ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•æ€è€ƒä¸€ä¸‹ã€‚è¿™äº›ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥åšä»€ä¹ˆ ï¼Ÿ\n\n```java\n ARouter.getInstance()\n        .build(\"/test/activity2\")\n        .navigation();\n```\n\nå…¶å®åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸² \"/test/activity2\" å°±å·²ç»çŸ¥é“äº†å¾ˆå¤šä¿¡æ¯\n\n- ä»–å¯¹åº”çš„ç±»æ˜¯ 'com.alibaba.android.arouter.demo.testactivity.Test2Activity'\n- å¯¹åº”ç±»çš„ç±»å‹æ˜¯ Activity \n\nå½“ç„¶ï¼Œå¦‚æœæ³¨è§£é‡Œé…ç½®çš„ä¿¡æ¯å†å¤šä¸€ç‚¹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è·å¾—æ›´å¤šçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿™ä¸ªè·¯ç”±çš„ä¼˜å…ˆçº§ä»¥åŠä»–çš„ group ç­‰ç­‰ã€‚\n\n**å¯ä»¥çœ‹åˆ°ï¼Œå®ç°é¡µé¢è·³è½¬åªæ˜¯å†°å±±ä¸€è§’ï¼Œå› ä¸ºæ•´ä¸ªç›®æ ‡ç±»çš„ä¿¡æ¯éƒ½å®Œå…¨è·å–åˆ°äº†ï¼Œéš¾é“åšä¸€ä¸‹è·³è½¬é¡µé¢å°±å®Œäº‹äº†å—?(å½“ç„¶å¯¹äºä¸€ä¸ª Activity æ¥è¯´ï¼Œè¿™æ ·ä¹Ÿä¸é”™ï¼Œä½†å¦‚æœç›®æ ‡ç±»ä¸å•å•æ˜¯ä¸ª Activity å‘¢ï¼Ÿæ˜¯ä¸æ˜¯å¯ä»¥åšçš„åˆ«çš„äº‹æƒ…å‘¢ï¼ŸğŸ‘»ğŸ‘»ğŸ‘»ğŸ‘»ğŸ‘»ğŸ‘»ğŸ‘»ğŸ‘»)**\n\n\n##### _navigation(context, postcard, requestCode, callback)\n\npostcard å·²ç»å®Œå…¨åŒ…å«æ‰€æœ‰ä¿¡æ¯äº†ï¼Œé‚£ä¹ˆåç»­çš„é€»è¾‘å±•å¼€å°±å¾ˆç®€å•äº†\n\n```java\nprivate Object _navigation(final Context context, final Postcard postcard, final int requestCode, final NavigationCallback callback) {\n        final Context currentContext = null == context ? mContext : context;\n\n        switch (postcard.getType()) {\n            case ACTIVITY:\n                // Build intent\n                final Intent intent = new Intent(currentContext, postcard.getDestination());\n                intent.putExtras(postcard.getExtras());\n\n                // Set flags.\n                int flags = postcard.getFlags();\n                if (-1 != flags) {\n                    intent.setFlags(flags);\n                } else if (!(currentContext instanceof Activity)) {    // Non activity, need less one flag.\n                    intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n                }\n\n                // Set Actions\n                String action = postcard.getAction();\n                if (!TextUtils.isEmpty(action)) {\n                    intent.setAction(action);\n                }\n\n                // Navigation in main looper.\n                runInMainThread(new Runnable() {\n                    @Override\n                    public void run() {\n                        startActivity(requestCode, currentContext, intent, postcard, callback);\n                    }\n                });\n\n                break;\n            case PROVIDER:\n                return postcard.getProvider();\n            case BOARDCAST:\n            case CONTENT_PROVIDER:\n            case FRAGMENT:\n                Class fragmentMeta = postcard.getDestination();\n                try {\n                    Object instance = fragmentMeta.getConstructor().newInstance();\n                    if (instance instanceof Fragment) {\n                        ((Fragment) instance).setArguments(postcard.getExtras());\n                    } else if (instance instanceof android.support.v4.app.Fragment) {\n                        ((android.support.v4.app.Fragment) instance).setArguments(postcard.getExtras());\n                    }\n\n                    return instance;\n                } catch (Exception ex) {\n                    logger.error(Consts.TAG, \"Fetch fragment instance error, \" + TextUtils.formatStackTrace(ex.getStackTrace()));\n                }\n            case METHOD:\n            case SERVICE:\n            default:\n                return null;\n        }\n\n        return null;\n    }\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œé€šè¿‡ postcard.getType() å¯ä»¥è·å–åˆ°æˆ‘ä»¬çš„è·¯ç”±æ˜¯æ‰“åœ¨äº†ä»€ä¹ˆ**ä¸œè¥¿**ä¸Šï¼Œå¯¹äº Activity ç±»å‹æ¥è¯´ï¼Œå°±æ˜¯æˆ‘ä»¬æœ€æœ€ç†Ÿæ‚‰çš„ startActivity æ“ä½œäº†ï¼Œå¯¹äºå…¶ç±»å‹ï¼Œæ¯”å¦‚ Fragmentï¼Œå¯ä»¥ç›´æ¥è·å–ä»–çš„å®ä¾‹ã€‚\n\nå¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ ARouter ä¸ä»…ä»…å¯ä»¥å®ç°é¡µé¢è·³è½¬è¿™ä¹ˆç®€å•ï¼Œæœ¬èº«ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªè§£å†³ç»„ä»¶é—´ä¾èµ–å…³ç³»è€¦åˆçš„åˆ©å™¨ã€‚\n\n```java\n Fragment fragment = (Fragment) ARouter.getInstance().build(\"/test/fragment\").navigation();\n                Toast.makeText(this, \"æ‰¾åˆ°Fragment:\" + fragment.toString(), Toast.LENGTH_SHORT).show();\n```\n\nç”¨ ARouter å®ç°é¡µé¢è·³è½¬æ—¶è¿˜å¯ä»¥æ·»åŠ è·³è½¬åŠ¨ç”»ï¼Œä¼ å‚ã€‚è¿™äº›å…¶å®éƒ½æ˜¯å¯¹å®ç°é¡µé¢è·³è½¬çš„åŸºç¡€åŠŸèƒ½ä¹‹ä¸Šçš„è£…é¥°å™¨å†™æ³•ï¼Œå°±ä¸å±•å¼€å™è¿°äº†ã€‚\n\næ‹¦æˆªå™¨çš„å®ç°ï¼Œåœ¨ä¸Šè¿°é€»è¾‘ä¸­å·²æœ‰åˆ†æï¼Œå…¶å®å°±æ˜¯ä½¿ç”¨æ¥å£å¯¹å¯¹ä»£ç æµç¨‹è¿›è¡Œé€»è¾‘åˆ†å‘çš„ä¸€ç§å®ç°ã€‚è¿™ç§æ€æƒ³å’Œ okhttp3 ä¸­æ‹¦æˆªå™¨çš„æ€è·¯æ˜¯ä¸€è‡´çš„ï¼Œåœ¨è¿™é‡Œå°±æ˜¯é€šè¿‡ä¸­é—´å±‚æŠŠ postcard æš´éœ²å‡ºæ¥ï¼Œç»™ä½ ä¸€æ¬¡æœºä¼šï¼Œè®©ä½ åšä¸€äº› hack çš„äº‹æƒ…ï¼Œè®©ä¸šåŠ¡çš„å®ç°æ›´è‡ªç”±è€Œå·²ã€‚ \n\n## æ€»ç»“\n\nä»¥ä¸Šç®€å•åˆ†æäº†ä¸€ä¸‹ ARouter ä¸­ï¼Œè·¯ç”± init å’Œ navigation çš„å®ç°ã€‚å¹¶å°±å®ç°è¿‡ç¨‹åšäº†ç®€å•çš„æ€è€ƒã€‚\nå½“ç„¶ï¼ŒARouter çš„å®šä½è¿œä¸æ­¢å¦‚æ­¤ï¼Œæ­£å¦‚å…¶ [GitHub æè¿°](https://github.com/alibaba/ARouter/blob/master/README_CN.md)æ‰€è®²ï¼Œä½œä¸ºä¸€ä¸ªä¾èµ–æ³¨å…¥çš„æ¡†æ¶ä½¿ç”¨ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚è¿™é‡Œé€šè¿‡ä¸€ä¸ªç±»å›¾ï¼Œåœ¨æ€»ç»“ä¸€ä¸‹æœ¬èŠ‚æ‰€è®²åˆ°çš„æ‰€æœ‰ç±»ï¼ŒåŠ æ·±ä¸€ä¸‹æ˜ è±¡ã€‚\n\n\n<img src=\"ARouter-API-åˆ†æ/contruct.png\" width=60%>\n","tags":["ARouterã€ä¸‰æ–¹åº“æºç åˆ†æ"]},{"title":"ç®€å•å®ç° GIF å›¾çš„å€’åºæ’­æ”¾","url":"%2F2019%2F07%2F07%2F%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0-GIF-%E5%80%92%E5%BA%8F%E6%92%AD%E6%94%BE%2F","content":"\n\n\n## å‰è¨€\n\nç»å¸¸åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€äº›æœ‰æ„æ€çš„ GIF å›¾ï¼Œæœ‰äº› GIF å›¾å€’æ”¾ä¹‹åï¼Œç”šè‡³å˜å¾—æ›´æœ‰æ„æ€ï¼Œç®€ç›´æ˜¯æ¯æ—¥çš„å¿«ä¹æºæ³‰;\n\næ¯”å¦‚ä¸‹é¢è¿™ä¸ª\n\n<img src=\"ç®€å•å®ç°-GIF-å€’åºæ’­æ”¾/haha.gif\" width=250 height=200 ><img src=\"ç®€å•å®ç°-GIF-å€’åºæ’­æ”¾/haha_revert.gif\" width=250 height=200>\n\næ­£æ”¾çš„æ—¶å€™å¾ˆæç¬‘ï¼Œå¾ˆæ‚²å‚¬ï¼›å€’æ”¾çš„æ—¶å€™å±…ç„¶å¾ˆç‚«é…·ï¼Œç®€ç›´æ¯”æ®µèª‰çš„å‡Œæ³¢å¾®æ­¥è¿˜ç‰›é€¼ï¼Œæœ‰æ²¡æœ‰ä¸€ç§ç›–ä¸–ç¥åŠŸå·²ç»ƒæˆçš„æ„Ÿè§‰ ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥å’Œç»¿å·¨äººä¸€æˆ˜ ğŸ˜€ğŸ˜€ã€‚\n\n<!--more-->\n\nå†æ¥ä¸€ä¸ª\n\n<img src=\"ç®€å•å®ç°-GIF-å€’åºæ’­æ”¾/haha1.gif\" width=200 height=300><img src=\"ç®€å•å®ç°-GIF-å€’åºæ’­æ”¾/haha1_revert.gif\" width=200 height=300>\n\nå°ç”·ç”Ÿçš„å¿«ä¹ä¸æ‚²ä¼¤å±…ç„¶å¦‚æ­¤ç®€å•ï¼Œå˜¤å˜¤å©´ ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Š\n\nğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ï¼ŒçœŸæ˜¯èƒ½è®©äººç¬‘ä¸Šä¸‰å¤©ä¸‰å¤œã€‚ä¸‹é¢å°±æ¥çœ‹çœ‹å¦‚ä½•å®ç° GIF å›¾çš„å€’æ”¾ã€‚\n\n**ä»¥ä¸‹æ‰€æœ‰å®ç°ç»†èŠ‚æºç å·²åŒæ­¥è‡³ GitHub ä»“åº“ï¼Œå¯å‚è€ƒæœ€å[æºç ](#æºç )**\n\n<!-- TOC -->\n\n- [å‰è¨€](#å‰è¨€)\n- [GIF æ˜¯æ€ä¹ˆæ’­æ”¾çš„ï¼Œå¦‚ä½•æŠŠGIFå€’åºï¼Ÿ](#gif-æ˜¯æ€ä¹ˆæ’­æ”¾çš„å¦‚ä½•æŠŠgifå€’åº)\n- [GIF å€’æ”¾çš„å®ç°](#gif-å€’æ”¾çš„å®ç°)\n  - [ä» GIF å›¾é‡ŒæŠŠæ¯ä¸€å¸§æŠ å‡ºæ¥](#ä»-gif-å›¾é‡ŒæŠŠæ¯ä¸€å¸§æŠ å‡ºæ¥)\n    - [GifFrameLoader.loadNextFrame](#gifframeloaderloadnextframe)\n    - [è·å–æ¯ä¸€å¸§å›¾ç‰‡å¹¶ä¿å­˜åœ¨é›†åˆä¸­](#è·å–æ¯ä¸€å¸§å›¾ç‰‡å¹¶ä¿å­˜åœ¨é›†åˆä¸­)\n  - [ç”¨å¸§åºåˆ—å†æ¬¡ç”Ÿæˆå›¾ç‰‡](#ç”¨å¸§åºåˆ—å†æ¬¡ç”Ÿæˆå›¾ç‰‡)\n  - [GIF å€’æ”¾](#gif-å€’æ”¾)\n    - [demo](#demo)\n- [æ€»ç»“](#æ€»ç»“)\n- [æºç ](#æºç )\n- [å‚è€ƒæ–‡æ¡£](#å‚è€ƒæ–‡æ¡£)\n\n<!-- /TOC -->\n\n\n## GIF æ˜¯æ€ä¹ˆæ’­æ”¾çš„ï¼Œå¦‚ä½•æŠŠGIFå€’åºï¼Ÿ\n\næƒ³è¦å€’æ”¾ GIF å›¾ï¼Œé¦–å…ˆäº†è§£ä¸€ä¸‹ GIF çš„åŸç†ï¼›è¿™é‡Œå»ºè®®çœ‹çœ‹è¿™ç¯‡æ¥è‡ªè…¾è®¯æ‰‹Qå›¢é˜Ÿçš„æ–‡ç« [æµ“ç¼©çš„æ‰æ˜¯ç²¾åï¼šæµ…æGIFæ ¼å¼å›¾ç‰‡çš„å­˜å‚¨å’Œå‹ç¼©](https://www.cnblogs.com/qcloud1001/p/6647080.html)ã€‚æ€»çš„æ¥è¯´ï¼ŒGIF å’Œå›¾é€šå›¾ç‰‡æœ€å¤§çš„ä¸åŒç‚¹å°±æ˜¯å®ƒæ˜¯ç”±è®¸å¤šå¸§ç»„æˆçš„ã€‚æ—¢ç„¶å¦‚æ­¤æˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œä» GIF é‡ŒæŠŠæ‰€æœ‰å¸§æ‹¿å‡ºæ¥ï¼Œç„¶åå€’åºç»„åˆè¿™äº›å¸§ï¼Œç„¶ååœ¨åˆæˆä¸€å¼  GIF ä¸å°±å¯ä»¥äº†å—ï¼Ÿ\n\næ˜¯çš„ï¼Œé“ç†å°±æ˜¯å°±ä¹ˆç®€å•ã€‚å¦‚æœä½ ç°åœ¨å» Google GIF å€’åºçš„å®ç°ï¼Œä¼šçœ‹åˆ°å¾ˆå¤š Python çš„å®ç°ç‰ˆæœ¬ï¼Œç±»ä¼¼å¦‚ä¸‹ï¼š\n\n```python\nimport os\nimport sys\nfrom PIL import Image, ImageSequence\n\npath = sys.path[0]                          # è®¾ç½®è·¯å¾„ -- ç³»ç»Ÿå½“å‰è·¯å¾„\ndirs = os.listdir(path)                     # è·å–è¯¥è·¯å¾„ä¸‹çš„æ–‡ä»¶\nfor i in dirs:                              # å¾ªç¯è¯»å–æ‰€æœ‰æ–‡ä»¶\n    if os.path.splitext(i)[1] == \".gif\":    # ç­›é€‰gifæ–‡ä»¶\n        print(i)                            # è¾“å‡ºæ‰€æœ‰çš„gifæ–‡ä»¶å\n        #å°†gifå€’æ”¾ä¿å­˜\n        with Image.open(i) as im:\n            if im.is_animated:\n                frames = [f.copy() for f in ImageSequence.Iterator(im)]\n                frames.reverse()  # å†…ç½®åˆ—è¡¨å€’åº\n                frames[0].save('./save/reverse_'+i+'.gif',save_all=True, append_images=frames[1:])# ä¿å­˜\n```\n ä¸å¾—ä¸è¯´ï¼ŒPython çš„å„ç§ä¸‰æ–¹åº“çš„ç¡®å¾ˆå¼ºå¤§ï¼Œå‡ è¡Œä»£ç å°±å®ç°äº† GIF å€’åºçš„åŠŸèƒ½ã€‚ä½†æ˜¯ä½œä¸ºä¸€ä¸ªç¨å¾®æœ‰ç‚¹è¿½æ±‚çš„äººï¼Œéš¾é“å°±åˆ°æ­¤ä¸ºæ­¢äº†å—ï¼Ÿä¸‹æ¬¡å¦‚æœæœ‰ä¸ªå¥½ç©çš„ GIF å›¾ç‰‡ï¼Œå¦‚æœæƒ³çœ‹å€’åºå›¾ï¼Œéš¾é“è¿˜è¦æ‰“å¼€ç”µè„‘ç”¨ç”¨ä¸Šè¿°è„šæœ¬è½¬ä¸€æ¬¡å—ï¼Ÿ\n\n\n <img src=\"ç®€å•å®ç°-GIF-å€’åºæ’­æ”¾/no_way.jpeg\" width=200>\n\n å°¤å…¶æ˜¯ä½œä¸ºä¸€ä¸ª Android å¼€å‘è€…ï¼Œè¿™ç§äº‹æƒ…ç”¨æ‰‹æœºä¸ä¹Ÿèƒ½åšå—ï¼Ÿä¸ºäº†æ¯æ—¥çš„å¿«ä¹æºæ³‰ï¼Œå°±ç®—å¤©å´©åœ°è£‚ï¼Œæµ·æ¯çŸ³çƒ‚ä¹Ÿè¦åšå‡ºæ¥ï¼ˆå…¶å®å¥½åƒä¹Ÿä¸æ˜¯å¾ˆéš¾o(â•¯â–¡â•°)oï¼‰\n\n\n <img src=\"ç®€å•å®ç°-GIF-å€’åºæ’­æ”¾/go.gif\" width=200>\n\nå¥½äº†ï¼Œä¸å¹ç‰›é€¼äº†ï¼Œä¸‹é¢æ¥çœ‹çœ‹æ€ä¹ˆå®ç°ã€‚\n\n## GIF å€’æ”¾çš„å®ç°\n\nä¸Šé¢å·²ç»è¯´è¿‡äº†ï¼Œè¦å®ç° GIF çš„å€’åºéœ€è¦åšä¸‰ä»¶äº‹\n- ä» GIF å›¾é‡ŒæŠŠæ¯ä¸€å¸§æ‘˜å‡ºæ¥ï¼Œç»„æˆåºåˆ—\n- æŠŠåºåˆ—é€†åº\n- ç”¨é€†åºåçš„æ¯ä¸€å¸§å†é‡æ–°ç”Ÿæˆä¸€å¼ æ–°çš„ GIF å›¾\n\nä¸Šé¢ä¸¤æ­¥ï¼Œå¯¹é›†åˆé€†åºä¸æ˜¯ä»€ä¹ˆéš¾äº‹ï¼Œä¸»è¦çœ‹çœ‹å¦‚ä½•å®ç°ç¬¬ä¸€æ­¥å’Œç¬¬ä¸‰æ­¥ã€‚\n\n### ä» GIF å›¾é‡ŒæŠŠæ¯ä¸€å¸§æŠ å‡ºæ¥\n\nè¿™ä¸ªå¬èµ·æ¥å¾ˆå¤æ‚ï¼Œåšèµ·æ¥å¥½åƒä¹ŸæŒºéš¾ï¼ŒAndroid æ²¡æœ‰æä¾›ç±»ä¼¼çš„ API å¯ä»¥åšè¿™ä»¶äº‹ï¼Œå¹³æ—¶åŠ è½½å›¾ç‰‡ç”¨çš„ä¸‰æ–¹åº“ Glideï¼ŒFresco ç­‰è²Œä¼¼ä¹Ÿæ²¡æœ‰æä¾›å¯ä»¥åšç±»ä¼¼äº‹æƒ…çš„æ¥å£ã€‚ä½†å…¶å®æˆ‘ä»¬ç¨å¾®æ·±å…¥çœ‹ä¸€ä¸‹ä¸‰æ–¹åº“æ˜¯å®ç° GIF æ’­æ”¾çš„ä»£ç ï¼Œå°±ä¼šæ‰¾åˆ°çªç ´å£ï¼Œè¿™é‡Œä»¥ Glide ä¸ºä¾‹,å‡è®¾ä½ ç ”ç©¶è¿‡ Glide çš„æºç ï¼ˆå¦‚æœæ²¡æœ‰çœ‹è¿‡ï¼Œä¹Ÿä¸è¦ç´§ï¼Œå¯ä»¥[ç•¥è¿‡è¿™æ®µï¼Œç›´æ¥çœ‹å®ç°](#get-frame-code)ï¼‰\n\n\n#### GifFrameLoader.loadNextFrame\n\nåœ¨ GifFrameLoader çš„ loadNextFrame å®ç°ä¸­ï¼ˆæˆ‘ä»¬å¯ä»¥çŒœæµ‹åˆ°è¿™å°±æ˜¯ Glide åŠ è½½æ¯ä¸€å¸§å›¾ç‰‡çš„å®ç°ï¼‰\n```java\nprivate void loadNextFrame() {\n    if (!isRunning || isLoadPending) {\n      return;\n    }\n    if (startFromFirstFrame) {\n      Preconditions.checkArgument(\n          pendingTarget == null, \"Pending target must be null when starting from the first frame\");\n      gifDecoder.resetFrameIndex();\n      startFromFirstFrame = false;\n    }\n    if (pendingTarget != null) {\n      DelayTarget temp = pendingTarget;\n      pendingTarget = null;\n      onFrameReady(temp);\n      return;\n    }\n    isLoadPending = true;\n    // Get the delay before incrementing the pointer because the delay indicates the amount of time\n    // we want to spend on the current frame.\n    int delay = gifDecoder.getNextDelay();\n    long targetTime = SystemClock.uptimeMillis() + delay;\n\n    gifDecoder.advance();\n    next = new DelayTarget(handler, gifDecoder.getCurrentFrameIndex(), targetTime);\n    requestBuilder.apply(signatureOf(getFrameSignature())).load(gifDecoder).into(next);\n  }\n```\n\nå¯ä»¥çœ‹åˆ°å…·ä½“çš„å®ç°æ˜¯ç”± gifDecoder è¿™ä¸ªå¯¹è±¡å®ç°çš„ã€‚è¿™é‡Œæœ€å…³é”®çš„ä¸€å¥å°±æ˜¯ \n\n```java\ngifDecoder.advance();\n```\næˆ‘ä»¬å¯ä»¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•çš„å®šä¹‰ \n\n```java\n  /**\n   * Move the animation frame counter forward.\n   */\n  void advance();\n```\n\nå°±æ˜¯è·³è½¬åˆ°ä¸‹ä¸€å¸§çš„æ„æ€ã€‚\n\nå¥½äº†ï¼Œè‡³æ­¤æˆ‘ä»¬çŸ¥é“å¦‚æœå¯ä»¥è·å–åˆ° GifDeCoder å’Œ GifFrameLoader çš„å®ä¾‹ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ‰‹åŠ¨æ§åˆ¶å’Œè·å– GIF å›¾é‡Œæ¯ä¸€å¸§äº†ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å›è¿‡å»çœ‹ Glide æä¾›çš„ API å‘ç°ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•ç›´æ¥è·å– GifFrameLoader å’Œ GifDeCoderï¼Œå› ä¸ºåœ¨æºç é‡Œè¿™äº›å˜é‡éƒ½æ˜¯ private çš„ã€‚ğŸ¤¦â€ğŸ¤¦â€ğŸ¤¦â€ ï¼Œéš¾é“è¿™å°±èµ°åˆ°äº†æ­»èƒ¡åŒå—ï¼Ÿä¸ç„¶ï¼Œå‰äººæ›¾è¯´è¿‡ï¼Œç¼–ç¨‹é¢†åŸŸçš„ä»»ä½•é—®é¢˜éƒ½å¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ªä¸­é—´å±‚å®ç°ã€‚æˆ‘ä»¬è¿™é‡Œçš„ä¸­é—´å±‚å°±æ˜¯ **åå°„**ã€‚ä½¿ç”¨åå°„å¯ä»¥è·å–å°±å¯ä»¥è®¿é—® GifFrameLoader å’Œ GifDeCoder äº†ï¼›é‚£ä¹ˆåç»­çš„å®ç°å°±å˜å¾—ç®€å•äº†ã€‚\n\n<span id=\"get-frame-code\">\n\n#### è·å–æ¯ä¸€å¸§å›¾ç‰‡å¹¶ä¿å­˜åœ¨é›†åˆä¸­\n\n```kotlin\nGlide.with(mContext).asGif().listener(object :RequestListener<GifDrawable>{\n            \n            ...fail stuff...\n\n            override fun onResourceReady(resource: GifDrawable, model: Any?, target: Target<GifDrawable>?, dataSource: DataSource?, isFirstResource: Boolean): Boolean {\n                val frames = ArrayList<ResFrame>()\n                val decoder = getGifDecoder(resource)\n                if (decoder != null) {\n\n                    for (i in 0..resource.frameCount) {\n                        val bitmap = decoder.nextFrame\n                        val path = IOTool.saveBitmap2Box(context, bitmap, \"pic_$i\")\n                        val frame = ResFrame(decoder.getDelay(i), path)\n                        frames.add(frame)\n                        decoder.advance()\n                    }\n                }\n                return false\n            }\n\n        }).load(originalUrl).into(original)\n```\n\nè¿™é‡Œçš„å®ç°å¾ˆç®€å•ï¼Œç›‘å¬ GIF çš„åŠ è½½è¿‡ç¨‹ï¼ŒåŠ è½½æˆåŠŸåå¾—åˆ°ä¸€ä¸ª GifDrawable çš„å®ä¾‹ resource ,é€šè¿‡è¿™ä¸ªå®ä¾‹ç”¨åå°„çš„æ–¹å¼(å…·ä½“å®ç°å¯å‚è€ƒæºç ï¼Œéå¸¸ç®€å•)è·å–åˆ°äº† GifDecode çš„å®ä¾‹ï¼Œæœ‰äº†è¿™ä¸ªå®ä¾‹å°±å¯ä»¥è·å–æ¯ä¸€å¸§äº†ï¼Œè¿™é‡Œè¿˜éœ€è¦è®°å½•ä¸€ä¸‹æ¯ä¸€å¸§æ’­æ”¾æ—¶é—´é—´éš”ï¼Œè¿”å›çš„æ¯ä¸€ä¸ªå¸§å°±æ˜¯ä¸€ä¸ª Bitmap ï¼Œæˆ‘ä»¬æŠŠè¿™äº› Bitmap ä¿å­˜åœ¨åº”ç”¨çš„å®‰è£…ç›®å½•ä¸‹ï¼Œç„¶åç”¨ä¸€ä¸ªåˆ—è¡¨è®°å½•ä¸‹æ‰€æœ‰å¸§çš„ä¿¡æ¯ï¼ŒåŒ…å«å½“å‰å¸§çš„å»¶è¿Ÿæ—¶é—´å’Œå½“å‰å¸§å¯¹åº”çš„ Bitmap çš„å­˜å‚¨è·¯å¾„ã€‚\n\næ¯ä¸€å¸§çš„é›†åˆåºåˆ—æœ‰äº†ï¼Œåºåˆ—åè½¬ä¸€è¡Œä»£ç çš„äº‹æƒ…ï¼Œå‰©ä¸‹çš„å°±æ˜¯ç”¨è¿™ä¸ªåºåˆ—ç”Ÿæˆæ–°çš„ GIF å›¾ç‰‡äº†ã€‚\n\n### ç”¨å¸§åºåˆ—å†æ¬¡ç”Ÿæˆå›¾ç‰‡\n\nç”¨å·²æœ‰çš„å›¾ç‰‡ç»„æˆå’Œä¸€ä¸ªæ–°çš„å›¾ç‰‡ï¼Œè¿™ä¸ªå¹¶ä¸æ˜¯ä»€ä¹ˆéš¾äº‹ï¼Œç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šå®ç°äº†ã€‚ç”šè‡³åŒ…æ‹¬ GIF çš„å†æ¬¡ç”Ÿæˆï¼Œä¹Ÿå¯ä»¥å€ŸåŠ© [GifMaker](https://github.com/LineChen/GifMaker) è¿™æ ·çš„ä¸‰æ–¹åº“å®Œæˆã€‚\n\n\n```kotlin\nprivate fun genGifByFrames(context: Context, frames: List<ResFrame>): String {\n        \n        val os = ByteArrayOutputStream()\n        val encoder = AnimatedGifEncoder()\n        encoder.start(os)\n        encoder.setRepeat(0)\n        for (value in frames) {\n            val bitmap = BitmapFactory.decodeFile(value.path)\n            encoder.setDelay(value.delay)\n            encoder.addFrame(bitmap)\n        }\n        encoder.finish()\n\n        val path = IOTool.saveStreamToSDCard(\"test\", os)\n        IOTool.notifySystemGallay(context, path)\n    \n        return path\n    }\n```\nå€ŸåŠ© AnimatedGifEncoder éå¸¸ç®€å•æŠŠä¹‹å‰ä¿å­˜çš„åºåˆ—å†æ¬¡æ‹¼æ¥æˆäº†ä¸€å¼ æ–°çš„ GIF å›¾ã€‚\n\n### GIF å€’æ”¾\n\næŠŠä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤ç®€å•æ•´ç†ä¸€ä¸‹ \n\n```kotlin\n    private fun reverseRes(context: Context, resource: GifDrawable?): String {\n        if (resource == null) {\n            return \"\"\n        }\n        // è·å–æ‰€æœ‰å¸§ä¿¡æ¯é›†åˆ\n        val frames = getResourceFrames(resource, context)\n\n        // é€†åºé›†åˆ\n        reverse(frames)\n\n        // ç”Ÿæˆæ–°çš„ GIF å›¾ç‰‡\n        return genGifByFrames(context, frames)\n    }\n```\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸‰æ­¥æ“ä½œéƒ½æ˜¯æ¶‰åŠåˆ° UI çš„è€—æ—¶æ“ä½œï¼Œå› æ­¤è¿™é‡Œç®€å•ç”¨ RxJava åšäº†ä¸€æ¬¡å°è£…ã€‚ç„¶åå°±å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨äº†ã€‚\n\n#### demo \n\n```kotlin\n        GifFactory.getReverseRes(mContext,source)\n                .subscribe { \n                    Glide.with(mContext).load(it).into(reversed)\n                }\n```\n\n<img src=\"ç®€å•å®ç°-GIF-å€’åºæ’­æ”¾/demo.gif\" width=320 height=564 >\n\næ˜¯çš„ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œæä¾›åŸå§‹ GIF èµ„æºçš„è·¯å¾„ï¼Œå³å¯è¿”å›å®ç°å€’åºçš„ GIF å›¾ã€‚\n\n\n\n## æ€»ç»“\n\nä¸å¾—ä¸è¯´ï¼ŒGlide çš„å†…éƒ¨å®ç°éå¸¸å¼ºå¤§ï¼Œå¯¹ç§»åŠ¨ç«¯å›¾ç‰‡åŠ è½½çš„å„ç§åœºæ™¯åšäº†éå¸¸å¤æ‚çš„è€ƒè™‘å’Œè®¾è®¡ï¼Œå› æ­¤ä¹Ÿå¯¼è‡´å®ƒçš„æºç éå¸¸çš„éš¾äºé˜…è¯»ã€‚ä½†æ˜¯ï¼Œå¦‚æœä»…ä»…ä»æŸä¸ªçš„å‡ºå‘ï¼Œæ¯”å¦‚ç¼“å­˜ã€ç½‘ç»œã€å›¾ç‰‡è§£ç å’Œç¼–ç çš„è§’åº¦å‡ºå‘ï¼Œè„±ç¦»æ•´ä¸ªæµç¨‹ï¼Œå»çœ‹å±€éƒ¨è¿˜æ˜¯æœ‰æ”¶è·çš„ã€‚\n\nå›åˆ°ä¸Šè¿° GIF å€’åºçš„æ­¥éª¤ï¼Œæ€»çš„æ¥è¯´æœ‰ä»¥ä¸‹å‡ ä¸ªå…³é”®æ­¥éª¤\n\n  1. Glide æ ¹æ® URL åŠ è½½ GIF å›¾ç‰‡ï¼ŒåŒæ—¶ç›‘å¬åŠ è½½è¿‡ç¨‹\n  2. é€šè¿‡ GifDrawable åå°„è·å–åˆ° GifDecoder\n  3. é€šè¿‡ GifDecoder è·å–æ‰€æœ‰å¸§ï¼ˆåŒ…å«ä¿å­˜è¿™äº›å¸§ Bitmapï¼‰\n  4. åè½¬å¸§åºåˆ— frames\n  5. é€šè¿‡ frame å†æ¬¡ç”Ÿæˆ GIF å›¾ç‰‡\n\nä¸Šè¿°æ­¥éª¤ä¸­ 1 å’Œ 4 çš„æ‰§è¡Œé€Ÿåº¦æ˜¯åŸºæœ¬ä¸Šæ˜¯çº¿æ€§çš„ï¼Œä¹Ÿæ˜¯æ— æ³•å†è¿‡å¤šå¹²é¢„çš„ã€‚è€Œæ­¥éª¤ 2ï¼Œ3ï¼Œ5 ä¹Ÿæ˜¯ GIF åè½¬å®ç°çš„æ ¸å¿ƒï¼Œå› æ­¤å¯¹æ–¹æ³•è€—æ—¶ç®€å•åšäº†ä¸‹è®°å½•ã€‚\n\n```shell\n\nGIF å›¾ size = 8.9M\n\nE/GifFactory: æ–¹æ³•: getGifDecoder        è€—æ—¶ 0.001000 second\nE/GifFactory: æ–¹æ³•: getResourceFrames    è€—æ—¶ 1.489000 second\nE/GifFactory: æ–¹æ³•: genGifByFrames       è€—æ—¶ 9.397000 second\n\nGIF å›¾ size = 11.9M\n\nE/GifFactory: æ–¹æ³•: getGifDecoder        è€—æ—¶ 0.000000 second\nE/GifFactory: æ–¹æ³•: getResourceFrames    è€—æ—¶ 1.074000 second\nE/GifFactory: æ–¹æ³•: genGifByFrames       è€—æ—¶ 9.559000 second\n\nGIF å›¾ size = 3.3M\n\nE/GifFactory: æ–¹æ³•: getGifDecoder        è€—æ—¶ 0.001000 second\nE/GifFactory: æ–¹æ³•: getResourceFrames    è€—æ—¶ 0.437000 second\nE/GifFactory: æ–¹æ³•: genGifByFrames       è€—æ—¶ 2.907000 second\n\nGIF å›¾ size = 8.1M\n\nE/GifFactory: æ–¹æ³•: getGifDecoder        è€—æ—¶ 0.000000 second\nE/GifFactory: æ–¹æ³•: getResourceFrames    è€—æ—¶ 0.854000 second\nE/GifFactory: æ–¹æ³•: genGifByFrames       è€—æ—¶ 6.416000 second\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶æˆ‘ä»¬è·å– GifDecoder çš„è¿‡ç¨‹ä½¿ç”¨äº†åå°„ï¼Œä½†å…¶å®è¿™æ¯”ä¸æ˜¯æ€§èƒ½ç“¶é¢ˆï¼›è·å–æ‰€æœ‰å¸§ä¿¡æ¯çš„æ–¹æ³• getResourceFrames è€—æ—¶ï¼Œä¹Ÿæ˜¯å’Œ GIF å›¾çš„å¤§å°æœ‰å…³ï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªå¯æ¥å—çš„å€¼ã€‚ä½†æ˜¯é€šè¿‡å¸§åºåˆ—å†æ¬¡ç”Ÿæˆ GIF å›¾çš„æ–¹æ³•æ‰§è¡Œæ—¶é—´å°±æœ‰ç‚¹ææ€–äº†ï¼Œå³ä¾¿æˆ‘çš„æµ‹è¯•æœºæ˜¯ kirinï¼ˆéº’éºŸï¼‰960 ï¼Œè¿è¡Œå†…å­˜æœ‰ 6G ğŸ˜³ğŸ˜³ã€‚\n\nä½†æ˜¯åŒæ ·çš„å›¾ç‰‡åœ¨ PC ä¸Šç”¨ Python è„šæœ¬åŸºæœ¬ä¸Šæ˜¯æ¯«ç§’çº§å®Œæˆã€‚æ‰€ä»¥çº¯ç²¹ç”¨ java å®ç°ï¼ˆAnimatedGifEncoder æ˜¯ java å†™çš„ï¼Œä¸ç®— kotlin ğŸ‘€ï¼‰å›¾ç‰‡äºŒæ¬¡ç¼–ç è¿˜æ˜¯æœ‰äº›æ€§èƒ½å·®è·çš„ã€‚\n\n\nè™½ç„¶ï¼Œæ­¤æ¬¡çš„å®ç°è½¬æ¢è¾ƒæ…¢ï¼Œä½†ä¹Ÿç®—æ˜¯ä¸€æ¬¡ä¸é”™çš„å°è¯•å§ã€‚\n\n\n## æºç \n\næœ¬æ–‡æ‰€æœ‰å®ç°ç»†èŠ‚æºç å·²åŒæ­¥è‡³ GitHub ä»“åº“ [AndroidAnimationExercise](https://github.com/REBOOTERS/AndroidAnimationExercise), å¯ä»¥å‚è€ƒ [ReverseGifActivity](https://github.com/REBOOTERS/AndroidAnimationExercise/blob/master/imitate/src/main/java/com/engineer/imitate/ui/activity/ReverseGifActivity.kt)\n\n## å‚è€ƒæ–‡æ¡£\n\n[æµ“ç¼©çš„æ‰æ˜¯ç²¾åï¼šæµ…æGIFæ ¼å¼å›¾ç‰‡çš„å­˜å‚¨å’Œå‹ç¼©](https://www.cnblogs.com/qcloud1001/p/6647080.html)","tags":["GIFã€Glideã€Android"]},{"title":"ä¸€ä¸ªç®€å•çš„è·¯ç”±","url":"%2F2019%2F06%2F22%2F%E4%B8%80%E4%B8%AA%E8%B7%AF%E7%94%B1%E7%9A%84%E8%AF%9E%E7%94%9F%2F","content":"\n## å‰è¨€\n\nåœ¨é¡µé¢è·³è½¬çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨è·¯ç”±å·²ä¸æ˜¯ä»€ä¹ˆæ–°é‹äº‹ï¼Œå¸‚é¢ä¸Šå·²ç»æœ‰å¾ˆå¤šåº“å¯ä»¥åšè¿™ä»¶äº‹ï¼Œæ¯”å¦‚ [ARouter](https://github.com/alibaba/ARouter), [WMRouter](https://github.com/meituan/WMRouter),[Router](https://github.com/chenenyu/Router)[ç­‰ç­‰](https://github.com/search?l=Java&q=Router&type=Repositories)ã€‚\nè¿™äº›è·¯ç”±æ¡†æ¶ï¼Œéƒ½æ˜¯ä½¿ç”¨ APT çš„åŸç†æ¥å®ç°çš„ã€‚é€šè¿‡ä¹‹å‰çš„ [æ³¨è§£å¤„ç†å™¨APTåˆæ¢](https://rebooters.github.io/2019/06/03/æ³¨è§£å¤„ç†å™¨APTåˆæ¢)ã€[SugarAdapter æ³¨è§£å¤„ç†å™¨åˆ†æ](https://rebooters.github.io/2019/06/04/SugarAdapter-%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E5%88%86%E6%9E%90/) ï¼Œæˆ‘ä»¬å¯¹ APT çš„ä½¿ç”¨æœ‰äº†ä¸€äº›è®¤è¯†ã€‚\n\nå› æ­¤ï¼Œè¿™é‡Œæˆ‘ä»¬ç®€å•å°è¯•ä¸€ä¸‹ï¼Œå®ç°ä¸€ä¸ª**å²ä¸Šæœ€æœ€ç®€å•**çš„è·¯ç”±ã€‚é€šè¿‡è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬å¯ä»¥äº†è§£ä¸€ä¸‹ï¼Œå®ç°ä¸€ä¸ªçœŸæ­£å¥½ç”¨çš„è·¯ç”±ï¼Œéœ€è¦è€ƒè™‘å“ªäº›é—®é¢˜ï¼Œåˆæœ‰å“ªäº›éš¾ç‚¹éœ€è¦å»å¤„ç†ã€‚\n\n<!--more-->\n\n<!-- TOC -->\n\n- [å‰è¨€](#å‰è¨€)\n- [å²ä¸Šæœ€ç®€å•è·¯ç”±çš„è¯ç”Ÿ](#å²ä¸Šæœ€ç®€å•è·¯ç”±çš„è¯ç”Ÿ)\n  - [ç›®æ ‡](#ç›®æ ‡)\n  - [è·¯ç”±è¡¨ç”Ÿæˆ](#è·¯ç”±è¡¨ç”Ÿæˆ)\n    - [æ³¨è§£å®šä¹‰](#æ³¨è§£å®šä¹‰)\n    - [æ³¨è§£å¤„ç†](#æ³¨è§£å¤„ç†)\n    - [ç”Ÿæˆä»£ç ](#ç”Ÿæˆä»£ç )\n    - [å°ç»“](#å°ç»“)\n  - [è·¯ç”± API](#è·¯ç”±-api)\n    - [æ§½ç‚¹](#æ§½ç‚¹)\n- [ä¸€ä¸ªé«˜æ•ˆçš„è·¯ç”±åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„](#ä¸€ä¸ªé«˜æ•ˆçš„è·¯ç”±åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„)\n  - [éœ€æ±‚æ¨åŠ¨æŠ€æœ¯](#éœ€æ±‚æ¨åŠ¨æŠ€æœ¯)\n- [æ€»ç»“](#æ€»ç»“)\n\n<!-- /TOC -->\n\n\n\n## å²ä¸Šæœ€ç®€å•è·¯ç”±çš„è¯ç”Ÿ\n\n### ç›®æ ‡\n\nä½œä¸ºå²ä¸Šæœ€ç®€å•çš„è·¯ç”±ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å¾ˆç®€å•ï¼Œ**ç”¨è·¯ç”±çš„æ–¹å¼å®ç° Activity çš„è·³è½¬**\n\n```java\n          mJump.setOnClickListener(v ->\n                QRouterApi.go(this, \"/activity/second\")\n        );\n```\n```java\n@QRouter(\"/activity/second\")\npublic class SecondActivity extends AppCompatActivity {\n  ....onCreate .... stuff ...\n}\n```\nä¸Šè¿°ç‚¹å‡»äº‹ä»¶ï¼Œå¯ä»¥æ­£ç¡®è·³è½¬åˆ° **\"/activity/second\"** æ³¨è§£æ‰€åœ¨çš„ SecondActivity(å‡è®¾æˆ‘ä»¬ç°åœ¨æ— æ³•ç›´æ¥ä¾èµ– SecondActivity.class,ğŸ˜ğŸ˜)\n\nä¸‹é¢å°±ä¸€æ­¥ä¸€æ­¥èµ°ï¼Œçœ‹çœ‹å¦‚ä½•å®ç°è¿™ä¸ªç®€å•çš„å°ç›®æ ‡ã€‚\n\n### è·¯ç”±è¡¨ç”Ÿæˆ\n\n#### æ³¨è§£å®šä¹‰\n\n```java\n@Retention(RetentionPolicy.CLASS)\n@Target(ElementType.TYPE)\npublic @interface QRouter {\n    String value();\n}\n```\né¦–å…ˆï¼Œä¸ºè·¯ç”±å®šä¹‰ä¸€ä¸ªæ³¨è§£ QRouterï¼Œåªæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯è·¯ç”±åœ°å€ã€‚\n\n#### æ³¨è§£å¤„ç†\n\nå…³äºæ³¨è§£å¤„ç†å™¨çš„ä½¿ç”¨ç»†èŠ‚è¿™é‡Œå°±ä¸å†èµ˜è¿°ï¼Œ[æ³¨è§£å¤„ç†å™¨APTåˆæ¢](https://rebooters.github.io/2019/06/03/æ³¨è§£å¤„ç†å™¨APTåˆæ¢) å·²ç»æœ‰è¿‡æ·±å…¥åˆ†æäº†ã€‚è¿™é‡Œç›´æ¥åˆ†æçœ‹çœ‹ process å¦‚ä½•å®ç°ã€‚\n\n```java\n  @Override\n    public boolean process(Set<? extends TypeElement> annotations, RoundEnvironment roundEnv) {\n        mMessager.printMessage(Diagnostic.Kind.NOTE, \"processing....\");\n\n\n        Set<? extends Element> elements = roundEnv.getElementsAnnotatedWith(QRouter.class);\n        for (Element element : elements) {\n            if (element instanceof TypeElement) {\n                \n\n                if (mQRouterCreatorProxy == null) {\n                    mQRouterCreatorProxy = new QRouterCreatorProxy(mElementUtils, (TypeElement) element);\n                }\n\n                QRouter routerAnnotation = element.getAnnotation(QRouter.class);\n                String router = routerAnnotation.value();\n                String target = ((TypeElement) element).getQualifiedName().toString();\n\n                mQRouterCreatorProxy.putElement(router, target);\n\n            } else {\n                mMessager.printMessage(Diagnostic.Kind.ERROR, \"annotation on mistake type, the type should be class\");\n            }\n        }\n\n        generateRouterTable();\n\n        return true;\n    }\n```\n\nè¿™é‡Œè¿˜æ˜¯æ²¿è¢­ä¹‹å‰ BingView çš„æ€è·¯ï¼Œç”¨ä»£ç†ç±» QRouterCreatorProxy å¤„ç†æ‰€æœ‰çš„å…³é”®ä¿¡æ¯ï¼Œprocessor å°†æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯ï¼Œå³\n\n```java\n String router = routerAnnotation.value();\n String target = ((TypeElement) element).getQualifiedName().toString();\nmQRouterCreatorProxy.putElement(router, target);\n```\næ³¨è§£çš„è·¯ç”±åœ°å€å’Œè·¯ç”±æ‰€åœ¨çš„ç›®æ ‡ç±»ï¼Œé€šè¿‡ mQRouterCreatorProxy åšä¸€æ¬¡èšåˆã€‚è¿™æ ·ä»£ç†ç±»åŒ…å«äº†æ‰€æœ‰çš„è·¯ç”±ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥å°±æ˜¯é€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œç”Ÿæˆä¸€äº›ä»£ç ã€‚\n\né‚£ä¹ˆè¦ç”Ÿæˆä»€ä¹ˆæ ·çš„ä»£ç å‘¢ï¼Ÿæƒ³æƒ³æˆ‘ä»¬çš„ç›®æ ‡ï¼Œ**é€šè¿‡è·¯ç”±æ‰“å¼€ Activity** ã€‚é‚£ä¹ˆæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°çš„ä¸€ç§åšæ³•ï¼Œå°±æ˜¯å»ºç«‹ä¸€ä¸ª è·¯ç”±å’Œ Activity çš„å¯¹åº”å…³ç³»ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå…³ç³»æ‰¾åˆ°å¯¹åº”çš„ Activity ã€‚ä¸‹é¢å°±æŒ‰ç…§è¿™ä¸ªæ€è·¯æ¥ç”Ÿæˆä»£ç ã€‚\n\n#### ç”Ÿæˆä»£ç \n\n```java\nprivate void generateRouterTable() {\n        TypeSpec typeSpec = mQRouterCreatorProxy.genCode();\n        String packageName = mQRouterCreatorProxy.getPackageName();\n        JavaFile javaFile = JavaFile.builder(packageName, typeSpec).build();\n        try {\n            javaFile.writeTo(mFiler);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n```\n - gencode çš„å®ç°\n\n```java\npublic class QRouterCreatorProxy {\n    private static final String Q_ROUTER_CLASS_NAME = \"QRouterTable\";\n\n    public TypeSpec genCode() {\n        TypeSpec typeSpec = TypeSpec.classBuilder(Q_ROUTER_CLASS_NAME)\n                .addModifiers(Modifier.FINAL, Modifier.PUBLIC)\n                .addMethod(genRouterTable())\n                .build();\n        return typeSpec;\n    }\n}\n```\n\nè¿™é‡Œé¦–å…ˆä¼šç”Ÿæˆä¸€ä¸ªåä¸º QRouterTable çš„ç±»ï¼Œæ˜¯ final ä¸” public ç±»å‹çš„ï¼Œå¹¶ä¸”è¿˜åŒ…æ‹¬ä¸€ä¸ªæ–¹æ³•ï¼Œç»§ç»­çœ‹\n\n\n- genRouterTable å®ç°\n\n```java\npublic class QRouterCreatorProxy {\n  \n    private HashMap<String, String> elements = new HashMap<>();\n    \n    public void putElement(String router, String targetClass) {\n        elements.put(router, targetClass);\n    }\n\n    /**\n     * @return HashMap<String, String>\n     */\n    private MethodSpec genRouterTable() {\n         /*\n         ```Map<String, String>```\n         */\n        ParameterizedTypeName inputMapTypeOfGroup = ParameterizedTypeName.get(\n                ClassName.get(Map.class),\n                ClassName.get(String.class),\n                ClassName.get(String.class)\n        );\n        \n        MethodSpec.Builder builder = MethodSpec.methodBuilder(\"map\")\n                .addModifiers(Modifier.PUBLIC, Modifier.FINAL)\n                .returns(inputMapTypeOfGroup);\n\n        builder.addCode(\"\\n\");\n        builder.addStatement(\"$T<$T,$T> tables=new $T()\", HashMap.class, String.class, String.class, HashMap.class);\n        builder.addCode(\"\\n\");\n\n        for (String key : elements.keySet()) {\n            String target = elements.get(key);\n            String code = \"tables.put(\\\"\" + key + \"\\\",\\\"\" + target + \"\\\");\\n\";\n            builder.addCode(code);\n        }\n        builder.addCode(\"return tables;\\n\");\n        return builder.build();\n    }\n}\n```\n\nelements è¿™ä¸ªæ•£åˆ—è¡¨é‡Œå­˜å‚¨çš„å°±æ˜¯è·¯ç”±å…³ç³»ä¿¡æ¯ã€‚\n\n- é¦–å…ˆä¼šåˆ›å»ºæ–¹æ³•å£°æ˜ï¼Œæ˜¯ä¸€ä¸ª åä¸º map è¿”å›å€¼ä¸º HashMap<String, String>ï¼Œfinal ä¸” public ç±»å‹çš„æ–¹æ³•ã€‚\n- ç„¶åï¼Œåœ¨æ–¹æ³•ä½“é‡Œé€šè¿‡ addStatement åˆå§‹åŒ–ä¸€ä¸ª HashMap<String, String> ï¼Œæ¥ä¸‹æ¥å°±å¼€å§‹éå† elements è¿™ä¸ª hashmap ï¼ŒæŠŠä¹‹å‰å­˜å‚¨çš„è·¯ç”±ä¿¡æ¯ï¼Œè½¬æ¢æˆä»£ç çš„æ–¹å¼è¿›è¡Œå­˜å‚¨ã€‚\n- æœ€åï¼Œè¿”å›ç¬¬äºŒæ­¥åˆ›å»ºçš„ HashMap<String, String> å®ä¾‹å³å¯ã€‚\n\næœ€ç»ˆæˆ‘ä»¬è¦ç”Ÿæˆçš„ä»£ç å¦‚ä¸‹ ï¼š\n\n\n```java\npublic final class QRouterTable {\n  public final Map<String, String> map() {\n\n    HashMap<String,String> tables=new HashMap();\n\n    tables.put(\"/activity/simple\",\"com.engineer.aptlite.SimpleActivity\");\n    tables.put(\"/activity/second\",\"com.engineer.aptlite.SecondActivity\");\n    return tables;\n  }\n}\n```\n\n#### å°ç»“\n\nè‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»ç”Ÿæˆäº†è·¯ç”±è¡¨ï¼ˆè¿™é‡Œå°±æ˜¯ä¸€ä¸ªåŒ…å«è·¯ç”±å’Œç›®æ ‡ Class å…³ç³»çš„ HashMap)ã€‚å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ javapoet ç”Ÿæˆä»£ç å’Œæˆ‘ä»¬æ‰‹åŠ¨å†™ä»£ç çš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ‰‹å†™çš„æ—¶å€™æ¯ä¸€ä¸ªå­æ¯éƒ½æ˜¯æˆ‘ä»¬æ•²å‡ºæ¥çš„(ide è¾…åŠ©ç”Ÿæˆï¼Œå…¶å®ä¹Ÿå¯ä»¥ç†è§£ä¸ºæ‰‹åŠ¨æ•²å‡ºæ¥çš„ä»£ç å§ ğŸ¤”ğŸ¤”)ï¼Œjavapoet é€šè¿‡æŸäº›ç‰¹å®šçš„ api å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆè¿™äº›ä»£ç ã€‚æœ¬è´¨ä¸Šéƒ½æ˜¯å†™æ–‡ä»¶çš„è¿‡ç¨‹ã€‚javapoet ä¹‹äºjava ç¨‹åºå‘˜ï¼Œå°±å¦‚åŒ è¾“å…¥æ³•ä¹‹äºé“…ç¬”ã€é’¢ç¬”æˆ–æ¯›ç¬”å§ã€‚\n\n### è·¯ç”± API \n\nè·¯ç”±è¡¨å·²ç»ç”Ÿæˆäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ”¹å¦‚ä½•ä½¿ç”¨è¿™å¼ è·¯ç”±è¡¨å‘¢ï¼Ÿ æƒ³æƒ³æˆ‘ä»¬çš„ç›®æ ‡ï¼Œ**é€šè¿‡è·¯ç”±æ‰“å¼€ Activity**ï¼Œè·¯ç”±è¡¨é‡Œå­˜ç€è·¯ç”±å’Œç›®æ ‡ Class çš„å¯¹åº”å…³ç³»ï¼Œé‚£ä¹ˆäº‹æƒ…å°±å¾ˆç®€å•äº†ã€‚\n\n```java\npublic class QRouterApi {\n\n    public static void go(Activity activity, String route) {\n        try {\n            long begin = System.currentTimeMillis();\n            String log;\n            \n            Class tableClass = Class.forName(\"com.engineer.aptlite.QRouterTable\");\n            Method methodMap = tableClass.getMethod(\"map\", null);\n            HashMap<String, String> tables = (HashMap<String, String>) methodMap.invoke(tableClass.newInstance(), null);\n\n            System.err.println(\"tables===\" + tables);\n\n            String target = tables.get(route);\n\n            log = String.format(Locale.CHINA, \"use %f to find the target\", 1000f * (System.currentTimeMillis() - begin));\n            System.err.println(log);\n\n            if (!TextUtils.isEmpty(target)) {\n                Class targetClass = Class.forName(target);\n                Intent intent = new Intent(activity, targetClass);\n                activity.startActivity(intent);\n\n                log = String.format(Locale.CHINA, \"use %f to finish\", 1000f * (System.currentTimeMillis() - begin));\n                System.err.println(log);\n            }\n        } catch (ClassNotFoundException e) {\n            e.printStackTrace();\n        } \n        .... other execption stuff...\n    }\n}\n```\nè¿™ä¸ªé™æ€æ–¹æ³• go(activity,route) çš„æ ¸å¿ƒ\n\n- Class tableClass = Class.forName(\"com.engineer.aptlite.QRouterTable\"); åŠ è½½è·¯ç”±è¡¨\n- åå°„è·å– hashmap çš„å®ä¾‹\n- String target = tables.get(route); ä» hashmap ä¸­æ‰¾åˆ°è·¯ç”±åœ°å€å¯¹åº”çš„ Class \n- Class targetClass = Class.forName(target); åŠ è½½è¿™ä¸ª Class\n- åˆ›å»º Intent å®ä¾‹ï¼Œç„¶å startActivity(intent) å®ç° Activity çš„è·³è½¬ã€‚\n\n**ä»¥ä¸Šå®ç°ï¼Œä¸ºå²ä¸Šæœ€ç®€å•ã€æœ€ä¸‘é™‹ä¸”æœ€ä½æ•ˆè·¯ç”±è·³è½¬ Activity çš„æ–¹æ³•ï¼Œçœ‹å®Œä¹‹åï¼Œè¯·ç«‹åˆ»é—å¿˜ ğŸ˜³ğŸ˜³**\n\nè¿™æ ·ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ \n\n```java\nQRouterApi.go(this, \"/activity/second\")\n```\nå°±å¯ä»¥æ‰“å¼€ @QRouter(\"/activity/second\") è¿™ä¸ªæ³¨è§£æ‰€åœ¨çš„ Activity äº†ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥[å‚è€ƒæºç ](https://github.com/REBOOTERS/APT-Lite)ï¼Œç®€å•ä½“éªŒä¸€ä¸‹æ•ˆæœã€‚\n\n#### æ§½ç‚¹\n\nåœ¨æˆ‘ä»¬æ€è€ƒä»€ä¹ˆæ˜¯é«˜æ•ˆè·¯ç”±ä¹‹å‰ï¼Œé¦–å…ˆç®€å•æ€»ç»“ä¸€ä¸‹è¿™ä¸ªå²ä¸Šæœ€ç®€å•è·¯ç”±æœ‰å“ªäº›é—®é¢˜ï¼ˆä»¥ç›®æ ‡ä¸ºå¯¼å‘æ¥å¯¹æ¯”ï¼‰\n\n- go æ–¹æ³•å¤šæ¬¡ä½¿ç”¨å‘å°„ï¼Œæ•ˆç‡å ªå¿§ã€‚ç›®æ ‡ Class å…¶å®æ˜¯å¯ä»¥ç›´æ¥è·å–åˆ°ï¼Œåœ¨ç¼–è¯‘æœŸåœ¨ HashMap ä¸­å­˜å‚¨çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥ä¿å­˜ Classï¼Œè€Œä¸æ˜¯ Class è·¯å¾„çš„å­—ç¬¦ä¸²ã€‚\n- æ— æ³•æ”¯æŒ startActivityForResult çš„æƒ…æ™¯\n- æ²¡æœ‰å¾ˆå¥½çš„å®¹é”™æœºåˆ¶\n\n## ä¸€ä¸ªé«˜æ•ˆçš„è·¯ç”±åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„\n\nçœ‹å®Œä¸Šé¢çš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœåªæ˜¯ä¸ºäº†ç®€å•çº¯ç²¹çš„è§£è€¦ï¼Œè§£å†³ç±»ä¾èµ–çš„é—®é¢˜ï¼Œé‚£ä¹ˆè·¯ç”±çš„å®ç°å…¶å®æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚ä½†å®é™…æƒ…å†µä¸­ï¼Œå¹¶ä¸æ˜¯è¿™æ ·ã€‚ä¸€ä¸ªé«˜æ•ˆçš„è·¯ç”±æ¡†æ¶éœ€è¦è€ƒè™‘çš„ç‚¹å…¶å®å¾ˆå¤šã€‚\n\n- **æ”¯æŒæ•°æ®é€šä¿¡**\n\næ”¯æŒæ•°æ®é€šä¿¡ï¼Œå…¶å®æ˜¯ä¸€ä»¶å³å¯ä»¥å¾ˆç®€å•ï¼Œåˆä¼šå¾ˆå¤æ‚çš„äº‹æƒ…ã€‚è·¯ç”±åœ°å€æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯¹äºåŸºæœ¬çš„æ•°æ®ç±»å‹ int,float,char ä»¥åŠ String ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠéœ€è¦ä¼ é€’çš„å‚æ•°ç›´æ¥å†™åœ¨è·¯ç”±åœ°å€ä¸Šï¼Œæˆ– path æˆ– queryä¸­ã€‚æœ€ç»ˆé€šè¿‡è§£æ URL éƒ½æ˜¯å¯ä»¥è§£æåˆ°çš„ã€‚ä½†æ˜¯å¯¹äºå¯¹è±¡æ¥è¯´ï¼Œå°±æ¯”è¾ƒéš¾äº†ã€‚Android ä¸­ä¼ é€’å¯¹è±¡é‡‡ç”¨çš„ Intent æºå¸¦ bundle çš„æœºåˆ¶ã€‚è·¯ç”±åœ°å€ä»…ä»…æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ˜¯æ— æ³•ç›´æ¥å®Œæˆå¯¹è±¡ä¼ é€’çš„ã€‚é‚£ä¹ˆæ˜¯å¦æœ‰å…¶ä»–çš„æ–¹æ³•å‘¢ï¼Ÿå†æœ‰å¯¹äºåŸºç¡€æ•°æ®ç±»å‹ï¼Œå¦‚æœåŒºåˆ†å‚æ•°å’Œå®é™…åœ°å€å‘¢ï¼Ÿ\n\n- **é«˜æ•ˆå‡†ç¡®ï¼Œä¸èƒ½æ¯”åŸç”Ÿçš„è·³è½¬æœºåˆ¶å·®**\n\nè¿™ä¸ªæ˜¯å¿…é¡»çš„ï¼Œä½¿ç”¨è·¯ç”±ï¼Œå°‘ä¸äº†è·¯ç”±åŒ¹é…çš„è¿‡ç¨‹ï¼Œä½†å¹¶ä¸èƒ½å› æ­¤ï¼Œå¯¼è‡´é¡µé¢è·³è½¬æ—¶é—´å˜é•¿ï¼Œè®©ç”¨æˆ·ä½“éªŒå˜å¾—ç³Ÿç³•ã€‚\n\n- æœ‰å¾ˆå¥½çš„å®¹é”™æœºåˆ¶ï¼Œæˆ–è€…è¯´æ˜¯é™çº§ç­–ç•¥\n\nè·¯ç”±åœ°å€å†™é”™äº†ï¼Œæˆ–ç€æ˜¯ç›®æ ‡è·¯ç”±å› ä¸ºæŸäº›åŸå› ä¸å­˜åœ¨äº†ï¼Œæ˜¯å¦å¯ä»¥æœ‰å¾ˆå¥½çš„é™çº§ç­–ç•¥ï¼Œè€Œä¸æ˜¯ç®€å•çš„æŠ¥é”™æˆ–æ— å“åº”ã€‚\n\n- è·¯ç”±è·³è½¬æœ‰æ‹¦æˆªæœºåˆ¶æˆ–ä¼˜å…ˆçº§æœºåˆ¶\n\nåœ¨å¤šäººåä½œçš„å¼€å‘ä¸­ï¼Œè·¯ç”±åœ°å€åŒåæ˜¯ä¸å¤ªå¥½é¿å…çš„ï¼ˆä¸€ç§å¯è¡Œçš„æ–¹æ¡ˆæ˜¯æŠŠæ‰€æœ‰è·¯ç”±åœ°å€å®šä¹‰åœ¨ä¸€ä¸ªå…¬å…±çš„åœ°æ–¹ï¼‰ï¼Œå¯¹äºå·²ç„¶æ— æ³•æ”¹åŠ¨çš„ä»£ç ï¼Œæ˜¯å¦å¯ä»¥é€šè¿‡æ·»åŠ  Interceptor(ç±»ä¼¼ OKHTTP çš„æ€è·¯) æˆ–å®šä¹‰ä¼˜å…ˆçº§çš„æ–¹å¼ï¼Œè§£å†³æœ‰å†²çªçš„è·¯ç”±ï¼›æˆ–è€…å› æŸäº›ç‰¹æ®Šä¸šåŠ¡çš„éœ€æ±‚ï¼Œå¯ä»¥æ›´æ”¹è·¯ç”±åŸå§‹çš„è·³è½¬è¡Œä¸ºã€‚\n\n- æ”¯æŒç»„ä»¶åŒ–ï¼ˆå³å¤š module çš„æƒ…å½¢ï¼‰\n\nç»„ä»¶åŒ–å¼€å‘å·²ç»æˆä¸ºå¤§å‹é¡¹ç›®çš„æ ‡å‡†ï¼Œè·¯ç”±çš„ APT å®ç°æ˜¯å¦å¯ä»¥å®Œç¾åº”å¯¹å¤š module æƒ…å½¢ä¸‹è·¯ç”±è¡¨çš„æ­£ç¡®åˆ›å»ºåŠæŸ¥æ‰¾è§£æã€‚\n\n- ç¼–è¯‘æœŸç”Ÿæˆä»£ç ï¼Œä¸è¦å¤ªè€—æ—¶\n\néšç€ä½¿ç”¨ APT çš„åº“è¶Šæ¥è¶Šå¤šï¼Œåœ¨ç¼–è¯‘æœŸè¦åšçš„äº‹æƒ…ä¹Ÿè¶Šå¤šè¶Šå¤šï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥ä¿è¯åœ¨ç¼–è¯‘æœŸç”Ÿæˆä»£ç çš„è¿‡ç¨‹ï¼Œå¯ä»¥é«˜æ•ˆå¿«é€Ÿçš„å®Œæˆï¼ˆæ¯”å¦‚å¢é‡ç¼–è¯‘ï¼‰ï¼Œä¿è¯å¼€å‘äººå‘˜çš„æ•ˆç‡ä¸å—å½±å“ã€‚\n\næ›´å¤šã€‚ã€‚ã€‚\n\nä»¥ä¸Šè¿™äº›ç‚¹ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªåˆæ ¼çš„è·¯ç”±åº”è¯¥æ”¯æŒçš„åŸºç¡€åŠŸèƒ½ï¼ˆçº¯å±ä¸ªäººè§‚ç‚¹ï¼ŒğŸ˜ğŸ˜ğŸ˜ğŸ˜ï¼‰ã€‚[ARouter](https://github.com/alibaba/ARouter) åœ¨ GitHub å·²ç»æœ‰ 1 ä¸‡+ çš„ starï¼Œè¯´æ˜ä»–è¿˜æ˜¯å¾ˆå—å¼€å‘è€…è®¤å¯çš„ã€‚å®ƒçš„å®ç°æ˜¯å¦æ»¡è¶³äº†ä¸Šè¿°è¦æ±‚ï¼Œä»¥åŠå®ƒåˆæœ‰å“ªäº›ç‹¬æœ‰çš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å¸¦ç€è¿™äº›ç–‘é—®å»å­¦ä¹ ä¸€ä¸‹ä»–çš„å®ç°ã€‚\n\n### éœ€æ±‚æ¨åŠ¨æŠ€æœ¯\n\nå¾ˆå¤šæ—¶å€™ï¼Œéƒ½æ˜¯éœ€æ±‚æ¨åŠ¨æŠ€æœ¯è¿›æ­¥ï¼Œæ²¡æœ‰å®Œç¾çš„æ¡†æ¶ï¼Œå¾ˆå¤šæ—¶å€™éƒ½æ˜¯éœ€è¦åŸºäºç‰¹å®šçš„ä¸šåŠ¡å®æ–½ç‰¹å®šçš„æ–¹æ¡ˆï¼Œå› æ­¤ã€‚è·¯ç”±ä¹Ÿæ˜¯è¿™æ ·ã€‚\n\n\n## æ€»ç»“\n\nå›å½’åˆ°æœ¬è´¨ï¼Œåœ¨æ³¨è§£å¤„ç†å™¨çš„ process æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡\n\n```java\nSet<? extends Element> elements = roundEnv.getElementsAnnotatedWith(QRouter.class);\n```\n\nè¿™é‡Œçš„ Element åŒ…å«ç€è¿™ä¸ªæ³¨è§£æ‰€åœ¨ç±»çš„å…¨éƒ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»–æ‰€åœ¨ç±»ä»¥åŠä»–çš„çˆ¶ç±»ç­‰å„ç§ä¿¡æ¯ï¼Œæœ‰äº†è¿™äº›ä¿¡æ¯æˆ‘ä»¬å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ã€‚\n\nå°±æ¯”å¦‚è¿™é‡Œçš„ QRouter æ³¨è§£ï¼ŒæŠŠè¿™ä¸ªæ³¨è§£æ‰“åœ¨ Activity ä¸Šï¼Œå¹¶åœ¨ç¼–è¯‘æœŸç”Ÿæˆè·¯ç”±è¡¨ï¼Œè€Œåœ¨è¿è¡Œæ—¶é€šè¿‡è·¯ç”±è¡¨é‡Œçš„ä¿¡æ¯ï¼Œåœ¨ç‰¹å®šçš„ API é‡Œå°è£…çš„ startActivity è¿™ç§ç±»ä¼¼æ¨¡æ¿çš„ä»£ç ï¼Œå¯¹å¤–æš´éœ²äº†æ›´è½»é‡çº§çš„ APIï¼Œä½¿å¾—é¡µé¢çš„è·³è½¬å®ç°å˜å¾—ä¼¼ä¹ç®€å•äº†è®¸å¤šã€‚\nAPI.go ä¸€è¡Œç®€å•çš„ä»£ç ç®€åŒ–äº†åŸæœ¬çš„å¤æ‚å®ç°ï¼Œå¯¹å¼€å‘è€…æ¥è¯´æ›´åŠ å‹å¥½äº†ã€‚\n\nè·¯ç”±çš„å®ç°ï¼Œåœ¨æŸäº›æ–¹é¢è¿˜æ˜¯éå¸¸ä¾èµ–å…·ä½“ä¸šåŠ¡è§„èŒƒçš„ã€‚æ²¡æœ‰å®Œç¾çš„è·¯ç”±ï¼Œåªæœ‰åˆé€‚çš„è·¯ç”±ã€‚\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["Routerã€APTã€æ³¨è§£"]},{"title":" å®‰è£… go2shell åˆ° Finder å·¥å…·æ çš„æ–¹æ³•","url":"%2F2019%2F06%2F21%2F%E5%AE%89%E8%A3%85-go2shell-%E5%88%B0-Finder-%E5%B7%A5%E5%85%B7%E6%A0%8F%E7%9A%84%E6%96%B9%E6%B3%95%2F","content":"\nMac ä¸Šä½¿ç”¨ go2shell çš„æ­£ç¡®æ–¹å¼\n\n1. [go2shell å®˜ç½‘](https://zipzapmac.com/go2shell) æˆ– App Store ä¸‹è½½ go2shell å®‰è£…\n2. ä» Finder Application ç›®å½•ä¸‹,æŒ‰ä½ Command é”®ï¼Œæ‹–åŠ¨ go2shell åº”ç”¨ç¨‹åºåˆ° Finder å·¥å…·æ \n\n<!--more-->\n\n<img src=\"å®‰è£…-go2shell-åˆ°-Finder-å·¥å…·æ çš„æ–¹æ³•/install.webp\">\n\n3. åœ¨éœ€è¦æ‰“å¼€çš„ç›®å½•ï¼Œç‚¹å‡»å›¾æ ‡å³å¯\n\n<img src=\"å®‰è£…-go2shell-åˆ°-Finder-å·¥å…·æ çš„æ–¹æ³•/result.png\">","tags":["macã€å·¥å…·ã€é«˜æ•ˆå·¥ä½œ"]},{"title":"ç”¨ SugarAdapter ç®€åŒ–å¤æ‚åˆ—è¡¨çš„å®ç°","url":"%2F2019%2F06%2F16%2F%E7%94%A8-SugarAdapter-%E7%AE%80%E5%8C%96%E5%A4%8D%E6%9D%82%E5%88%97%E8%A1%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%2F","content":"\n<img src=\"ç”¨-SugarAdapter-ç®€åŒ–å¤æ‚åˆ—è¡¨çš„å®ç°\\SugarAdapter.png\" width=500>\n\n## å‰è¨€\n\nåœ¨ä¸€ä¸ª App ä¸­ Feed æµç±»å‹çš„é¡µé¢éå¸¸ä¾èµ– RecyclerView çš„ä½¿ç”¨ï¼Œæœ‰å¤§é‡çš„åˆ—è¡¨ã€‚è€Œåˆ—è¡¨ä¸­å¡ç‰‡(å³åˆ—è¡¨ä¸­çš„ Itemï¼Œä»¥ä¸‹ç»Ÿç§°å¡ç‰‡)æœ‰å¾ˆå¤šç§æ ·å¼ï¼Œå¹¶ä¸”ä¸åŒçš„æ ·å¼å¯¹åº”çš„ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ï¼Œä½¿å¾— Adapter çš„å®ç°éå¸¸çš„çˆ†ç‚¸ï¼Œå› æ­¤éœ€è¦ä¸€ç§åˆé€‚çš„æ–¹å¼å»å®ç° Adapterã€‚\n\næœ¬æ–‡ç»“åˆæ—¥å¸¸å¼€å‘çš„åœºæ™¯ï¼Œç®€å•åˆ†æä¸€ä¸‹ï¼Œä½¿ç”¨å¸¸è§„æ‰‹æ³•å¦‚ä½•æœ€å¤§çš„ç¨‹åº¦çš„ä¼˜åŒ– RecyclerView çš„ Adapter çš„å®ç°ã€‚æœ€ååˆ†æä¸€ä¸‹ SugarAdapterï¼Œçœ‹çœ‹ä½¿ç”¨å®ƒæ˜¯å¦‚ä½•è§£å†³å¸¸è§„å®ç°ç—›ç‚¹çš„ã€‚\n\n<!--more-->\n\n<!-- TOC -->\n\n- [å‰è¨€](#%E5%89%8D%E8%A8%80)\n- [SugarAdapter æ˜¯ä»€ä¹ˆ ï¼Ÿ](#sugaradapter-%E6%98%AF%E4%BB%80%E4%B9%88)\n- [å¸¸è§„çš„ Adapter æœ‰ä»€ä¹ˆç—›ç‚¹](#%E5%B8%B8%E8%A7%84%E7%9A%84-adapter-%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%9B%E7%82%B9)\n  - [ViewHolder çš„æœ¬è´¨](#viewholder-%E7%9A%84%E6%9C%AC%E8%B4%A8)\n- [SugarAdapter å¦‚ä½•è§£å†³äº†è¿™äº›ç—›ç‚¹](#sugaradapter-%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E4%BA%86%E8%BF%99%E4%BA%9B%E7%97%9B%E7%82%B9)\n  - [Layout & ViewHolder](#layout--viewholder)\n  - [SugarAdapter](#sugaradapter)\n    - [Build æ¨¡å¼](#build-%E6%A8%A1%E5%BC%8F)\n      - [Container](#container)\n    - [add() çš„å…·ä½“å®ç°](#add-%E7%9A%84%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0)\n    - [Sugar](#sugar)\n  - [ç—›ç‚¹å¦‚ä½•è¢«æ¶ˆé™¤](#%E7%97%9B%E7%82%B9%E5%A6%82%E4%BD%95%E8%A2%AB%E6%B6%88%E9%99%A4)\n    - [getItemViewType](#getitemviewtype)\n    - [onCreateViewHolder](#oncreateviewholder)\n    - [onBindViewHolder](#onbindviewholder)\n    - [å°ç»“](#%E5%B0%8F%E7%BB%93)\n- [SugarAdapter è¿˜èƒ½åšä»€ä¹ˆ](#sugaradapter-%E8%BF%98%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88)\n  - [**â€œä¸€ç§â€** æ•°æ®å¯¹åº”ä¸åŒçš„æ ·å¼](#%E4%B8%80%E7%A7%8D-%E6%95%B0%E6%8D%AE%E5%AF%B9%E5%BA%94%E4%B8%8D%E5%90%8C%E7%9A%84%E6%A0%B7%E5%BC%8F)\n    - [è§„åˆ™](#%E8%A7%84%E5%88%99)\n  - [ç”Ÿå‘½å‘¨æœŸå›è°ƒ å’Œ Lifecycleowner çš„æ”¯æŒã€‚](#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%9E%E8%B0%83-%E5%92%8C-lifecycleowner-%E7%9A%84%E6%94%AF%E6%8C%81)\n- [æ€»ç»“](#%E6%80%BB%E7%BB%93)\n\n<!-- /TOC -->\n\n\n\n## SugarAdapter æ˜¯ä»€ä¹ˆ ï¼Ÿ\n\n>[SugarAdapter](https://github.com/zhihu/SugarAdapter),        Make RecyclerView.Adapter Great Again!\n\n## å¸¸è§„çš„ Adapter æœ‰ä»€ä¹ˆç—›ç‚¹\n\né¢å¯¹ä¸€ä¸ªæœ‰ä¸Šç™¾ç§å¡ç‰‡æ ·å¼çš„ RecyclerView ï¼Œç®€å•ç²—æš´çš„åšæ³•å¯èƒ½å°±æ˜¯æŠŠæ‰€æœ‰å¯èƒ½éœ€è¦æ˜¾ç¤ºçš„ UI å…ƒç´ æ€¼åœ¨ä¸€ä¸ª xml å¸ƒå±€æ–‡ä»¶é‡Œï¼Œç„¶ååœ¨ Adapter é‡Œæ ¹æ®æ•°æ®å¯¹ view åš visible/invisible/gone åŠ setXXX çš„æ“ä½œï¼Œè¿™æ— ç–‘æ˜¯æœ€ç³Ÿç³•çš„åšæ³•ï¼Œä»£ç ä¼šçˆ†ç‚¸ï¼Œæ€§èƒ½æ›´æ˜¯å ªå¿§ï¼ŒåŸºæœ¬ä¸Šå°±æ— æ³•ç»´æŠ¤äº†ã€‚\n\næ¢ä¸ªæ€è·¯ï¼Œæœ¬è´¨ä¸Šæ¯ä¸€ç§å¡ç‰‡æ ·å¼å…¶å®å°±æ˜¯ä¸€ç§ ViewHolderï¼ˆonCreateViewHolder è¿”å›å€¼æ˜¯ Holder,è‡³äºä¸ºå•¥æ˜¯ Holderï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å› Viewï¼Œç”¨è¿‡ä¸Šå¤ç¥å™¨ ListView çš„åŒå­¦ä¸€å®šçŸ¥é“åŸå› çš„ï¼‰ ï¼Œé‚£ä¹ˆé¢å¯¹è¿™ä¹ˆå¤šçš„å¡ç‰‡æ ·å¼ï¼Œå†™ä¸€å¤§å † ViewHolder å°±å¯ä»¥äº†ï¼Œäº‹å®ä¸Šåœ¨å¤§éƒ¨åˆ†æ—¶å€™ï¼Œæˆ‘ä»¬ç¡®å®æ˜¯è¿™ä¹ˆåšçš„ï¼Œæ–°çš„éœ€æ±‚æ¥äº†ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„ ViewHolder æˆ–è€…æ˜¯ç»§æ‰¿ä¸€ä¸ªå·²æœ‰çš„ ViewHolder åšä¸€ä¸‹æ‰©å±•å°±å¯ä»¥äº†ã€‚\n\nä¸‹é¢ç”¨æœ€ç®€å•çš„ä»£ç ï¼Œæè¿°ä»¥ä¸‹ä¸Šè¿°å®ç°ã€‚\n\n```java\npublic class NormalAdapter extends RecyclerView.Adapter<NormalAdapter.MyHolder> {\n\n    private List<String> datas = new ArrayList<>();\n    private static final int VIEW_TYPE_A = 0;\n    private static final int VIEW_TYPE_B = 1;\n\n    public NormalAdapter(List<String> datas) {\n        this.datas = datas;\n    }\n\n    @NonNull\n    @Override\n    public MyHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\n        if (viewType == VIEW_TYPE_A) {\n            View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.layout_type_a, parent, false);\n            return new HolderA(view);\n        } else if (viewType == VIEW_TYPE_B) {\n            View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.layout_type_b, parent, false);\n            return new HolderB(view);\n        } else {\n            // more view_type stuff\n            return null;\n        }\n    }\n\n    @Override\n    public void onBindViewHolder(@NonNull MyHolder holder, int position) {\n        int viewType = getItemViewType(position);\n        if (viewType == VIEW_TYPE_A) {\n            // data-to-ui  stuff\n        } else {\n            // data-to-ui  stuff\n        }\n    }\n\n    @Override\n    public int getItemViewType(int position) {\n        if (position % 2 == 0) {\n            return VIEW_TYPE_A;\n        } else {\n            return VIEW_TYPE_B;\n        }\n    }\n\n    @Override\n    public int getItemCount() {\n        return datas.size();\n    }\n\n    public class MyHolder extends RecyclerView.ViewHolder {\n\n        public MyHolder(@NonNull View itemView) {\n            super(itemView);\n        }\n    }\n\n    public class HolderA extends MyHolder {\n        public HolderA(@NonNull View itemView) {\n            super(itemView);\n        }\n    }\n\n    public class HolderB extends MyHolder {\n        public HolderB(@NonNull View itemView) {\n            super(itemView);\n        }\n    }\n```\n\n}\n\nå¦‚ä¸Šï¼Œæ˜¯ RecyclerView.Adapter å®ç°çš„å¸¸è§„æ“ä½œã€‚ViewHolderA å’Œ ViewHolderB å¯¹åº”ä¸åŒçš„å¡ç‰‡æ ·å¼ã€‚å¦‚æœæœ‰æ–°çš„æ ·å¼ï¼Œç»§ç»­æ·»åŠ å³å¯ã€‚ä½†æ˜¯æ¯æ·»åŠ ä¸€ä¸ªæ–°çš„ ViewHolder ,å°±éœ€è¦æ”¹ä¸‰ä¸ªæ–¹æ³•(getItemViewType,onCreateViewHolder,onBindViewHolder).å½“ç„¶ï¼Œå¯ä»¥é€šè¿‡å·¥å‚æ–¹æ³•ç­‰è®¾è®¡æ¨¡å¼ï¼Œä¿®æ”¹å…·ä½“åˆ›å»º ViewHolder çš„æ–¹æ³•ï¼Œä½†æœ¬è´¨ä¸Šè¦ä¿®æ”¹çš„åœ°æ–¹ä¸ä¼šå˜å°‘ã€‚\n\n### ViewHolder çš„æœ¬è´¨\n\n```java\n    @Override\n    public int getItemViewType(int position) {\n        Object object = datas.get(position);\n        if (object instanceof ModelA) {\n            return VIEW_TYPE_A;\n        } else if (object instanceof ModelB) {\n            return VIEW_TYPE_B;\n        }else {\n            return -1;\n        }\n    }\n```\n\n> ç”±äº RecyclerView æ²¡æœ‰æä¾›åŸç”Ÿçš„æ–¹æ³•ç”¨æ¥ä¸ºåˆ—è¡¨æ·»åŠ  Header å’Œ Footer ï¼Œå› æ­¤æœ‰åœ¨ position ä¸º 0 å’Œåˆ—è¡¨æœ«å°¾æ—¶ï¼Œè¿”å›ç‰¹å®šçš„ viewtype æ¥æ·»åŠ  Header å’Œ Footer ä¹Ÿæ˜¯ä¸€ç§å¸¸è§„ç”¨æ³•ã€‚\n\nå‡è®¾ï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦æ·»åŠ  ViewHolderCï¼Œæˆ‘ä»¬éœ€è¦ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\n\n- ä» getItemViewType å¼€å§‹ï¼Œç¡®å®š ViewType çš„å€¼ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¼šæ ¹æ®æ•°æ®ç±»å‹ç¡®å®šè¿™ä¸ªå€¼ã€‚å½“ç„¶ï¼Œè¿™é‡Œä¸ä¸€å®šé€šè¿‡ instanceof å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ•°æ®ä¸­ç‰¹å®šå­—æ®µå®ç°ï¼Œä½†æœ¬è´¨æ˜¯ç›¸åŒçš„ï¼Œæ•°æ®å†³å®š viewType ç±»å‹ã€‚\n- ç„¶å**æ ¹æ®è¿™ä¸ª ViewType** åœ¨ onCreateViewHolder æ–¹æ³•ä¸­ç¡®å®šå…¶å¯¹åº”çš„ ViewHolder çš„ç±»å‹ï¼Œæ›´è¿›ä¸€æ­¥æ¥è¯´æ˜¯**ç¡®å®šäº†è¦ inflate çš„ xml èµ„æºæ–‡ä»¶**ï¼Œé€šè¿‡è¿™ä¸ª xml å¯¹åº”çš„ view åˆ›å»º ViewHolderã€‚\n- æœ€åï¼Œåœ¨ onBindViewHolder ï¼Œæˆ‘ä»¬ç¡®å®šäº†æœ€ç»ˆéœ€è¦ä½¿ç”¨çš„ ViewHolder å’Œ Modelï¼ˆæ•°æ®ç±»å‹ï¼‰ï¼Œè¿™é‡Œå¯èƒ½éœ€è¦å¼ºè½¬ä»¥ä¸‹ï¼Œä½†æ˜¯åªè¦ä»¥ä¸Šä¸¤æ­¥æ²¡æœ‰é”™ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼ºè½¬æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚\n\nä½†æ˜¯ï¼Œè¿˜æ˜¯å›åˆ°ä¸€å¼€å§‹è¦é¢å¯¹çš„é—®é¢˜ï¼Œé¢å¯¹ä¸Šç™¾ç§çš„å¡ç‰‡æ ·å¼ï¼Œè¿™ç§æ–¹å¼åˆå˜å¾—ä¸å¤ªå‹å¥½ï¼Œæ¯æ¬¡æ·»åŠ ä¸€ä¸ªæ–°çš„ ViewHolderï¼Œéœ€è¦ä¿®æ”¹å·²æœ‰ä»£ç ï¼Œæ— ç–‘ä¼šå¸¦æ¥ä¸å¯é¢„æ–™çš„ bugã€‚\n\né‚£ä¹ˆæˆ‘ä»¬æ”¹å¦‚ä½•é¢å¯¹è¿™ç§æƒ…å†µå‘¢ï¼Ÿ ä¸€ç§å¯è¡Œçš„è§£å†³æ–¹å¼ [å½»åº•è§£è€¦ RecyclerView.Adapter](https://puke3615.github.io/2018/08/26/Android-RecyclerView-Architecture-Design/),è¿™ç¯‡æ–‡ç« ä¸­æåˆ°çš„è§£å†³æ–¹å¼å…¶å®å’Œæ¥ä¸‹æ¥è¦åˆ†æçš„ SugarAdapter çš„æ€è·¯å¤§è‡´ç›¸åŒï¼Œåªä¸è¿‡ SugarAdapter é‡‡ç”¨æ³¨è§£çš„æ–¹å¼ï¼Œå…å»äº†è‡ªå»ºå·¥å‚ç±»çš„éº»çƒ¦ï¼Œå®ç°æ›´åŠ çš„ä¼˜é›…ï¼Œå› æ­¤ä½¿ç”¨èµ·æ¥ä¹Ÿæ›´åŠ çš„æ–¹ä¾¿ã€‚\n\n## SugarAdapter å¦‚ä½•è§£å†³äº†è¿™äº›ç—›ç‚¹\n\nå…³äºå¦‚ä½•ä½¿ç”¨ SugarAdapter åŠå®ƒå¯ä»¥è¦†ç›–å“ªäº›åœºæ™¯ï¼Œè¿™é‡Œå°±ä¸å†å±•å¼€äº†ï¼Œå‚è€ƒå…¶ [README æ–‡æ¡£](https://github.com/zhihu/SugarAdapter)ï¼Œå°±å¯ä»¥éå¸¸ç®€å•è€Œåˆå¿«é€Ÿçš„ä¸Šæ‰‹äº†,éå¸¸å¥½ç”¨ï¼Œå¢™è£‚æ¨è ï¼ï¼ï¼\n\n### Layout & ViewHolder\n\né¦–å…ˆçœ‹ä¸€ä¸‹å¦‚ä½•åˆ›å»ºä¸€ä¸ª ViewHolder\n\n```java\n@Layout(R.layout.layout_bar)\npublic final class BarHolder extends SugarHolder<Bar> {\n\n    @Id(R.id.text)\n    public AppCompatTextView mTextView;\n\n\n    public BarHolder(@NonNull View view) {\n        super(view);\n    }\n\n    @Override\n    protected void onBindData(@NonNull Bar bar) {\n        mTextView.setText(bar.getText());\n    }\n}\n```\n\nçœ‹ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºä¸€ä¸ª ViewHolder åªéœ€è¦åš 4 ä»¶äº‹æƒ…\n\n- Layout æ³¨è§£æä¾› ViewHolder å¯¹åº”çš„ xml å¸ƒå±€æ–‡ä»¶\n- ç»§æ‰¿ SugarHolder å¹¶æŒ‡å®šæ³›å‹çš„å…·ä½“ç±»å‹\n- ä¸ºç”¨åˆ°çš„ View åŠ ä¸Š @ID çš„æ³¨è§£ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨å¸®ä½  fvb(å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±åœ¨æ„é€ å‡½æ•°é‡Œå†™ fvbï¼›å¦‚æœä½ åœ¨ç”¨ kotlin,å¿½ç•¥è¿™æ¡)\n- å®ç° onBindData æ–¹æ³•ï¼Œå®Œæˆæ•°æ®å’Œ UI çš„ç»‘å®šã€‚\n\nä¸Šé¢çš„æ³¨è§£åœ¨ç¼–è¯‘æœŸï¼Œä¼šç”Ÿæˆå¦‚ä¸‹çš„æ–‡ä»¶ï¼ˆå…³äº SugarAdapter æ³¨è§£å¤„ç†å™¨å¦‚ä½•è§£ææ³¨è§£åŠç”Ÿæˆæ–‡ä»¶,å¯ä»¥å‚è€ƒ[SugarAdapter æ³¨è§£å¤„ç†å™¨åˆ†æ](https://rebooters.github.io/2019/06/04/SugarAdapter-%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E5%88%86%E6%9E%90/)ï¼‰\n\n**ContainerDelegateImpl.java**\n\nåœ¨ build/generated/source/apt/debug/com/zhihu/android/sugaradapter/ ç›®å½•ä¸‹ ï¼ˆç”Ÿæˆçš„ä»£ç æ˜¯ ViewHolder ç±»åç›¸å…³ï¼Œä¸ä¸€å®šå’Œè¿™é‡Œå®Œå…¨ç›¸åŒï¼Œä½†æ–¹æ³•ä½“åŠå®ç°æ˜¯é›·åŒçš„ï¼‰\n\n```java\npublic final class ContainerDelegateImpl implements ContainerDelegate {\n    private Map<Class<? extends SugarHolder>, Integer> mLayoutResMap;\n    private Map<Class<? extends SugarHolder>, Class> mDataClassMap;\n\n    public ContainerDelegateImpl() {\n        mLayoutResMap = new HashMap<>();\n        mDataClassMap = new HashMap<>();\n\n        mLayoutResMap.put(com.zhihu.android.sugaradapterdemo.holder.BarHolder.class, com.zhihu.android.sugaradapterdemo.R.layout.layout_bar);\n        mDataClassMap.put(com.zhihu.android.sugaradapterdemo.holder.BarHolder.class, com.zhihu.android.sugaradapterdemo.item.Bar.class);\n    }\n\n    @NonNull\n    public Map<Class<? extends SugarHolder>, Integer> getLayoutResMap() {\n        return mLayoutResMap;\n    }\n\n    @NonNull\n    public Map<Class<? extends SugarHolder>, Class> getDataClassMap() {\n        return mDataClassMap;\n    }\n\n    @Override\n    @LayoutRes\n    public int getLayoutRes(@NonNull Class<? extends SugarHolder> holderClass) {\n        return mLayoutResMap.get(holderClass);\n    }\n\n    @Override\n    @NonNull\n    public Class getDataClass(@NonNull Class<? extends SugarHolder> holderClass) {\n        return mDataClassMap.get(holderClass);\n    }\n}\n```\n\nè¿™ä¸ªæ–‡ä»¶é€šè¿‡ HashMap å»ºç«‹äº†ä¸¤ä¸ªæ˜ å°„å…³ç³»\n\n- ViewHolder å’Œå…¶å¯¹åº”çš„ xml å¸ƒå±€æ–‡ä»¶çš„ id\n- ViewHolder å’Œå…¶å¯¹åº”çš„ Model ç±»\n\n**BarHolder\\$InjectDelegateImpl.java**\n\nåœ¨ build/generated/source/apt/debug/ ç›®å½•ä¸‹\n\n```java\npublic final class BarHolder$InjectDelegateImpl implements InjectDelegate {\n    @Override\n    @SuppressLint(\"ResourceType\")\n    public <SH extends SugarHolder> void injectView(@NonNull SH sh, @NonNull View view) {\n        if (sh instanceof com.zhihu.android.sugaradapterdemo.holder.BarHolder) {\n            com.zhihu.android.sugaradapterdemo.holder.BarHolder th = (com.zhihu.android.sugaradapterdemo.holder.BarHolder) sh;\n            th.mTextView = (androidx.appcompat.widget.AppCompatTextView) view.findViewById(com.zhihu.android.sugaradapterdemo.R.id.text);\n        }\n    }\n}\n```\n\nè¿™ä¸ªæ–‡ä»¶ï¼Œä¹Ÿæ˜¯åšäº†ä¸¤ä»¶äº‹\n\n- ViewHolder çš„å¼ºåˆ¶ç±»å‹è½¬æ¢\n- ViewHolder å¯¹åº”æ§ä»¶çš„ findViewById æ“ä½œ\n\nä¸‹é¢å°±ä» SugarAdapter æœ€åŸºç¡€çš„ç”¨æ³•çœ‹çœ‹ä»–çš„å…·ä½“å®ç°\n\n### SugarAdapter\n\n```java\nList<Object> list = new ArrayList<>();\n        SugarAdapter adapter = SugarAdapter.Builder.with(list)\n                .add(FooHolder.class)\n                .add(BarHolder.class)\n                .build();\n                \n                \n        recyclerView.setAdapter(adapter);\n        for (int i = 0; i < 100; i++) {\n            String text = String.valueOf(i);\n            list.add(i % 2 == 0 ? new Foo(text) : new Bar(text));\n        }\n        adapter.notifyDataSetChanged();\n```\n\nä»¥ä¸Šå°±æ˜¯ SugarAdapter æœ€åŸºç¡€çš„ç”¨æ³•ï¼Œå¯ä»¥çœ‹åˆ°åˆ›å»º adapter çš„æ“ä½œéå¸¸ç®€å•ã€‚è¿™é‡Œæ·»åŠ äº†ä¸¤ä¸ª ViewHolderï¼Œæ•°æ®ç±»å‹ä¹Ÿæœ‰ä¸¤ç§ï¼Œå®é™…æ˜¾ç¤ºçš„ RecyclerView ä¼šæ ¹æ®æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«æ˜¾ç¤ºè¿™ä¸¤ç§å¡ç‰‡ã€‚é‚£ä¹ˆä»–æ˜¯æ€ä¹ˆåšåˆ°å‘¢ï¼Œä¸‹é¢å°±ä»ä»–çš„å®ç°å¼€å§‹çœ‹çœ‹ã€‚\n\n<img src=\"ç”¨-SugarAdapter-ç®€åŒ–å¤æ‚åˆ—è¡¨çš„å®ç°\\sugar.png\" height=300>\n\n#### Build æ¨¡å¼\n\n```java\npublic final class SugarAdapter extends RecyclerView.Adapter<SugarHolder> {\n    private static final String TAG = \"SugarAdapter\";\n\n    public static final class Builder {\n        private List<?> mList;\n        private SparseArray<Container> mArray;\n\n        @NonNull\n        public static Builder with(@NonNull List<?> list) {\n            return new Builder(list);\n        }\n\n        private Builder(@NonNull List<?> list) {\n            mList = list;\n            mArray = new SparseArray<>();\n        }\n\n        @NonNull\n        public <SH extends SugarHolder> Builder add(@NonNull Class<SH> holderClass) {\n            return add(holderClass, null);\n        }\n\n        ....\n\n        @NonNull\n        public SugarAdapter build() {\n            if (mArray.size() <= 0) {\n                throw new IllegalStateException(\"must add at least one Class<? extends SugarHolder>\");\n            }\n\n            return new SugarAdapter(mList, mArray);\n        }\n    }\n}\n\n```\n\næœ¬è´¨ä¸Šæ¥è¯´ï¼ŒSugarAdapter æ˜¯ç»§æ‰¿è‡ª RecyclerView.Adapterï¼Œæ³›å‹é‡Œçš„ ViewHolder ç”¨çš„æ˜¯ SugarHolderã€‚é¦–å…ˆè¿™é‡Œé€šè¿‡ä¸€ä¸ª Builder æ¨¡å¼æ„å»ºäº†æ‰€æœ‰éœ€çš„æ•°æ®çš„é›†åˆã€‚\n\n##### Container\n\n```java\nclass Container {\n    private Class<? extends SugarHolder> mHolderClass;\n    private Class<?> mDataClass;\n    private int mLayoutRes;\n    private SugarHolder.OnCreatedCallback mCallback;\n    private Object mData;\n\n    Container(@NonNull Class<? extends SugarHolder> holderClass,\n              @NonNull Class<?> dataClass, @LayoutRes int layoutRes,\n              @Nullable SugarHolder.OnCreatedCallback callback) {\n        mHolderClass = holderClass;\n        mDataClass = dataClass;\n        mLayoutRes = layoutRes;\n        mCallback = callback;\n    }\n\n    .....\n}\n```\n\nContainer æ˜¯å¯¹æ‰€æœ‰éœ€è¦ç”¨åˆ°çš„å¯¹è±¡ç±»å‹çš„åŒ…è£….\n\n<span id=sugar-add>\n\n#### add() çš„å…·ä½“å®ç°\n\n```java\n@NonNull\n        public <SH extends SugarHolder> Builder add(\n                @NonNull Class<SH> holderClass, @Nullable SugarHolder.OnCreatedCallback<SH> callback) {\n            ContainerDelegate delegate = Sugar.INSTANCE.getContainerDelegate();\n            Class dataClass = delegate.getDataClass(holderClass);\n            int layoutRes = delegate.getLayoutRes(holderClass);\n\n            if (layoutRes == 0) {\n                throw new IllegalStateException(holderClass.getCanonicalName()\n                        + \" must have an annotation @Layout(R.layout.*)\");\n            }\n\n            mArray.put(holderClass.hashCode(), new Container(holderClass, dataClass, layoutRes, callback));\n            return this;\n        }\n```\n\nadd çš„å®ç°å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡ Sugar è¿™ä¸ªå•ä¾‹ç±»é€šè¿‡åå°„çš„æ–¹å¼è·å–åˆ° ContainerDelegateImpl çš„å®ä¾‹ï¼Œ[å‰é¢]()å·²ç»è¯´è¿‡äº†ï¼Œ**è¿™ä¸ªå®ç°å…¶å®å°±æ˜¯ä¸€ä¸ª ViewHolder å’Œå…¶å¯¹åº”çš„ æ•°æ®ç±»å‹åŠå¸ƒå±€æ–‡ä»¶çš„ä¸€ä¸ªæ˜ å°„é›†åˆã€‚å› æ­¤ï¼Œè¿™ä¸€æ­¥è¦åšçš„å°±æ˜¯é€šè¿‡ holder ä»æ˜ å°„é›†åˆä¸­è·å–åˆ°å½“å‰ ViewHolder å¯¹åº”çš„æ•°æ®ç±»å‹å’Œå¸ƒå±€æ–‡ä»¶ xml æ–‡ä»¶çš„ id**\n\n**å…³é”®çš„æ­¥éª¤**\n\n```java\n Class dataClass = delegate.getDataClass(holderClass);\n int layoutRes = delegate.getLayoutRes(holderClass);\n```\n\n#### Sugar\n\n```java\nenum Sugar {\n    INSTANCE;\n\n    private ContainerDelegate mContainerDelegate;\n    private Map<Class<? extends SugarHolder>, InjectDelegate> mInjectMap;\n\n    @NonNull\n    ContainerDelegate getContainerDelegate() {\n        if (mContainerDelegate == null) {\n            try {\n                Class delegateClass = Class.forName(\"com.zhihu.android.sugaradapter.ContainerDelegateImpl\");\n                mContainerDelegate = (ContainerDelegate) delegateClass.newInstance();\n            } catch (Exception e) {\n                throw new RuntimeException(e);\n            }\n        }\n\n        return mContainerDelegate;\n    }\n}\n```\n\nè‡³æ­¤ï¼Œåœ¨ build æ–¹æ³•è°ƒç”¨çš„ç¬é—´ï¼Œå°±å¦‚ä½•è§£å†³äº†ä¹‹å‰çš„ç—›ç‚¹åšå¥½äº†é“ºå«ã€‚ViewHolder,Model.class,R.layout.xxx ä¹‹é—´çš„å¯¹åº”å…³ç³»å·²ç»è¢«æ¢³ç†å¥½ï¼Œå¹¶ä¿å­˜åœ¨ mArray è¿™ä¸ªé›†åˆä¸­äº†ã€‚\n\n<img src=\"ç”¨-SugarAdapter-ç®€åŒ–å¤æ‚åˆ—è¡¨çš„å®ç°\\SugarAdapter.png\">\n\né€šè¿‡ä¸Šå›¾å¯ä»¥æ¸…æ™°çœ‹åˆ°å„ä¸ªä¹‹é—´çš„å…³ç³»äº†ï¼ŒSugar å¯ä»¥ç†è§£ä¸º SugarAdapter å’Œ SugarHolder çš„ä»£ç†ç±»ï¼Œæ–¹ä¾¿å…¶è·å–ç”Ÿæˆç±»çš„å®ä¾‹ã€‚æœ€ç»ˆåœ¨ SugarAdapter çš„ mArray é›†åˆä¸­å­˜å‚¨ç€æ‰€æœ‰å…³é”®ä¿¡æ¯ï¼Œä¸‹é¢å°±çœ‹çœ‹è¿™äº›å…³é”®ä¿¡æ¯æ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ã€‚\n\n### ç—›ç‚¹å¦‚ä½•è¢«æ¶ˆé™¤\n\næŒ‰ç…§ä¹‹å‰çš„å¸¸è§„çš„é€»è¾‘ï¼Œç—›ç‚¹æ— éå°±æ˜¯æ–°å¢æ ·å¼ï¼ˆViewHolderï¼‰éœ€è¦ getItemViewType,onCreateViewHolder,onBindViewHolder è¿™ä¸‰ä¸ªæ–¹æ³•è½®æµæ”¹ä¸€éã€‚é‚£ä¹ˆæœ‰äº†ä¹‹å‰çš„é“ºå«ï¼ŒSugarAdapter åˆæ˜¯å¦‚è§£å†³è¿™äº›ç—›ç‚¹çš„å‘¢ï¼Ÿ\næˆ‘ä»¬è¿˜æ˜¯å›åˆ° SugarAdapter ä¸­ã€‚\n\n#### getItemViewType\n\n```java\npublic int getItemViewType(@IntRange(from = 0) int position) {\n        Object data = mList.get(position);\n\n        ....\n\n        for (int i = 0; i < mArray.size(); i++) {\n            int key = mArray.keyAt(i);\n            Container container = mArray.get(key);\n            if (container.getDataClass() == data.getClass()) {\n                container.setData(data);\n                return key;\n            }\n        }\n\n        throw new RuntimeException(\"getItemViewType failed, data: \" + data.getClass().getCanonicalName()\n                + \", please make sure you have associated it with a Class<? extends SugarHolder>\");\n    }\n```\n\næ²¡é”™ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ã€‚ç¬¬ä¸€æ­¥ï¼Œè·å–æ•°æ®é›†åˆä¸­ï¼Œå½“å‰ä½ç½®çš„æ•°æ®ç±»å‹ï¼Œç„¶åéå†ä¹‹å‰ä¿å­˜å¥½çš„ mArray é›†åˆï¼Œæ‰¾çš„é‚£ä¸ªä¸å½“å‰æ•°æ®ç±»å‹åŒ¹é…çš„ key (ä¹Ÿå°±æ˜¯ viewtype) è¿”å›å³å¯ã€‚æœ¬è´¨æ¥è¯´ï¼Œç¡®å®š viewType ç±»å‹çš„æ–¹å¼è¿˜æ˜¯æ²¡å˜ï¼Œå³æ•°æ®å†³å®šç±»å‹ï¼Œä½†æ˜¯ç”±äºä¹‹å‰çš„ä¸€ç³»åˆ—é“ºå«å‡†å¤‡ï¼Œç°åœ¨è¿™é‡Œå°±å¯ä»¥é€šè¿‡æ•°æ®ç›´æ¥**è‡ªåŠ¨**æŸ¥æ‰¾äº†ã€‚\n\n**å›åˆ°ä¹‹å‰ [add æ–¹æ³•](#sugar-add) çš„å®ç°ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿›è¡Œ put æ“ä½œæ—¶ï¼Œä½¿ç”¨çš„ key æ˜¯ viewholder å®ä¾‹çš„ hashcode(),å› æ­¤ è¿™é‡Œè¿”å›çš„å…¶å®å°±æ˜¯ viewholder çš„ hashcode**ï¼Œå› æ­¤ï¼Œå¯ä»¥ç†è§£ä¸º SugarAdapter æ˜¯ç”¨ ViewHolder hashcode ä½œä¸º viewtype çš„å–å€¼ã€‚\n\n#### onCreateViewHolder\n\nviewtype ç¡®å®šäº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ›å»ºè¿™ä¸ª type å¯¹åº”çš„ ViewHolder äº†\n\n```java\npublic SugarHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\n        Container container = mContainerArray.get(viewType);\n\n        try {\n            View view = null;\n            int layoutRes = container.getLayoutRes();\n\n            ... preInflate view stuff ...\n\n            if (view == null) {\n                view = inflateView(layoutRes, parent);\n            }\n\n            SugarHolder holder = container.getHolderClass().getDeclaredConstructor(View.class).newInstance(view);\n            holder.setAdapter(this);\n            holder.setData(container.getData()); // makes SugarHolder#getData non-null\n\n            ... lifecycle and callback stuff ..\n\n            return holder;\n        } catch (@NonNull Exception e) {\n            Log.e(TAG, \"onCreateViewHolder failed, holder: \" + container.getHolderClass().getCanonicalName());\n            throw new RuntimeException(e);\n        }\n    }\n```\n\nè¿™é‡Œçš„ mContainerArray å…¶å®å°±æ˜¯ä¹‹å‰ä¸€ç›´åœ¨è¯´çš„ mArrayã€‚**æ˜¯ä»¥ viewholder çš„ hashcode (viewtype) ä¸º key ,Container(åŒ…å«è¿™ä¸ª viewholder æ•°æ®ç±»å‹ï¼Œè‡ªèº«ï¼ŒR.layout.xxx ç­‰å†…å®¹çš„åŒ…è£…ç±») ä¸ºå€¼çš„ä¸€ä¸ª SparseArrayã€‚**\n\nå› æ­¤ï¼Œåˆ°äº†è¿™é‡Œå°±å¾ˆç®€å•äº†ï¼Œæ ¹æ® viewtype ä» Container çš„ map é›†åˆä¸­å–å‡ºå¯¹åº”çš„ Container ï¼Œä½¿ç”¨ _R.layout.xxx_ inflate view, ç„¶ååˆ›å»º viewholder çš„å®ä¾‹è¿”å›ã€‚å½“ç„¶ä¸ºäº†æ€§èƒ½æå‡ï¼Œinflate view ä¹‹å‰ï¼Œè¿˜ä¼šæœ‰ preInflate çš„é€»è¾‘ï¼Œå…·ä½“ç»†èŠ‚å¯ä»¥å‚è€ƒæºç ï¼Œè¿™é‡Œä¸åšé‡ç‚¹è®¨è®ºã€‚\n\n#### onBindViewHolder\n\n```java\nprivate void onBindViewHolderInternal(@NonNull SugarHolder holder, int position, @Nullable List<Object> payloads) {\n        Object data = mList.get(position);\n        holder.setData(data); // double check\n\n        if (payloads == null || payloads.isEmpty()) {\n            holder.onBindData(data, Collections.emptyList());\n        } else {\n            holder.onBindData(data, payloads);\n        }\n\n        holder.getLifecycleRegistry().handleLifecycleEvent(Lifecycle.Event.ON_START);\n\n        for (SugarHolderListener listener : mSugarHolderListenerList) {\n            if (listener.isInstance(holder)) {\n                listener.onSugarHolderBindData(holder);\n            }\n        }\n    }\n```\n\nåˆ°è¿™é‡Œå°±å¾ˆç®€å•äº†ï¼Œè·å– position å¯¹åº”çš„æ•°æ®ï¼Œè°ƒç”¨ holder.onBindData æ–¹æ³•å³å¯ï¼Œè¿˜è®°å¾—è¿™ä¸ªæ–¹æ³•å—ï¼Œå°±æ˜¯åœ¨ç»§æ‰¿ SugarHolder æ—¶éœ€è¦å®ç° UI å’Œæ•°æ®ç»‘å®šçš„é‚£ä¸ªæ–¹æ³•ã€‚\n\nå¯ä»¥çœ‹åˆ°ï¼ŒSugarAdapter è¿˜å¸®æˆ‘ä»¬æ·»åŠ äº† lifecycle ç›¸å…³çš„å›è°ƒï¼ŒåŒ…æ‹¬åœ¨ onCreateViewHolder æ—¶ä¹Ÿä¼šæœ‰ ã€‚å› æ­¤ä½¿ç”¨ SugarAdapter è¿˜å¯ä»¥æ–¹ä¾¿çš„æ„ŸçŸ¥åˆ°æ›´å¤šçš„ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼Œè·å–åˆ°æ›´å¤šçš„æ–¹æ³•æ‰§è¡Œç»“ç‚¹ã€‚\n\n#### å°ç»“\n\nè‡³æ­¤ï¼Œæˆ‘ä»¬äº†è§£åˆ° **SugarAdapter è§£å†³ç—›ç‚¹æœ€å…³é”®ï¼Œæœ€æ ¸å¿ƒçš„é€»è¾‘ï¼Œå°±æ˜¯åœ¨ add(SugarHolder holder) çš„æ—¶å€™ï¼Œæ ¹æ®ç¼–è¯‘æœŸç”Ÿæˆçš„æ–‡ä»¶ï¼Œå»ºç«‹å¥½äº†æœ€ç»ˆéœ€è¦çš„å¯¹åº”å…³ç³»é›†åˆï¼ˆåŒ…å« Container çš„ mArrayï¼‰**ï¼Œä»è€Œåœ¨åç»­æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ï¼Œå¯ä»¥æ ¹æ®å·²æœ‰çš„å¯¹åº”å…³ç³»ï¼Œéå¸¸æ–¹ä¾¿çš„è‡ªåŠ¨å®ç° viewtype-->view-->viewholder-->Data-->UI æœ€ç»ˆå¯¹åº”å…³ç³»ã€‚\n\n## SugarAdapter è¿˜èƒ½åšä»€ä¹ˆ\n\n### **â€œä¸€ç§â€** æ•°æ®å¯¹åº”ä¸åŒçš„æ ·å¼\n\né€šè¿‡ä¹‹å‰çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨ SugarAdapter ï¼Œåœ¨å…¶ getItemViewType æ–¹æ³•ï¼Œä¼šæ ¹æ®å½“å‰ position ä»æ•°æ®åˆ—è¡¨ä¸­è·å–å½“å‰ä½ç½®çš„ Modelï¼Œç„¶åç”±è¿™ä¸ª model å†³å®š viewType ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®å†³å®šäº†åœ¨ RecyclerView ä¸­å½“å‰è¿™ä¸ª position ç”¨å“ªç§ ViewHolderã€‚\n\nç„¶è€Œï¼Œæœ‰æ—¶å€™ ViewHolder (å³å¡ç‰‡æ ·å¼) å¹¶ä¸ä¸€å®šç”±å®Œå…¨æ•°æ®ç±»å‹å†³å®šï¼Œè€Œæ˜¯ç”± Model ä¸­çš„æŸä¸ªå­—æ®µçš„ç±»å‹å†³å®šï¼Œç”šè‡³é¢ä¸´ç€ç›¸åŒçš„æ•°æ®ï¼Œåœ¨ä¸åŒçš„ä½ç½®éœ€è¦ä¸åŒçš„ ViewHolder,ç”šè‡³æç«¯æƒ…å†µä¸‹ï¼Œç›¸åŒä½ç½®éœ€è¦ä½¿ç”¨çš„ ViewHolder æ˜¯éœ€è¦åŠ¨æ€å˜åŒ–çš„ã€‚\n\n<img src=\"ç”¨-SugarAdapter-ç®€åŒ–å¤æ‚åˆ—è¡¨çš„å®ç°\\news.jpg\" height=300>\n\næ¯”å¦‚å›¾ä¸­å¸¸è§çš„ feed æµå¼æ–°é—»ï¼Œå¡ç‰‡ 1 å’Œ 3 åŸºæœ¬ä¸Šæ˜¯ç›¸åŒçš„ï¼Œå¡ç‰‡ 2 å´æ˜¯å®Œå…¨ä¸€ç§ä¸åŒçš„æ ·å¼ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç«¯ä¸‹å‘çš„æ•°æ®ä¸€å®šæ˜¯åŒç±»å‹çš„ï¼Œé¡¶å¤šåŠ å‡ ä¸ªå­—æ®µï¼ŒåŒºåˆ†ä¸€ä¸‹è¿™äº›å†…å®¹ã€‚å¦‚ä¸Šæ‰€è¯´ï¼ŒSugarAdapter æ˜¯æ ¹æ®æ•°æ®ç±»å‹å†³å®š ViewHolderï¼Œé‚£ä¹ˆæ•°æ®ç±»å‹å¦‚æœç›¸åŒï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿè¿™å°±è¦é  Dispatcher äº†ã€‚è¿™é‡Œçœ‹ä¸€ä¸‹å®˜æ–¹çš„ä¾‹å­å°±æ˜ç™½äº†ã€‚\n\n```java\n adapter.addDispatcher(Foo.class,new SugarAdapter.Dispatcher<Foo>() {\n            @SuppressWarnings(\"ConstantConditions\")\n            @Override\n            @Nullable\n            public Class<? extends SugarHolder> dispatch(@NonNull Foo foo) {\n                return Integer.parseInt(foo.getText()) % 2 == 0 ? FooHolder.class : FooHolder2.class;\n            }\n        });\n```\n\nåŒæ ·çš„æ•°æ®ç±»å‹ Fooï¼Œä½†**æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ªæ•°æ®çš„ç»†èŠ‚ï¼Œè‡ªå·±å†³å®šä½¿ç”¨å“ªç§ç±»å‹çš„ ViewHolder** (ä½†å‰ææ˜¯éœ€è¦æŠŠç”¨åˆ° ViewHolder add è¿›å»ï¼Œå¦åˆ™æ˜¯æ‰¾ä¸åˆ°çš„)\n\n#### è§„åˆ™\n\né‚£ä¹ˆè¿™ä¸ª Dispatcher æ˜¯å¦‚ä½•çš„åŸç†åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n\n```java\n    public static abstract class Dispatcher<T> {\n\n        @Nullable\n        public abstract Class<? extends SugarHolder> dispatch(@NonNull T data);\n    }\n```\n\n- é¦–å…ˆå¯ä»¥çœ‹åˆ°ï¼Œä»–å°±æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚SugarAdapter å†…éƒ¨ç»´æŠ¤ç€ä¸€ä¸ª Dispatcher çš„é›†åˆã€‚\n\n```java\nprivate Map<Class<?>, Dispatcher<?>> mDispatcherMap;\n```\n\nå½“æˆ‘ä»¬è¿›è¡Œ addDispatcher çš„æ“ä½œæ—¶ï¼Œå°±ä¼šæŠŠä¸€ä¸ªå®é™…çš„ Dispatcher å®ç°æ·»åŠ åˆ°è¿™ä¸ªé›†åˆä¸­ã€‚è€Œåœ¨ onCreateViewHolder æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œä¼šä¼˜å…ˆä»è¿™ä¸ª map é‡Œè·å–å¯¹åº”çš„ ViewHolderï¼Œç„¶åé€šè¿‡ viewholder åå‘ç¡®å®š viewtype ã€‚è¿™é‡Œè¿™æ ·åšè™½ç„¶æœ‰ç‚¹ç»•ï¼Œä½†æ˜¯è¿™æ · dispatcher å°±å¯ä»¥å±è”½æ•°æ®å†³å®š viewtype çš„æµç¨‹ï¼Œä»è€Œå·§å¦™åœ°è§£å†³äº†**åŒç±»å‹æ•°æ®ï¼Œéœ€è¦ä¸åŒæ ·å¼**çš„éš¾é¢˜ã€‚\n\nå¦‚æœæ‰¾åˆ°äº†å°±ç›´æ¥è¿”å› viewtype; å¦‚æœæ²¡æ‰¾åˆ°å°±ä¼šä» mArray ï¼ˆæ‰€æœ‰å¯¹åº”å…³ç³»çš„é›†åˆä¸­ï¼‰æŸ¥æ‰¾,ä¸å½±å“å…¶ä½™çš„ç±»å‹ã€‚\n\n```java\npublic int getItemViewType(@IntRange(from = 0) int position) {\n        Object data = mList.get(position);\n\n        Class<? extends SugarHolder> holderClass = null;\n        if (mDispatcherMap.containsKey(data.getClass())) {\n            Dispatcher dispatcher = mDispatcherMap.get(data.getClass());\n            holderClass = dispatcher.dispatch(data);\n        }\n\n        if (holderClass != null) {\n            int key = holderClass.hashCode();\n            if (mContainerArray.indexOfKey(key) < 0) {\n                throw new RuntimeException(\"getItemViewType() failed, holder: \" + holderClass.getCanonicalName()\n                        + \", please make sure you have added it when build SugarAdapter.\");\n            }\n\n            mContainerArray.get(key).setData(data);\n            return key;\n        }\n\n        ... search key from mArray stuff...\n    }\n```\n\nè¿™å°±æ˜¯ Dispatcher ï¼ŒDispatcher å°±æ˜¯ç”¨æ¥åŠ¨æ€åˆ†å‘ ViewHolder çš„ï¼Œå…·ä½“å¦‚ä½•åŠ¨æ€åˆ†å‘ï¼Œå°±çœ‹å®é™…çš„åœºæ™¯äº†ã€‚\n\n### ç”Ÿå‘½å‘¨æœŸå›è°ƒ å’Œ Lifecycleowner çš„æ”¯æŒã€‚\n\nSugarAdapter å†…éƒ¨æœ‰å¾ˆå¤šå›è°ƒï¼Œå¯ä»¥ç›‘å¬ SugarAdapter æ‰§è¡Œçš„å„ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œè¿™äº›ç”Ÿå‘½å‘¨æœŸå’Œ RecyclerView è‡ªèº«ä¹Ÿæ˜¯ç›¸å…³çš„ã€‚ç”šè‡³å¦‚æœä½ è¦ä½¿ç”¨ lifecycle-aware(ç”Ÿå‘½å‘¨æœŸå¯æ„ŸçŸ¥çš„)ç»„ä»¶ï¼Œä¹Ÿå¾ˆéå¸¸æ–¹ä¾¿çš„ã€‚æ›´å¤šç»†èŠ‚å¯ä»¥å‚è€ƒ [å…·ä½“å®ç°](https://github.com/zhihu/SugarAdapter/blob/master/app/src/main/java/com/zhihu/android/sugaradapterdemo/MainActivity.java#L41)ã€‚\n\n## æ€»ç»“\n\næ€»çš„æ¥è¯´ï¼Œå¯¹äºåŒ…å«å¤šç§æ ·å¼çš„ RecyclerView æ¥è¯´ï¼ŒSugarAdapter æ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚æ›´é‡è¦çš„æ˜¯ï¼ŒSugarAdapter ä¸ºæˆ‘ä»¬è§£å†³é—®é¢˜ï¼Œæä¾›äº†ä¸€ç§æ€è·¯ã€‚å¯¹äºä¸€äº›éœ€è¦é‡å¤æ‰§è¡Œï¼Œä½†åˆå¾ˆæœ‰è§„å¾‹çš„ä»£ç é€»è¾‘ï¼›æ‰¾åˆ°é—®é¢˜çš„æœ¬è´¨ï¼Œä»æœ€ç—›çš„åœ°æ–¹å‡ºå‘ï¼Œå¾€å¾€å°±èƒ½è§£å†³é—®é¢˜ã€‚\n\n","tags":["æ³¨è§£ã€APTã€SugarAdapterã€RecyclerView"]},{"title":"SugarAdapter æ³¨è§£å¤„ç†å™¨åˆ†æ","url":"%2F2019%2F06%2F04%2FSugarAdapter-%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E5%88%86%E6%9E%90%2F","content":"\nä¸»è¦åˆ†æä¸€ä¸‹ sugaradapterâ€”processor æ˜¯å¦‚ä½•å¤„ç† Layout è¿™ä¸ªæ³¨è§£çš„ã€‚ID æ³¨è§£å¹³æ—¶ä¸å¤ªç”¨ï¼ˆä¸»è¦æ„Ÿè§‰ä¸å¤ªç¨³å®šï¼‰ï¼ŒåŒæ—¶ç°åœ¨åœ¨ kotlin ä¸­ï¼ŒfindviewbyId å·²ç„¶ä¸æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œæ‰€ä»¥ ID æ³¨è§£å°±ä¸åˆ†æäº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±çœ‹çœ‹ã€‚\n\nå…³äºæ³¨è§£å¤„ç†å™¨ APT çš„ä½¿ç”¨åŠåŸºç¡€ä½¿ç”¨åœ¨[æ³¨è§£å¤„ç†å™¨APTåˆæ¢](https://rebooters.github.io/2019/06/03/%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8APT%E5%88%9D%E6%8E%A2)å·²æœ‰è¿‡åˆ†æï¼Œåœ¨è¿™é‡Œä¸å†å±•å¼€å™è¿°ï¼Œåªé‡ç‚¹æè¿°\nprocess æ–¹æ³•çš„å®ç°ã€‚\n\n<!--more-->\n\n# SugarAdapter æ³¨è§£å¤„ç†å™¨å®ç°åˆ†æ\n\n\n\n<!-- TOC -->\n\n- [SugarAdapter æ³¨è§£å¤„ç†å™¨å®ç°åˆ†æ](#sugaradapter-%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E5%AE%9E%E7%8E%B0%E5%88%86%E6%9E%90)\n  - [æ³¨è§£](#%E6%B3%A8%E8%A7%A3)\n  - [æ€è€ƒ](#%E6%80%9D%E8%80%83)\n  - [process çš„å®ç°](#process-%E7%9A%84%E5%AE%9E%E7%8E%B0)\n    - [DataClass çš„è§£æ](#dataclass-%E7%9A%84%E8%A7%A3%E6%9E%90)\n    - [LayoutRes çš„è§£æ](#layoutres-%E7%9A%84%E8%A7%A3%E6%9E%90)\n    - [ç”Ÿæˆç¼–è¯‘æœŸæ–‡ä»¶](#%E7%94%9F%E6%88%90%E7%BC%96%E8%AF%91%E6%9C%9F%E6%96%87%E4%BB%B6)\n      - [generateContainerDelegateImpl](#generatecontainerdelegateimpl)\n      - [ContainerDelegateImpl.java](#containerdelegateimpljava)\n  - [æ€»ç»“](#%E6%80%BB%E7%BB%93)\n\n<!-- /TOC -->\n\n\n\n\n\n## æ³¨è§£\n\nLayout\n\n```java\n@Retention(RetentionPolicy.CLASS)\n@Target(ElementType.TYPE)\n@Inherited\npublic @interface Layout {\n    @LayoutRes\n    int value() default 0;\n}\n```\n\nå¯ä»¥çœ‹åˆ° **Layout æ˜¯æ”¯æŒç»§æ‰¿çš„**\n\n## æ€è€ƒ\n\n```java\n@Layout(R.layout.layout_bar)\npublic final class BarHolder extends SugarHolder<Bar> {\n\n    .... init and bindData stuff...\n}\n```\n\nå‡è®¾ä½ å¯¹æ³¨è§£å¤„ç†å™¨ APT ä½¿ç”¨å·²æœ‰ä¸€å®šçš„äº†è§£ï¼Œé‚£ä¹ˆä»ä¸Šé¢è¿™ä¸ª BarHolder ç±»ä¸­ï¼Œ\nå¦‚ä½•è·å– R.layout.layout_bar è¿™ä¸ªèµ„æºçš„å®Œæ•´è·¯å¾„å‘¢ï¼Ÿåˆè¯¥å¦‚ä½•è·å– Bar è¿™ä¸ªç±»çš„å®Œæ•´è·¯å¾„å‘¢ï¼Ÿ\nå¯ä»¥ç®€å•æ€è€ƒä¸€ä¸‹ ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”\n\n## process çš„å®ç°\n\n### DataClass çš„è§£æ\n\næ•°æ®ç±»çš„è§£æ\n\n```java\n\nprivate static final Pattern TYPE_PARAM_PATTERN = Pattern.compile(\"(.*?)<(.*?)>\");\n\nprivate Map<String, Set<String>> processLayout(@NonNull RoundEnvironment roundEnv) {\n        mMessager.printMessage(Diagnostic.Kind.NOTE, \"processLayout begin\");\n\n        for (Element element : roundEnv.getElementsAnnotatedWith(Layout.class)) {\n            if (element instanceof TypeElement) {\n                String holderClass = ((TypeElement) element).getQualifiedName().toString();\n\n                String dataClass = null;\n                TypeMirror mirror = ((TypeElement) element).getSuperclass();\n                while (mirror != null && !(mirror instanceof NoType)) {\n                    Matcher matcher = TYPE_PARAM_PATTERN.matcher(mirror.toString());\n                    if (matcher.matches()) {\n                        // remove generic type from dataClass\n                        dataClass = matcher.group(2).trim().replaceAll(\"<[^>]*>\", \"\");\n                        break;\n                    } else {\n                        mirror = ((TypeElement) processingEnv.getTypeUtils().asElement(mirror)).getSuperclass();\n                    }\n                }\n\n                mMessager.printMessage(Diagnostic.Kind.NOTE, \"dataClass==\" + dataClass);\n            }\n        }\n    }\n```\n\nä¸ºäº†è·å–åˆ° SugarHolder æ³›å‹ä¸­ Model ç±»çš„å®é™…ç±»å‹\n\n1. é€šè¿‡ TypeMirror è·å–åˆ°äº†å½“å‰ ViewHolder çš„çˆ¶ç±»\n\nä»¥ä¸Šé¢çš„ BarHolder ä¸ºä¾‹\n\n```java\ncom.zhihu.android.sugaradapter.SugarHolder<com.zhihu.android.sugaradapterdemo.item.Bar>\n```\n\n2. ç”¨æ­£åˆ™åŒ¹é…çš„æ–¹å¼ï¼Œå¯¹ä¸Šè¿°å†…å®¹æŒ‰å­—ç¬¦ä¸²è¿›è¡ŒæŸ¥æ‰¾åŒ¹é…å’ŒåŒ¹é…ï¼Œè·å–åˆ°\n\n```java\ncom.zhihu.android.sugaradapterdemo.item.Bar\n```\n\nå¦‚æœè¿™ä¸ªç±»è¿˜æœ‰æ³›å‹ï¼Œæ¯”å¦‚ Bar<\\*> ï¼Œåˆ™ä¼šç›´æ¥æ“¦é™¤æ‰ï¼ˆç”¨ç©ºå­—ç¬¦ä¸²æ›¿ä»£ï¼‰\n\nå½“ç„¶ï¼Œç”±äº Layout æ”¯æŒç»§æ‰¿ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥è·å–å½“å‰ ViewHolder çš„çˆ¶ç±»ï¼Œå¯èƒ½ä¼šå­˜åœ¨æ‰¾ä¸æ³›å‹çš„æƒ…å†µï¼Œå› æ­¤éœ€è¦ä¸æ–­å›æº¯æŸ¥æ‰¾çˆ¶ç±»ã€‚\n\n> ç¬¬ 2 æ­¥ï¼Œç†è®ºä¸Šä¹Ÿå¯ä»¥é€šè¿‡ **((Type.ClassType) mirror).getTypeArguments().head** çš„æ–¹å¼æ‹¿åˆ°ï¼Œä½†è¿™æ˜¯å…·ä½“å®ç°ç»†èŠ‚ï¼Œç”¨æ­£åˆ™åŒ¹é…ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚\n\n### LayoutRes çš„è§£æ\n\nèµ„æºæ–‡ä»¶çš„è§£æ\n\n```java\nprivate Map<String, Set<String>> processLayout(@NonNull RoundEnvironment roundEnv) {\n        mMessager.printMessage(Diagnostic.Kind.NOTE, \"processLayout begin\");\n\n        RParser parser = RParser.builder(processingEnv)\n                .setSupportedAnnotations(Collections.singleton(Layout.class))\n                .setSupportedTypes(\"layout\")\n                .build();\n\n        parser.scan(roundEnv);\n\n        for (Element element : roundEnv.getElementsAnnotatedWith(Layout.class)) {\n            if (element instanceof TypeElement) {\n                String holderClass = ((TypeElement) element).getQualifiedName().toString();\n                int layoutRes = element.getAnnotation(Layout.class).value();\n\n                if (layoutRes == 0 || dataClass == null) {\n                    throw new IllegalStateException(\"process \" + holderClass + \" failed!\");\n                }\n\n                String layoutResStr = null;\n                String packageName = null;\n                for (String path : holderClass.split(\"\\\\.\")) {\n                    if (packageName == null) {\n                        packageName = path;\n                    } else {\n                        packageName = packageName + \".\" + path;\n                    }\n\n                    layoutResStr = parser.parse(packageName, layoutRes);\n                    if (!layoutResStr.equals(String.valueOf(layoutRes))) {\n                        break;\n                    }\n                }\n                mMessager.printMessage(Diagnostic.Kind.NOTE, \"layoutResStr==\" + layoutResStr);\n            }\n        }\n    }\n```\n\nå…³äºèµ„æºæ–‡ä»¶çš„è§£æï¼Œä½ å¯èƒ½è§‰å¾—å¾ˆç®€å•ï¼Œä½†å…¶å®ä¸ç®€å•\n\n```java\nint layoutRes = element.getAnnotation(Layout.class).value();\n```\n\né€šè¿‡æ³¨è§£ç›´æ¥è·å–çš„èµ„æºæ–‡ä»¶ value æ˜¯ä¸€æ®µç±»ä¼¼ 34343438943 çš„æ•°å­—ï¼Œè¿™ä¸ªæ˜¯ç³»ç»Ÿè‡ªåŠ¨åœ¨ R æ–‡ä»¶ä¸­ç”Ÿæˆçš„ã€‚å› æ­¤è¿™é‡Œè·å–çš„ layoutRes æ˜¯ä¸€ä¸ª int å€¼ï¼Œå¹¶ä¸èƒ½ç›´æ¥æ‹¿æ¥ä½¿ç”¨ã€‚ç„¶è€Œæˆ‘ä»¬æœ€ç»ˆéœ€è¦çš„æ˜¯ packagename.R.layout.xxx è¿™æ ·çš„æ–‡ä»¶(åœ¨ç»„ä»¶åŒ–å¼€å‘æˆ–ä¾èµ–ç¬¬ä¸‰æ–¹åº“æ—¶ï¼Œä½ æ— æ³•é¿å…åˆ«äººå’Œä½ å®šä¹‰äº†ä¸€ä¸ªåŒåçš„èµ„æºæ–‡ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å¸¦åŒ…åçš„èµ„æºè·¯å¾„ï¼Œä»¥åšåŒºåˆ†)ã€‚\n\nå› æ­¤è¿™é‡Œå€ŸåŠ©[HendraAnggrian/r-parser](https://github.com/HendraAnggrian/r-parser \"HendraAnggrian/r-parser\") å®ç°äº†è¿™ä¸ªåŠŸèƒ½ã€‚\n\n```java\n                    layoutResStr = parser.parse(packageName, layoutRes);\n                    if (!layoutResStr.equals(String.valueOf(layoutRes))) {\n                        break;\n                    }\n```\n\nparser.parse ä¼šæ ¹æ®åŒ…åå’Œèµ„æº id å»æŸ¥æ‰¾å…·ä½“çš„èµ„æºè·¯å¾„åã€‚è¿™é‡Œé€šè¿‡æ‹¼æ¥åŒ…åçš„æ–¹å¼ï¼Œä¸æ–­æŸ¥æ‰¾è¿™ä¸ªèµ„æºã€‚\n\né€šè¿‡ä¸Šè¿°è¿‡ç¨‹ï¼Œå°±å®Œæˆäº† DataClass å’Œ Reslayot å®Œæ•´è·¯å¾„çš„è·å–ã€‚ä»¥ BarViewHolder ä¸ºä¾‹\n\n```java\n@Layout(R.layout.layout_bar)\npublic final class BarHolder extends SugarHolder<Bar> {\n\n    .... init and bindData stuff...\n}\n```\n\næ­£å¸¸æƒ…å†µä¸‹ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœ\n\n```java\ndataClass = com.zhihu.android.sugaradapterdemo.item.Bar.class\n\nlayoutResStr = com.zhihu.android.sugaradapterdemo.R.layout.layout_bar\n\n```\n\n### ç”Ÿæˆç¼–è¯‘æœŸæ–‡ä»¶\n\næœ‰äº†è¿™ä¸¤ä¸ªæœ€æ€»è¦çš„å†…å®¹ï¼Œå°±å¯ä»¥ç”¨æ¥ç”Ÿæˆç¼–è¯‘æœŸçš„æ–‡ä»¶äº†ã€‚\n\n```java\nprivate Map<String, Set<String>> processLayout(@NonNull RoundEnvironment roundEnv) {\n\n\n        Map<String, Pair> containerMap = new HashMap<>();\n\n        for (Element element : roundEnv.getElementsAnnotatedWith(Layout.class)) {\n            if (element instanceof TypeElement) {\n                String holderClass = ((TypeElement) element).getQualifiedName().toString();\n                int layoutRes = element.getAnnotation(Layout.class).value();\n\n                String dataClass = null;\n\n                ... detail stuff...\n\n\n                if (layoutResStr == null || layoutResStr.equals(String.valueOf(layoutRes))) {\n                    throw new IllegalStateException(\"process \" + holderClass + \" failed!\");\n                }\n\n                containerMap.put(holderClass, new Pair(layoutResStr, dataClass));\n            }\n        }\n\n        generateContainerDelegateImpl(containerMap)\n\n        .....\n    }\n```\n\n#### generateContainerDelegateImpl\n\nå…³äºç¼–è¯‘æœŸæ–‡ä»¶çš„ç”Ÿæˆï¼Œå¯ä»¥ç”¨ javapoet ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥æŒ‰æœ€ç»ˆéœ€è¦çš„æ ¼å¼ï¼Œè¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œéƒ½æ˜¯å¯ä»¥çš„ã€‚è¿™é‡Œå‡è®¾æˆ‘ä»¬åªæœ‰ BarViewHolder è¿™ä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆæœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶ï¼Œå°±æ˜¯å¦‚ä¸‹[ContainerDelegateImpl.java](#container-delegate)\n\n```java\n private void generateContainerDelegateImpl(@NonNull Map<String, Pair> map) throws IOException {\n        StringBuilder builder = new StringBuilder();\n        String packageName = \"com.zhihu.android.sugaradapter\";\n        builder.append(\"package \").append(packageName).append(\";\\n\\n\");\n\n\n        ...import...\n\n        // for module project\n\n        ... å˜é‡å£°æ˜...\n\n        for (String key : map.keySet()) {\n            String layoutResStr = map.get(key).getFirst();\n            String dataClass = map.get(key).getSecond();\n            builder.append(\"        mLayoutResMap.put(\").append(key).append(\".class, \")\n                    .append(layoutResStr).append(\");\\n\");\n            builder.append(\"        mDataClassMap.put(\").append(key).append(\".class, \")\n                    .append(dataClass).append(\".class);\\n\");\n        }\n\n        ... getxxx method stuff...\n\n\n\n        JavaFileObject object = processingEnv.getFiler().createSourceFile(packageName + \".\" + className);\n        Writer writer = object.openWriter();\n        writer.write(builder.toString());\n        writer.flush();\n        writer.close();\n    }\n```\n\n<span id=container-delegate>\n\n#### ContainerDelegateImpl.java\n\n```java\npublic final class ContainerDelegateImpl implements ContainerDelegate {\n    private Map<Class<? extends SugarHolder>, Integer> mLayoutResMap;\n    private Map<Class<? extends SugarHolder>, Class> mDataClassMap;\n\n    public ContainerDelegateImpl() {\n        mLayoutResMap = new HashMap<>();\n        mDataClassMap = new HashMap<>();\n\n\n        mLayoutResMap.put(com.zhihu.android.sugaradapterdemo.holder.BarHolder.class, com.zhihu.android.sugaradapterdemo.R.layout.layout_bar);\n        mDataClassMap.put(com.zhihu.android.sugaradapterdemo.holder.BarHolder.class, com.zhihu.android.sugaradapterdemo.item.Bar.class);\n    }\n\n    @NonNull\n    public Map<Class<? extends SugarHolder>, Integer> getLayoutResMap() {\n        return mLayoutResMap;\n    }\n\n    @NonNull\n    public Map<Class<? extends SugarHolder>, Class> getDataClassMap() {\n        return mDataClassMap;\n    }\n\n    @Override\n    @LayoutRes\n    public int getLayoutRes(@NonNull Class<? extends SugarHolder> holderClass) {\n        return mLayoutResMap.get(holderClass);\n    }\n\n    @Override\n    @NonNull\n    public Class getDataClass(@NonNull Class<? extends SugarHolder> holderClass) {\n        return mDataClassMap.get(holderClass);\n    }\n}\n```\n\n## æ€»ç»“\n\nä»¥ä¸Šå°±æ˜¯ sugaradapter-processor çš„åˆ†æï¼Œå¯ä»¥çœ‹åˆ°å…³äºæ³¨è§£å¤„ç†å™¨çš„ä½¿ç”¨æ˜¯éå¸¸çµæ´»çš„ï¼Œåœ¨ç¼–è¯‘æœŸæ ¹æ® RoundEnvironment æ¥å£ï¼ŒElement æ¥å£åŠå…¶å­ç±»æä¾›çš„ API éå¸¸çµæ´»çš„è·å–å„ç§ä½ æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œåˆ©ç”¨è¿™äº›è¿›è¡ŒäºŒæ¬¡çš„ç»„åˆï¼Œæˆ–åˆ†è§£å°±å¯ä»¥åœ¨ç¼–è¯‘æœŸç”Ÿæˆéå¸¸æœ‰ä»·å€¼çš„æ–‡ä»¶ï¼Œä½¿ä¸€äº›çœ‹ä¼¼æ— æ³•è§£å†³çš„é‡å¤å·¥ä½œå˜å¾—ç®€å•æœ‰æ¡ç†ã€‚\n\n","tags":["æ³¨è§£ã€APTã€SugarAdapterã€RecyclerView"]},{"title":"æ³¨è§£å¤„ç†å™¨APTåˆæ¢","url":"%2F2019%2F06%2F03%2F%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8APT%E5%88%9D%E6%8E%A2%2F","content":"\n<img src=\"æ³¨è§£å¤„ç†å™¨APTåˆæ¢/BindView_Proxy.png\" width=500>\n\n# å‰è¨€\n\nä»æ—©æœŸçš„ ButterKnifeï¼ŒDagger2ï¼ŒEventBus åˆ°å¦‚ä»Šçš„ [ARouter](https://github.com/alibaba/ARouter), [WMRouter](https://github.com/meituan/WMRouter) ,[SugarAdapter](https://github.com/zhihu/SugarAdapter)ï¼ˆä¹Ÿè®¸è¿˜æœ‰å…¶ä»–çš„ï¼Œå¹³æ—¶å…³æ³¨è¾ƒå¤šçš„å°±æ˜¯è¿™äº›ï¼‰ï¼Œå€ŸåŠ©æ³¨è§£å¤„ç†å™¨ APT,å„è·¯ç¥ä»™å¼€å‘äº†è®¸å¤šæœ‰ç”¨çš„å·¥å…·ã€æ¡†æ¶ï¼Œè§£æ”¾äº† Android å¼€å‘è€…çš„åŒæ‰‹ï¼Œè®©æˆ‘ä»¬å°‘å†™äº†å¾ˆå¤šå†—ä½™çš„ä»£ç ï¼Œä¹Ÿä½¿å¾—ç»„ä»¶åŒ–è¿™æ ·çš„å¼€å‘æ€è·¯å¯ä»¥å¤§è¡Œå…¶é“ã€‚\n\n<!--more-->\n\n<!-- TOC -->\n\n- [å‰è¨€](#å‰è¨€)\n- [æ³¨è§£å¤„ç†å™¨ APT æ˜¯ä»€ä¹ˆï¼Œèƒ½åšä»€ä¹ˆ ï¼Ÿ](#æ³¨è§£å¤„ç†å™¨-apt-æ˜¯ä»€ä¹ˆèƒ½åšä»€ä¹ˆ-)\n  - [APT å¤„ç†å“ªç§ç±»å‹çš„æ³¨è§£](#apt-å¤„ç†å“ªç§ç±»å‹çš„æ³¨è§£)\n  - [APT çš„ä½œç”¨](#apt-çš„ä½œç”¨)\n- [æ³¨è§£å¤„ç†å™¨å°è¯•ç‰›åˆ€](#æ³¨è§£å¤„ç†å™¨å°è¯•ç‰›åˆ€)\n  - [æ³¨è§£å¤„ç†å™¨å·¥ç¨‹çš„åˆ›å»º](#æ³¨è§£å¤„ç†å™¨å·¥ç¨‹çš„åˆ›å»º)\n  - [å°ç›®æ ‡ï¼ˆBindView & BindString)](#å°ç›®æ ‡bindview--bindstring)\n    - [apt-annotaion](#apt-annotaion)\n    - [apt-processor](#apt-processor)\n      - [BindViewProcessor](#bindviewprocessor)\n        - [ä»£ç ç”Ÿæˆ](#ä»£ç ç”Ÿæˆ)\n        - [ç”Ÿæˆçš„ç›®æ ‡ä»£ç ](#ç”Ÿæˆçš„ç›®æ ‡ä»£ç )\n- [æ€»ç»“](#æ€»ç»“)\n- [æ³¨è§£å¤„ç†å™¨åœ¨ Kotlin ä¸­çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹](#æ³¨è§£å¤„ç†å™¨åœ¨-kotlin-ä¸­çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹)\n- [å‚è€ƒæ–‡æ¡£](#å‚è€ƒæ–‡æ¡£)\n\n<!-- /TOC -->\n\n\n\nè¯•æƒ³ï¼Œå¦‚æœæ²¡æœ‰ ButterKnife è¿™æ ·çš„ç¥å™¨ï¼Œé‚£ä¹ˆç°åœ¨æ¯ä¸€ä¸ª Android å¼€å‘è€…ä¼°è®¡ä¸‹è¾ˆå­éƒ½ä¼šè®°å¾— findViewById è¿™ä¸ªæ–¹æ³•ï¼ŒçœŸæ˜¯èƒ½è®©äººå†™çš„åè¡€çš„ä¸€ä¸ªæ–¹æ³•ã€‚ï¼ˆå½“ç„¶ï¼Œç°åœ¨ä¸Šäº† Kotlin çš„è½¦ï¼Œè¿™éƒ½ä¸æ˜¯é—®é¢˜äº†ï¼‰ã€‚\n\nä½ èƒ½æƒ³è±¡åœ¨ EventBus å°šæœªè¯ç”Ÿçš„æ—¶å€™ï¼Œæˆ‘æ›¾ç»ä¸ºäº†æŠŠä¸€ä¸ªæ–¹æ³•çš„å€¼ä»æŸä¸ª  RecyclerView çš„ Adapter ä¼ é€’åˆ°å¦ä¸€ä¸ª Activity çš„ Fragment é‡Œå†™äº†å¤šå°‘å±‚çš„å›è°ƒå—ï¼Ÿä½ èƒ½æƒ³è±¡ä¸€ä¸ª Activity(Fragment) çš„ onActivityResult æœ‰ 100 å¤šè¡Œçš„æ¡ä»¶åˆ¤æ–­(ä»…ä»…æ˜¯è¿”å›å€¼æŒ‰ requestCode å–å€¼ï¼Œä¸åŒ…æ‹¬ä»»ä½•ä¸šåŠ¡é€»è¾‘)ï¼Œå»è·å–å…¶ä»–é¡µé¢çš„å„ç§è¿”å›å€¼æ˜¯å¤šä¹ˆçš„è®©äººç»æœ›å—ï¼Ÿç”šè‡³æœ‰äº›æ—¶å€™è¿˜è¦è€ƒè™‘è¢«å¯åŠ¨çš„ Activity åœ¨ç‰¹å®šçš„å¯åŠ¨æ¨¡å¼ä¸‹ï¼ŒonActivityResult æ–¹æ³•å›è°ƒå¼‚å¸¸çš„æƒ…å†µï¼Œæ›´æ˜¯å‡ºç°äº†æ— æ³•å®ç°ä¸šåŠ¡éœ€æ±‚çš„çª˜å¢ƒ ğŸ˜¢\n\nåœ¨ç»„ä»¶åŒ–å¼€å‘çš„æ—©æœŸï¼Œç±»ä¾èµ–æ˜¯æœ€æœ€ç—›è‹¦çš„é—®é¢˜ï¼Œä¸¤ä¸ªä»ä¸šåŠ¡ä¸Šå·²ç»å‰¥ç¦»çš„ç»„ä»¶ï¼Œå´å› ä¸ºè¦å®ç°é¡µé¢è·³è½¬ï¼ˆç®€å•æ¥è¯´å°±æ˜¯ä¾èµ– Activity æˆ– Fragment ç±»ï¼‰è€Œä¸å¾—ä¸äº§ç”Ÿä¾èµ–ã€‚è·¯ç”±æ¡†æ¶åœ¨ Android ä¸­çš„åº”ç”¨ï¼Œå®Œç¾çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚\n\nè€Œè¿™äº›æ¡†æ¶ï¼Œéƒ½ç”¨åˆ°äº†æ³¨è§£å¤„ç†å™¨è¿™é¡¹æŠ€æœ¯ï¼Œå› æ­¤è¿™é‡Œå°±æ¥å­¦äº›ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ³¨è§£å¤„ç†å™¨ï¼Œä»¥åŠæ³¨è§£å¤„ç†å™¨å¯ä»¥åšä»€ä¹ˆã€‚\n\n# æ³¨è§£å¤„ç†å™¨ APT æ˜¯ä»€ä¹ˆï¼Œèƒ½åšä»€ä¹ˆ ï¼Ÿ\n\n## APT å¤„ç†å“ªç§ç±»å‹çš„æ³¨è§£\n\næ³¨è§£å¤„ç†å™¨ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç”¨äºå¤„ç†**æ³¨è§£**çš„å·¥å…·ã€‚\n\nåœ¨[ç†è§£ Android ä¸­çš„æ³¨è§£ä¸åå°„](https://www.jianshu.com/p/d4978bbce12a) ä¸€æ–‡ä¸­æˆ‘ä»¬å·²çŸ¥ï¼ŒJava ä»£ç åœ¨è¿è¡Œæ—¶ä¼šé€šè¿‡åå°„çš„æ–¹å¼å¤„ç† æ³¨è§£ä½œç”¨èŒƒå›´@Retention ä¸º RetentionPolicy.RUNTIME çš„æ³¨è§£ã€‚è€Œä»Šå¤©çš„ä¸»è§’ APT åˆ™è´Ÿè´£å¤„ç†æ³¨è§£ä½œç”¨èŒƒå›´ @Retention ä¸º RetentionPolicy.CLASS çš„æ³¨è§£ã€‚\n\n## APT çš„ä½œç”¨\n\n> APT(Annotation Processing Tool)å³æ³¨è§£å¤„ç†å™¨ï¼Œæ˜¯ä¸€ç§å¤„ç†æ³¨è§£çš„å·¥å…·ï¼Œç¡®åˆ‡çš„è¯´å®ƒæ˜¯ javac çš„ä¸€ä¸ªå·¥å…·ï¼Œå®ƒç”¨æ¥åœ¨ç¼–è¯‘æ—¶æ‰«æå’Œå¤„ç†æ³¨è§£ã€‚æ³¨è§£å¤„ç†å™¨ä»¥ Java ä»£ç (æˆ–è€…ç¼–è¯‘è¿‡çš„å­—èŠ‚ç )ä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆ.java æ–‡ä»¶ä½œä¸ºè¾“å‡ºã€‚ç®€å•æ¥è¯´å°±æ˜¯åœ¨ç¼–è¯‘æœŸï¼Œé€šè¿‡æ³¨è§£ç”Ÿæˆ.java æ–‡ä»¶ã€‚\n\n# æ³¨è§£å¤„ç†å™¨å°è¯•ç‰›åˆ€\n\n<span id=\"init-project\">\n\n## æ³¨è§£å¤„ç†å™¨å·¥ç¨‹çš„åˆ›å»º\n\næ³¨è§£å¤„ç†å™¨çš„ä½¿ç”¨å¾ˆç®€å•ï¼Œç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šçš„ä¾‹å­å’Œå®ç°ï¼Œå¯ä»¥å‚è€ƒ[Android å¦‚ä½•ç¼–å†™åŸºäºç¼–è¯‘æ—¶æ³¨è§£çš„é¡¹ç›®](https://blog.csdn.net/lmj623565791/article/details/51931859) ï¼Œ[è½»æ¾æ‰“é€ ä¸€ä¸ªè‡ªå·±çš„æ³¨è§£æ¡†æ¶](https://mp.weixin.qq.com/s/ljJ1uBCinBLhCU6MtOApYA) è¿™ä¸¤ç¯‡æ–‡ç« æ­å»ºä¸€ä¸ªåˆé€‚çš„æ³¨è§£å¤„ç†å™¨æ¡†æ¶ã€‚ä¸ºäº†åç»­æè¿°æ–¹ä¾¿ï¼Œè¿™é‡Œä¹Ÿç®€å•å†™äº†ä¸€ä¸ª [Demo](https://github.com/REBOOTERS/APT-Lite) ,ä»£ç å·²åŒæ­¥åˆ°Github [APT-Lite](https://github.com/REBOOTERS/APT-Lite) ä»“åº“ï¼Œå¯ä»¥å‚è€ƒã€‚\n\n<img src=\"æ³¨è§£å¤„ç†å™¨APTåˆæ¢/code-structure.jpg\">\n\nä¸€èˆ¬æ¥è¯´æŒ‰ç…§ä¸Šå›¾\n\n- apt-annotation (java module) å®šä¹‰æ‰€æœ‰éœ€è¦ç”¨åˆ°çš„æ³¨è§£ï¼ˆrequireï¼‰\n- apt-processor (java module) è§£ææ³¨è§£å¹¶ç”Ÿæˆ java ä»£ç  (require)\n- apt-libray ï¼ˆandroid module) å®šä¹‰å¯¹å¤–æš´éœ²çš„ API æ¥å£ (option)\n- example (android module) demo (option)\n\nè¿™æ ·å®šä¹‰å°±è¶³å¤Ÿäº†ã€‚å°±æ³¨è§£å¤„ç†å™¨å®é™…è¦å®ç°çš„ä¸šåŠ¡åŠŸèƒ½ï¼Œapt-library å¯èƒ½éœ€è¦å®šä¹‰åœ¨å…¶ä»–ç»„ä»¶ä¸­ï¼Œç”šè‡³æŸäº›æ³¨è§£å¤„ç†è¦å®ç°çš„åŠŸèƒ½ï¼Œå¦‚æœå’Œä¸šåŠ¡æœ‰å¼ºç»‘å®šï¼Œè¿™ä¸ª api ç”šè‡³éƒ½å¯èƒ½ä¸å­˜åœ¨ï¼Œexample(æˆ– app) ä½œä¸ºéªŒè¯ï¼ˆæ¼”ç¤ºï¼‰æ³¨è§£åŠŸèƒ½çš„ module æ˜¯å¯ä»¥å¿½ç•¥çš„ï¼Œå› æ­¤æ³¨è§£å¤„ç†å™¨æ¡†æ¶å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªçº¯ Java é¡¹ç›®ã€‚\n\n**å…³äºåœ¨å·¥ç¨‹ä¸­è¿™äº›æ¨¡å—çš„ build.gradle ä¸­ç›¸äº’ä¾èµ–å…³ç³»åŠä¾èµ–å“ªäº›åº“ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œæ¯•ç«Ÿå¾ˆç®€å•ï¼Œå…·ä½“ç»“åˆ[ä¸Šé¢çš„ä¸¤ç¯‡æ–‡ç« ](#init-project)å¯ä»¥å¾ˆè½»æ¾çš„å®Œæˆé…ç½®**ã€‚\n\n## å°ç›®æ ‡ï¼ˆBindView & BindString)\n\nç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä¹Ÿä»æ¨¡ä»¿ ButterKnife å¼€å§‹ï¼Œç®€å•å®šä¹‰ä¸¤ä¸ªæ³¨è§£ï¼ŒBindView å’Œ BindString ï¼Œä»£ç è¿è¡Œåå¯ä»¥å®ç° å˜é‡å’Œ View çš„è‡ªåŠ¨ç»‘å®šã€‚\n\n<span id=main-actvity-code>\n\n```java\npublic class MainActivity extends AppCompatActivity {\n\n    @BindView(R.id.content)\n    @BindString(\"Hello APT\")\n    TextView mContent;\n\n    @BindView(R.id.name)\n    @BindString(\"APT Success\")\n    TextView mName;\n\n    ...else...\n}\n```\n\nä¸Šè¿°ä»£ç ï¼Œåœ¨è¿è¡ŒæœŸå¯ä»¥æ­£ç¡®çš„æ‰¾çš„ id ä¸º content å’Œ name çš„ TextView å¹¶åˆ†åˆ«èµ‹å€¼ä¸º \"Hello APT\" å’Œ \"APT Success\"\n\n### apt-annotaion\n\nå®šä¹‰æˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸¤ä¸ªæ³¨è§£\n\n- BindView\n\n```java\n@Retention(RetentionPolicy.CLASS)\n@Target(ElementType.FIELD)\npublic @interface BindView {\n    int value();\n}\n```\n\n- BindString\n\n```java\n@Retention(RetentionPolicy.CLASS)\n@Target(ElementType.FIELD)\npublic @interface BindString {\n    String value() default \"\";\n}\n```\n\n### apt-processor\n\napt processor çš„å®ç°ï¼Œæ˜¯ APT æœ€æ ¸å¿ƒçš„å†…å®¹ã€‚ä½†æ˜¯è¦åšçš„äº‹æƒ…ä¹Ÿå¾ˆç®€å•ã€‚å°±æ˜¯ç»§æ‰¿ AbstractProcessor ç±»ï¼Œå¹¶å®ç°å®ƒçš„å››ä¸ªæ–¹æ³•\n\n- init\n- getSupportedSourceVersion ï¼ˆå¯ä»¥ç”¨æ³¨è§£ä»£æ›¿ï¼‰\n- getSupportedAnnotationTypes ï¼ˆå¯ä»¥ç”¨æ³¨è§£ä»£æ›¿ï¼‰\n- process\n\nè¿™å››ä¸ªæ–¹æ³•çš„å®šä¹‰åŠåŠŸèƒ½ï¼Œå°±ä¸å±•å¼€è¯´äº†ï¼Œé€šè¿‡[å‚è€ƒèµ„æ–™](#refercen-doc)ä¸­çš„å†…å®¹ï¼Œç”šè‡³å…¶å‘½åæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“è¿™å‡ ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯å•¥äº†ã€‚\nä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆç®€å•çš„æŠ½å–ä¸€å±‚ BaseProcessorã€‚å¯¹äºä¸€äº›å¸¸ç”¨çš„åˆå§‹åŒ–ä¸€äº›å¸¸ç”¨çš„æˆå‘˜å˜é‡ã€‚\n\n```java\npublic abstract class BaseProcessor extends AbstractProcessor {\n    // è¿›è¡Œæ—¥å¿—æ‰“å°çš„æ¥å£\n    Messager mMessager;\n    // Element å…ƒç´ å¤„ç†çš„æ¥å£\n    Elements mElementUtils;\n    // å¸®åŠ©æ–‡ä»¶ç”Ÿæˆçš„æ¥å£\n    Filer mFiler;\n\n    @Override\n    public SourceVersion getSupportedSourceVersion() {\n        return SourceVersion.latestSupported();\n    }\n\n    @Override\n    public synchronized void init(ProcessingEnvironment processingEnvironment) {\n        super.init(processingEnvironment);\n\n        mFiler = processingEnvironment.getFiler();\n        mMessager = processingEnvironment.getMessager();\n        mElementUtils = processingEnvironment.getElementUtils();\n\n        mMessager.printMessage(Diagnostic.Kind.NOTE, \"init\");\n    }\n}\n```\n\n#### BindViewProcessor\n\nä¸‹é¢å°±é€šè¿‡ BindViewProcessor çœ‹çœ‹å¦‚ä½•å®ç°æˆ‘ä»¬çš„ç›®æ ‡ã€‚\n\n- é¦–å…ˆå®šä¹‰è¦æ”¯æŒçš„æ³¨è§£ç±»å‹\n\n```java\n    @Override\n    public Set<String> getSupportedAnnotationTypes() {\n        HashSet<String> supportTypes = new HashSet<>();\n        supportTypes.add(BindView.class.getCanonicalName());\n        supportTypes.add(BindString.class.getCanonicalName());\n        return supportTypes;\n    }\n```\n\n- process æ ¸å¿ƒé€»è¾‘çš„å¤„ç†\n\n```java\n    @Override\n    public boolean process(Set<? extends TypeElement> set, RoundEnvironment roundEnvironment) {\n        mMessager.printMessage(Diagnostic.Kind.NOTE, \"processing....\");\n\n        // ä»£ç†æ–¹æ³•æ¸…ç©º\n        mProxyProMap.clear();\n        // å¤„ç†æ³¨è§£ï¼Œå®Œæˆéœ€è¦ç”Ÿæˆä»£ç çš„å‰æœŸå‡†å¤‡\n        assembleAnnotations(roundEnvironment);\n        // ç”Ÿæˆä»£ç \n        genCodeAuto();\n\n        mMessager.printMessage(Diagnostic.Kind.NOTE, \"process finish ...\");\n        return true;\n    }\n```\n\n*ps: å¯èƒ½æ˜¯å—åˆ°[é¸¿æ´‹è€å¸ˆ](https://github.com/hongyangAndroid)è¿™ç¯‡ [Android å¦‚ä½•ç¼–å†™åŸºäºç¼–è¯‘æ—¶æ³¨è§£çš„é¡¹ç›®](https://blog.csdn.net/lmj623565791/article/details/51931859)çš„å½±å“ï¼Œç°åœ¨çœ‹åˆ°ç½‘ä¸Šæ³¨è§£å¤„ç†å™¨çš„æ–‡ç« ï¼Œéƒ½ä¼šæ–°å»º Proxy é€šè¿‡ä»£ç†æ¨¡å¼æ¥å¤„ç†ç”Ÿæˆä»£ç çš„æ ¸å¿ƒé€»è¾‘ï¼Œo(â•¥ï¹â•¥)oã€‚* è¿™é‡Œä¸ºäº†æ–¹ä¾¿ä¹Ÿæ˜¯ç”¨ä»£ç†ç±»å¤„ç†ã€‚\n\n- assembleAnnotations() å¯¹æ³¨è§£è¿›è¡Œå®Œå…¨çš„å¤„ç†\n\n```java\n    /**\n     *\n     * @param roundEnvironment é›†ä¸­æ”¶é›†æ‰€æœ‰éœ€è¦å¤„ç†çš„ æ³¨è§£\n     */\n    private void assembleAnnotations(RoundEnvironment roundEnvironment) {\n        processAnnotations(roundEnvironment, BindView.class);\n        processAnnotations(roundEnvironment, BindString.class);\n    }\n\n\n    private void processAnnotations(RoundEnvironment roundEnvironment, Class<? extends Annotation> className) {\n\n        RParser parser = RParser.builder(processingEnv)\n                .setSupportedAnnotations(BindView.class)\n                .setSupportedTypes(\"id\")\n                .build();\n\n        parser.scan(roundEnvironment);\n\n        // è·å–æ‰€æœ‰æ‰“ä¸Š className ç±»å‹æ³¨è§£çš„å…ƒç´ \n        Set<? extends Element> elements = roundEnvironment.getElementsAnnotatedWith(className);\n        // éå†å…ƒç´ \n        for (Element element : elements) {\n            // å› ä¸º BindView å’Œ BindString çš„ target æ˜¯ ElementType.FIELDï¼Œå› æ­¤è¿™é‡Œå¼ºè½¬ç†è®ºä¸Šæ˜¯å®‰å…¨çš„ï¼Œ\n            // é™¤éæ•…æ„æŠŠæ³¨è§£æ‰“åœ¨äº†é”™è¯¯çš„ä½ç½®\n            VariableElement variableElement = (VariableElement) element;\n            TypeElement classElement = (TypeElement) variableElement.getEnclosingElement();\n            String fullClassName = classElement.getQualifiedName().toString();\n\n            BindCreatorProxy proxy = mProxyProMap.get(fullClassName);\n            if (proxy == null) {\n                proxy = new BindCreatorProxy(mElementUtils, classElement);\n                mProxyProMap.put(fullClassName, proxy);\n            }\n\n            if (className.getCanonicalName().equals(BindView.class.getCanonicalName())) {\n                // BindView æ³¨è§£å¤„ç†\n                BindView bindAnnotation = variableElement.getAnnotation(BindView.class);\n                int id = bindAnnotation.value();\n                // è¿”å›å½“å‰çš„ id çš„ human å€¼ï¼Œç±»ä¼¼ R.id.xxx\n                String idRes = getBindViewResId(parser, fullClassName, id);\n                ResModel model = new ResModel(idRes, id, BindView.class);\n                proxy.putElement(model, variableElement);\n\n            } else if (className.getCanonicalName().equals(BindString.class.getCanonicalName())) {\n                // BindString æ³¨è§£å¤„ç†\n                BindString bindAnnotation = variableElement.getAnnotation(BindString.class);\n                String str = bindAnnotation.value();\n                proxy.putElement(str, variableElement);\n            }\n        }\n    }\n\n```\n\nä¸ºäº†ä¾¿äºç†è§£ä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹æ•´ä¸ª apt-processor çš„ UML ç±»å›¾\n\n<img src=\"æ³¨è§£å¤„ç†å™¨APTåˆæ¢/BindView_Proxy.png\">\n\næ€»çš„æ¥è¯´ï¼ŒmProxyProMap æ˜¯ä»¥æ³¨è§£æ‰€åœ¨çš„ç±»åä¸º key ï¼ŒBindCreatorProxy ä¸ºå€¼çš„ä¸€ä¸ª mapã€‚è¿™æ ·åšä¸ºäº†æ–¹ä¾¿ä»¥ @BindView,@BindString\næ³¨è§£æ‰€åœ¨çš„ç±»ä¸ºç»´åº¦ï¼Œè§£ææ³¨è§£ç”Ÿæˆä»£ç ã€‚BindCreatorProxy ä¸­çš„ putElements() æ–¹æ³•ä¼šä¿å­˜æ³¨è§£å¯¹åº”çš„ value å’Œ element çš„æ˜ å°„è¡¨ï¼ˆå³ä¸€ä¸ª HaspMapï¼‰ã€‚\n\n- getBindViewResIdï¼ˆï¼‰\n\n  è¿™é‡Œå†æ¥ç®€å•è¯´ä¸€ä¸‹ getBindViewResId è¿™ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œå…¶å®æ˜¯å€Ÿç”¨ [RParser](https://github.com/HendraAnggrian/r-parser)ä¸ºäº†ä¾¿äºç”Ÿæˆæ›´åŠ å‹å¥½çš„ä»£ç ã€‚å› ä¸ºæˆ‘ä»¬é€šè¿‡ R æ–‡ä»¶ç›´æ¥è·å–åˆ°çš„ View çš„ id ä¸€èˆ¬æ˜¯æ— æ„ä¹‰çš„ä¸€ä¸ªæ•°å­—ï¼Œå› æ­¤ç”Ÿæˆçš„æ–‡ä»¶ä¸€èˆ¬ä¼šæ˜¯ç±»ä¼¼\n\n  ```java\n    target.mName = target.findViewById(2131165246);\n  ```\n\n  è¿™æ ·çš„ä»£ç ï¼Œç†è®ºä¸Šæ¥è¯´ï¼Œè¿™é‡Œçš„ id æ˜¯ä»¥ä»€ä¹ˆæ ·çš„å½¢æ€å­˜åœ¨ï¼Œå…¶å®æ— æ‰€è°“ï¼Œä½†ä¸ºäº†æ›´åŠ å‹å¥½çš„é˜…è¯»ä½“éªŒï¼Œæˆ‘ä»¬å¯ä»¥å†ä¼˜åŒ–ä¸€ä¸‹æ³¨è§£ç”Ÿæˆå™¨æŠŠç”Ÿæˆçš„ä»£ç å˜æˆè¿™ä¸ªæ ·å­\n\n  ```java\n    target.mName=target.findViewById(com.engineer.aptlite.R.id.name);\n  ```\n\n  è¿™æ ·çš„ä»£ç æ›´æ¥è¿‘æˆ‘ä»¬æœ€ç»ˆæƒ³è¦çœ‹åˆ°çš„æ ·å­ã€‚\n\n##### ä»£ç ç”Ÿæˆ \n\nmProxyProMap å·²ç»åŒ…å«æ‰€æœ‰æˆ‘ä»¬éœ€è¦ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ ¹æ®è¿™ä¸ªé›†åˆç”Ÿæˆä»£ç äº†ã€‚åœ¨ APT å¤„ç†è¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬ä¼šé€‰æ‹©ä½¿ç”¨ javapoet æ¥ç”Ÿæˆä»£ç ï¼Œè¿™ä¸ªåº“æä¾›äº†å¾ˆå¤š api æ–¹æ³•å¼€å‘è€…æŒ‰ç…§é¢å‘å¯¹è±¡çš„æ–¹å¼**è¾“å‡º**ä¸€ä¸ªåŒ…å«å¯¼åŒ…ï¼Œç±»å£°æ˜ï¼Œå˜é‡å£°æ˜ï¼Œæ–¹æ³•å®šä¹‰ç­‰å„ç§ä¿¡æ¯çš„ç±»æ–‡ä»¶ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹æ³•ï¼ŒæŒ‰ç…§ä½ å¸Œæœ›çš„æ ¼å¼è¿›è¡Œæ‹¼æ¥å³å¯ã€‚\n\n  - genCodeAuto() \n\n```java\nprivate void genCodeAuto() {\n        for (String key : mProxyProMap.keySet()) {\n            BindCreatorProxy proxyPro = mProxyProMap.get(key);\n            try {\n                JavaFile javaFile = JavaFile.builder(proxyPro.getPackageName(), proxyPro.generatorJavaCode()).build();\n                javaFile.writeTo(mFiler);\n            } catch (Exception e) {}\n        }\n    }\n\n```\nè¿™é‡Œéå†æ‰€æœ‰éœ€è¦ç”Ÿæˆçš„ç±»ï¼Œåˆ†åˆ«ä¸ºä»–ä»¬ç”Ÿæˆæ–‡ä»¶ï¼ŒproxyPro.generatorJavaCode() çš„å…·ä½“å®ç° \n\n```java\npublic TypeSpec generatorJavaCode() {\n        TypeSpec typeSpec = TypeSpec.classBuilder(mBindingClassName)\n                .addModifiers(Modifier.PUBLIC)\n                .addModifiers(Modifier.FINAL)\n                .addMethod(generateViewBindMethod())\n                .addMethod(generateStringBindMethod())\n                .build();\n        return typeSpec;\n    }\n```\nè¿™é‡Œä½¿ç”¨ javapoet å®ç°,å¯ä»¥çœ‹åˆ°ä»–çš„ API è®¾è®¡å‘½åè¿˜æ˜¯å¾ˆæ¸…æ™°çš„ï¼ŒåŸºæœ¬ä¸Šæ ¹æ®æ–¹æ³•å‘½åå°±å¯ä»¥çŸ¥é“éœ€è¦åšä»€ä¹ˆäº‹æƒ…äº†ï¼Œè¿™é‡Œçš„å®ç°å°±å¾ˆç®€å•äº†ï¼Œå…·ä½“ç»†èŠ‚å°±ä¸å±•å¼€äº†ï¼Œå¯ä»¥å‚è€ƒ[æºç ](https://github.com/REBOOTERS/APT-Lite/blob/master/apt-processor/src/main/java/com/engineer/apt_processor/creator/BindCreatorProxy.java#L53)\n\n\n##### ç”Ÿæˆçš„ç›®æ ‡ä»£ç \n\nä»¥[ä¸Šé¢æˆ‘ä»¬åˆ¶å®šçš„ç›®æ ‡ MainActivity](#main-actvity-code)ä¸ºä¾‹ï¼Œé‚£ä¹ˆæœ€ç»ˆåœ¨ç¼–è¯‘æœŸç”Ÿæˆçš„ä»£ç å°±æ˜¯è¿™ä¸ªæ ·å­ï¼š\n\n```java\npackage com.engineer.aptlite;\n\npublic final class MainActivity_Binding {\n  public void bindView(MainActivity target) {\n    target.mContent=target.findViewById(com.engineer.aptlite.R.id.content);\n    target.mJump1=target.findViewById(com.engineer.aptlite.R.id.jump_1);\n    target.mGenCode=target.findViewById(com.engineer.aptlite.R.id.genCode);\n    target.mJump=target.findViewById(com.engineer.aptlite.R.id.jump);\n    target.mName=target.findViewById(com.engineer.aptlite.R.id.name);\n  }\n\n  public void bindString(MainActivity target) {\n    target.mName.setText(\"APT Success\");\n\n    target.mContent.setText(\"Hello APT\");\n\n  }\n}\n```\n\n**è¿™ä¸ªæ–‡ä»¶åœ¨ä¸€èˆ¬ä¼šåœ¨ */app/build/generated/source/apt/debug/packagename/* ç›®å½•ä¸‹ã€‚ä½†å…¶å®ä¹Ÿä¸ç”¨æŒ‰ç…§ç›®å½•æ‰¾ï¼ŒAndroid Studio åˆ‡æ¢åˆ° Android ç›®å½•è§†å›¾ä¸‹ï¼Œåœ¨ generatedJava åŒ…ä¸‹å³å¯éå¸¸æ–¹ä¾¿çš„æ‰¾åˆ°**\n\nå¯ä»¥çœ‹åˆ°å’Œæˆ‘ä»¬æ‰‹å†™çš„åŸºæœ¬å·®ä¸å¤šã€‚ä»£ç å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œè¯´æ˜ä¸€åˆ‡éƒ½æ­£å¸¸ï¼Œè¯´æ˜ç¼–è¯‘æœŸç”Ÿæˆçš„ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚\n\n<img src=\"æ³¨è§£å¤„ç†å™¨APTåˆæ¢/apt.png\" height=200>\n\n# æ€»ç»“\n\nä½¿ç”¨ APT å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨ç¼–è¯‘æœŸé¢„å…ˆå®Œæˆä¸€äº›é‡å¤æ€§è¾ƒå¼ºï¼Œä¸”å¾ˆæœ‰è§„å¾‹çš„äº‹æƒ…ï¼Œç”Ÿæˆä¸€äº›è¾…åŠ©æ€§çš„ä»£ç ï¼Œæœ€ç»ˆåœ¨æˆ‘ä»¬ç¼–ç çš„æ—¶å€™ï¼Œå¯ä»¥å€ŸåŠ©è¿™äº›è¾…åŠ©ç±»æ›´é«˜æ•ˆå’Œå‡†ç¡®çš„å®Œæˆå·¥ä½œã€‚ä¾‹å¦‚ SugarAdapter é€šè¿‡åœ¨ç¼–è¯‘æœŸç”Ÿæˆçš„æ–‡ä»¶ï¼Œè§£å†³äº† RecyclerView éœ€è¦å¤šç§ç±»å‹çš„ Item æ—¶ï¼ŒAdapter å®ç°çˆ†ç‚¸çš„é—®é¢˜ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹[ç”¨ SugarAdapter ç®€åŒ–å¤æ‚åˆ—è¡¨çš„å®ç°](https://rebooters.github.io/2019/06/16/%E7%94%A8-SugarAdapter-%E7%AE%80%E5%8C%96%E5%A4%8D%E6%9D%82%E5%88%97%E8%A1%A8%E7%9A%84%E5%AE%9E%E7%8E%B0/)\n\n# æ³¨è§£å¤„ç†å™¨åœ¨ Kotlin ä¸­çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹\n\nåœ¨å¸¸è§„çš„ java ç‰ˆæœ¬çš„ Android é¡¹ç›®ä¸­ï¼Œä¸ºäº†å¼•å…¥å¸¦æœ‰æ³¨è§£å¤„ç†å™¨çš„åº“ï¼Œä¸€èˆ¬ä¼šæœ€ build.gradle çš„ dependencies é—­åŒ…ä¸­ä¼šä½¿ç”¨annotationProcessor æ¥ä½¿ç”¨æ³¨è§£å¤„ç†å™¨ï¼Œæ¯”å¦‚ glide çš„ä¾èµ– \n\n```groovy\ndependencies {\n  implementation 'com.github.bumptech.glide:glide:4.9.0'\n  annotationProcessor 'com.github.bumptech.glide:compiler:4.9.0'\n}\n```\nåœ¨ Kotlin ä¸­éœ€è¦æ›¿æ¢ä¸º kapt äº†ã€‚å…·ä½“æ¥è¯´ï¼Œé¦–å…ˆéœ€è¦æ·»åŠ  kapt çš„æ’ä»¶\n\n```groovy\napply plugin: 'kotlin-kapt'\n```\n\nç„¶åå°†æ‰€æœ‰éœ€è¦ä½¿ç”¨ annotationProcessor çš„åœ°æ–¹æ›¿æ¢ä¸º kapt å³å¯ã€‚\n\n<span id=\"refercen-doc\">\n\n# å‚è€ƒæ–‡æ¡£\n\n- [Android å¦‚ä½•ç¼–å†™åŸºäºç¼–è¯‘æ—¶æ³¨è§£çš„é¡¹ç›®](https://blog.csdn.net/lmj623565791/article/details/51931859)\n- [APT æ³¨è§£å¤„ç†å™¨ï¼Œè®©ä½ çš„ä»£ç å˜å¾—æ›´ç®€å•](https://mp.weixin.qq.com/s/cZf87Du11cqWD0GF2PmPyw)\n- [è½»æ¾æ‰“é€ ä¸€ä¸ªè‡ªå·±çš„æ³¨è§£æ¡†æ¶](https://mp.weixin.qq.com/s/ljJ1uBCinBLhCU6MtOApYA)\n- [æ•™ä½ å®ç°ä¸€ä¸ªè½»é‡çº§çš„æ³¨è§£å¤„ç†å™¨ï¼ˆAPTï¼‰](https://mp.weixin.qq.com/s/3zrAzOUGpovRRbuYnce3uw)\n- [åœ¨ Android ä¸­ä¼˜é›…åœ°ä½¿ç”¨æ³¨è§£](https://mp.weixin.qq.com/s/fJKAwpqn_hXRXRS4oh1dEw)\n- [è‡ªå®šä¹‰æ³¨è§£ä¹‹ç¼–è¯‘æ—¶æ³¨è§£(RetentionPolicy.CLASS)ï¼ˆä¸‰ï¼‰â€”â€” å¸¸ç”¨æ¥å£ä»‹ç»](https://www.2cto.com/kf/201608/536317.html)\n","tags":["æ³¨è§£ã€åå°„ã€APT"]},{"title":"DebugæŠ€å·§","url":"%2F2019%2F06%2F02%2FDebug%E6%8A%80%E5%B7%A7%2F","content":"\nDebug æŠ€å·§\n\nä½¿ç”¨ IDE è¿›è¡Œ Debug æ—¶çš„ä¸€äº›æŠ€å·§æ“ä½œï¼Œå…¶å®å¯ä»¥èŠ‚çœå¤§é‡çš„æ—¶é—´\n\n<!--more-->\n\n### Code\n\n```java\npublic class Client {\n    private static final String[] NAMES = {\"ç¾é˜Ÿ\", \"æµ©å…‹\", \"é»‘å¯¡å¦‡\"};\n    private static final List<User> USERS = Arrays.stream(NAMES)\n            .map(name -> new User(name, \"ç”·\"))\n            .collect(Collectors.toList());\n\n    public static void main(String[] args) {\n        for (User user : USERS) {\n            System.out.println(user);\n        }\n    }\n}\n```\n\n#### æ¡ä»¶æ–­ç‚¹ + ä»£ç æ¤å…¥\n\n**æ”¹å˜å˜é‡çŠ¶æ€èƒ½å¤ŸåŠ¨æ€åœ°è®¾ç½®å˜é‡å€¼ï¼Œæ¡ä»¶æ–­ç‚¹å¯ä»¥æ§åˆ¶æ–­ç‚¹æ˜¯èƒ½åœ¨æ­¤å¤„æŒ‚èµ·ï¼Œé‚£å°†ä¸¤è€…ç»“åˆå°±èƒ½è¾¾åˆ°åœ¨ç¨‹åºä¸æŒ‚èµ·çš„æƒ…å†µä¸‹è¿›è¡ŒåŠ¨æ€ä»£ç æ¤å…¥çš„æ•ˆæœ**\n\n<img src=\"DebugæŠ€å·§/insert_code.gif\">\n\n#### Android\n\nåŠ¨æ€ä¿®æ”¹å€¼ï¼Œé¿å…å¤šæ¬¡è¿è¡Œä»£ç \n\n<img src=\"DebugæŠ€å·§/insert_Image_url.gif\">\n\n#### å˜é‡è§£æå™¨\n\nå˜é‡å±æ€§è¿‡å¤š debug æ—¶æ— æ³•å®Œå…¨å±•ç°æ—¶\n\n<img src=\"DebugæŠ€å·§/CustomGoodsRenderers.gif\">\n\nç”šè‡³å¯ä»¥é€šè¿‡åå°„çš„æ–¹å¼ï¼Œè·å–ä»»æ„ç±»çš„æ˜¯æ‰€æœ‰å±æ€§ï¼Œç„¶åç›´æ¥[é€šè¿‡å˜é‡è§£æå™¨è¿›è¡Œè®¾ç½®](https://puke3615.github.io/2018/06/05/Android-Studio-Debug-2/)\n\n### å‚è€ƒæ–‡æ¡£\n\n[Android Studio ä¹‹ Debugï¼ˆä¸€ï¼‰ï¼šè¿è¡ŒæœŸä»£ç æ¤å…¥](https://puke3615.github.io/2018/06/05/Android-Studio-Debug-1/)\n[Android Studio ä¹‹ Debugï¼ˆäºŒï¼‰ï¼šè¿è¡ŒæœŸä»£ç æ¤å…¥](https://puke3615.github.io/2018/06/05/Android-Studio-Debug-2/)\n","tags":["Debug"]},{"title":"Java ä¿®é¥°ç¬¦ VS Kotlin ä¿®é¥°ç¬¦","url":"%2F2019%2F05%2F25%2FJava-%E4%BF%AE%E9%A5%B0%E7%AC%A6-VS-Kotlin-%E4%BF%AE%E9%A5%B0%E7%AC%A6%2F","content":"\nJava å’Œ Kotlin ä¸­æƒé™ä¿®é¥°ç¬¦å°ç»“(é•¿æœŸæ›´æ–°)\n\n<!--more-->\n\n## Java ä¸­\n\n**ä»¥ä¸‹æ‰€è¯´çš„æƒ…å†µæ’é™¤å†…éƒ¨ç±»çš„æƒ…å†µã€‚**\n\n- ç±»ä¸­çš„æ•°æ®æˆå‘˜å’Œæˆå‘˜å‡½æ•°æ®å…·æœ‰çš„è®¿é—®æƒé™åŒ…æ‹¬ï¼špublicã€privateã€protectedã€defaultï¼ˆåŒ…è®¿é—®æƒé™ï¼‰\n\n\n\n\næ€»ç»“ä¸€ä¸‹å¦‚å›¾\n\n| ä½œç”¨åŸŸ    | å½“å‰ç±» | åŒä¸€ package | å­å­™ç±» | å…¶ä»– package |\n| --------- | :----: | :----------: | :----: | :----------: |\n| public    |   âœ…    |      âœ…       |   âœ…    |      âœ…       |\n| protected |   âœ…    |      âœ…       |   âœ…    |      âŒ       |\n| default   |   âœ…    |      âœ…       |   âŒ    |      âŒ       |\n| private   |   âœ…    |      âŒ       |   âŒ    |      âŒ       |\n\né»˜è®¤ä¸å†™æ—¶ï¼Œä¸º default .\n\n1. publicï¼š æ‰€ä¿®é¥°çš„ç±»ã€å˜é‡ã€æ–¹æ³•ï¼Œåœ¨å†…å¤–åŒ…å‡å…·æœ‰è®¿é—®æƒé™ï¼›\n2. protectedï¼š è¿™ç§æƒé™æ˜¯ä¸ºç»§æ‰¿è€Œè®¾è®¡çš„ï¼Œprotectedæ‰€ä¿®é¥°çš„æˆå‘˜ï¼Œå¯¹æ‰€æœ‰å­ç±»æ˜¯å¯è®¿é—®çš„ï¼Œä½†åªå¯¹åŒåŒ…çš„ç±»æ˜¯å¯è®¿é—®çš„ï¼Œå¯¹å¤–åŒ…çš„éå­ç±»æ˜¯ä¸å¯ä»¥è®¿é—®ï¼›\n3. åŒ…è®¿é—®æƒé™ï¼ˆdefaultï¼‰ï¼š åªå¯¹åŒåŒ…çš„ç±»å…·æœ‰è®¿é—®çš„æƒé™ï¼Œå¤–åŒ…çš„æ‰€æœ‰ç±»éƒ½ä¸èƒ½è®¿é—®ï¼›\n4. privateï¼š ç§æœ‰çš„æƒé™ï¼Œåªå¯¹æœ¬ç±»çš„æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼›\n\n- ç±»çš„è®¿é—®æƒé™åŒ…æ‹¬ï¼š åŒ…è®¿é—®æƒé™å’Œ public\n\n## Kotlin\n\nKotlin ä¸­çš„ä¿®é¥°ç¬¦ä¸º publicã€internalã€protectedã€private. å…¶ä¸­ public ä¸ºé»˜è®¤ä¿®é¥°ç¬¦ï¼Œinternal å’Œ Java ä¸­ default çš„è¯­ä¹‰æ˜¯ç±»ä¼¼çš„ï¼Œéƒ½è¡¨ç¤ºå¯¹åŒåŒ…çš„ç±»å¯è§ï¼Œå¤–éƒ¨ä¸å¯è§ã€‚\n\n## å‚è€ƒæ–‡æ¡£\n\n[javaåŸºç¡€(ä¸ƒ) javaå››ç§è®¿é—®æƒé™](https://www.cnblogs.com/jinggod/p/8425423.html)\n","tags":["Java åŸºç¡€"]},{"title":"UML ç±»å›¾åŸºç¡€","url":"%2F2019%2F05%2F22%2FUML-%E5%9F%BA%E7%A1%80%E7%BB%93%E6%9E%84%2F","content":"\n<img src=\"UML-åŸºç¡€ç»“æ„/Aggregation_1.png\" width=60% height=40%/>\n\n## å‰è¨€\n\n> UMLï¼ˆUnified Modeling Language ç»Ÿä¸€å»ºæ¨¡è¯­è¨€ï¼‰æ˜¯ç”¨æ¥å¯¹è½¯ä»¶å¯†é›†ç³»ç»Ÿè¿›è¡Œå¯è§†åŒ–å»ºæ¨¡çš„ä¸€ç§è¯­è¨€ã€‚\n\n**ç®€å•æ¥è¯´ï¼ŒUML ç±»å›¾å°±æ˜¯ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿä¸­å„ä¸ªç±»çš„ç‰¹å¾åŠç›¸äº’å…³ç³»çš„å›¾**ã€‚è¿™é‡Œè¯´çš„è½¯ä»¶ç³»ç»Ÿå¯èƒ½å¾ˆåºå¤§ï¼Œæ˜¯ä¸€ä¸ªå®å®åœ¨åœ¨çš„å¤æ‚è½¯ä»¶æ¶æ„ï¼ˆå¦‚ Android ç³»ç»Ÿï¼‰ï¼Œä¹Ÿå¯èƒ½åªæ˜¯æŸç§æŠ½è±¡è¡¨ç¤ºï¼ˆæ¯”å¦‚è®¾è®¡æ¨¡å¼ï¼‰ã€‚\n\nä¸‹é¢å°±ä»¥ Java è¯­è¨€ä¸ºä¾‹ï¼Œçœ‹çœ‹å¦‚ä½•ç”¨ UML ç±»å›¾è¡¨ç¤º Java ä¸­ç±»ã€æ¥å£åŠå…¶å¤æ‚çš„å…³ç³»ã€‚\n\n<!--more-->\n\n## ç±»\n\nç±»ä½¿ç”¨åŒ…å«å…¶ **ç±»å**ï¼Œ**å±æ€§**ï¼Œ**æ–¹æ³•ååŠå…¶å‚æ•°**å¹¶ä¸”ç”¨**åˆ†å‰²çº¿åˆ†éš”çš„é•¿æ–¹å½¢**è¡¨ç¤ºã€‚åœ¨é•¿æ–¹å½¢ä¸­å±æ€§åŠæ–¹æ³•ååˆæœ‰å¦‚ä¸‹è§„åˆ™ã€‚\n\n### ç±»ä¸­æˆå‘˜å˜é‡è¡¨ç¤º\n\n> å¯è§æ€§ åç§°:ç±»å‹ [ = é»˜è®¤å€¼ ]\n\nå…¶ä¸­å¯è§æ€§ç”¨+ï¼Œ-ï¼Œ\\* ä¸‰ç§ç¬¦åˆè¡¨ç¤ºï¼Œæ„ä¹‰å¦‚ä¸‹ã€‚\n\n| å¯è§æ€§ |      å«ä¹‰       |\n| ------ | :-------------: |\n| +      |     public      |\n| -      |     private     |\n| \\*     |    protected    |\n| ~      | package private |\n\n### ç±»ä¸­æ–¹æ³•è¡¨ç¤º\n\n> å¯è§æ€§ åç§°(å‚æ•°åˆ—è¡¨) [ : è¿”å›ç±»å‹]\n\næ–¹æ³•ä¸­å¯è§æ€§çš„å«ä¹‰å’Œæˆå‘˜å˜é‡ä¸€è‡´ï¼Œåªæ˜¯åç§°ç”±å±æ€§åå˜æˆäº†æ–¹æ³•åã€‚\n\nå‡è®¾ç°æœ‰ç±» Student.java\n\n```java\npublic class Student {\n    public String name=\"mike\";\n    private int score;\n    protected int number=89757;\n    String address;\n\n    public String getName(){\n        return name;\n    }\n\n    private void setScore(int score) {\n        this.score=score;\n    }\n\n    protected void setNumber(int number) {\n        this.number=number;\n        setScore(number * 2);\n    }\n}\n```\n\né‚£ä¹ˆä»–æ‰€å¯¹åº”çš„ UML ç±»å›¾å¦‚ä¸‹ï¼š\n\n<img src=\"UML-åŸºç¡€ç»“æ„/Student.png\" width=300 />\n\n[Student ç±» UML å®ç°](https://github.com/REBOOTERS/My-MVP/blob/master/uml/Student.puml)\n\n## æ¥å£ & æŠ½è±¡ç±»\n\né€šè¿‡ä¸Šè¿°ä¿¡æ¯ï¼Œå·²ç»é˜è¿°äº† UML è¡¨ç¤º **Java Class** æ‰€éœ€è¦çš„æ‰€æœ‰åŸºç¡€çŸ¥è¯†ï¼Œå‰©ä¸‹çš„æ¥å£ã€æŠ½è±¡ç±»åŒ…æ‹¬æŠ½è±¡æ–¹æ³•ã€é™æ€ç±»ã€æŠ½è±¡æ–¹æ³•å’Œæšä¸¾ç±»åªæ˜¯åœ¨å…¶åŸºç¡€ä¸Šæ‰©å±•ï¼Œå¯¹ç±»çš„å®šä¹‰æœ‰ä¸€äº›ç¨å¾®çš„å·®å¼‚è€Œå·²ã€‚\n\n<img src=\"UML-åŸºç¡€ç»“æ„/base.png\" width=300 />\n\n[æŠ½è±¡ç±»ï¼Œæ¥å£ï¼Œæšä¸¾çš„ UML å®ç°](https://github.com/REBOOTERS/My-MVP/blob/master/uml/base.puml)\n\nä¸Šå›¾ç®€å•å±•ç¤ºäº† Java é›†åˆç±»ä¹‹é—´çš„å…³ç³»ï¼Œä¸‹é¢è¯¦ç»†çš„æ¢³ç†ä¸€ä¸‹å¦‚ä½•ç”¨ UML å›¾æè¿°ç±»ä¹‹é—´çš„å…³ç³»ã€‚\n\n## ç±»ä¹‹é—´çš„å…³ç³»\n\nåœ¨ UML ä¸­ï¼Œç±»(è¿™é‡Œæ³›æŒ‡ Java ä¸­çš„ç±»å’Œæ¥å£)ä¹‹é—´çš„å…³ç³»å¯ä»¥ç”¨ä»¥ä¸‹ 6 ç§å½¢æ€è¡¨è¾¾ã€‚\n\n- ç»§æ‰¿ï¼ˆæ³›åŒ–ï¼‰ï¼š å­ç±»å’Œçˆ¶ç±»ç”¨**å¸¦ç©ºå¿ƒä¸‰è§’çš„ç›´çº¿**è¡¨ç¤ºï¼Œç®­å¤´æŒ‡å‘çˆ¶ç±»ï¼›\n- å®ç°ï¼š å°±æ˜¯æ¥å£çš„å®ç°ç±»å’Œæ¥å£ä¹‹é—´çš„å…³ç³»ï¼Œç”¨**å¸¦ç©ºå¿ƒä¸‰è§’çš„è™šçº¿**è¡¨ç¤ºï¼Œç®­å¤´æŒ‡å‘æ¥å£ï¼›\n- ä¾èµ–ï¼šå°±æ˜¯ä¸€ä¸ªç±»ä¸­åŒ…å«å¦ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œç”¨**å¸¦ç®­å¤´çš„è™šçº¿**è¡¨ç¤ºï¼Œç®­å¤´æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡å¯¹åº”çš„ç±»ï¼›\n- å…³è”ï¼šä¸€ä¸ªç±»å’Œå¦ä¸€ä¸ªç±»æœ‰è”ç³»ï¼Œç”¨**å¸¦ç®­å¤´çš„ç›´çº¿**è¡¨ç¤ºï¼Œç®­å¤´æŒ‡å‘è¢«åŒ…å«ç±»ï¼›\n- èšåˆï¼šæ•´ä½“å’Œéƒ¨åˆ†çš„å…³ç³»ï¼Œéƒ¨åˆ†å¯ä»¥è„±ç¦»æ•´ä½“å­˜åœ¨ï¼›ç”¨**å¸¦ç©ºå¿ƒè±å½¢çš„ç›´çº¿**è¡¨ç¤ºï¼Œç®­å¤´æŒ‡å‘ä»£è¡¨éƒ¨åˆ†çš„é‚£ä¸ªç±»ï¼›\n- ç»„åˆï¼šæ•´ä½“å’Œéƒ¨åˆ†çš„å…³ç³»ï¼Œéƒ¨åˆ†å—æ•´ä½“çš„å½±å“ï¼Œæ•´ä½“ä¸å­˜åœ¨æ—¶éƒ¨åˆ†ä¹Ÿå°†æ¶ˆå¤±ï¼Œç”¨**å¸¦å®å¿ƒè±å½¢çš„ç›´çº¿**è¡¨ç¤ºï¼Œç®­å¤´æŒ‡å‘ä»£è¡¨éƒ¨åˆ†çš„é‚£ä¸ªç±»ï¼›\n\nä¸ºäº†åŠ æ·±å°è±¡ï¼Œä¸‹é¢é€šè¿‡å›¾ç¤ºå†æ¥è¯¦ç»†é˜è¿°ä¸€ä¸‹ä»¥ä¸Šçš„å†…å®¹ã€‚\n\n### ç»§æ‰¿ï¼ˆæ³›åŒ–ï¼‰\n\nè¿™ä¸ªæœ€å¥½ç†è§£äº†ï¼Œæ¯”å¦‚ Android ä¸­çš„ View æ ‘ã€‚ **è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¥å£ä¹‹é—´ä¹Ÿæ˜¯å¯ä»¥æœ‰ç»§æ‰¿å…³ç³»çš„**\n\nç”¨**å¸¦ç©ºå¿ƒä¸‰è§’çš„ç›´çº¿**è¡¨ç¤ºï¼Œç®­å¤´æŒ‡å‘åŸºç±»\n\n<img src=\"UML-åŸºç¡€ç»“æ„/Generalization.png\" width=300 height=auto />\n\n[Generalization](https://github.com/REBOOTERS/My-MVP/blob/master/uml/Generalization.puml)\n\n### å®ç°\n\nåŒæ ·ä»¥ Android ä¸­ View å’Œ RecyclerView ä¸ºä¾‹ï¼Œä»–ä»¬å„è‡ªå®ç°äº†ä¸åŒçš„æ¥å£ ã€‚\n\nç”¨**å¸¦ç©ºå¿ƒä¸‰è§’çš„è™šçº¿**è¡¨ç¤ºï¼Œç®­å¤´æŒ‡å‘æ¥å£\n\n<img src=\"UML-åŸºç¡€ç»“æ„/Realization.png\" height=auto />\n\n[Realization](https://github.com/REBOOTERS/My-MVP/blob/master/uml/Realization.puml)\n\n### ä¾èµ–\n\nä¾èµ–å…³ç³»æ˜¯ç±»ä¸ç±»ä¹‹é—´æœ€å¼±çš„å…³ç³»ï¼Œä¾èµ–å¯ä»¥ç®€å•çš„ç†è§£ä¸€ä¸ªç±»ä½¿ç”¨äº†å¦ä¸€ä¸ªç±»ã€‚åŒæ—¶è¢«ä¾èµ–çš„ç±»ï¼Œå¦‚æœå‘ç”Ÿäº†å˜åŒ–ä¼šå½±å“ä¾èµ–ä»–çš„ç±»ã€‚\n\nè¿™ä¸ªæœ€å¥½çš„è§£é‡Šå°±æ˜¯ View çš„ draw æ–¹æ³•äº†, åœ¨æ•´ä¸ª View ç±»ä¸­ï¼Œåªæ˜¯éœ€è¦åœ¨ draw æ–¹æ³•ä¸­ä¾èµ– Canvas è¿›è¡Œç»˜åˆ¶æ“ä½œã€‚onTouchEvent() çš„å‚æ•° MotionEvent ä¹Ÿæ˜¯ç±»ä¼¼ã€‚å¯¹ View æ¥è¯´åªæ˜¯ä¾èµ–è¿™ä¸¤ä¸ªç±»å®Œæˆä¸€äº›å…³é”®æ“ä½œï¼ŒåŒæ—¶ MotiveEvent æœ‰ä¸åŒçš„ event æ—¶ï¼ŒView ä¹Ÿéœ€è¦å‘ç”Ÿç›¸åº”çš„å˜åŒ–ã€‚\n\nç”¨**å¸¦ç®­å¤´çš„è™šçº¿**è¡¨ç¤ºï¼Œç®­å¤´æŒ‡å‘å½“å‰ç±»ä¾èµ–çš„ç±»\n\n<img src=\"UML-åŸºç¡€ç»“æ„/Dependence.png\" height=300 />\n\n[Dependence](https://github.com/REBOOTERS/My-MVP/blob/master/uml/Dependence.puml)\n\n**æ€»çš„æ¥è¯´ï¼Œä¾èµ–å…³ç³»å°±æ˜¯åœ¨æŸä¸ªç±»çš„æ–¹æ³•ä¸­éœ€è¦å¦ä¸€ä¸ªç±»**ï¼Œä½†è¿™ç§ä¾èµ–å…³ç³»ä¸ä¸€å®šè¡¨ç°ä¸ºå½¢å‚ï¼Œå…·ä½“ç»†èŠ‚å¯å‚è€ƒ[è®¾è®¡æ¨¡å¼ä¹‹ UML ç±»å›¾](https://zhuanlan.zhihu.com/p/24576502)ã€‚å½“ç„¶ï¼Œè¿™é‡Œéµå¾ªè®¾è®¡æ¨¡å¼ä¸­ã€ä¾èµ–æ³¨å…¥ã€çš„ç†å¿µï¼Œä½¿ç”¨å½¢å‚å»æ³¨å…¥å¦å¤–ä¸€ä¸ªç±»ï¼ˆè¿™é‡Œçš„ç±»æ³›æŒ‡ç±»å’Œæ¥å£ï¼‰æ¥å®ç°ä¾èµ–åº”è¯¥æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚\n\n### å…³è”\n\nAssociation\n\nå…³è”å…³ç³»çš„å®šä¹‰ä¸ºï¼šå¯¹äºä¸¤ä¸ªç›¸å¯¹ç‹¬ç«‹çš„å¯¹è±¡ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ä¸å¦ä¸€ä¸ªå¯¹è±¡çš„ä¸€äº›ç‰¹å®šå®ä¾‹å­˜åœ¨å›ºå®šçš„å¯¹åº”å…³ç³»æ—¶ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´ä¸ºå…³è”å…³ç³»ã€‚å…³è”å…³ç³»è¡¨ç¤ºä¸€ä¸ªç±»å’Œå¦ä¸€ç±»æœ‰è”ç³»ï¼Œæ˜¯ä¸€ç§åŒ…å«å…³ç³»ã€‚\n\n> å…³è”å…³ç³»åˆ†ä¸ºå•å‘å…³è”å’ŒåŒå‘å…³è”ï¼šåœ¨ Java ä¸­ï¼Œ\n>\n> - å•å‘å…³è”è¡¨ç°ä¸º: ç±» A å½“ä¸­ä½¿ç”¨äº† ç±» Bï¼Œå…¶ä¸­ç±» B æ˜¯ä½œä¸ºç±» A çš„> æˆå‘˜å˜é‡ã€‚\n> - åŒå‘å…³è”è¡¨ç°ä¸º: ç±» A å½“ä¸­ä½¿ç”¨ç±» B ä½œä¸ºæˆå‘˜å˜é‡ï¼ŒåŒæ—¶ç±» B ä¸­ä¹Ÿä½¿ç”¨äº†ç±» A ä½œä¸ºæˆå‘˜å˜é‡ã€‚\n\nè¿™é‡Œå°±éœ€è¦äº†è§£ä¸€ä¸‹ï¼Œå…³è”å’Œä¾èµ–çš„åŒºåˆ«äº†ã€‚**åœ¨ä¾èµ–å…³ç³»ä¸­ï¼Œè¢«ä¾èµ–çš„ç±»åªæ˜¯ä¸´æ—¶è¢«æ‹¿æ¥ç”¨ä¸€ä¸‹ï¼Œå’Œå½“å‰ç±»åªæ˜¯ä¸€ç§å¶ç„¶çš„å…³ç³»ï¼Œè€Œåœ¨å…³è”å…³ç³»ä¸­ï¼Œæ‰€æœ‰è¢«å…³è”çš„ç±»ï¼Œå’Œå½“å‰ç±»éƒ½æ˜¯æœ‰å¿…ç„¶è”ç³»çš„ç±»ã€‚**\n\n**è¿™ç§å…³ç³»é€šå¸¸ä½¿ç”¨ç±»çš„å±æ€§è¡¨è¾¾**,æ¯”å¦‚ Android ä¸­çš„ ViewGroup çš„ LayoutParams ç±»ã€‚\n\nå…³è”å…³ç³»ç”¨**å¸¦ç®­å¤´çš„ç›´çº¿**è¡¨ç¤ºï¼Œç®­å¤´æŒ‡å‘å½“å‰ç±»å…³è”çš„ç±»\n\n<img src=\"UML-åŸºç¡€ç»“æ„/Association.png\" height=200 />\n\n[Association](https://github.com/REBOOTERS/My-MVP/blob/master/uml/Association.puml)\n\næ¯ä¸ª ViewGroup å¿…ç„¶ä¼šæœ‰ä»–çš„ LayoutParams ç±»ï¼Œæ¥è¡¥å…… ViewGroup çš„å…·ä½“ä¿¡æ¯ã€‚\n\n### èšåˆï¼ˆAggregationï¼‰\n\nèšåˆå…³ç³»æ˜¯å…³è”å…³ç³»çš„ä¸€ç§ï¼Œè€¦åˆåº¦å¼ºäºå…³è”ã€‚è¡¨ç¤º has-a çš„å…³ç³»ï¼Œæ˜¯ä¸€ç§ä¸ç¨³å®šçš„åŒ…å«å…³ç³»ã€‚\n\nè¿™ç§åœºæ™¯ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„ã€‚æ¯”å¦‚åœ¨ä¸ºäº†æ–¹ä¾¿å®ç° RecyclerView ä¸­çš„ç‚¹å‡»äº‹ä»¶ï¼Œä¸€èˆ¬ä¼šåœ¨å…¶ Adapter ç±»ä¸­æ³¨å…¥ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡å›è°ƒçš„æ–¹å¼æ¥å®ç°ç‚¹å‡»äº‹ä»¶çš„ç›‘å¬ã€‚\n\n```java\npublic class MyAdapter extends RecyclerView.Adapter {\n20    .....\n24\n25     private OnRecyclerViewListener onRecyclerViewListener;\n26\n27     public void setOnRecyclerViewListener(OnRecyclerViewListener onRecyclerViewListener) {\n28         this.onRecyclerViewListener = onRecyclerViewListener;\n29     }\n\n       ....\n}\n```\n\nè¿™æ˜¯ä¸€ç§å…¸å‹çš„ has-a å…³ç³»ã€‚\n\nç”¨**å¸¦ç©ºå¿ƒè±å½¢çš„ç›´çº¿**è¡¨ç¤ºï¼Œè±å½¢ä»å±€éƒ¨æŒ‡å‘æ•´ä½“\n\n\n<img src=\"UML-åŸºç¡€ç»“æ„/Aggregation.png\" height=200 />\n\n[Aggregation](https://github.com/REBOOTERS/My-MVP/blob/master/uml/Aggregation.puml)\n\n### ç»„åˆ\n\nç»„åˆå…³ç³»ä¹Ÿæ˜¯ä¸€ç§éƒ¨åˆ†å’Œæ•´ä½“çš„å…³ç³»ï¼Œä½†æ˜¯éƒ¨åˆ†å­˜æ´»å‘¨æœŸå—åˆ°æ•´ä½“çš„å½±å“ï¼Œè‹¥æ•´ä½“ä¸å­˜åœ¨åˆ™éƒ¨åˆ†ä¹Ÿå°†ä¸å­˜åœ¨ã€‚\n\nè¿™ä¸ªå°±å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬å¹³æ—¶å†™çš„ Activity æˆ– Fragment å’Œå…¶å†…éƒ¨æˆå‘˜çš„å…³ç³»å°±æ˜¯è¿™æ ·ï¼ŒAcitivity æˆ– Fragment å†…çš„å„ç§ View,Presenter,ViewModel å¯¹è±¡ï¼Œä¸€æ—¦è¿™ä¸ª Activity æˆ– Fragment é”€æ¯äº†ï¼Œé‚£ä¹ˆè¿™äº›å†…å®¹åŸºæœ¬ä¹Ÿå°±æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†ã€‚\n\nç”¨**ç”¨å¸¦å®å¿ƒè±å½¢çš„ç›´çº¿**è¡¨ç¤ºï¼Œè±å½¢ä»å±€éƒ¨æŒ‡å‘æ•´ä½“\n\n\n\n<img src=\"UML-åŸºç¡€ç»“æ„/Composition.png\" height=200 />\n\n[Composition](https://github.com/REBOOTERS/My-MVP/blob/master/uml/Composition.puml)\n\nç»„åˆå…³ç³»çš„å¦ä¸€ä¸ªä¾‹å­å°±æ˜¯è‡ªå®šä¹‰ View çš„å®ç°ã€‚\n\næ¯”å¦‚ä¸‹é¢ä¸€ä¸ªè‡ªå®šä¹‰é—¹é’Ÿçš„å®ç° ClockView(èŠ‚é€‰éƒ¨åˆ†ï¼Œå®Œæ•´æºç å¯å‚è€ƒ[ClockView](https://github.com/REBOOTERS/AndroidAnimationExercise/blob/master/app/src/main/java/home/smart/fly/animations/customview/ClockView.java)) ä¸­;ç”¨ Paint,TextPaint,RectF,ValueAnimator ç»„åˆèµ·æ¥ï¼Œå®Œæˆäº†è¿™ä¸ªè‡ªå®šä¹‰ View ï¼Œä½†æ˜¯åŒæ—¶å½“è¿™ä¸ªè‡ªå®šä¹‰ä¸å­˜åœ¨æ—¶ï¼Œè¿™äº›ç±»å°±æ²¡ä»€ä¹ˆå­˜åœ¨çš„æ„ä¹‰äº†ã€‚\n\n```java\npublic class ClockView extends View {\n\n    private Paint mCirclePaint;\n    private Paint mArcPaint;\n    private TextPaint mTextPaint;\n\n    private RectF mRectF;\n    private ValueAnimator mAnimator;\n}\n\n```\n\n<img src=\"UML-åŸºç¡€ç»“æ„/Composition1.png\" height=200 />\n\n[Composition](https://github.com/REBOOTERS/My-MVP/blob/master/uml/Composition1.puml)\n\n## æ€»ç»“\n\n- ä¸Šè¿°å…­ç§ç±»çš„å…³ç³»ï¼ŒæŒ‰ç…§ **ä¾èµ–>å…³è”>èšåˆ>ç»„åˆ>ç»§æ‰¿>å®ç° çš„é¡ºåºï¼Œä»–ä»¬çš„è€¦åˆåº¦ä¾æ¬¡å¢å¼º**ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè®¾è®¡æ¨¡å¼ä¸­ï¼Œæå€¡æˆ‘ä»¬ä¾èµ–æ³¨å…¥çš„åŸå› ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ç»„åˆçš„è€¦åˆåº¦æ˜¯ä½äºç»§æ‰¿çš„ï¼Œæ‰€ä»¥åœ¨ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä¼˜å…ˆè€ƒè™‘ä¸€ä¸‹ç»„åˆçš„å¯èƒ½æ€§ã€‚\n- ç»“åˆä¸Šè°ƒè€¦åˆåº¦å…³ç³»ï¼ŒåŠç»„åˆã€èšåˆå’Œå…³è”çš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œåœ¨ä»£ç å±‚é¢è¿™ä¸‰ç§å…³ç³»å…¶å®æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œæˆ‘ä»¬å¾ˆéš¾ç›´æ¥ä»ä»£ç åˆ†æå‡ºç±»ä¹‹é—´çš„ å…³è”ã€èšåˆã€ç»„åˆè¿™ä¸‰ç§å…³ç³»æ¥ï¼Œéœ€è¦ç»“åˆå…¶å…·ä½“çš„è¯­ä¹‰æ‰èƒ½åˆ†è¾¨ã€‚\n- å…³äºå…³è”ï¼Œèšåˆã€ç»„åˆæ›´å‹å¥½çš„è§£é‡Šã€‚\n\n> èšåˆå’Œç»„åˆçš„å…³ç³»,è¡¨ç¤ºä¸€ä¸ªç±»å¯¹è±¡æŒæœ‰å¦å¤–çš„ç±»å¯¹è±¡ä½œä¸ºè‡ªå·±çš„ä¸€ä¸ªå±æ€§.\n>\n> å…³è”ä»…ä»…è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡è·Ÿå¦å¤–çš„å¯¹è±¡å‘ç”Ÿäº†é€šä¿¡, æ²¡æœ‰æŒæœ‰å®ƒä½œä¸ºå¯¹è±¡.\n>\n> æ‰€ä»¥äººä»¬è¯´: å…³è”æè¿°çš„æ˜¯æ–¹æ³•å±‚æ¬¡ä¸Šçš„äº¤äº’, è€Œèšåˆå’Œç»„åˆæ˜¯æè¿°å±æ€§å±‚æ¬¡ä¸Šçš„äº¤äº’!\n>\n> For Example: é‚®é€’å‘˜å’Œä½ çš„äº¤äº’, å±äºå…³è”, å› ä¸ºä»–åªæ˜¯æ‹œè®¿ä½ , ç»™ä½ é€ä¸€å°ä¿¡.\n> é‚®é€’å‘˜å’Œé‚®å±€çš„å…³ç³»,å±äºèšåˆæˆ–è€…ç»„åˆ{æš‚ä¸”åªåŒºåˆ†å…³è”å…³ç³»}.\n> åŸå› æ˜¯: ä½ æ‰“ç”µè¯ç»™é‚®é€’å‘˜é€ä¿¡,é‚®é€’å‘˜ä¸ä¸€å®šå¬ä½ çš„, è€Œé‚®å±€å°±ä¸åŒäº†, å®ƒè¦è‡ªå·±çš„\n> é‚®é€’å‘˜é€ä¿¡, é‚®é€’å‘˜æ•¢ä¸å¬è¯å—?\n> è¿™å°±æ˜¯å…³è”è·Ÿå…¶å®ƒä¸¤ç§æ–¹æ³•çš„åŒºåˆ«, ä½ æ²¡æœ‰æŒæœ‰å¯¹æ–¹åšä¸ºè‡ªå·±çš„å±æ€§, ç”¨ä¸€æ¬¡,ç®—åˆ«äººç»™ä½ \n> çš„æ©èµ, ä½†ä½ ä¸å¯èƒ½è‚†æ„æŒ‡æŒ¥å®ƒ\n\n> èšåˆå’Œç»„åˆçš„å…³ç³»:\n> ä»–ä»¬éƒ½å°†å¯¹è±¡æŒæœ‰ä¸ºå±æ€§. ä½†è¿™æ˜¯ä¸åŒçš„.\n> æ¯”å¦‚ä½ ä¹°çš„ä¹¦, å’Œä½ å€Ÿçš„ä¹¦. ç°åœ¨éƒ½æ”¾åœ¨å®¶é‡Œ. ä½†æ¦‚å¿µæ˜¯ä¸åŒçš„, ä½ ä¹°çš„ä¹¦,å¯ä»¥éšä¾¿å¤„ç†,\n> é¬¼åˆ’ç³Šæ¶‚,ä½†å›¾ä¹¦é¦†çš„å€Ÿæ¥çš„ä¹¦,ä½ èƒ½è¿™ä¹ˆå¹²å—? èšåˆ:å¤§å®¶éƒ½å¯æŒæœ‰,ä½†ä¸å¯å®Œå…¨å æœ‰,ç»„åˆ:\n> ç§æœ‰è´¢äº§.\n\n## å‚è€ƒæ–‡æ¡£\n\n[è®¾è®¡æ¨¡å¼ä¹‹ UML ç±»å›¾](https://zhuanlan.zhihu.com/p/24576502)\n\n[äº”åˆ†é’Ÿçœ‹æ‡‚ UML ç±»å›¾ä¸ç±»çš„å…³ç³»è¯¦è§£](https://juejin.im/post/5b42d4396fb9a04fbc21d7dd)\n\n[UML çš„å…³è”(Association), èšåˆ(Aggregation), ç»„åˆ(Composition)åŒºåˆ«](https://ostrichmyself.iteye.com/blog/733720)","tags":["è®¾è®¡æ¨¡å¼"]},{"title":"å…³äºã€Šç»¿çš®ä¹¦ã€‹çš„ä¸€äº›æ„Ÿæƒ³","url":"%2F2019%2F03%2F10%2F%E5%85%B3%E4%BA%8E%E3%80%8A%E7%BB%BF%E7%9A%AE%E4%B9%A6%E3%80%8B%E7%9A%84%E4%B8%80%E4%BA%9B%E6%84%9F%E6%83%B3%2F","content":"\n\n<img src=\"å…³äºã€Šç»¿çš®ä¹¦ã€‹çš„ä¸€äº›æ„Ÿæƒ³/p2549177902.webp\" />\n\nå¾ˆä¹…æ²¡æœ‰çœ‹åˆ°è¿™æ ·çš„ç”µå½±äº†ï¼Œçœ‹å®Œçš„æ—¶å€™ï¼Œå†…å¿ƒçœŸçš„å¾ˆèˆ’æœã€‚å¥½ä¹…æ²¡æœ‰è¿™æ ·çš„æ„Ÿå—äº†ï¼Œå¤ªå¤šçš„å°è¯å¤ªç»å…¸äº†ï¼Œå°¤å…¶æ˜¯é‚£å¥ **ä¸–ç•Œä¸Šæœ‰å¤ªå¤šå­¤ç‹¬çš„äººå®³æ€•å…ˆè¸å‡ºç¬¬ä¸€æ­¥ï¼ˆthe world's full of lonely people afraid to make the first move ï¼‰** ,å¿ƒçœŸçš„é¢¤äº†ä¸€ä¸‹ã€‚\n\n\n\n<!--more-->\n\næƒ³å†™çš„ä¸œè¥¿å¤ªå¤šï¼Œå´åˆä¸çŸ¥ä»ä½•å†™èµ·ï¼Œå°±ç”¨è¿™äº›å‰§ç…§(å›¾æºè‡ªè±†ç“£ç”µå½±)è¡¨è¾¾æˆ‘çš„å¿ƒæƒ…å§ã€‚\n\n- è®©æˆ‘çœ‹çš„æ—¶å€™åœä¸‹æ¥æ²‰æ€äº†ååˆ†é’Ÿçš„ç”µå½±å°è¯\n\n<img src=\"å…³äºã€Šç»¿çš®ä¹¦ã€‹çš„ä¸€äº›æ„Ÿæƒ³/p2548973932.webp\" />\n\n- ä¹Ÿè®¸è¿™åº”è¯¥æ˜¯æˆ‘ä»¬åšäº‹æ—¶æœ€è¯¥æœ‰çš„æ€åº¦\n\n<img src=\"å…³äºã€Šç»¿çš®ä¹¦ã€‹çš„ä¸€äº›æ„Ÿæƒ³/p2545880063.webp\" />\n\n- æœ‰å¤šå°‘ç±»ä¼¼è¿™æ ·çš„è¯ï¼Œå´ä»æ¥æ²¡æœ‰å¬äººè¯´èµ·è¿‡\n\n<img src=\"å…³äºã€Šç»¿çš®ä¹¦ã€‹çš„ä¸€äº›æ„Ÿæƒ³/p2549106335.webp\" />\n\n- æˆ‘ä»¬åº”è¯¥æ€æ ·æ´»ç€\n\n<img src=\"å…³äºã€Šç»¿çš®ä¹¦ã€‹çš„ä¸€äº›æ„Ÿæƒ³/p2548991669.webp\" />\n\n- æœ€åï¼Œä¸¤å¼ å¥½çœ‹çš„ç”µå½±å‰§ç…§\n\n<img src=\"å…³äºã€Šç»¿çš®ä¹¦ã€‹çš„ä¸€äº›æ„Ÿæƒ³/p2548719163.webp\" />\n\n<img src=\"å…³äºã€Šç»¿çš®ä¹¦ã€‹çš„ä¸€äº›æ„Ÿæƒ³/p2548719157.webp\" />\n\n\n\n[æ›´å¤šå‰§ç…§](https://movie.douban.com/subject/27060077/photos?type=S)\n\n\n","tags":["è¯»ä¹¦"]},{"title":"è¯»ã€Šæ›¾å›½è—© åˆç¬¨åˆæ…¢å¹³å¤©ä¸‹ã€‹çš„ä¸€äº›æ„Ÿæƒ³","url":"%2F2019%2F03%2F03%2F%E3%80%8A%E6%9B%BE%E5%9B%BD%E8%97%A9-%E5%8F%88%E7%AC%A8%E5%8F%88%E6%85%A2%E5%B9%B3%E5%A4%A9%E4%B8%8B%E3%80%8B%E8%AF%BB%E5%90%8E%E6%84%9F%2F","content":"\nå¯¹æ›¾å›½è—©ä¸€ç›´ä¸æ˜¯å¾ˆäº†è§£ï¼Œåªæ˜¯åœ¨è¿‘ä»£å†å²æ•…äº‹é‡Œï¼Œæ€»èƒ½å¬åˆ°ä»–çš„åå­—ã€‚å°¤å…¶è¿™ä¸¤å¹´æ›¾å›½è—©ä¼¼ä¹æˆä¸ºåŠ±å¿—äººç‰©ï¼Œæ›¾å›½è—©å®¶ä¹¦ï¼Œæ›¾å›½è—©å„ç§äº‹è¿¹è¢«ç¿»å‡ºï¼Œå„ç§åå®¶å¤§å¸ˆéƒ½ä¼šæ¨èæˆ‘ä»¬å»è¯»æ›¾å›½è—©ï¼Œäº†è§£ä»–è¿™ä¸€ç”Ÿçš„æ•…äº‹ã€‚å› æ­¤ï¼Œå°±ä»è¿™æœ¬ä»å›½å®¶å›¾ä¹¦é¦†å€Ÿæ¥çš„ä¹¦ï¼Œäº†è§£ä¸€ä¸‹è¿™ä½å†å²åäººçš„ä¸€äº›æ•…äº‹ã€‚\n\n<!--more-->\n\n<img src=\"ã€Šæ›¾å›½è—©-åˆç¬¨åˆæ…¢å¹³å¤©ä¸‹ã€‹è¯»åæ„Ÿ/s28787066.jpg\" width=30% height=20%/>\n\n\n### å…³äºä½œè€…\n\né¦–å…ˆç®€å•è¯´ä¸‹è¿™æœ¬ä¹¦çš„ä½œè€…å§ï¼Œ**åº¦é˜´å±±**ï¼Œç™¾ç§‘ä¸Šæœ‰å…³äºä»–çš„ä»‹ç»ï¼Œå°±ä¸å¤šè¯´äº†ã€‚è¯»å®Œè¿™æœ¬ä¹¦æ„Ÿè§‰ä½œè€…çš„æ–‡é£è¿˜æ˜¯æ¯”è¾ƒé£è¶£ï¼Œäººç‰©å¯¹è¯å’Œå†…å¿ƒæ´»åŠ¨çš„è¯­è¨€æè¿°éƒ½æ¯”è¾ƒ**å¹³æ°‘åŒ–**ï¼Œæœ‰ç§å’Œå¥½å‹èŠå¤©çš„æ„Ÿè§‰ã€‚\n\nå…¨ä¹¦ä¸­å…³äºæ›¾å›½è—©å‡ºç”Ÿå’Œå»ä¸–æ—¶çš„æè¿°æŒºæœ‰æ„æ€ã€‚\n\n*è¯´æ›¾å›½è—©å‡ºç”Ÿçš„å‰ä¸€å¤©ï¼Œå‡ åªèš°èœ’(youyan)çˆ¬ä¸Šäº†æˆ¿æ¢ï¼Œä¿¯ç°ä¸‹é¢æ˜æ˜æ¬²ç¡çš„ä»–çš„æ›¾ç¥–çˆ¶æ›¾ç«Ÿå¸Œã€‚\næ›¾ç«Ÿå¸Œä¹Ÿè€çœ¼æ˜èŠ±çš„çœ‹ç€å®ƒä»¬ï¼Œå½“ç¡®ä¿¡æ²¡æœ‰çœ‹é”™æ—¶ï¼Œä»–ç”¨å°½å…¨èº«çš„åŠ›æ°”å–Šé“ï¼šâ€œé¾™ï¼Œé¾™ï¼Œæœ‰é¾™ï¼â€*\n\n*æ›¾å›½è—©æ™šå¹´ï¼ˆ61å²ï¼‰å»ä¸–çš„æ—¶å€™ï¼Œæˆ¿é—´é‡Œä¸€ç‰‡æ­»å¯‚ï¼Œæœ‰å¿è€ä¸ä½è¿™æ­»ä¸€èˆ¬çš„æ²‰å¯‚ï¼Œä¼¼ä¹å—åˆ°äº†ç¥çµçš„å¯ç¤ºï¼Œå·å·æœ›å‘æˆ¿æ¢ã€‚å‡ åªèš°èœ’æ­£åœ¨æˆ¿æ¢ä¸Šå¿«ä¹çš„ç©è€ï¼Œçªç„¶â€œç °â€çš„ä¸€å£°ï¼Œèš°èœ’å¦‚çˆ†ç«¹ä¼¼çš„çˆ†å¼€ï¼Œåˆºé¼»çš„çƒŸæ°”è¢…è¢…ç»•æ¢ã€‚*\n\nè¿™ä¸€å‰ä¸€åçš„å‘¼åº”ï¼Œä¸çŸ¥çœŸå‡ï¼Œä½†åœ¨æ•´éƒ¨ä¹¦è¯»å®Œçš„ä¸€ç¬é—´ï¼Œè¿˜æ˜¯æ„Ÿè§‰è¿™ä½œè€…æŒºæœ‰æ„æ€ã€‚\n\n### æ›¾å›½è—©æ˜¯ä¸€ä¸ªæ€æ ·çš„äºº\n\næŒ‰ç…§ç°åœ¨çš„æ¡ä»¶ï¼Œæ›¾å›½è—©å®Œå…¨æ˜¯ä¸€å±Œä¸ï¼Œè€Œä¸”æ˜¯é‚£ç§æ™ºå•†ç‰¹åˆ«ä½çš„å±Œä¸ï¼Œç®€ç›´å°±æ˜¯ä¸€ä¸ªåå‘çˆ±å› æ–¯å¦ã€‚è¯´æ˜¯æœ‰ä¸€æ—¥ä¸€å°å·è¿›åˆ°æ›¾å›½è—©æˆ¿é‡Œæƒ³å·ä¸œè¥¿ï¼Œç»“æœä¸´è¦èµ°äº†ï¼Œæ›¾å›½è—©çªç„¶å›æ¥ï¼Œå°å·æ— å¥ˆåªå¾—è—åœ¨æ›¾å›½è—©åºŠåº•ï¼Œæ›¾å›½è—©ä¸€è¿›å±‹ä¾¿å¼€å§‹åœ¨å±‹é‡ŒèƒŒä¸€ç¯‡æ–‡ç« ï¼Œç»“æœè¿‡å»å¥½å‡ ä¸ªæ—¶è¾°ï¼Œè¿˜æ²¡èƒŒä¼šï¼›å°å·åœ¨åºŠåº•ä¸‹å·å¬éƒ½èƒŒä¼šäº†ï¼Œæœ€åå°å·å®åœ¨å—ä¸äº†äº†ï¼Œå°±ä»åºŠåº•ä¸‹çˆ¬å‡ºæ¥ï¼Œç‹ ç‹ åæ§½äº†ä¸€é¡¿æ›¾å›½è—©æœ‰å¤šä¹ˆç¬¨ä¹‹åæ‰¬é•¿è€Œå»ï¼Œæ›¾å›½è—©å¾ˆæ— å¥ˆï¼Œæ¥ç€ç»§ç»­èƒŒæ–‡ç« ï¼Œç›´åˆ°ç¬¬äºŒå¤©å‡Œæ™¨æ‰èƒŒä¼šã€‚\n\nè¯»ä¹¦è€ƒå–åŠŸåï¼Œè€ƒäº† N å¤šæ¬¡æ‰è€ƒä¸Šï¼Œè€Œä¸”ä¹Ÿè€ƒå¾—ä¸æ˜¯å¾ˆå¥½ã€‚\n\nåæ¥åœ¨äº¬åŸåšå®˜ï¼Œè™½ç„¶åšåˆ°äº†å¾ˆé«˜çš„å“çº§ï¼Œç®—æ˜¯ç»™æ›¾å®¶å…‰å®—è€€ç¥–äº†ï¼Œä½†æœ€ç»ˆè¿˜æ˜¯ç¦»å¼€äº†åŒ—äº¬ã€‚\n\nåæ¥ï¼Œåœ¨æ¹–å—ä»»èŒæœŸé—´åˆ›å»ºäº†å¤§åé¼é¼çš„æ¹˜å†›ï¼Œå¹¶ä¸€ä¸¾æ¶ˆç­äº†å¤ªå¹³å¤©å›½çš„å›ä¹±ã€‚\n\næ›¾å›½è—©ç§‰æ‰¿çš„è‡ªå·±çš„åšäººçš„åŸåˆ™ï¼Œæ·±çŸ¥è‡ªèº«çš„ç¼ºç‚¹ä¸æ¯›ç—…ï¼Œåšå®ˆç€è‡ªå·±å†…å¿ƒçš„â€å¿ â€œä¸â€è¯šâ€œï¼Œç«­å°½å…¨åŠ›çš„ä¸ºå›½æ•ˆåŠ›ã€‚æ„Ÿè§‰æœ‰ç‚¹ç”Ÿä¸é€¢æ—¶ï¼Œé‡åˆ°äº†æ¸…æœ«æ´‹äººå…¥ä¾µï¼Œæ…ˆç¦§å¤ºæƒç­‰ä¸€ç³»åˆ—æ‚²å‰§çš„äº‹æƒ…ã€‚å…¨ç¯‡é€šè¯»ä¸‹æ¥ï¼Œæ„Ÿè§‰æ›¾å›½è—©çš„ä¸€ç”Ÿéå¸¸çš„ä¸å®¹æ˜“ã€‚**â€æ‰“è„±ç‰™å’Œè¡€åâ€œ**çš„å°±åƒæ˜¯ç¬¼ç½©åœ¨ä»–å¤´é¡¶çš„é˜´å½±ï¼Œåœ¨ä»–äººç”Ÿçš„å¼¯å¼¯è§’è§’é‡Œä¸æ–­çš„é”¤ç‚¼ç€ä»–ã€‚\n\n### æ„Ÿæƒ³\n\nå¦‚ä»Šï¼Œåœ¨æˆ‘ä»¬èº«è¾¹è¿˜æ˜¯æœ‰æƒ³æ›¾å›½è—©è¿™èˆ¬çš„äººï¼Œå¤©èµ‹ä¸€èˆ¬ï¼Œä½†å°±æ˜¯éå¸¸åŠªåŠ›çš„äººã€‚ä½†ä¸å¾—ä¸è¯´å¾ˆå¤šæ—¶å€™æœºé‡å¾ˆé‡è¦ï¼Œé‡è§å¯¹çš„äººï¼Œåœ¨é‚£ä¸ªæ­£ç¡®çš„æ—¶é—´åšäº†æ­£ç¡®çš„äº‹ï¼ŒçœŸçš„éå¸¸é‡è¦ã€‚æœ‰å¥è¯è¯´ï¼Œæœºä¼šæ˜¯ç•™ç»™æœ‰å‡†å¤‡çš„äººï¼Œæ‰€ä»¥å¦‚æœæ™®é€šäººæƒ³è¦æ‰“ç ´é˜¶çº§åˆ°è¾¾å¦ä¸€ä¸ªé˜¶å±‚ï¼Œä¸€å®šè¦ç»ƒå¥½è‡ªå·±çš„å†…åŠŸï¼Œæ—¶åˆ»å‡†å¤‡å¥½ä¸æœŸè€Œé‡çš„æœºä¼šï¼Œæœ‰äº›æœºä¼šè½¬ç¬å³é€ï¼Œè«è¦ç•™ä¸‹ç»ˆç”Ÿé—æ†¾ã€‚\n\n","tags":["è¯»ä¹¦"]},{"title":"2019-Book&Movie List","url":"%2F2019%2F01%2F06%2F2019-Book%26Movie%20List%2F","content":"\n\n## Book\n\n - book read once \n    - [x] **äººç±»ç®€å² â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸**\n    - [x] æ›¾å›½è—© åˆç¬¨åˆæ…¢å¹³å¤©ä¸‹ â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n    - [ ] åŸºç£å±±ä¼¯çˆµï¼ˆreadingï¼‰\n    - [x] **ç¾å›½ç®€å²** â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n    - [x] å£«å…µçªå‡»\n    - [ ] é•¿è„–å­å¥³äºº\n    - [ ] ç™½é¹¿åŸ(listening)\n\n\n- book on bed\n\n    - [ ] **åŸåˆ™(pending)**\n    - [ ] **è½¯æŠ€èƒ½(reading)**\n    - [ ] å¹¶å‘ç¼–ç¨‹ä¹‹ç¾ ï¼ˆreading)\n    - [ ] Kotlin å®æˆ˜ ï¼ˆreadingï¼‰\n    - [ ] Android è®¾è®¡æ¨¡å¼\n    - [ ] **ç®—æ³•ï¼ˆç¬¬ 4 ç‰ˆï¼‰**\n    - [ ] Think in Java\n\n## Movie\n\n- [x] **æ— åä¹‹è¾ˆ â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸**\n- [x] ç‹—åä¸‰ â¤ï¸â¤ï¸â¤ï¸\n- [x] **æµæµªåœ°çƒ â¤ï¸â¤ï¸â¤ï¸â¤ï¸**\n- [x] æ¥ç”µç‹‚å“\n- [x] ç»¿çš®ä¹¦ â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n- [x] ç™½è›‡ç¼˜èµ· â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n- [x] æ é£ŸåŸå¸‚ â¤ï¸\n- [x] æ–°å–œå‰§ä¹‹ç‹ â¤ï¸â¤ï¸\n- [x] ç–¯ç‹‚å¤–æ˜Ÿäºº â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n- [x] **é£é©°äººç”Ÿ** â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n- [x] **å¤ä»‡è€…è”ç›Ÿ 4** â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n- [x] **Xæˆ˜è­¦ ç«å‡¤å‡°** â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n- [x] **è¾›å¾·å‹’çš„åå•** â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n- [ ] **æ‹¯æ•‘å¤§å…µç‘æ©**\n- [x] è°ƒéŸ³å¸ˆ â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n- [x] ä¸‰å‚»å¤§é—¹å®è±å â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n- [x] èœ˜è››ä¾ ï¼šè‹±é›„è¿œå¾ â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n- [ ] æ±Ÿæ¹–å„¿å¥³\n- [ ] æµ·å¸‚èœƒæ¥¼\n- [ ] è¿‡æ˜¥å¤©\n- [ ] æ¥šé—¨çš„ä¸–ç•Œ\n- [ ] å—å—è€å¸ˆ\n- [x] æƒŠå¥‡é˜Ÿé•¿ â¤ï¸â¤ï¸â¤ï¸\n- [x] ç»æ€æ…•å°¼é»‘ â¤ï¸â¤ï¸â¤ï¸\n- [ ] å¤§ä¾¦æ¢çš®å¡ä¸˜\n- [x] å† å†› â¤\n- [x] é»‘å®¢å¸å›½ (ä¸€) â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n- [x] é»‘å®¢å¸å›½ (äºŒ) â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n- [x] é»‘å®¢å¸å›½ (ä¸‰) â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n- [x] æ— é—´é“ (ä¸€)  â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n- [x] æ— é—´é“ (äºŒ)  â¤ï¸â¤ï¸â¤ï¸â¤\n- [x] æ— é—´é“ (ä¸‰)  â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤\n- [x] ä¸€ä¸ªæ¯äº²çš„å¤ä»‡ â¤ï¸â¤ï¸â¤ï¸\n- [x] æ¥šé—¨çš„ä¸–ç•Œ â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤\n- [x] è‚–ç”³å…‹å¾—æ•‘èµ â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n- [x] æˆ˜æ–—å¤©ä½¿é˜¿ä¸½å¡” â¤ï¸â¤ï¸\n- [x] å¯„ç”Ÿè™« â¤ï¸â¤ï¸â¤ï¸â¤ï¸\n\n> time â‰ˆ 2.2h * 31 = 68.2h \n\n\n## Tv\n\n- [x] é“é½¿é“œç‰™çºªæ™“å²š ç¬¬ä¸‰éƒ¨ ï¼ˆ43 * 45 min = 1935 â‰ˆ 32.2h)\n- [x] é“é½¿é“œç‰™çºªæ™“å²š ç¬¬å››éƒ¨ ï¼ˆ43 * 45 min = 1935 â‰ˆ 32.2h)\n- [x] æ¯å‘¨è‹±è¶…ç²¾å ï¼ˆ 30 * 50 = 1500 = 25h)\n- [ ] ç‹ç‰Œå¯¹ç‹ç‰Œ ï¼ˆ10 * 1.6h = 16h)\n- [x] å£«å…µçªå‡» (10 * 45 = 450 = 9h)\n- [x] **ç‹æœ** â¤ï¸â¤ï¸â¤ï¸â¤ï¸ 5h\n- [ ] **è¶Šå—æˆ˜äº‰**\n- [ ] **ç¬¬ä¸‰å¸å›½æœ€åçš„ç§˜å¯†**\n- [x] **è§¦åŠçœŸå¿ƒ** ï¼ˆ16 * 70 = 1120 â‰ˆ 18.6h)\n- [x] æˆ‘ä»¬ä¸æ¶çš„è·ç¦»  10h \n- [ ] é•¿å®‰åäºŒæ—¶è¾° (watching)\n- [ ] æ¯å‘¨å¤©ä¸‹è¶³çƒ (52 * 2h = 104h)\n- [ ] çœŸæ¢\n- [ ] å¤©ç©ºä¹‹åŸ\n- [x] ç”Ÿæ´»å¤§çˆ†ç‚¸æœ€ç»ˆå­£ (24 * 22 = 528 â‰ˆ 8.8h)\n- [x] å°è°¢å°”é¡¿ç¬¬äºŒå­£ (22 * 22 = 484 â‰ˆ 8h)\n- [x] æ‘©ç™»å®¶åº­ (22 * 22 = 484 â‰ˆ 8h)\n- [ ] ç¥ç›¾å±€ç‰¹å·¥ç¬¬å…­å­£ (watching) \n- [x] **æ— è€»ä¹‹å¾’ç¬¬ä¹å­£** (14 * 55 = 770 â‰ˆ 12.8h) \n- [x] è¶…æ„Ÿè­¦æ¢ç¬¬ä¸€å­£ ï¼ˆ22 * 43 = 946 â‰ˆ 15.7h)\n- [x] è¶…æ„Ÿè­¦æ¢ç¬¬äºŒå­£  (22 * 43 = 946 â‰ˆ 15.7h)\n- [x] è¶…æ„Ÿè­¦æ¢ç¬¬ä¸‰å­£ \n\n> time â‰ˆ 215h + 104h \n> \n\n**ï¼ˆæˆªæ­¢ 2019 å¹´ 7 æœˆ 28 æ—¥ï¼‰**\n\n\n## æ—¶é—´éƒ½å»å“ªå„¿äº†\n\n- æ¯å¤© = 24h \n\n- æ¯å‘¨ = 7 * 24h = 168h \n\n- æ¯å¹´ = 52 * 168h = 8736h \n\n- æ¯æœˆ â‰ˆ 8736 / 12 = 728 h \n\nsleep_every_day = 8h\nyear_sleep = 8h * 7 * 52 = 2912h \n\nwork_every_day = 10h\nyear_work = 10h * 5 * 52 = 2600h \n\n\nevery_year_real_free_time = 8736 - 2912 - 2600 = 3224h\n\n\n\n\n\n\n","tags":["è¯—ä¸è¿œæ–¹"]},{"title":"Some One Like You","url":"%2F2019%2F01%2F01%2FSome-One-Like-You%2F","content":"\nè®°å½•ä¸€ä¸‹æ¯ä¸€ä¸ªæœˆå¹²äº†äº›å•¥å§ã€‚\n\n\n## ä¸ƒæœˆ \n\n\n|study|entertainment |else| \n|-----|--------------|----|\n|ç®€å•å®ç° GIF å›¾çš„å€’åºæ’­æ”¾|æ— é—´é“ç”µå½±ä¸‰éƒ¨|kotlin å®æˆ˜é˜…è¯»|\n|ARouter API ç®€å•åˆ†æ|é•¿å®‰åäºŒæ—¶è¾°1~26é›†|è½¯æŠ€èƒ½é˜…è¯»|\n|ASM ä»£ç æ’æ¡©ç®€å•å°è¯•|ä¸€ä¸ªå¤ä»‡çš„æ¯äº²ç”µå½±|åŸºç£å±±ä¼¯çˆµ 1~21 ç« \n|react å…¥é—¨||åŸåˆ™é˜…è¯» 36%|\n|JavaScript å…¥é—¨||ã€Šç™½é¹¿åŸã€‹å¬ä¹¦1~38ç« |\n\n\n## å…«æœˆ todo \n\n\n- study\n    - [ ] **TimeFly** \n    - [ ] asm æ’æ¡© blog \n    - [ ] arouter æ’æ¡©åˆ†æ blog\n    - [ ] fragment + viewpager åˆ†æ blog\n    - [ ] react + JavaScript ç†Ÿç»ƒ\n- entertainment\n    - [ ] çœ‹æµ·\n    - [ ] éª‘è½¦å»äºŒç¯\n    - [ ] é•¿å®‰åäºŒæ—¶è¾°å®Œç»“\n- else\n    - [ ] effective java é˜…è¯»\n    - [ ] ã€Šç™½é¹¿åŸã€‹å¬ä¹¦ 39~60 ç« \n    - [ ] åŸºç£å±±ä¼¯çˆµè¯»å®Œï¼Œå¹¶å†™è¯»åæ„Ÿ\n    - [ ] **æˆ‘ä»¬ä¸æ¶çš„è·ç¦» blog**\n    - [ ]  kotlin å®æˆ˜ blog \n\n\n\n> ç»¼ä¸Šï¼š éœ€è¦å†™ 6 ç¯‡ blog ,æœ¬æœˆä»¥è¯»ä¹¦ä¸ºä¸»ï¼Œå¤šçœ‹ä¸€ç‚¹ä¹¦ï¼Œå¥½ä¹…æ²¡çœ‹ä¹¦äº†ã€‚\n\n\n\n\n\n\n\n"},{"title":"RxJava2 æ˜¯å¦‚ä½•å®ç°çº¿ç¨‹åˆ‡æ¢çš„ï¼ˆä¸‹ï¼‰","url":"%2F2018%2F05%2F08%2FRxJava2%20%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2%E7%9A%84%EF%BC%88%E4%B8%8B%EF%BC%89%2F","content":"\n\n## å‰è¨€\n\né€šè¿‡å‰ä¸€ç¯‡çš„[RxJava2 æ˜¯å¦‚ä½•å®ç°çº¿ç¨‹åˆ‡æ¢çš„ (ä¸Š)](https://juejin.im/post/5a6751af6fb9a01cb2571794)æˆ‘ä»¬å·²ç»çŸ¥é“äº†åœ¨RxJavaä¸­ï¼ŒsubscribeOn å°†ä¸Šæ¸¸çº¿ç¨‹åˆ‡æ¢åˆ°**æŒ‡å®šçš„å­çº¿ç¨‹**æ˜¯å¦‚ä½•å®ç°çš„ã€‚è¿™é‡Œå°±æ¥ç€æ¥çœ‹ï¼ŒobserveOn æ˜¯å¦‚ä½•å°†ä¸‹æ¸¸çº¿ç¨‹åˆ‡æ¢åˆ°æŒ‡å®šçº¿ç¨‹çš„ã€‚\n\n<!--more-->\n\n## RxJava - subscribeOn\n\nè¿™é‡Œå¯ä»¥é€šè¿‡UMLå›¾ç®€å•å›é¡¾ä¸€ä¸‹subscribeOnçš„åŸç†ã€‚\n\n\n![](https://user-gold-cdn.xitu.io/2018/1/23/16123a868c390ac1?w=1127&h=525&f=png&s=51911)\n\né€šè¿‡ subscribeOn æˆ‘ä»¬å®Œæˆäº†ä»¥ä¸‹æ“ä½œï¼š\n\n - åˆ›å»ºäº†ä¸€ä¸ª ObservableSubscribeOn å¯¹è±¡ï¼Œæœ¬è´¨ä¸Šæ¥è¯´ä»–å°±æ˜¯ä¸€ä¸ªObservableï¼Œä»–åŒæ—¶å®ç°äº† AbstractObservableWithUpstreamï¼ˆHasUpstreamObservableSource ï¼‰è¿™æ ·ä¸€ä¸ªæ¥å£ï¼Œæ˜¯ä»–å˜äº†ä¸€ä¸ª**æ‹¥æœ‰ä¸Šæ¸¸**çš„Observeableã€‚\n - åœ¨ ObservableSubscribeOn çš„ subscribeActual æ–¹æ³•ä¸­\n\n```java\nparent.setDisposable(scheduler.scheduleDirect(new SubscribeTask(parent)));\n```\nå°†çœŸæ­£çš„ subscribe æ“ä½œå®‰ç½®åœ¨äº†SubscribeTaskè¿™æ ·ä¸ªä¸€ä¸ªRunnableå½“ä¸­ï¼Œè¿™ä¸ª Runnable å°†ç”±scheduler è¿™ä¸ªè°ƒåº¦å™¨è´Ÿè´£å¯åŠ¨ï¼Œå› æ­¤å°±æŠŠä¸Šæ¸¸æ“ä½œæ”¾åˆ°äº† scheduler æ‰€åœ¨çš„çº¿ç¨‹ä¸­ã€‚\n\n- Schedulers.newThread()æˆ–è€…Schedulers.io() éƒ½æ˜¯é€šè¿‡å·¥å‚æ–¹æ³•çš„æ¨¡å¼åˆ›å»ºäº†æŸç§**æŒ‡å®šç±»å‹**çš„çº¿ç¨‹ï¼Œ å½“è¿™ä¸ªç‰¹å®šçš„çº¿ç¨‹æ‰§è¡Œæ˜¯ï¼Œå°±æ˜¯æ‰§è¡ŒçœŸå®çš„ subscribe æ–¹æ³•ï¼Œè¿™æ ·å°±æŠŠä¸Šæ¸¸æ“ä½œæ”¾åˆ°äº†ä¸€ä¸ªç‰¹å®šçš„çº¿ç¨‹ä¸­å»æ‰§è¡Œã€‚\n\n## RxJava - observeOn\n\nç®€å•å›é¡¾å®Œ subscribeOn ä¹‹åï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹ observeOn æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚\n\n**å…¶å®ï¼Œäº†è§£ subscribeOn çš„åŸç†ä¹‹åï¼Œå†æ¥çœ‹ observeOn å°±ç®€å•å¤šäº†ï¼Œç±»çš„å‘½ååŠå®ç°æ€è·¯éƒ½æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œå¯ä»¥å¯¹ç…§ç€ç†è§£**ã€‚\n\n![ObserveOn](https://user-gold-cdn.xitu.io/2018/6/4/163cb392e2328470?w=1280&h=616&f=png&s=215509)\n\nRxJavaçš„ä»£ç å†™çš„éå¸¸å·§å¦™ï¼Œå¯ä»¥è¯´æ˜¯ç™¾è¯»ä¸åŒï¼Œå¯ä»¥å­¦ä¹ çš„åœ°æ–¹ç‰¹åˆ«å¤šã€‚ä¸ºäº†é¿å…é™·å…¥åªè§æ ‘æœ¨ä¸è§æ£®æ—çš„å™©æ¢¦ï¼Œæˆ‘ä»¬å°±å¸¦ç€ä»¥ä¸‹é—®é¢˜å»æ¢ç´¢ observeOn çš„å¥¥ç§˜ã€‚\n\n1. åœ¨ Android ä¸­çº¿ç¨‹é—´ä¼ é€’æ¶ˆæ¯ä¼šä½¿ç”¨ Handlerï¼Œè¿™é‡Œæ˜¯å¦ä½¿ç”¨ï¼Ÿåˆæ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Ÿ\n2. AndroidSchedulers.mainThread() åšäº†ä»€ä¹ˆ ï¼Ÿ \n3. ä¸‹æ¸¸ä»»åŠ¡æ˜¯å¦‚ä½•ä¿è¯è¢«åˆ†é…åˆ°æŒ‡å®šçº¿ç¨‹çš„ã€‚\n\n#### ç¤ºä¾‹ \n\n```java\n\n    private void multiThread() {\n        Observable.create(new ObservableOnSubscribe<String>() {\n            @Override\n            public void subscribe(ObservableEmitter<String> e) throws Exception {\n                e.onNext(\"This msg from work thread :\" + Thread.currentThread().getName());\n                sb.append(\"\\nsubscribe: currentThreadName==\" + Thread.currentThread().getName());\n            }\n        })\n                .subscribeOn(Schedulers.newThread())\n                .observeOn(AndroidSchedulers.mainThread())\n                .subscribe(new Consumer<String>() {\n                    @Override\n                    public void accept(String s) throws Exception {\n                        Log.e(TAG, \"accept: s= \" + s);\n                    }\n                });\n    }\n\n```\n\næˆ‘ä»¬è¿˜æ˜¯ä»¥è¿™æ®µä»£ç ä¸ºä¾‹ï¼Œæ¥çœ‹çœ‹ observeOn çš„å·¥ä½œåŸç†ã€‚è¿™é‡Œé€šè¿‡observeOn(AndroidSchedulers.mainThread())å°†ä¸‹æ¸¸çº¿ç¨‹åˆ‡æ¢åˆ°äº†æˆ‘ä»¬éå¸¸ç†Ÿæ‚‰çš„ Android UI çº¿ç¨‹ã€‚è¿™æ ·å°±å¯ä»¥ç¡®ä¿æˆ‘ä»¬åœ¨ä¸‹æ¸¸æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åœ¨ UI çº¿ç¨‹ä¸­å®Œæˆã€‚è¿™é‡Œå’Œè®¨è®º subscribeOn ä¸€æ ·ï¼Œæˆ‘ä»¬å°±ä»è¿™å¥ä»£ç å‡ºå‘ï¼Œçœ‹çœ‹è¿™èƒŒååˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚\n\næœ‰äº†ä¸Šä¸€ç¯‡çš„ç»éªŒï¼Œæˆ‘ä»¬çŸ¥é“ AndroidSchedulers.mainThread() ä¸€å®šå»åˆ›å»ºäº†æŸç§ç±»å‹çš„è°ƒåº¦å™¨ï¼Œä¸ºäº†æ–¹ä¾¿åé¢çš„å™è¿°ï¼Œè¿™ä¸€æ¬¡æˆ‘ä»¬å…ˆä»è°ƒåº¦å™¨çš„åˆ›å»ºè¯´èµ·ï¼Œåé¢å†çœ‹ observeOn() çš„å…·ä½“å®ç°ã€‚\n\n\n**éœ€è¦æ³¨æ„çš„æ˜¯ AndroidSchedulers å¹¶ä¸æ˜¯ RxJava çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯ä¸ºäº†åœ¨ Android ä¸­æ–¹ä¾¿çš„ä½¿ç”¨ RxJava è€Œä¸“é—¨è®¾è®¡çš„ä¸€ä¸ªè°ƒåº¦å™¨å®ç°ï¼Œæºç [RxAndroid](https://github.com/ReactiveX/RxAndroid) è®¾è®¡éå¸¸å·§å¦™ï¼›ä½¿ç”¨å‰è®°å¾—åœ¨gradleæ–‡ä»¶ä¸­é…ç½®ä¾èµ–ã€‚**\n\n\n### AndroidSchedulers.mainThread()\n\nä¸‹é¢å°±æ¥çœ‹çœ‹ AndroidSchedulers.mainThread() è¿™ä¸ªæˆ‘ä»¬éå¸¸ç†Ÿæ‚‰çš„ Scheduler æ˜¯å¦‚ä½•åˆ›å»ºçš„ã€‚\n\n```java\npublic final class AndroidSchedulers {\n\n    private static final class MainHolder {\n\n        static final Scheduler DEFAULT = new HandlerScheduler(new Handler(Looper.getMainLooper()));\n    }\n\n    private static final Scheduler MAIN_THREAD = RxAndroidPlugins.initMainThreadScheduler(\n            new Callable<Scheduler>() {\n                @Override public Scheduler call() throws Exception {\n                    return MainHolder.DEFAULT;\n                }\n            });\n\n    public static Scheduler mainThread() {\n        return RxAndroidPlugins.onMainThreadScheduler(MAIN_THREAD);\n    }\n}\n```\n\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼Œå½“è°ƒç”¨AndroidSchedulers.mainThread() æ—¶ï¼Œè¿”å›äº†ä¸€ä¸ªHandlerScheduler çš„å®ä¾‹ï¼Œè€Œè¿™ä¸ªå®ä¾‹ä½¿ç”¨åˆ°äº†æˆ‘ä»¬éå¸¸ç†Ÿæ‚‰çš„ Handlerã€‚é‚£ä¹ˆé‡ç‚¹å°±æ¥åˆ°HandlerScheduler äº†ã€‚\n\n\n```java\nfinal class HandlerScheduler extends Scheduler {\n    private final Handler handler;\n\n    HandlerScheduler(Handler handler) {\n        this.handler = handler;\n    }\n\n    @Override\n    public Disposable scheduleDirect(Runnable run, long delay, TimeUnit unit) {\n        if (run == null) throw new NullPointerException(\"run == null\");\n        if (unit == null) throw new NullPointerException(\"unit == null\");\n\n        run = RxJavaPlugins.onSchedule(run);\n        ScheduledRunnable scheduled = new ScheduledRunnable(handler, run);\n        handler.postDelayed(scheduled, Math.max(0L, unit.toMillis(delay)));\n        return scheduled;\n    }\n\n    @Override\n    public Worker createWorker() {\n        return new HandlerWorker(handler);\n    }\n\n    private static final class HandlerWorker extends Worker {\n        private final Handler handler;\n\n        private volatile boolean disposed;\n\n        HandlerWorker(Handler handler) {\n            this.handler = handler;\n        }\n\n        @Override\n        public Disposable schedule(Runnable run, long delay, TimeUnit unit) {\n            if (run == null) throw new NullPointerException(\"run == null\");\n            if (unit == null) throw new NullPointerException(\"unit == null\");\n\n            if (disposed) {\n                return Disposables.disposed();\n            }\n\n            run = RxJavaPlugins.onSchedule(run);\n\n            ScheduledRunnable scheduled = new ScheduledRunnable(handler, run);\n\n            Message message = Message.obtain(handler, scheduled);\n            message.obj = this; // Used as token for batch disposal of this worker's runnables.\n\n            handler.sendMessageDelayed(message, Math.max(0L, unit.toMillis(delay)));\n\n            // Re-check disposed state for removing in case we were racing a call to dispose().\n            if (disposed) {\n                handler.removeCallbacks(scheduled);\n                return Disposables.disposed();\n            }\n\n            return scheduled;\n        }\n\n        @Override\n        public void dispose() {\n            disposed = true;\n            handler.removeCallbacksAndMessages(this /* token */);\n        }\n\n        @Override\n        public boolean isDisposed() {\n            return disposed;\n        }\n    }\n\n    private static final class ScheduledRunnable implements Runnable, Disposable {\n        private final Handler handler;\n        private final Runnable delegate;\n\n        private volatile boolean disposed;\n\n        ScheduledRunnable(Handler handler, Runnable delegate) {\n            this.handler = handler;\n            this.delegate = delegate;\n        }\n\n        @Override\n        public void run() {\n            try {\n                delegate.run();\n            } catch (Throwable t) {\n                IllegalStateException ie =\n                    new IllegalStateException(\"Fatal Exception thrown on Scheduler.\", t);\n                RxJavaPlugins.onError(ie);\n                Thread thread = Thread.currentThread();\n                thread.getUncaughtExceptionHandler().uncaughtException(thread, ie);\n            }\n        }\n\n        @Override\n        public void dispose() {\n            disposed = true;\n            handler.removeCallbacks(this);\n        }\n\n        @Override\n        public boolean isDisposed() {\n            return disposed;\n        }\n    }\n}\n```\nè¿™ä¸ªç±»è™½ç„¶å¾ˆç®€å•ï¼Œä½†æ˜¯è®¾è®¡éå¸¸å·§å¦™ã€‚\n\n- **é¦–å…ˆ HandlerScheduler æ˜¯ä¸€ä¸ª Scheduler ï¼Œé€šè¿‡æ„é€ å‡½æ•°ä»–è·å–åˆ°äº†ä¸»çº¿ç¨‹æ‰€åœ¨çš„ Handlerå®ä¾‹ã€‚è€Œåœ¨ä»–çš„ createWorker() æ–¹æ³•ä¸­ï¼Œä»–åˆé€šè¿‡è¿™ä¸ª Handler å®ä¾‹åˆ›å»ºäº†ä¸€ä¸ªHandlerWorker çš„å®ä¾‹ï¼Œè¿™ä¸ªHandlerWorker æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª Workerã€‚åœ¨ä»–çš„ schedule æ–¹æ³•ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ª ScheduleRunnable å¯¹è±¡ï¼Œå¹¶ä¼šæŠŠè¿™ä¸ªRunnableå¯¹è±¡é€šè¿‡ handler çš„ sendMessageDelayed æ–¹æ³•å‘é€å‡ºå»ï¼Œè€Œæˆ‘ä»¬çŸ¥é“è¿™ä¸ª Handler æ˜¯ä¸»çº¿ç¨‹ï¼Œè¿™æ ·åœ¨ä¸‹æ¸¸ä¸­ï¼Œå°±æŠŠä»»åŠ¡ä»æŸä¸ªå­çº¿ç¨‹è½¬ç§»åˆ°äº†UIçº¿ç¨‹ã€‚**\n\n\n- ScheduleRunnable ä¸ä½†å®ç°äº† Runnable ï¼Œè€Œä¸”å®ç°äº†æˆ‘ä»¬çœ‹åˆ°è¿‡æ— æ•°æ¬¡çš„ Disposable ã€‚\n\n```java\n        @Override\n        public void run() {\n            try {\n                delegate.run();\n            } catch (Throwable t) {\n\n            }\n        }\n\n        @Override\n        public void dispose() {\n            disposed = true;\n            handler.removeCallbacks(this);\n        }\n```\nè¿™æ ·ï¼Œæ­£ç¡®æƒ…å†µä¸‹ run æ–¹æ³•ä¼šæ­£å¸¸æ‰§è¡Œçº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œè€Œä¸€æ—¦ disposable  å¯¹è±¡æ‰§è¡Œäº†dispose()æ–¹æ³•ï¼Œé‚£ä¹ˆ handler.removeCallbacks(this),å°±å¯ç¡®ä¿åœ¨ handler çš„ dispatchMessage æ–¹æ³•ä¸­ï¼Œä¸ä¼šåœ¨æ‰§è¡Œä»»ä½•æ“ä½œï¼Œä»è€Œè¾¾åˆ°äº† dispose çš„æ•ˆæœã€‚\n\n\n\n### observeOn\n \nä¸‹é¢å°±æ¥çœ‹çœ‹ Observable ä¸­çš„ observeOn æ–¹æ³•\n\n**Observable.java --- observeOn**\n\n```java\n\n    public final Observable<T> observeOn(Scheduler scheduler) {\n        return observeOn(scheduler, false, bufferSize());\n    }\n\n    public final Observable<T> observeOn(Scheduler scheduler, boolean delayError, int bufferSize) {\n        ObjectHelper.requireNonNull(scheduler, \"scheduler is null\");\n        ObjectHelper.verifyPositive(bufferSize, \"bufferSize\");\n        return RxJavaPlugins.onAssembly(new ObservableObserveOn<T>(this, scheduler, delayError, bufferSize));\n    }\n```\n\nè¿™ä¸ªæ–¹æ³•çš„å®ç°å’Œ subscribeOn çš„å®ç°éå¸¸ç›¸ä¼¼ï¼Œå¤šäº†ä¸¤ä¸ªå‚æ•° delayError å’Œ buffersize ã€‚ buffersize å¯ä»¥è®¤ä¸ºæ˜¯RxJavaå†…éƒ¨çš„ä¸€ä¸ªé™æ€å˜é‡ï¼Œé»˜è®¤æƒ…å†µä¸‹ä»–çš„å€¼æ˜¯128ã€‚é€šè¿‡æˆ‘ä»¬ä¹‹å‰çš„ç»éªŒï¼Œè¿™é‡Œå¯ä»¥æŠŠ observeOn çš„è¿‡ç¨‹ç®€åŒ–å¦‚ä¸‹ï¼š\n\n```java\nnew ObservableObserveOn<T>(this, scheduler, delayError, bufferSize)\n```\nä¹Ÿå°±æ˜¯è¯´ observeOn è¿™ä¸ªæ“ä½œç¬¦ç»™æˆ‘ä»¬è¿”å›äº†ä¸€ä¸ª ObservableObserveOn å¯¹è±¡ã€‚å¾ˆå®¹æ˜“æƒ³åˆ°ä»–ä¹Ÿæ˜¯ä¸€ä¸ª Observeableã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å»çœ‹çœ‹è¿™ä¸ª ObservableObserveOn åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬æœ€å…³å¿ƒçš„ subscribeActual æ–¹æ³•ä»–åˆæ˜¯æ€æ ·å®ç°çš„ã€‚\n\n\n\n#### ObservableObserveOn\n\n```java\npublic final class ObservableObserveOn<T> extends AbstractObservableWithUpstream<T, T> {\n    final Scheduler scheduler;\n    final boolean delayError;\n    final int bufferSize;\n    public ObservableObserveOn(ObservableSource<T> source, Scheduler scheduler, boolean delayError, int bufferSize) {\n        super(source);\n        this.scheduler = scheduler;\n        this.delayError = delayError;\n        this.bufferSize = bufferSize;\n    }\n\n    @Override\n    protected void subscribeActual(Observer<? super T> observer) {\n        if (scheduler instanceof TrampolineScheduler) {\n            source.subscribe(observer);\n        } else {\n            Scheduler.Worker w = scheduler.createWorker();\n\n            source.subscribe(new ObserveOnObserver<T>(observer, w, delayError, bufferSize));\n        }\n    }\n}\n\n```\n\nå’Œ ObservableSubscribeOn ä¸€æ ·ï¼Œä»–ä¹Ÿç»§æ‰¿äº† AbstractObservableWithUpstream ï¼Œè¿™æ ·ä»–ä¹Ÿæ˜¯ä¸€ä¸ªæ‹¥æœ‰ä¸Šæ¸¸çš„ Observeableï¼Œä»–çš„æ„é€ å‡½æ•°å¾ˆç®€å•ï¼Œæ²¡ä»€ä¹ˆå¯ä»¥è¯´ã€‚è¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ä¸€ä¸‹ subscribeActual æ–¹æ³•çš„å®ç°ã€‚è¿™é‡Œæˆ‘ä»¬çš„ä½¿ç”¨çš„**Scheduler å®ä¾‹æ˜¯ AndroidSchedulers.mainThread()**ï¼Œå› æ­¤å°±æŒ‰ elseçš„é€»è¾‘åˆ†æã€‚\n\n```java\n\n            Scheduler.Worker w = scheduler.createWorker();\n\n            source.subscribe(new ObserveOnObserver<T>(observer, w, delayError, bufferSize));\n```\n\né€šè¿‡ scheduler.createWorker() åˆ›å»ºäº† Worker è¿™ä¸ªå¯¹è±¡ã€‚è¿™é‡Œç»“åˆä¹‹å‰å¯¹ AndroidSchedulers.mainThread() çš„åˆ†æï¼Œæ­¤å¤„çš„ worker å¯¹è±¡æ˜¯å°±æ˜¯ä¸€ä¸ªæŒæœ‰ä¸»çº¿ç¨‹ handler å¼•ç”¨çš„ Workerã€‚\n\n\næ¥ç€ç”¨è¿™ä¸ªworkeråˆåˆ›å»ºäº†ä¸€ä¸ªObserveOnObserverå¯¹è±¡ã€‚çœ‹çœ‹è¿™ä¸ªç±»çš„å®ç°ã€‚\n\n\n```java\n    static final class ObserveOnObserver<T> extends BasicIntQueueDisposable<T>\n    implements Observer<T>, Runnable { ....}\n```\n\nè¿™ä¸ªç±»åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ª Observer ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªRunnableï¼Œå¹¶ä¸”è¿˜ç»§æ‰¿äº† BasicIntQueueDisposable(ä¿è¯åŸå­æ€§ã€æ‹¥æœ‰æ“ä½œé˜Ÿåˆ—åŠŸèƒ½å’Œ DisposableåŠŸèƒ½)ã€‚\n\n```java\nsource.subscribe(new ObserveOnObserver<T>(observer, w, delayError, bufferSize));\n```\n\næˆ‘ä»¬å…³æ³¨ä¸€ä¸‹è¿™è¡Œä»£ç ï¼Œæ ¹æ®ä¹‹å‰çš„è¯´æ³•è¿™é‡Œçš„ source æ˜¯å…¶çˆ¶ç±»(AbstractObservableWithUpstream)ä¸­çš„æˆå‘˜å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯ä¸Šæ¸¸ï¼Œé‚£ä¹ˆå½“å‰ObservableObserveOn çš„ä¸Šæ¸¸æ˜¯è°å‘¢ï¼Ÿ å°±æ˜¯æˆ‘ä»¬ä¸Šä¸€ç¯‡æ‰€è¯´çš„ ObservableSubscribeOn ã€‚\n\nå› æ­¤ï¼Œå½“è¿™é‡Œå¼€å§‹æ‰§è¡Œè®¢é˜…æ–¹æ³• subscribe() åï¼Œå°†ä»¥å¦‚ä¸‹é¡ºåºå“åº”ï¼š\n\n\n>**Observable.subscribe--->Observable.subscribeActual---> ObservableObserveOn.subscribeActual---> ObservableSubscribeOn.subscribeActual--->ObservableCreate.subscribeActual**\n\nè¿™äº›æ–¹æ³•çš„å‚æ•°å‡ä¸º observer,é€šè¿‡å±‚å±‚å›è°ƒï¼Œæœ€åçš„ subscribeActual(Observer<? super T> observer) æ‰§è¡Œæ—¶ï¼Œè¿™ä¸ª observer æŒæœ‰ä¹‹å‰å‡ ä¸ª observer çš„å¼•ç”¨ã€‚\n\næˆ‘ä»¬å†çœ‹ä¸€ä¸‹ **ObservableCreate.subscribeActual**\n\n```java\n    @Override\n    protected void subscribeActual(Observer<? super T> observer) {\n        CreateEmitter<T> parent = new CreateEmitter<T>(observer);\n        observer.onSubscribe(parent);\n\n        try {\n            source.subscribe(parent);\n        } catch (Throwable ex) {\n            Exceptions.throwIfFatal(ex);\n            parent.onError(ex);\n        }\n    }\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œé¦–å…ˆä¼šè§¦å‘ observer.onSubscribe ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹ **ObservableSubscribeOn.subscribeActual**\n\n```java\n    @Override\n    public void subscribeActual(final Observer<? super T> s) {\n        final SubscribeOnObserver<T> parent = new SubscribeOnObserver<T>(s);\n\n        s.onSubscribe(parent);\n\n        parent.setDisposable(scheduler.scheduleDirect(new SubscribeTask(parent)));\n    }\n```\n\nå¥½äº†ï¼Œè¿™æ ·æˆ‘ä»¬åˆå›åˆ°äº†åŸç‚¹ï¼š\n\n```java\nsource.subscribe(new ObserveOnObserver<T>(observer, w, delayError, bufferSize));\n```\n\nå›åˆ°äº†æœ€åˆçš„ Observerï¼š**ObserveOnObserver**\n\n\nè¿™ä¸ª ObserveOnObserver æŒæœ‰æˆ‘ä»¬ä¸€å¼€å§‹åˆ›å»ºçš„observerï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªConsumerå¯¹è±¡ã€‚\n\nä¸‹é¢å°±æ¥çœ‹çœ‹è¿™ä¸ª ObserveOnObserver\n\n- æ„é€ å‡½æ•°\n\n```java\n        ObserveOnObserver(Observer<? super T> actual, Scheduler.Worker worker, boolean delayError, int bufferSize) {\n            this.actual = actual;\n            this.worker = worker;\n            this.delayError = delayError;\n            this.bufferSize = bufferSize;\n        }\n```\n\nè¿™é‡ŒæŒ‡çš„æ³¨æ„çš„ä¸€ç‚¹ ï¼Œactual å…¶å®å°±æ˜¯observer\n\n- onSubscribe\n\n```java\n@Override\n        public void onSubscribe(Disposable s) {\n            if (DisposableHelper.validate(this.s, s)) {\n                this.s = s;\n\t\t\t\t// ç°é˜¶æ®µï¼Œæˆ‘ä»¬ç”¨åˆ°çš„Disposable éƒ½æ˜¯å•ä¸ªçš„ï¼Œæš‚æ—¶ä¸è®¨è®ºå…¶\n\t\t\t\t//ä¸ºQueueDisposableçš„æƒ…å†µ\n\n                queue = new SpscLinkedArrayQueue<T>(bufferSize);\n\n                actual.onSubscribe(this);\n            }\n        }\n```\n\nåœ¨**ObservableCreate.subscribeActual** ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œå½“æ‰§è¡Œsubscribe æ–¹æ³•åï¼Œé¦–å…ˆä¼šæ‰§è¡Œ observerçš„ onSubscribe æ–¹æ³•ã€‚è¿™é‡Œçš„å®ç°éå¸¸ç®€å•ï¼Œå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªqueue,å¹¶è§¦å‘äº†è¿™ä¸ª observer è‡ªå·±çš„ onSubscribe æ–¹æ³•ã€‚\n\n- onNext\n\n```java\n        @Override\n        public void onNext(T t) {\n            if (done) {\n                return;\n            }\n\n            if (sourceMode != QueueDisposable.ASYNC) {\n                queue.offer(t);\n            }\n            schedule();\n        }\n```\n\nåœ¨ onNext ä¸­ä¼šæ‰§è¡Œ scheule() æ–¹æ³•ã€‚\n\n```java\n        void schedule() {\n            if (getAndIncrement() == 0) {\n                worker.schedule(this);\n            }\n        }\n```\n\n**è¿™ä¸ªåœ°æ–¹å°±æœ‰æ„æ€äº†ï¼Œå‰é¢è¯´è¿‡è¿™é‡Œçš„ worker æ˜¯ä¸€ä¸ªæŒæœ‰ä¸»çº¿ç¨‹handler çš„Workerå¯¹è±¡ï¼Œå½“ä»–çš„ schedule æ‰§è¡Œæ—¶ï¼Œå°±ä¼šæŠŠç‰¹å®šçš„çº¿ç¨‹ä»»åŠ¡é€šè¿‡Handler.postDelay æ–¹æ³•è½¬ç§»åˆ°ä¸»çº¿ä¸­å»æ‰§è¡Œ** ã€‚\n\né‚£ä¹ˆè¿™é‡Œçš„this åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå‰é¢æˆ‘ä»¬è¯´è¿‡ï¼ŒObserveOnObserver è¿™ä¸ªç±»åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œä»–æ˜¯ä¸€ä¸ªRunnableï¼Œé‚£ä¹ˆè¿™é‡Œå°±æ˜¯æ‰§è¡Œä»–è‡ªå·±çš„runæ–¹æ³•å–½ï¼Œæˆ‘ä»¬èµ¶ç´§çœ‹çœ‹ã€‚\n\n```java\n        @Override\n        public void run() {\n            if (outputFused) {\n                drainFused();\n            } else {\n                drainNormal();\n            }\n        }\n```\n\nè¿™é‡Œæœ‰ä¸€ä¸ªå‚æ•° outputFused ä»–é»˜è®¤æ˜¯falseï¼Œè‡³äºä»–ä»€ä¹ˆæ—¶å€™ä¸ºtrueï¼Œä¸ä½œä¸ºè¿™é‡Œè®¨è®ºçš„é‡ç‚¹ã€‚\n\n```java\nvoid drainNormal() {\n            int missed = 1;\n\n            final SimpleQueue<T> q = queue;\n            final Observer<? super T> a = actual;\n\n            for (;;) {\n                if (checkTerminated(done, q.isEmpty(), a)) {\n                    return;\n                }\n\n                for (;;) {\n                    boolean d = done;\n                    T v;\n\n                    try {\n                        v = q.poll();\n                    } catch (Throwable ex) {\n                        Exceptions.throwIfFatal(ex);\n                        s.dispose();\n                        q.clear();\n                        a.onError(ex);\n                        worker.dispose();\n                        return;\n                    }\n                    boolean empty = v == null;\n\n                    if (checkTerminated(d, empty, a)) {\n                        return;\n                    }\n\n                    if (empty) {\n                        break;\n                    }\n\n                    a.onNext(v);\n                }\n\n                missed = addAndGet(-missed);\n                if (missed == 0) {\n                    break;\n                }\n            }\n        }\n```\n\nè¿™é‡Œå¤§æ¦‚å°±æ˜¯é€šè¿‡ä¸€ä¸ªæ­»å¾ªç¯ï¼Œä¸æ–­ä» onSubscribe æ–¹æ³•ä¸­åˆ›å»ºçš„é˜Ÿåˆ—ä¸­å–å‡ºäº‹ä»¶ï¼Œæ‰§è¡Œobserver çš„ onNextæ–¹æ³•ã€‚è€Œå½“ä¸ºä¾‹ä¸ºç©ºæ—¶ï¼Œå°±ä¼šæ‰§è¡Œworker.dispose å–æ¶ˆæ•´ä¸ªäº‹ä»¶æµï¼ŒåŒæ—¶ä»Handlerä¸­ç§»é™¤æ‰€æœ‰æ¶ˆæ¯ã€‚\n\næœ€ååœ¨çœ‹ä¸€çœ¼ onComplete ,onError å’Œæ•´ä¸ªç±»ä¼¼\n\n```java\n        @Override\n        public void onComplete() {\n            if (done) {\n                return;\n            }\n            done = true;\n            schedule();\n        }\n```\nå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„å¤„ç†ä¹Ÿå¾ˆç®€å•ï¼Œdone è®¾ç½®ä¸º true .è¿™æ ·æœ€åä¾¿å®Œæˆäº†ä¸‹æ¸¸äº‹ä»¶çš„æ‰§è¡Œã€‚\n\n## æœ€å\n\nå¥½äº†ï¼Œç”±äºä¸€äº›æ— ä»¥è¯‰è¯´çš„åŸå› ï¼Œç»å†äº†å¾ˆä¹…ç»ˆäºæŠŠ RxJava çº¿ç¨‹åˆ‡æ¢çš„ä¸‹ç¯‡ç»™å®Œæˆäº†ã€‚\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["RxJava2"],"categories":["Android è¿›é˜¶"]},{"title":"2018-Book&Movie List","url":"%2F2018%2F03%2F01%2F2018-Book%26Movie%20List%2F","content":"\n## Book\n\n- [x] å¤§æ•°æ®æ—¶ä»£[ç»´å…‹æ‰˜.è¿ˆå°”]\n- [x] åŠå°æ—¶æ¼«ç”»ä¸–ç•Œå²[äºŒæ··å­]\n- [x] æˆ‘é•¿å¾—ä¸‘ï¼Œä½ ä»¬éƒ½å¾—è®©ç€æˆ‘[å”æ¢“ä¸¥]\n- [x] æªç‚®ç»†èŒä¸é’¢é“\n- [x] ä¸‰ä½“ [åˆ˜æ…ˆæ¬£]\n- [x] çˆµè¿¹ [éƒ­æ•¬æ˜]\n- [x] æ—¶é—´ç®€å² ï¼ˆéœé‡‘ï¼‰\n- [x] äººé—´å¤±æ ¼ \n\n\n- [x] Java 8 å®æˆ˜\n- [x] Android Gradle å®æˆ˜\n- [x] Clean Code\n\n## Movie\n\n- [x] ä¸‰å—å¹¿å‘Šç‰Œ\n- [x] è¥¿æ¸¸è®°-å¥³å„¿å›½\n- [x] å¤ä»‡è€…è”ç›Ÿ3\n- [x] çº¢æµ·è¡ŒåŠ¨\n- [x] å®«å´éª-èµ·é£äº†\n- [x] è‡³æš—æ—¶åˆ»\n- [x] é­”å¥³å®…æ€¥ä¾¿\n- [x] è€ç”·å­©ï¼ˆç¾ç‰ˆï¼‰\n- [x] é»‘è±¹\n- [x] ç’å¤©è¿‡æµ·ï¼šç¾äººè®¡\n- [x] æ— é—®è¥¿ä¸œ\n- [x] çº¢é«˜ç²±\n- [x] èšäºº2\n- [x] è©¹å¦®å¼—çš„è‚‰ä½“\n- [x] çˆµè¿¹\n- [x] æˆ‘ä¸æ˜¯è¯ç¥\n- [x] ä¸€å‡ºå¥½æˆ\n- [x] è¾¹å¢ƒæ€æ‰‹2\n- [x] èœ˜è››ä¾ ï¼šå¹³è¡Œå®‡å®™\n- [x] é—ªå…‰å°‘å¥³\n- [x] åä¾¦æ¢æŸ¯å—å‰§åœºç‰ˆ- é›¶çš„æ‰§è¡Œäºº\n- [x] æ— åŒ\n\n## Tv\n\n- [x] ç™½å¤œè¿½å‡¶\n- [x] è¶³çƒå°å°† 100 é›†\n- [x] ç”Ÿæ´»å¤§çˆ†ç‚¸ season-11\n- [x] æ‘©ç™»å®¶åº­ season-01\n- [x] ä¸­å›½å¥½å£°éŸ³ 2018\n- [x] é“é½¿é“œç‰™çºªæ™“å²š ç¬¬ä¸€éƒ¨ + ç¬¬äºŒéƒ¨\n\n","tags":["è¯»ä¹¦"]},{"title":"RxJava2 æ˜¯å¦‚ä½•å®ç°çº¿ç¨‹åˆ‡æ¢çš„ (ä¸Š)","url":"%2F2018%2F01%2F23%2FRxJava2%20%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2%E7%9A%84%EF%BC%88%E4%B8%8A%EF%BC%89%2F","content":"\n\n## å‰è¨€\n\n\n\né€šè¿‡å‰ä¸€ç¯‡çš„[ä»è§‚å¯Ÿè€…æ¨¡å¼å‡ºå‘ï¼ŒèŠèŠRxJava](https://juejin.im/post/5a521d68f265da3e4e25750e),æˆ‘ä»¬å¤§è‡´ç†è§£äº†RxJavaçš„å®ç°åŸç†ï¼Œåœ¨RxJavaä¸­å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°ä¸åŒçº¿ç¨‹é—´çš„åˆ‡æ¢ã€‚subscribeOn ç”¨äºæŒ‡å®šä¸Šæ¸¸çº¿ç¨‹ï¼ŒobserveOn ç”¨äºæŒ‡å®šä¸‹æ¸¸çº¿ç¨‹ï¼Œå¤šæ¬¡ç”¨ subscribeOn æŒ‡å®šä¸Šæ¸¸çº¿ç¨‹åªæœ‰ç¬¬ä¸€æ¬¡æœ‰æ•ˆï¼Œå¤šæ¬¡ç”¨ observeOn æŒ‡å®šä¸‹æ¬¡çº¿ç¨‹ï¼Œæ¯æ¬¡éƒ½æœ‰æ•ˆï¼›ç®€ç›´å¤ªæ–¹ä¾¿äº†ï¼Œæ¯”ç›´æ¥ä½¿ç”¨Handlerçœäº†ä¸å°‘åŠ›æ°”ï¼ŒåŒæ—¶ä¹Ÿä¸ç”¨å»å…³æ³¨å†…å­˜æ³„æ¼çš„é—®é¢˜äº†ã€‚æœ¬ç¯‡å°±æ¥çœ‹çœ‹åœ¨RxJavaä¸­ä¸Šæ¸¸æ˜¯å¦‚ä½•å®ç°çº¿ç¨‹åˆ‡æ¢ã€‚\n\n\n<!--more-->\n\n## RxJava åŸºç¡€åŸç†\n\nä¸ºäº†æ–¹ä¾¿åé¢çš„å™è¿°ï¼Œè¿™é‡Œé€šè¿‡ä¸‹é¢çš„UMLå›¾ç®€å•å›é¡¾ä¸€ä¸‹ä¸Šä¸€ç¯‡çš„å†…å®¹ã€‚\n\n\n![](https://user-gold-cdn.xitu.io/2018/1/23/161239920cc6b9d9?w=910&h=525&f=png&s=42043)\n\n*æ­¤å›¾å¹¶æ²¡æœ‰å®Œæ•´çš„å±•ç°å›¾ä¸­å„ä¸ªæ¥å£å’Œç±»ä¹‹é—´çš„å„ç§å…³ç³»ï¼Œå› ä¸ºé‚£æ ·ä¼šå¯¼è‡´æ•´ä¸ªå›¾é”™ç»¼å¤æ‚ï¼Œä¸ä¾¿äºæŸ¥çœ‹ï¼Œè¿™é‡Œåªç»˜åˆ¶å‡ºäº†RxJavaå„ä¸ªç±»ä¹‹é—´æ ¸å¿ƒå…³ç³»ç½‘ç»œ*\n\n\n\nä»ä¸Šé¢çš„UMLå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå…·ä½“çš„å®ç°ç±»åªæœ‰ObservableCreateå’ŒCreateEmitterã€‚CreateEmitteræ˜¯ObservableCreateçš„å†…éƒ¨ç±»ï¼ˆPlantUML æ€ä¹ˆç»˜åˆ¶å†…éƒ¨ç±»ï¼Œæ²¡ææ‡‚ï¼Œç©çš„è½¬çš„åŒå­¦è¯·èµæ•™å‘€(*^â–½^*)ï¼‰ã€‚\n\nä¸Šç¯‡è¯´è¿‡Observableåˆ›å»ºçš„è¿‡ç¨‹ï¼Œå¯ä»¥ç®€åŒ–å¦‚ä¸‹ï¼š\n\n```java\n  Observable mObservable=new ObservableCreate(new ObservableOnSubscribe())\n```\nç»“åˆå›¾å¯ä»¥æ›´ç›´è§‚çš„ä½“ç°å‡ºè¿™ä¸€ç‚¹ã€‚ObservableCreate å†…éƒ¨æŒæœ‰ObservableOnSubscribeçš„å¼•ç”¨ã€‚\n\nå½“è§‚å¯Ÿè€…è®¢é˜…ä¸»é¢˜åï¼š\n\n```java\nmObservable.subscribe(mObserver);\n```\nObservableCreate ä¸­çš„subscribeActual()æ–¹æ³•å°±ä¼šæ‰§è¡Œï¼Œ\n\n\n```java\n    protected void subscribeActual(Observer<? super T> observer) {\n        CreateEmitter<T> parent = new CreateEmitter<T>(observer);\n        observer.onSubscribe(parent);\n\n        try {\n            source.subscribe(parent);\n        } catch (Throwable ex) {\n            Exceptions.throwIfFatal(ex);\n            parent.onError(ex);\n        }\n    }\n\n```\n\nåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šåˆ›å»ºCreateEmitter çš„å®ä¾‹ï¼Œè€Œè¿™ä¸ªCreateEmitterå®ç°äº†Emitterå’ŒDisposableæ¥å£ï¼ŒåŒæ—¶åˆæŒæœ‰Observerçš„å¼•ç”¨ï¼ˆå½“ç„¶è¿™ä¸ªå¼•ç”¨æ˜¯ObservableCreateä¼ é€’ç»™ä»–çš„ï¼‰ã€‚**æ¥ç€å°±ä¼šæ‰§è¡ŒObservableOnSubscribeçš„subscribe æ–¹æ³•**ï¼Œæ–¹æ³•çš„å‚æ•°å³ä¸ºåˆšåˆšåˆ›å»ºçš„CreateEmitter çš„å®ä¾‹ï¼Œæ¥ç€ä¸€ç³»åˆ—è¿é”ååº”ï¼ŒEmitter æ¥å£ä¸­çš„æ–¹æ³•ï¼ˆonNext,onCompleteç­‰ï¼‰å¼€å§‹æ‰§è¡Œï¼Œåœ¨CreateEmitterå†…éƒ¨ï¼ŒObserveræ¥å£ä¸­å¯¹åº”çš„æ–¹æ³•ä¾æ¬¡æ‰§è¡Œï¼Œè¿™æ ·å°±å®ç°äº†ä¸€æ¬¡ä»ä¸»é¢˜ï¼ˆä¸Šæ¸¸ï¼‰åˆ°è§‚å¯Ÿè€…ï¼ˆä¸‹æ¸¸ï¼‰çš„äº‹ä»¶ä¼ é€’ã€‚\n\n\n**source.subscribe(parent)** \n\nè¿™é‡Œçš„ source æ˜¯ObservableOnSubscribeçš„å®ä¾‹ï¼Œparentæ˜¯CreateEmitterçš„å®ä¾‹ã€‚ä¸Šé¢åŠ ç²—æ–‡æœ¬å™è¿°çš„å†…å®¹ï¼Œå°±æ˜¯è¿™è¡Œä»£ç ï¼Œå¯ä»¥è¯´è¿™æ˜¯æ•´ä¸ªè®¢é˜…è¿‡ç¨‹æœ€æ ¸å¿ƒçš„å®ç°ã€‚\n\nå¥½äº†ï¼Œå›é¡¾å®ŒåŸºç¡€çŸ¥è¯†åï¼Œé©¬ä¸Šè¿›å…¥æ­£é¢˜ï¼Œçœ‹çœ‹RxJavaæ˜¯å¦‚ä½•å®ç°çº¿ç¨‹åˆ‡æ¢çš„ã€‚\n\n\n\n\n\n## RxJava ä¹‹ subscribeOn\næˆ‘ä»¬çŸ¥é“æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„å†…å®¹éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œæ—¢ç„¶è¿™é‡Œæåˆ°äº†çº¿ç¨‹åˆ‡æ¢ï¼Œé‚£ä¹ˆå¿…ç„¶æ˜¯åˆ‡æ¢åˆ°äº†å­çº¿ç¨‹ï¼Œå› æ­¤ï¼Œè¿™é‡Œéœ€è¦å…³æ³¨çº¿ç¨‹çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¸¦ç€ä¸‹é¢è¿™å‡ ä¸ªé—®é¢˜å»é˜…è¯»ä»£ç ã€‚\n\n- 1.**æ˜¯å“ªä¸ªå¯¹è±¡åœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºäº†å­çº¿ç¨‹ï¼Œæ˜¯ä¸€ç§æ€æ ·çš„æ–¹å¼åˆ›å»ºçš„ï¼Ÿ**\n- 2.**å­çº¿ç¨‹åˆæ˜¯å¦‚ä½•å¯åŠ¨çš„ï¼Ÿ**\n- 3.**ä¸Šæ¸¸äº‹ä»¶æ˜¯æ€ä¹ˆè·‘åˆ°å­çº¿ç¨‹é‡Œæ‰§è¡Œçš„ï¼Ÿ**\n- 4.**å¤šæ¬¡ç”¨ subscribeOn æŒ‡å®šä¸Šæ¸¸çº¿ç¨‹ä¸ºä»€ä¹ˆåªæœ‰ç¬¬ä¸€æ¬¡æœ‰æ•ˆ ?**\n\n\n### ç¤ºä¾‹ \n\né¦–å…ˆçœ‹ä¸€ä¸‹ï¼Œæ—¥å¸¸å¼€å‘ä¸­å®ç°çº¿ç¨‹åˆ‡æ¢çš„å…·ä½“å®ç°\n\n```java\n\n    private void multiThread() {\n        Observable.create(new ObservableOnSubscribe<String>() {\n            @Override\n            public void subscribe(ObservableEmitter<String> e) throws Exception {\n                e.onNext(\"This msg from work thread :\" + Thread.currentThread().getName());\n                sb.append(\"\\nsubscribe: currentThreadName==\" + Thread.currentThread().getName());\n            }\n        })\n                .subscribeOn(Schedulers.newThread())\n                .observeOn(AndroidSchedulers.mainThread())\n                .subscribe(new Consumer<String>() {\n                    @Override\n                    public void accept(String s) throws Exception {\n                        Log.e(TAG, \"accept: s= \" + s);\n                    }\n                });\n    }\n\n```\nè¿™æ®µä»£ç ï¼Œä½¿ç”¨è¿‡RxJavaçš„åŒå­¦å†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œä¸Šæ¸¸äº‹ä»¶ä¼šåœ¨ä¸€ä¸ªåä¸º RxNewThreadScheduler-1 çš„çº¿ç¨‹æ‰§è¡Œï¼Œä¸‹æ¸¸çº¿ç¨‹ä¼šåˆ‡æ¢å›æˆ‘ä»¬ç†Ÿæ‚‰çš„Android UIçº¿ç¨‹ã€‚\n\næˆ‘ä»¬å°±ä»subscribeOn(Schedulers.newThread()) å‡ºå‘ï¼Œçœ‹çœ‹è¿™ä¸ªä»£ç çš„èƒŒåï¼Œåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚\n\n![](https://user-gold-cdn.xitu.io/2018/1/23/161239e8d8af610b?w=1280&h=610&f=png&s=218709)\n### subscribeOn\n\nè¿™é‡Œæˆ‘ä»¬å…ˆä¸ç®¡Schedulers.newThread() æ˜¯ä»€ä¹ˆé¬¼ï¼Œé¦–å…ˆçœ‹çœ‹è¿™ä¸ªsubscribeOn()æ–¹æ³•ã€‚\n\n\n**Observable.java---  subscribeOn(Scheduler scheduler)**\n\n```java\n    public final Observable<T> subscribeOn(Scheduler scheduler) {\n        ObjectHelper.requireNonNull(scheduler, \"scheduler is null\");\n        return RxJavaPlugins.onAssembly(new ObservableSubscribeOn<T>(this, scheduler));\n    }\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦ä¸€ä¸ªScheduler ç±»å‹çš„å‚æ•°ã€‚\n\n**RxJavaPlugins.java--- onAssembly(@NonNull Observable<T> source)**\n\n```java\n    public static <T> Observable<T> onAssembly(@NonNull Observable<T> source) {\n        Function<? super Observable, ? extends Observable> f = onObservableAssembly;\n        if (f != null) {\n            return apply(f, source);\n        }\n        return source;\n    }\n```\n\nO(âˆ©_âˆ©)Oå“ˆå“ˆ~ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—ä¼¼æ›¾ç›¸è¯†ï¼Œå’Œcreateæ“ä½œç¬¦ä¸€ä¸ªå¥—è·¯å‘€ã€‚å› æ­¤ï¼ŒobserveOnä¹Ÿå¯ä»¥ç®€åŒ–å¦‚ä¸‹ï¼š\n\n```java\nnew ObservableSubscribeOn<T>(this, Schedulers.newThread());\n```\nè¿™é‡Œä½ ä¹Ÿè®¸ä¼šæœ‰ç–‘é—®ï¼Œè¿™ä¸ªthisæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…¶å®è¿™ä¸ªthiså°±æ˜¯Observableï¼Œå…·ä½“åˆ°ä¸Šé¢çš„ä»£ç æ¥è¯´å°±æ˜¯ObservableCreateï¼Œæ€»ä¹‹å°±æ˜¯ä¸€ä¸ªå…·ä½“çš„Observableã€‚\n\næ¥ç€çœ‹ObservableSubscribeOn è¿™ä¸ªç±»\n\n```java\npublic final class ObservableSubscribeOn<T> extends AbstractObservableWithUpstream<T, T> {\n}\n\n```\n\nçœ‹ä¸€ä¸‹ **AbstractObservableWithUpstream.java**\n\n```java\n\nabstract class AbstractObservableWithUpstream<T, U> extends Observable<U> implements HasUpstreamObservableSource<T> {\n\n    /** The source consumable Observable. */\n    protected final ObservableSource<T> source;\n\n    AbstractObservableWithUpstream(ObservableSource<T> source) {\n        this.source = source;\n    }\n\n    @Override\n    public final ObservableSource<T> source() {\n        return source;\n    }\n\n}\n```\n\nå†çœ‹ä¸€ä¸‹ **HasUpstreamObservableSource.java**\n\n```java\n/**\n * Interface indicating the implementor has an upstream ObservableSource-like source available\n * via {@link #source()} method.\n *\n * @param <T> the value type\n */\npublic interface HasUpstreamObservableSource<T> {\n    /**\n     * Returns the upstream source of this Observable.\n     * <p>Allows discovering the chain of observables.\n     * @return the source ObservableSource\n     */\n    ObservableSource<T> source();\n}\n```\n\né¥¶äº†åŠå¤©ï¼ŒObservableSubscribeOn åŸæ¥å’Œä¸Šä¸€ç¯‡è¯´çš„ObservableCreateä¸€æ ·ï¼Œä¹Ÿæ˜¯Observableçš„ä¸€ä¸ªå­ç±»ã€‚åªä¸è¿‡æ¯”ObservableCreateå¤šå®ç°äº†ä¸€ä¸ªæ¥å£HasUpstreamObservableSourceï¼Œè¿™ä¸ªæ¥å£å¾ˆæœ‰æ„æ€ï¼Œä»–çš„source()æ–¹æ³•è¿”å›ç±»å‹æ˜¯ObservableSourceï¼ˆè¿˜è®°å¾—è¿™ä¸ªç±»çš„è§’è‰²å—ï¼Ÿï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ObservableSubscribeOnè¿™ä¸ªObservableæ˜¯ä¸€ä¸ªæ‹¥æœ‰ä¸Šæ¸¸çš„Observableã€‚ä»–æœ‰ä¸€ä¸ªéå¸¸å…³é”®çš„æ–¹æ³•source()ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯ObservableSourceï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡è°ƒç”¨å®ç°sourceæ–¹æ³•ï¼Œå¯ä»¥è·å–åˆ°ä¸Šæ¸¸çš„Observeableã€‚**AbstractObservableWithUpstreamç±»ç»§æ‰¿HasUpstreamObservableSource å¹¶å®ç°äº†è¿™ä¸ªsourceæ–¹æ³•ï¼Œè¿”å›ç»“æœä¸ºObservableSourceï¼Œæ˜¯é€šè¿‡å…¶æ„é€ å‡½æ•°è·å–ã€‚**ï¼Œé‚£ä¹ˆAbstractObservableWithUpstreamçš„æ„é€ å‡½æ•°åˆæ˜¯åœ¨å“ªé‡Œè°ƒç”¨çš„å‘¢ï¼Ÿ\n\næˆ‘ä»¬æ¥ç€çœ‹ObservableSubscribeOnçš„å…·ä½“å®ç°ã€‚\n\n```java\npublic final class ObservableSubscribeOn<T> extends AbstractObservableWithUpstream<T, T> {\n    final Scheduler scheduler;\n\n    public ObservableSubscribeOn(ObservableSource<T> source, Scheduler scheduler) {\n        super(source);\n        this.scheduler = scheduler;\n    }\n\n    @Override\n    public void subscribeActual(final Observer<? super T> s) {\n        final SubscribeOnObserver<T> parent = new SubscribeOnObserver<T>(s);\n\t\t// observer è°ƒç”¨onSubscribeæ–¹æ³•ï¼Œè·å–ä¸Šæ¸¸çš„æ§åˆ¶æƒ\n        s.onSubscribe(parent);\n\n        parent.setDisposable(scheduler.scheduleDirect(new SubscribeTask(parent)));\n    }\n}\n```\n\n- é¦–å…ˆçœ‹ä»–çš„æ„é€ å‡½æ•°ï¼Œå‚æ•°sourceå°±æ˜¯æˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡çš„thisï¼Œschedulerå°±æ˜¯Schedulers.newThread()ã€‚åŒæ—¶è°ƒç”¨äº†çˆ¶ç±»AbstractObservableWithUpstreamçš„æ„é€ å‡½æ•°ï¼Œè¿™é‡Œç»“åˆä¹‹å‰çš„ç»“è®ºï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šé€šè¿‡è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œå°±åˆ›å»ºå‡ºæ¥äº†ä¸€ä¸ªåŒ…å«ä¸Šæ¸¸çš„ObservableSubscribeOnå®ä¾‹ã€‚\n- å†çœ‹å®ç°è®¢é˜…å…³ç³»çš„å…³é”®æ–¹æ³•subscribeActual()ï¼Œåœ¨è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªSubscribeOnObserverçš„å®ä¾‹ï¼ŒSubscribeOnObserver æ˜¯AtomicReferenceçš„å­ç±»(ä¿è¯åŸå­æ€§)ï¼ŒåŒæ—¶å®ç°äº† Observeræ¥å£ å’Œ Disposable æ¥å£ï¼›ä½ å¯ä»¥æŠŠä»–ç†è§£æˆä¸€ä¸ªObserverã€‚\n\næˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼ŒsubscribeActual()æ˜¯å®ç°ä¸Šä¸‹æ¸¸ä¹‹é—´è®¢é˜…å…³ç³»çš„é‡è¦æ–¹æ³•ã€‚å› ä¸ºåªæœ‰çœŸæ­£å®ç°äº†è®¢é˜…å…³ç³»ï¼Œä¸Šä¸‹æ¸¸ä¹‹é—´æ‰èƒ½è¿æ¥èµ·æ¥ã€‚æˆ‘ä»¬çœ‹è¿™ä¸ªæ–¹æ³•çš„æœ€åä¸€å¥ä»£ç ã€‚\n\n```java\n parent.setDisposable(scheduler.scheduleDirect(new SubscribeTask(parent)));\n```\nè¿™å¥ä»£ç ï¼Œå¯ä»¥è¯´å°±æ˜¯éå¸¸å…³é”®ï¼Œå› ä¸ºä»è¿™é‡Œå¼€å§‹äº†ä¸€ç³»åˆ—çš„è¿é”ååº”ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹SubscribeTask\n\n\n```java\n    final class SubscribeTask implements Runnable {\n        private final SubscribeOnObserver<T> parent;\n\n        SubscribeTask(SubscribeOnObserver<T> parent) {\n            this.parent = parent;\n        }\n\n        @Override\n        public void run() {\n            source.subscribe(parent);\n        }\n    }\n```\n\nçœ‹åˆ°è¿™å¥ **source.subscribe(parent)**ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—ä¼¼æ›¾ç›¸è¯†å‘¢ï¼Ÿ\n\n\nSubscribeTask å®ç°äº†æ˜¯Runnableæ¥å£ï¼Œåœ¨å…¶runæ–¹æ³•ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªéœ€è¦åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä»»åŠ¡ã€‚æŒ‰ç…§ç±»çš„ç»§æ‰¿å…³ç³»ï¼Œå¾ˆæ˜æ˜¾source å°±æ˜¯ObservableSubscribeOn çš„ä¸Šæ¸¸Observableï¼Œparentæ˜¯ä¸€ä¸ªObserverã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªrunæ–¹æ³•è¦æ‰§è¡Œçš„å†…å®¹å°±æ˜¯å®ç°ObservableSubscribeOnçš„ä¸Šæ¸¸å’ŒObserverçš„è®¢é˜…ã€‚**ä¸€æ—¦æŸä¸ªçº¿ç¨‹æ‰§è¡Œäº†è¿™ä¸ªRunnableï¼ˆSubscribeTaskï¼‰ï¼Œå°±ä¼šè§¦å‘äº†è¿™ä¸ªrunæ–¹æ³•ï¼Œä»è€Œå®ç°è®¢é˜…**ï¼Œè€Œä¸€æ—¦è¿™ä¸ªè®¢é˜…å®ç°ï¼Œé‚£ä¹ˆåé¢çš„æµç¨‹å°±æ˜¯ä¸ŠèŠ‚æ‰€è¯´çš„äº‹æƒ…äº†ã€‚\n\n**è¿™é‡Œå¯ä»¥è§£ç­”ç¬¬ä¸‰ä¸ªé—®é¢˜äº†ï¼Œä¸Šæ¸¸äº‹ä»¶æ˜¯æ€ä¹ˆç»™å¼„åˆ°å­çº¿ç¨‹é‡Œå»çš„ï¼Œè¿™é‡Œå¾ˆæ˜æ˜¾äº†ï¼Œå°±æ˜¯ç›´æ¥æŠŠè®¢é˜…æ–¹æ³•æ”¾åœ¨äº†ä¸€ä¸ªRunnableä¸­å»æ‰§è¡Œï¼Œè¿™æ ·å°±ä¸€æ—¦è¿™ä¸ªRunnableåœ¨æŸä¸ªå­çº¿ç¨‹æ‰§è¡Œï¼Œé‚£ä¹ˆä¸Šæ¸¸æ‰€æœ‰äº‹ä»¶åªèƒ½åœ¨è¿™ä¸ªå­çº¿ç¨‹ä¸­æ‰§è¡Œäº†ã€‚**\n \nå¥½äº†ï¼Œçº¿ç¨‹è¦æ‰§è¡Œçš„ä»»åŠ¡**ä¼¼ä¹**åˆ›å»ºå®Œäº†ï¼Œä¸‹é¢å°±æ¥ç€æ‰¾çœ‹çœ‹å­çº¿ç¨‹æ˜¯æ€ä¹ˆåˆ›å»ºçš„ã€‚å›è¿‡å¤´ç»§ç»­çœ‹åˆšæ‰çš„æ–¹æ³•ï¼Œ\n\n```java\nscheduler.scheduleDirect(new SubscribeTask(parent))\n```\n\n**Scheduler.java----scheduleDirect**\n\n```java\n\n    public Disposable scheduleDirect(@NonNull Runnable run) {\n        return scheduleDirect(run, 0L, TimeUnit.NANOSECONDS);\n    }\n\n\n    public Disposable scheduleDirect(@NonNull Runnable run, long delay, @NonNull TimeUnit unit) {\n        final Worker w = createWorker();\n\t\t// å¯¹runè¿›è¡Œäº†ä¸€æ¬¡è£…é¥°\n        final Runnable decoratedRun = RxJavaPlugins.onSchedule(run);\n\n        DisposeTask task = new DisposeTask(decoratedRun, w);\n\n        w.schedule(task, delay, unit);\n\n        return task;\n    }\n\n\t@NonNull\n\t// æŠ½è±¡æ–¹æ³•\n    public abstract Worker createWorker();\n```\n\né¦–å…ˆçœ‹ä¸€ä¸‹Workerç±»\n\n```java\n    /**\n     * Sequential Scheduler for executing actions on a single thread or event loop.\n     * <p>\n     * Disposing the {@link Worker} cancels all outstanding work and allows resource cleanup.\n     */\n    public abstract static class Worker implements Disposable {\n  \n        @NonNull\n        public Disposable schedule(@NonNull Runnable run) {\n            return schedule(run, 0L, TimeUnit.NANOSECONDS);\n        }\n\n  \n        @NonNull\n        public abstract Disposable schedule(@NonNull Runnable run, long delay, @NonNull TimeUnit unit);\n\n        \n    }\n\n```\n\nWorkeræ˜¯Schedulerå†…éƒ¨çš„ä¸€ä¸ªé™æ€æŠ½è±¡ç±»ï¼Œå®ç°äº†Disposableæ¥å£ï¼Œå…¶schedule()æ–¹æ³•ä¹Ÿæ˜¯æŠ½è±¡çš„ã€‚\n\n\nå†çœ‹ä¸€ä¸‹DisposeTask \n\n\n```java\nstatic final class DisposeTask implements Runnable, Disposable {\n        final Runnable decoratedRun;\n        final Worker w;\n\n        Thread runner;\n\n        DisposeTask(Runnable decoratedRun, Worker w) {\n            this.decoratedRun = decoratedRun;\n            this.w = w;\n        }\n\n        @Override\n        public void run() {\n            runner = Thread.currentThread();\n            try {\n                decoratedRun.run();\n            } finally {\n                dispose();\n                runner = null;\n            }\n        }\n\n        @Override\n        public void dispose() {\n            if (runner == Thread.currentThread() && w instanceof NewThreadWorker) {\n                ((NewThreadWorker)w).shutdown();\n            } else {\n                w.dispose();\n            }\n        }\n\n        @Override\n        public boolean isDisposed() {\n            return w.isDisposed();\n        }\n    }\n\n```\nDisposeTask åˆæ˜¯ä¸€ä¸ªRunnableï¼ŒåŒæ—¶ä¹Ÿå®ç°äº†Disposableæ¥å£ã€‚å¯ä»¥çœ‹åˆ°åœ¨ä»–çš„runæ–¹æ³•ä¸­ä¼šæ‰§è¡ŒdecoratedRunçš„runæ–¹æ³•ï¼Œè¿™ä¸ªdecoratedRunå…¶å®å°±æ˜¯å‚æ•°ä¸­ä¼ é€’è¿›æ¥çš„runï¼Œ**ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰§è¡Œäº†è¿™ä¸ªDisposeTaskçš„runæ–¹æ³•ï¼Œå°±ä¼šè§¦å‘SubscribeTaskä¸­çš„runæ–¹æ³•**ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°±è¦å…³æ³¨æ˜¯è°æ‰§è¡Œäº†è¿™ä¸ªDisposeTaskã€‚\n\n\n\nå›åˆ°scheduleDirect()æ–¹æ³•\n\n\n```java\n    public Disposable scheduleDirect(@NonNull Runnable run, long delay, @NonNull TimeUnit unit) {\n        final Worker w = createWorker();\n\t\t// å¯¹runè¿›è¡Œäº†ä¸€æ¬¡è£…é¥°\n        final Runnable decoratedRun = RxJavaPlugins.onSchedule(run);\n\n        DisposeTask task = new DisposeTask(decoratedRun, w);\n\n        w.schedule(task, delay, unit);\n\n        return task;\n    }\n```\n\n\nscheduleDirect()æ–¹æ³•çš„å®ç°æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ï¼š\n\n1. åˆ›å»ºä¸€ä¸ªWorkerå¯¹è±¡w,è€Œåœ¨Schedulerç±»ä¸­createWorker()æ–¹æ³•è¢«å®šä¹‰ä¸ºæŠ½è±¡æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å»Schedulerçš„å…·ä½“å®ç°ä¸­äº†è§£è¿™ä¸ªWorkerçš„å…·ä½“å®ç°ã€‚\n2. å¯¹å‚æ•°runé€šè¿‡RxJavaPluginsè¿›è¡Œä¸€æ¬¡è£…é¥°ï¼Œç”Ÿæˆä¸€ä¸ªdecoratedRunçš„Runnableï¼ˆé€šè¿‡æºç å¯ä»¥å‘ç°ï¼Œå…¶å®ä»€ä¹ˆä¹Ÿæ²¡å¹²ï¼Œå°±æ˜¯åŸæ ·è¿”å›ï¼‰\n3. é€šè¿‡decoratedRunå’Œwç”Ÿæˆä¸€ä¸ªDisposeTaskå¯¹è±¡task\n4. **é€šè¿‡Workerçš„scheduleæ–¹æ³•å¼€å§‹æ‰§è¡Œè¿™ä¸ªtaskã€‚**\n\n\nÎµ=(Â´Î¿ï½€*)))å”‰ï¼Œè¯´äº†è¿™ä¹ˆä¹…ï¼Œå­çº¿ç¨‹æ˜¯å¦‚ä½•åˆ›å»ºçš„ä¾ç„¶ä¸æ¸…æ¥šï¼Œæ— è®ºæ˜¯SubscribeTaskè¿˜æ˜¯DisposeTaskåªæ˜¯å®šä¹‰ä¼šåœ¨æŸä¸ªå­çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶ä¸ä»£è¡¨å­çº¿ç¨‹å·²è¢«åˆ›å»ºã€‚ä½†æ˜¯é€šè¿‡ä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ”¶è·ä¸€äº›æœ‰ä»·å€¼çš„ç»“è®ºï¼š\n\n- æœ€ç»ˆçš„Runnableä»»åŠ¡ï¼Œå°†ç”±æŸä¸ªå…·ä½“çš„Workerå¯¹è±¡çš„scheduler()æ–¹æ³•æ‰§è¡Œã€‚\n- è¿™ä¸ªscheduleDirectä¼šè¿”å›ä¸€ä¸ªDisposableå¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡Observerå»æ§åˆ¶æ•´ä¸ªä¸Šæ¸¸çš„æ‰§è¡Œäº†ã€‚\n\nå¥½äº†ï¼Œåˆ°è¿™é‡Œå¯¹äºsubscribeOn()æ–¹æ³•çš„åˆ†æå·²ç»åˆ°äº†å°½å¤´ï¼Œæˆ‘ä»¬æ‰¾äº†æœ€ç»ˆéœ€è¦è¿è¡Œå­ä»»åŠ¡çš„å¯¹è±¡Worker,è€Œè¿™ä¸ªWorkeræ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å…³æ³¨Workerçš„å…·ä½“å®ç°äº†ã€‚\n\nä¸‹é¢æˆ‘ä»¬å°±ä»åˆšæ‰ä¸¢ä¸‹çš„Schedulers.newThread() æ¢ä¸ªè§’åº¦æ¥åˆ†æï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ‰¾åˆ°è¿™ä¸ªWorkerçš„å…·ä½“å®ç°ã€‚\n\n\n## Schedulers.newThread()\n\nå‰é¢è¯´äº†subscribeOn()æ–¹æ³•éœ€è¦ä¸€ä¸ªScheduler ç±»å‹çš„å‚æ•°ï¼Œç„¶è€Œé€šè¿‡å‰é¢çš„åˆ†ææˆ‘ä»¬çŸ¥é“Scheduleræ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œæ˜¯æ— æ³•è¢«å®ä¾‹åŒ–çš„ã€‚å› æ­¤ï¼Œè¿™é‡Œå°±ä»Schedulersç±»å‡ºå‘ã€‚\n\n\n```java\n/**\n * Static factory methods for returning standard Scheduler instances.\n */\npublic final class Schedulers {\n}\n```\n\næ³¨é‡Šå¾ˆæ¸…æ¥šï¼Œè¿™ä¸ªSchedulerså°±æ˜¯ä¸€ä¸ªç”¨äºç”ŸæˆSchedulerå®ä¾‹çš„é™æ€å·¥å‚ã€‚\n\nä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹ï¼Œåœ¨è¿™ä¸ªå·¥å‚ä¸­newThread() ç”Ÿæˆäº†ä¸€ä¸ªä»€ä¹ˆæ ·çš„Schedulerå®ä¾‹ã€‚\n\n```java\n    @NonNull\n    public static Scheduler newThread() {\n        return RxJavaPlugins.onNewThreadScheduler(NEW_THREAD);\n    }\n\n\tNEW_THREAD = RxJavaPlugins.initNewThreadScheduler(new NewThreadTask());\n\n    static final class NewThreadTask implements Callable<Scheduler> {\n        @Override\n        public Scheduler call() throws Exception {\n            return NewThreadHolder.DEFAULT;\n        }\n    }\n\n    static final class NewThreadHolder {\n        static final Scheduler DEFAULT = new NewThreadScheduler();\n    }\n```\n\nnewThread() æ–¹æ³•ç»è¿‡å±‚å±‚å§”æ‰˜å¤„ç†(æœ€ç»ˆçš„åˆ›å»ºæ–¹å¼ï¼Œæœ‰ç‚¹å•ä¾‹æ¨¡å¼çš„æ„å‘³)ï¼Œæœ€ç»ˆæˆ‘ä»¬éœ€è¦çš„å°±æ˜¯ä¸€ä¸ªNewThreadSchedulerçš„å®ä¾‹ã€‚\n\n**NewThreadScheduler.java**\n\n```java\npublic final class NewThreadScheduler extends Scheduler {\n\n    final ThreadFactory threadFactory;\n\n    private static final String THREAD_NAME_PREFIX = \"RxNewThreadScheduler\";\n    private static final RxThreadFactory THREAD_FACTORY;\n\n    /** The name of the system property for setting the thread priority for this Scheduler. */\n    private static final String KEY_NEWTHREAD_PRIORITY = \"rx2.newthread-priority\";\n\n    static {\n        int priority = Math.max(Thread.MIN_PRIORITY, Math.min(Thread.MAX_PRIORITY,\n                Integer.getInteger(KEY_NEWTHREAD_PRIORITY, Thread.NORM_PRIORITY)));\n\n        THREAD_FACTORY = new RxThreadFactory(THREAD_NAME_PREFIX, priority);\n    }\n\n    public NewThreadScheduler() {\n        this(THREAD_FACTORY);\n    }\n\n    public NewThreadScheduler(ThreadFactory threadFactory) {\n        this.threadFactory = threadFactory;\n    }\n\n    @NonNull\n    @Override\n    public Worker createWorker() {\n        return new NewThreadWorker(threadFactory);\n    }\n}\n```\nä¸å‡ºæ‰€æ–™NewThreadScheduler æ˜¯Schedulerçš„ä¸€ä¸ªå­ç±»ï¼Œåœ¨ä»–çš„é™æ€ä»£ç å—ä¸­æ„é€ äº†ä¸€ä¸ªPriority=5çš„çº¿ç¨‹å·¥å‚ã€‚è€Œåœ¨æˆ‘ä»¬æœ€æœ€å…³æ³¨çš„**createWorker()æ–¹æ³•ä¸­ä»–åˆç”¨è¿™ä¸ªçº¿ç¨‹å·¥å‚åˆ›å»ºäº†ä¸€ä¸ªNewThreadWorker çš„å®ä¾‹**ã€‚ä¸‹é¢å°±è®©æˆ‘ä»¬çœ‹çœ‹æœ€ç»ˆçš„NewThreadWorker åšäº†äº›ä»€ä¹ˆå·¥ä½œã€‚\n\n**NewThreadWorker.java**(èŠ‚é€‰å…³é”®å†…å®¹)\n\n```java\n\npublic class NewThreadWorker extends Scheduler.Worker implements Disposable {\n    private final ScheduledExecutorService executor;\n\n    volatile boolean disposed;\n\n    public NewThreadWorker(ThreadFactory threadFactory) {\n        executor = SchedulerPoolFactory.create(threadFactory);\n    }\n\n    @NonNull\n    @Override\n    public Disposable schedule(@NonNull final Runnable run) {\n        return schedule(run, 0, null);\n    }\n\n    \n\n    @Override\n    public void dispose() {\n        if (!disposed) {\n            disposed = true;\n            executor.shutdownNow();\n        }\n    }\n\n}\n```\n\nä¼—é‡Œå¯»ä»–åƒç™¾åº¦ï¼Œç»ˆäºæ‰¾åˆ°äº†Workerçš„å®ç°äº†ï¼ŒåŒæ—¶å†ä¸€æ¬¡ä¸å‡ºæ‰€æ–™çš„åˆä¸€æ¬¡å®ç°äº†Disposableæ¥å£ï¼Œo(â•¥ï¹â•¥)oã€‚\n\n\nåœ¨å…¶æ„é€ å‡½æ•°ä¸­ï¼Œé€šè¿‡NewThreadSchedulerä¸­æä¾›çš„çº¿ç¨‹å·¥å‚threadFactoryåˆ›å»ºäº†ä¸€ä¸ªScheduledExecutorServiceã€‚\n\n\n**ScheduledExecutorService.java ---create**\n\n```java\n\n    public static ScheduledExecutorService create(ThreadFactory factory) {\n        final ScheduledExecutorService exec = Executors.newScheduledThreadPool(1, factory);\n        if (PURGE_ENABLED && exec instanceof ScheduledThreadPoolExecutor) {\n            ScheduledThreadPoolExecutor e = (ScheduledThreadPoolExecutor) exec;\n            POOLS.put(e, exec);\n        }\n        return exec;\n    }\n```\n\nç”¨å¤§åé¼é¼çš„Executors(Executorçš„å·¥å…·ç±»)ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ä¸º1çš„çº¿ç¨‹ã€‚ \n\n**è‡³æ­¤ï¼Œæˆ‘ä»¬ç»ˆäºæ‰¾åˆ°äº†ç¬¬ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œå­çº¿ç¨‹æ˜¯è°å¦‚ä½•åˆ›å»ºçš„ï¼›åœ¨NewThreadSchedulerçš„createWorker()æ–¹æ³•ä¸­ï¼Œé€šè¿‡å…¶æ„å»ºå¥½çš„çº¿ç¨‹å·¥å‚ï¼Œåœ¨Workerå®ç°ç±»çš„æ„é€ å‡½æ•°ä¸­åˆ›å»ºäº†ä¸€ä¸ªScheduledExecutorServiceçš„å®ä¾‹ï¼Œæ˜¯é€šè¿‡SchedulerPoolFactoryåˆ›å»ºçš„ã€‚**\n\nåŒæ—¶å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡æ‰§è¡Œdispose æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ScheduledExecutorServiceçš„shutdown()æ–¹æ³•ï¼Œåœæ­¢çº¿ç¨‹çš„æ‰§è¡Œã€‚\n\nçº¿ç¨‹å·²ç»åˆ›å»ºå¥½äº†ï¼Œä¸‹é¢å°±æ¥çœ‹çœ‹åˆ°åº•æ˜¯è°å¯åŠ¨äº†è¿™ä¸ªçº¿ç¨‹ã€‚å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼ŒWorkerçš„schedule()æ–¹æ³•å¦‚æœæ‰§è¡Œäº†ï¼Œå°±ä¼šæ‰§è¡Œæˆ‘ä»¬å®šä¹‰å¥½çš„Runnableï¼Œé€šè¿‡è¿™ä¸ªRunnableä¸­runæ–¹æ³•çš„æ‰§è¡Œï¼Œå°±å¯ä»¥å®ç°ä¸Šä¸‹æ¸¸è®¢é˜…å…³ç³»ã€‚ä¸‹é¢å°±æ¥çœ‹çœ‹è¿™ä¸ªscheduler()æ–¹æ³•ã€‚\n\n```java\n@NonNull\n    @Override\n    public Disposable schedule(@NonNull final Runnable action, long delayTime, @NonNull TimeUnit unit) {\n        if (disposed) {\n            return EmptyDisposable.INSTANCE;\n        }\n        return scheduleActual(action, delayTime, unit, null);\n    }\n\n    @NonNull\n    public ScheduledRunnable scheduleActual(final Runnable run, long delayTime, @NonNull TimeUnit unit, @Nullable DisposableContainer parent) {\n        Runnable decoratedRun = RxJavaPlugins.onSchedule(run);\n\n        ScheduledRunnable sr = new ScheduledRunnable(decoratedRun, parent);\n\n        if (parent != null) {\n            if (!parent.add(sr)) {\n                return sr;\n            }\n        }\n\n        Future<?> f;\n        try {\n            if (delayTime <= 0) {\n                f = executor.submit((Callable<Object>)sr);\n            } else {\n                f = executor.schedule((Callable<Object>)sr, delayTime, unit);\n            }\n            sr.setFuture(f);\n        } catch (RejectedExecutionException ex) {\n            if (parent != null) {\n                parent.remove(sr);\n            }\n            RxJavaPlugins.onError(ex);\n        }\n\n        return sr;\n    }\n```\n\nåˆ°è¿™é‡Œï¼Œå·²ç»å¾ˆæ˜æ˜¾äº†ï¼Œåœ¨schedulerActualæ–¹æ³•ä¸­ï¼Œä¼šé€šè¿‡åˆšæ‰åˆ›å»ºå¥½çš„å­çº¿ç¨‹å¯¹è±¡executoré€šè¿‡submitæˆ–scheduleæ‰§è¡Œä¸€ä¸ªRunnableä»»åŠ¡ï¼ˆè™½ç„¶è¿™ä¸ªRunnableå¯¹è±¡å†ä¸€æ¬¡ç»è¿‡äº†å„ç§è£…é¥°å’ŒåŒ…è£…ï¼Œä½†å…¶æœ¬è´¨æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼‰ï¼Œå¹¶å°†æ‰§è¡Œç»“æœå°è£…åè¿”å›ã€‚è€Œè¿™ä¸ªRunnableå¯¹è±¡è¿½æ ¹æº¯æºæ¥è¯´ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨ObservableSubscribeOnç±»ä¸­åˆ›å»ºçš„ä¸€ä¸ªSubscribeTaskå¯¹è±¡ã€‚å› æ­¤ï¼Œå½“è¿™ä¸ªå­çº¿ç¨‹å¼€å§‹è¿è¡Œçš„æ—¶å€™å°±æ˜¯æ‰§è¡ŒSubscribeTaskä¸­run()æ–¹æ³•çš„æ—¶æœºï¼›ä¸€æ—¦è¿™ä¸ªrunæ–¹æ³•æ‰§è¡Œï¼Œé‚£ä¹ˆ\n\n```java\nsource.subscribe(parent)\n```\nè¿™å¥æœ€å…³é”®çš„ä»£ç å°±å¼€å§‹æ‰§è¡Œäº†ï¼Œä¸€åˆ‡çš„ä¸€åˆ‡åˆå›åˆ°äº†æˆ‘ä»¬ä¸Šä¸€ç¯‡é‚£ç†Ÿæ‚‰çš„æµç¨‹äº†ã€‚\n\nå¥½äº†ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æµç¨‹æ‹ä¸‹æ¥ï¼Œæ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹åˆ†æ•£ï¼Œé‚£ä¹ˆå°±ç”¨UMLå›¾çœ‹çœ‹æ•´ä½“çš„ç»“æ„ã€‚\n\n\n![](https://user-gold-cdn.xitu.io/2018/1/23/16123a868c390ac1?w=1127&h=525&f=png&s=51911)\n\n\n\næˆ‘ä»¬çœ‹æœ€ä¸‹é¢çš„ObservableSubscribeOnï¼Œ**ä»–æ˜¯subscribeOn è¿”å›çš„Observableå¯¹è±¡ï¼Œä»–æŒæœ‰ä¸€ä¸ªScheduler å®ä¾‹çš„å¼•ç”¨ï¼Œè€Œè¿™ä¸ªSchedulerå®ä¾‹å°±æ˜¯NewThreadScheduler(å³Schedulers.newThreade())çš„ä¸€ä¸ªå®ä¾‹ã€‚ObservableSubscribeOn çš„subscribeActualæ–¹æ³•ï¼Œä¼šè§¦å‘NewThreadSchedulerå»æ‰§è¡ŒSubscribeTaskä¸­å®šä¹‰çš„ä»»åŠ¡ï¼Œè€Œè¿™ä¸ªå…·ä½“çš„ä»»åŠ¡åˆå°†ç”±Workerç±»åˆ›å»ºçš„å­çº¿ç¨‹å»æ‰§è¡Œã€‚è¿™æ ·å°±æŠŠä¸Šæ¸¸äº‹ä»¶æ”¾åˆ°äº†ä¸€ä¸ªå­çº¿ç¨‹ä¸­å®ç°ã€‚**\n\n\nè‡³äºæœ€åä¸€ä¸ªé—®é¢˜ï¼Œ**å¤šæ¬¡ç”¨ subscribeOn æŒ‡å®šä¸Šæ¸¸çº¿ç¨‹ä¸ºä»€ä¹ˆåªæœ‰ç¬¬ä¸€æ¬¡æœ‰æ•ˆ?**ï¼Œçœ‹å®Œé€šç¯‡å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£äº†ï¼Œå› ä¸ºä¸Šæ¸¸Observableåªæœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œå°±æ˜¯subscribe(å‡†ç¡®çš„æ¥è¯´æ˜¯subscribeActual()ï¼‰ï¼Œè€ŒsubscribeOn è¦åšçš„äº‹æƒ…å°±æ˜¯æŠŠä¸Šæ¸¸ä»»åŠ¡åˆ‡æ¢åˆ°ä¸€ä¸ªæŒ‡å®šçº¿ç¨‹é‡Œï¼Œé‚£ä¹ˆä¸€æ—¦è¢«åˆ‡æ¢åˆ°äº†æŸä¸ªæŒ‡å®šçš„çº¿ç¨‹é‡Œï¼Œåé¢çš„åˆ‡æ¢ä¸å°±æ˜¯æ²¡æœ‰æ„ä¹‰äº†å—ã€‚\n\nå¥½äº†ï¼Œè‡³æ­¤ä¸Šæ¸¸äº‹ä»¶åˆ‡æ¢åˆ°å­çº¿ç¨‹çš„è¿‡ç¨‹æˆ‘ä»¬å°±æ˜ç™½äº†ã€‚ä¸‹æ¸¸äº‹ä»¶åˆæ˜¯å¦‚ä½•åˆ‡æ¢çš„ä¸”å¬ä¸‹å›åˆ†è§£ï¼Œæœ¬æ¥æƒ³ä¸€ç¯‡å†™å®Œçš„ï¼Œç»“æœå‘ç°è¶Šå†™è¶Šå¤šï¼Œåªèƒ½åˆ†æˆä¸¤ç¯‡äº†ï¼ï¼ï¼o(â•¯â–¡â•°)oã€‚\n\n\n## å†™åœ¨åé¢çš„è¯\n\n\n####  å…³äºDisposable\n\nåœ¨RxJavaçš„åˆ†æä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°Disposableè¿™ä¸ªå•è¯ï¼Œç¡®åˆ‡çš„è¯´æ˜¯æ¥å£ï¼Œè¿™é‡Œç®€å•è¯´ä¸€è¯´è¿™ä¸ªæ¥å£ã€‚\n\n```java\n/**\n * Represents a disposable resource.\n */\npublic interface Disposable {\n    void dispose();\n    boolean isDisposed();\n}\n```\n\næˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Javaä¸­ï¼Œç±»å®ç°æŸä¸ªæ¥å£ï¼Œé€šä¿—æ¥è¯´å°±æ˜¯ä»£è¡¨è¿™ä¸ªç±»å¤šäº†ä¸€é¡¹åŠŸèƒ½ï¼Œæ¯”å¦‚ä¸€ä¸ªç±»å®ç°Serializableæ¥å£ï¼Œä»£è¡¨è¿™ä¸ªç±»æ˜¯å¯ä»¥åºåˆ—åŒ–çš„ã€‚è¿™é‡ŒDisposableä¹Ÿæ˜¯ä»£è¡¨ä¸€ç§èƒ½åŠ›ï¼Œè¿™ä¸ªèƒ½åŠ›å°±æ˜¯Disposableï¼Œå°±æ˜¯ä»£è¡¨ä¸€æ¬¡æ€§çš„ï¼Œç”¨åå°±ä¸¢å¼ƒçš„ï¼Œæ¯”å¦‚ä¸€æ¬¡æ€§ç­·å­ï¼Œè¿˜æœ‰é‚£å•¥ã€‚\n\nåœ¨RxJavaä¸­å¾ˆå¤šç±»éƒ½å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼ŒisDisposed()é¡¾åæ€ä¹‰è¿”å›å½“å‰ç±»æ˜¯å¦è¢«æŠ›å¼ƒï¼Œdispose()å°±æ˜¯ä¸»åŠ¨æŠ›å¼ƒã€‚å› æ­¤ï¼Œæ‰€æœ‰å®ç°äº†è¿™ä¸ªæ¥å£çš„ç±»ï¼Œéƒ½æ‹¥æœ‰äº†è¿™æ ·ä¸€ç§èƒ½åŠ›ï¼Œå°±æ˜¯å¯ä»¥åˆ¤æ–­è‡ªå·±æ˜¯å¦è¢«æŠ›å¼ƒï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¸»åŠ¨æŠ›å¼ƒè‡ªå·±ã€‚\n\nä¸Šä¸€ç¯‡æˆ‘ä»¬è¯´äº†ï¼ŒObserveré€šè¿‡onSubscribe(@NonNull Disposable d)ï¼Œä¼šè·å¾—ä¸€ä¸ªDisposableï¼Œè¿™æ ·å°±æœ‰èƒ½åŠ›æ§åˆ¶ä¸Šæ¸¸çš„äº‹ä»¶å‘é€äº†ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸éš¾ç†è§£ï¼Œä¸ºä»€ä¹ˆé‚£ä¹ˆå¤šç±»å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œå› ä¸ºä¸‹æ¸¸è·å–åˆ°çš„æ˜¯ä¸€ä¸ªæ‹¥æœ‰Disposableçš„å¯¹è±¡ï¼Œè€Œä¸€æ—¦æ‹¥æœ‰äº†ä¸€ä¸ªè¿™æ ·çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ä¸‹æ¸¸æ§åˆ¶ä¸Šæ¸¸äº†ã€‚å¯ä»¥è¯´ï¼Œè¿™æ˜¯RxJavaå¯¹å¸¸è§„çš„è§‚å¯Ÿè€…æ¨¡å¼æ‰€åšçš„æœ€ç»™åŠ›çš„æ”¹å˜ã€‚\n\n\n#### å…³äºå„ç§ObservableXXX ,subscribeXXX,ObserverXXX \n\nåœ¨æŸ¥çœ‹RxJavaçš„æºç æ—¶ï¼Œå¯èƒ½å¾ˆå¤šäººéƒ½å’Œæˆ‘ä¸€æ ·ï¼Œæœ‰ä¸€ä¸ªå·¨å¤§çš„å›°æ‰°ï¼Œå°±æ˜¯è¿™äº›ç±»çš„åå­—å¥½ä»–å¦ˆéš¾è®°ï¼Œæ„Ÿè§‰é•¿å¾—éƒ½å·®ä¸å¤šï¼Œå…³é”®å¿µèµ·æ¥å¥½åƒä¹Ÿå·®ä¸å¤šã€‚ä½†å…¶å®æœ¬è´¨ä¸Šæ¥è¯´ï¼ŒRxJavaå¯¹ç±»çš„å‘½åè¿˜æ˜¯éå¸¸è§„èŒƒçš„ï¼Œåªæ˜¯æˆ‘ä»¬ä¸å¤ªä¹ æƒ¯è€Œå·²ã€‚æŒ‰ç…§è‹±æ–‡å•è¯ç¿»è¯‘ï¼š\n\n- Observable å¯è§‚å¯Ÿçš„ï¼ˆä¸»é¢˜ ï¼Œä¸Šæ¸¸ï¼‰\n- Observer   è§‚å¯Ÿè€… ï¼ˆè®¢é˜…è€…ï¼Œä¸‹æ¸¸ï¼‰\n- Subscribe  è®¢é˜…\n\nå…¶å®å°±è¿™ä¹ˆä¸‰ä¸ªä¸»è¯­ï¼Œå…¶ä»–çš„ä»€ä¹ˆObservableCreateï¼ŒObservableSubscribeOnï¼ŒAbstractObservableWithUpstreamï¼Œè¿˜æœ‰ä¸Šé¢æåˆ°çš„Disposableï¼Œéƒ½æ˜¯å¯¹å„ç§å„æ ·çš„Observableå’ŒObserverçš„å˜å½¢å’Œä¿®é¥°ç»“æœï¼Œåªè¦ç†è§£è¿™ä¸ªç±»çš„æ ¸å¿ƒå«ä¹‰æ˜¯ä»€ä¹ˆï¼Œå°±ä¸ä¼šè¢«è¿™äº›åå­—ææ™•äº†ã€‚\n\n\nRxJava å¯ä»¥è¯´æ˜¯åšå¤§ç²¾æ·±ï¼Œä»¥ä¸Šæ‰€æœ‰åˆ†æå®Œå…¨æ˜¯ä¸ªäººå¹³æ—¶ä½¿ç”¨æ—¶çš„æ€»ç»“ä¸æ„Ÿæ‚Ÿï¼Œæœ‰ä»»ä½•é”™è¯¯ä¹‹å¤„ï¼Œè¿˜æœ›å„ä½è¯»è€…æå‡ºï¼Œå…±åŒè¿›æ­¥ã€‚\n\nå…³äºRxJava è¿™é‡Œå¢™è£‚æ¨èä¸€ç¯‡æ–‡ç« [ä¸€ç¯‡ä¸å¤ªä¸€æ ·çš„RxJavaä»‹ç»](https://juejin.im/post/5a2549576fb9a04519696d45)ï¼Œæ„Ÿè§‰æ˜¯è‡ªæ‰”ç‰©çº¿é‚£ç¯‡ä¹‹åï¼Œå¯¹RxJavaæ€æƒ³æ„Ÿæ‚Ÿæœ€æ·±çš„ä¸€ç¯‡äº†ã€‚å¯¹RxJava æœ‰å…´è¶£çš„åŒå­¦ï¼Œå¯ä»¥å¤šåº¦å‡ éï¼Œæ¯æ¬¡éƒ½ä¼šæœ‰æ”¶è·ï¼ï¼\n\n***\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["RxJava2"],"categories":["Android è¿›é˜¶"]},{"title":"ä»è§‚å¯Ÿè€…æ¨¡å¼å‡ºå‘ï¼ŒèŠèŠRxJava2","url":"%2F2018%2F01%2F12%2F%E4%BB%8E%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E5%87%BA%E5%8F%91%EF%BC%8C%E8%81%8A%E8%81%8ARxJava%2F","content":"\n\n## å‰è¨€\n\n### RxJava æ˜¯ä»€ä¹ˆ\n\n>RxJava â€“ Reactive Extensions for the JVM â€“ a library for composing asynchronous and event-based programs using observable sequences for the Java VM.\n\nä»¥ä¸Šæ˜¯RxJavaåœ¨[Github](https://github.com/ReactiveX/RxJava)ä¸Šçš„ä»‹ç»ï¼Œå¤§æ¦‚æ„æ€æ˜¯ï¼Œ**é’ˆå¯¹äºJVM(Javaè™šæ‹Ÿæœºï¼‰çš„å“åº”å¼æ‰©å±•å®ç°ï¼Œä¸€ä¸ªåœ¨Java VMä¸Šä½¿ç”¨å¯è§‚å¯Ÿçš„åºåˆ—æ¥ç»„åˆå®ç°å¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶ç¼–ç¨‹çš„åº“ã€‚**\n\n<!--more-->\n\nRxJavaç°åœ¨å¤§å®¶ç”¨çš„éƒ½åº”è¯¥å·²ç»å¾ˆæºœäº†ï¼Œç”¨æ³•è¿™é‡Œå°±ä¸å†å¤šè¯´äº†ã€‚æˆ‘ä»¬éƒ½çŸ¥é“RxJavaæ˜¯å¯¹**è§‚å¯Ÿè€…æ¨¡å¼**çš„æ‰©å±•ï¼Œä¸‹é¢å°±ä»è§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°æœºåˆ¶å‡ºå‘ï¼Œäº†è§£ä¸€ä¸‹RxJava2çš„å®ç°é€»è¾‘ã€‚åªæœ‰çœŸæ­£äº†è§£äº†RxJava çš„å®ç°åŸç†ï¼Œæˆ‘ä»¬æ‰èƒ½åœ¨é‡åˆ°é—®é¢˜çš„æ—¶å€™ï¼Œæ›´å¿«é€Ÿæ›´å‡†ç¡®çš„å®šä½çš„åˆ°é—®é¢˜ã€‚\n\n> æ­¤æ¬¡æºç åˆ†æåŸºäº [RxJava Release 2.1.7](https://github.com/ReactiveX/RxJava/releases/tag/v2.1.7)\n\n\n### è§‚å¯Ÿè€…æ¨¡å¼\n\nè¿™é‡Œç®€å•å›é¡¾ä¸€ä¸‹è§‚å¯Ÿè€…æ¨¡å¼çš„ç»„æˆåŠä½¿ç”¨æ–¹å¼ï¼Œé€šè¿‡ä¹‹å‰[è§‚å¯Ÿè€…æ¨¡å¼](https://www.jianshu.com/p/6fcce09cc1ce)ä¸€æ–‡ä¸­çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“è§‚å¯Ÿè€…æ¨¡å¼ä¸­æœ‰å››ä¸ªé‡è¦çš„è§’è‰²ï¼š\n\n- æŠ½è±¡ä¸»é¢˜ï¼š**å®šä¹‰æ·»åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯æ³¨å†Œå’Œè§£é™¤æ³¨å†Œçš„åŠŸèƒ½**\n- æŠ½è±¡è§‚å¯Ÿè€…ï¼š**å®šä¹‰è§‚å¯Ÿè€…æ”¶åˆ°ä¸»é¢˜é€šçŸ¥åè¦åšä»€ä¹ˆäº‹æƒ…**\n- å…·ä½“ä¸»é¢˜ï¼š**æŠ½è±¡ä¸»é¢˜çš„å®ç°**\n- å…·ä½“è§‚å¯Ÿè€…ï¼š**æŠ½è±¡è§‚å¯Ÿè€…çš„å®ç°**\n\nå½“æˆ‘ä»¬åˆ›å»ºå¥½äº†å…·ä½“ä¸»é¢˜å’Œè§‚å¯Ÿè€…ç±»ï¼Œå°±å¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼äº†ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„æµ‹è¯•demoã€‚\n\n```java\npublic class TestObservePattern {\n\n    public static void main(String[] args) {\n\t\t// åˆ›å»ºä¸»é¢˜(è¢«è§‚å¯Ÿè€…)\n        ConcreteSubject concreteSubject = new ConcreteSubject();\n\t\t// åˆ›å»ºè§‚å¯Ÿè€…\n        ObserverOne observerOne=new ObserverOne();\n        // ä¸ºä¸»é¢˜æ·»åŠ è§‚å¯Ÿè€…\n        concreteSubject.addObserver(observerOne);        \n        //ä¸»é¢˜é€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…\n        concreteSubject.notifyAllObserver(\"wake up,wake up\");\n    }\n\n}\n```\n\nä»¥ä¸Šå°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„ä½¿ç”¨æ–¹å¼ï¼Œå¾ˆç®€å•æ˜¯å§ã€‚ç°åœ¨å°±è®©æˆ‘ä»¬å¸¦ç€ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼Œçœ‹çœ‹RxJavaæ˜¯å¦‚ä½•ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼çš„ã€‚\n\nç”¨RxJavaè¿™ä¹ˆä¹…äº†ï¼Œä½ å¯ä»¥æ€è€ƒä¸€ä¸‹å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š\n\n1. RxJava ä¸­ä¸Šé¢æåˆ°çš„å››ä¸ªé‡è¦è§’è‰²æ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Ÿ\n2. RxJava ä¸­å…·ä½“çš„ä¸»é¢˜ï¼Œå…·ä½“çš„è§‚å¯Ÿè€…æ˜¯å¦‚ä½•å®ä¾‹åŒ–çš„ï¼Ÿ\n3. RxJava ä¸­è§‚å¯Ÿè€…å’Œä¸»é¢˜æ˜¯å¦‚ä½•å®ç°è®¢é˜…çš„ï¼Ÿ\n4. RxJava ä¸­ä¸Šæ¸¸æ˜¯æ€ä¹ˆå‘é€äº‹ä»¶çš„ï¼Œä¸‹æ¸¸åˆæ˜¯æ€æ ·æ¥æ”¶åˆ°çš„?\n5. RxJava ä¸­å¯¹å¸¸è§„çš„è§‚å¯Ÿè€…æ¨¡å¼åšäº†æ€æ ·è°ƒæ•´ï¼Œå¸¦æ¥äº†ä»€ä¹ˆå¥½å¤„ï¼Ÿ\n\n*å¦‚æœå¯¹ä»¥ä¸Šå‡ ä¸ªé—®é¢˜ï¼Œä½ æœ‰æ˜ç¡®çš„ç­”æ¡ˆï¼Œæ­å–œä½ ï¼Œä»¥ä¸‹å†…å®¹ä½ å°±ä¸ç”¨å†çœ‹äº†ï¼ŒO(âˆ©_âˆ©)Oå“ˆå“ˆ~ã€‚*\n\n>å¾ˆå¤šå¼€å‘è€…å¯¹RxJavaçš„å­¦ä¹ å¯èƒ½æ˜¯ä»**ä¸Šæ¸¸**å’Œ**ä¸‹æ¸¸**çš„è§’åº¦å¼€å§‹ï¼Œè¿™é‡Œå¯ä»¥è®¤ä¸ºè¿™æ ·çš„å™è¿°æ›´åé‡RxJava äº‹ä»¶åºåˆ—çš„ç‰¹å¾ã€‚æœ¬æ–‡ä»**è¢«è§‚å¯Ÿè€…ï¼ˆä¸»é¢˜ï¼‰**å’Œ**è§‚å¯Ÿè€…**çš„è§’åº¦å‡ºå‘ï¼Œå¯ä»¥è¯´æ˜¯æ›´åå‘äºRxJava è§‚å¯Ÿè€…æ¨¡å¼çš„ç‰¹å¾ã€‚è¿™é‡Œçš„ä¸»é¢˜å°±æ˜¯ä¸Šæ¸¸ï¼Œè§‚å¯Ÿè€…å°±æ˜¯ä¸‹æ¸¸ã€‚æ— è®ºä»å“ªä¸ªè§’åº¦å‡ºå‘å»ç†è§£ï¼Œæºç å°±é‚£ä¹ˆä¸€ä»½ï¼Œæ— æ‰€è°“å¯¹é”™ï¼Œåªæ˜¯æ¯ä¸ªäººçš„è®¤çŸ¥è§’åº¦ä¸åŒè€Œå·²ï¼Œé€‰æ‹©ä¸€ç§è‡ªå·±æ›´å®¹æ˜“äº†è§£çš„æ–¹å¼å³å¯ã€‚\n\nå¥½äº†ï¼Œå¦‚æœä½ çœ‹åˆ°äº†è¿™é‡Œï¼Œè¯´æ˜ä½ å¯¹ä»¥ä¸Šå‡ ä¸ªé—®é¢˜ï¼Œè¿˜æœ‰äº›è®¸ç–‘é—®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä»è¿™å‡ ä¸ªé—®é¢˜å‡ºå‘ï¼Œäº†è§£ä¸€ä¸‹RxJavaçš„æºç å®ç°ã€‚\n\n## RxJava2 çš„è§‚å¯Ÿè€…æ¨¡å¼å®ç°\n\næˆ‘ä»¬å°±å¸¦ç€ä¸Šè¿°å‡ ä¸ªé—®é¢˜ï¼Œä¾æ¬¡æ¥çœ‹çœ‹RxJavaåˆ°åº•æ˜¯æ€ä¹ˆä¸€å›äº‹å„¿ã€‚ä¸ºäº†æ–¹ä¾¿å™è¿°å’Œè®°å¿†ï¼Œæˆ‘ä»¬é¦–å…ˆçœ‹ä¸€æ®µRxJava2 æœ€æœ€åŸºç¡€çš„ä½¿ç”¨æ–¹å¼ã€‚\n\n\n```java\nprivate void basicRxjava2() {\n        Observable mObservable = Observable.create(new ObservableOnSubscribe() {\n            @Override\n            public void subscribe(ObservableEmitter e) throws Exception {\n                e.onNext(\"1\");\n                e.onNext(\"2\");\n                e.onNext(\"3\");\n                e.onNext(\"4\");\n                e.onComplete();\n            }\n        });\n\n        Observer mObserver = new Observer() {\n            @Override\n            public void onSubscribe(Disposable d) {\n                Log.e(TAG, \"onSubscribe: d=\" + d);\n                sb.append(\"\\nonSubcribe: d=\" + d);\n            }\n\n            @Override\n            public void onNext(Object s) {\n                Log.e(TAG, \"onNext: \" + s);\n                sb.append(\"\\nonNext: \" + s);\n            }\n\n            @Override\n            public void onError(Throwable e) {\n                Log.e(TAG, \"onError: \" + e);\n                sb.append(\"\\nonError: \" + e.toString());\n                logContent.setText(sb.toString());\n            }\n\n            @Override\n            public void onComplete() {\n                Log.e(TAG, \"onComplete\");\n                sb.append(\"\\nonComplete: \");\n                logContent.setText(sb.toString());\n            }\n        };\n\n        mObservable.subscribe(mObserver);\n    }\n```\n\nä¸Šé¢è¿™æ®µä»£ç ï¼Œåº”è¯¥å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œè¾“å‡ºç»“æœå¤§å®¶é—­ç€çœ¼ç›ä¹Ÿèƒ½æƒ³å‡ºæ¥å§ã€‚æˆ‘ä»¬å°±ä»¥è¿™æ®µä»£ç ä¸ºåŸºç¡€ï¼Œç»“åˆä¸Šé¢æåˆ°çš„é—®é¢˜ä¾æ¬¡å±•å¼€å¯¹RxJavaçš„åˆ†æã€‚\n\n#### å››ä¸ªé‡è¦çš„è§’è‰²\n\né¦–å…ˆçœ‹çœ‹RxJava ä¸­å››ä¸ªé‡è¦çš„è§’è‰²æ˜¯å¦‚ä½•å®šä¹‰çš„ã€‚\n\n- æŠ½è±¡ä¸»é¢˜\n\né¦–å…ˆå¯ä»¥çœ‹çœ‹è¿™ä¸ªObservableç±»ã€‚\n\n```java\npublic abstract class Observable<T> implements ObservableSource<T> {\nâ€¦â€¦\n}\n```\nä»–å®ç°äº†ObservableSourceæ¥å£ï¼Œæ¥ç€çœ‹ObservableSource\n\n```java\npublic interface ObservableSource<T> {\n\n    /**\n     * Subscribes the given Observer to this ObservableSource instance.\n     * @param observer the Observer, not null\n     * @throws NullPointerException if {@code observer} is null\n     */\n    void subscribe(@NonNull Observer<? super T> observer);\n}\n```\n\nè¿™é‡Œå¾ˆæ˜æ˜¾äº†ï¼ŒObservableSource å°±æ˜¯æŠ½è±¡ä¸»é¢˜ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰çš„è§’è‰²ã€‚æŒ‰ç…§ä¹‹å‰è§‚å¯Ÿè€…æ¨¡å¼ä¸­çº¦å®šçš„èŒè´£ï¼Œsubscribe æ–¹æ³•å°±æ˜¯ç”¨æ¥å®ç°è®¢é˜…è§‚å¯Ÿè€…ï¼ˆObserverï¼‰è§’è‰²çš„åŠŸèƒ½ã€‚ä»è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºï¼ŒæŠ½è±¡è§‚å¯Ÿè€…çš„è§’è‰²å°±æ˜¯Observeräº†ã€‚\n\nè¿™é‡Œï¼Œä½ ä¹Ÿè®¸ä¼šæœ‰ç–‘é—®ï¼Œè¿™ä¹ˆç®€å•ï¼ŸæŠ½è±¡ä¸»é¢˜ï¼ˆä¸Šæ¸¸ï¼‰ä¸æ˜¯éœ€è¦å‘é€äº‹ä»¶å—ï¼ŸonNext(),onComplete()ä»¥åŠonError()è·‘å“ªå„¿å»äº†ï¼Ÿåˆ«ç€æ€¥ï¼Œæˆ‘ä»¬åé¢æ…¢æ…¢çœ‹ã€‚\n\n- å…·ä½“ä¸»é¢˜\n\nå›è¿‡å¤´æ¥ç»§ç»­çœ‹Observableï¼Œä»–å®ç°äº†ObservableSourceæ¥å£ï¼Œå¹¶ä¸”å®ç°äº†å…¶subscribeæ–¹æ³•ï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰çœŸæ­£çš„å»å®Œæˆ**ä¸»é¢˜**å’Œ**è§‚å¯Ÿè€…**ä¹‹é—´çš„è®¢é˜…å…³ç³»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªåŠŸèƒ½ï¼Œè½¬æ¥ç»™äº†å¦ä¸€ä¸ªæŠ½è±¡æ–¹æ³•subscribeActualï¼ˆå…·ä½“ç»†èŠ‚åé¢åˆ†æï¼‰ã€‚\n\nå› æ­¤ï¼ŒObservableä¾æ—§æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬çŸ¥é“**æŠ½è±¡ç±»æ˜¯ä¸èƒ½è¢«å®ä¾‹åŒ–çš„**ï¼Œå› æ­¤ä»ç†è®ºä¸Šæ¥è¯´ï¼Œä»–å¥½åƒä¸èƒ½ä½œä¸ºå…·ä½“ä¸»é¢˜çš„è§’è‰²ã€‚å…¶å®ä¸ç„¶ï¼ŒObservableå†…éƒ¨æä¾›äº†create,defer,fromXXX,repeat,justç­‰ä¸€ç³»åˆ—**åˆ›å»ºå‹æ“ä½œç¬¦**ï¼Œ ç”¨æ¥åˆ›å»ºå„ç§Observableã€‚\n```java\n    public static <T> Observable<T> create(ObservableOnSubscribe<T> source) {\n        ObjectHelper.requireNonNull(source, \"source is null\");\n        return RxJavaPlugins.onAssembly(new ObservableCreate<T>(source));\n    }\n```\n\n\nåœ¨RxJavaå†…æœ‰å¾ˆå¤šä»–çš„å­ç±»ã€‚\n\n\n![Observableå­ç±»](https://user-gold-cdn.xitu.io/2018/1/7/160d0dafe04868f6?w=669&h=509&f=png&s=53479)\n\nè¯šç„¶ï¼Œä½ å¯ä»¥è®¤ä¸ºï¼Œè¿™äº›å­ç±»å…¶å®æ‰æ˜¯çœŸæ­£çš„å…·ä½“ä¸»é¢˜ã€‚ä½†æ˜¯ï¼Œæ¢ä¸€ä¸ªè§’åº¦ï¼Œä»[ä»£ç†æ¨¡å¼](https://juejin.im/post/5a4e4725f265da3e2c37e36e)çš„è§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠObservableå½“åšæ˜¯ä¸€ä¸ªä»£ç†ç±»ï¼Œå®¢æˆ·ç«¯ä½ åªç®¡è°ƒç”¨create æ–¹æ³•ï¼Œæƒ³è¦ä»€ä¹ˆæ ·çš„\nObservableå‘Šè¯‰æˆ‘ä¸€å£°å°±å¯ä»¥ï¼Œä¸åŒObservableä¹‹é—´çš„å·®å¼‚ä½ ä¸ç”¨ç®¡ï¼ŒåŒ…åœ¨æˆ‘èº«ä¸Šï¼Œä¿è¯ç»™ä½ è¿”å›ä½ æƒ³è¦çš„Observableå®ä¾‹ã€‚\n\nåŒæ—¶ï¼ŒObservableå¦ä¸€ä¸ªå·¨å¤§çš„è´¡çŒ®ï¼Œå°±æ˜¯å®šä¹‰äº†å¾ˆå¤šçš„æ“ä½œç¬¦ï¼Œæˆ‘ä»¬å¹³æ—¶å¸¸ç”¨çš„map,flatMap,distinctç­‰ï¼Œä¹Ÿæ˜¯åœ¨è¿™é‡Œå®šä¹‰ã€‚å¹¶ä¸”è¿™äº›æ–¹æ³•éƒ½æ˜¯finalç±»å‹çš„ï¼Œå› æ­¤ä»–çš„æ‰€æœ‰å­ç±»éƒ½ä¼šç»§æ‰¿åŒæ—¶ä¹Ÿæ— æ³•æ”¹å˜è¿™äº›æ“ä½œç¬¦çš„å®ç°ã€‚\n\nå› æ­¤ï¼ŒObservable å°±æ˜¯å…·ä½“ä¸»é¢˜ã€‚\n\n- æŠ½è±¡è§‚å¯Ÿè€…\n\nåœ¨æŠ½è±¡ä¸»é¢˜é‡Œå·²ç»æè¿‡äº†ï¼ŒObserverå°±æ˜¯æŠ½è±¡è§‚å¯Ÿè€…çš„è§’è‰²ã€‚\n\n```java\npublic interface Observer<T> {\n\n    void onSubscribe(@NonNull Disposable d);\n\n    void onNext(@NonNull T t);\n\n    void onError(@NonNull Throwable e);\n\n    void onComplete();\n\n}\n\n```\n\néå¸¸ç¬¦åˆè§‚å¯Ÿè€…æ¨¡å¼ä¸­æŠ½è±¡è§‚å¯Ÿè€…çš„èŒè´£æè¿°ï¼ŒObserver å®šä¹‰äº†è§‚å¯Ÿè€…ï¼ˆä¸‹æ¸¸ï¼‰æ”¶åˆ°ä¸»é¢˜ï¼ˆä¸Šæ¸¸ï¼‰é€šçŸ¥åè¯¥åšä»€ä¹ˆäº‹æƒ…ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯onSubscribe ä¹Ÿæ˜¯å®šä¹‰åœ¨è¿™é‡Œçš„ã€‚\n\n\n- å…·ä½“çš„è§‚å¯Ÿè€…\n\nè¿™ä¸ªå…·ä½“çš„è§‚å¯Ÿè€…ï¼Œo(â•¯â–¡â•°)oo(â•¯â–¡â•°)oï¼Œå°±ä¸å¤šè¯´äº†å§ã€‚å¤§å®¶å¹³æ—¶ä½¿ç”¨åº”è¯¥éƒ½æ˜¯ç›´æ¥ç”¨newä¸€ä¸ªObserverçš„å®ä¾‹ã€‚RxJavaå†…éƒ¨æœ‰å¾ˆå¤šObserverçš„å­ç±»ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å…·ä½“äº†è§£ä¸€ä¸‹ã€‚è¿™é‡Œå…¶å®å¯ä»¥å¼•ç”³å‡ºä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜ï¼ŒåŒæ ·æ˜¯æŠ½è±¡ç±»ï¼Œä¸ºä»€ä¹ˆæ¥å£å¯ä»¥ç›´æ¥å®ä¾‹åŒ–ï¼Œè€Œç”¨abstractä¿®é¥°è¿‡çš„ç±»å°±ä¸å¯ä»¥ï¼Ÿ\n\n#### å…·ä½“çš„è§‚å¯Ÿè€…æ˜¯å¦‚ä½•å®ä¾‹åŒ–çš„\n\næˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™æ®µä»£ç ï¼š\n\n```java\n    Observable mObservable = Observable.create(new ObservableOnSubscribe() {\n            @Override\n            public void subscribe(ObservableEmitter e) throws Exception {\n            }\n        });\n\n    public static <T> Observable<T> create(ObservableOnSubscribe<T> source) {\n        ObjectHelper.requireNonNull(source, \"source is null\");\n        return RxJavaPlugins.onAssembly(new ObservableCreate<T>(source));\n    }\n\t\n\t\n    public static <T> Observable<T> onAssembly(@NonNull Observable<T> source) {\n        Function<? super Observable, ? extends Observable> f = onObservableAssembly;\n\t\t// æ˜¯å¦æœ‰åˆ«çš„å…¶ä»–æ“ä½œç¬¦è¿ç®—ï¼Œæœ‰çš„è¯ï¼Œåœ¨æ­¤Observableä¸Šæ‰§è¡Œä¸€é\n        if (f != null) {\n            return apply(f, source);\n        }\n        return source;\n    }\n\n```\n\n**RxJavaçš„ä»£ç é‡Œï¼Œå¾ˆå¤šæ—¶å€™ä¼šæœ‰ObjectHelper.requireNonNullè¿™ç§ç©ºæ£€æŸ¥çš„åœ°æ–¹ï¼Œä¸€å¾‹éƒ½æ˜¯ä¸ºäº†æœ€å¤§ç¨‹åº¦çš„é˜²æ­¢NPEçš„å‡ºç°ï¼Œåé¢å‡ºç°å°±ä¸å†èµ˜è¿°äº†**.\n\næˆ‘ä»¬ä½¿ç”¨createæ“ä½œç¬¦åˆ›å»ºObservableçš„è¿‡ç¨‹ä¸­ï¼Œçœ‹ä¼¼ç»å†äº†å¾ˆå¤šæ–¹æ³•ï¼Œ**åœ¨ä¸è€ƒè™‘ä»»ä½•å…¶ä»–æ“ä½œç¬¦çš„å‰æä¸‹**ï¼Œæ•´ä¸ªè¿‡ç¨‹ç®€åŒ–ä¸€ä¸‹çš„è¯å°±è¿™ä¹ˆä¸€å¥ä»£ç \n\n```java\n  Observable mObservable=new ObservableCreate(new ObservableOnSubscribe())\n```\nä»ä¹‹å‰çš„åˆ†æï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†ObservableCreate å°±æ˜¯ObserveableæŠ½è±¡ç±»çš„ä¸€ä¸ªå­ç±»ã€‚æˆ‘ä»¬ç®€å•çœ‹ä¸€ä¸‹ä»–çš„å®ç°ã€‚\n\n```java\npublic final class ObservableCreate<T> extends Observable<T> {\n    final ObservableOnSubscribe<T> source;\n\n    public ObservableCreate(ObservableOnSubscribe<T> source) {\n        this.source = source;\n    }\n\n    @Override\n    protected void subscribeActual(Observer<? super T> observer) {\n        â€¦â€¦\n    }\n}\n\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œä»–å”¯ä¸€çš„æ„é€ å‡½æ•°éœ€è¦ä¸€ä¸ªObservableOnSubscribeå®ä¾‹ï¼ŒåŒæ—¶ä»–å®ç°subscribeActualæ–¹æ³•ï¼Œè¯´æ˜ä»–çœŸæ­£å¤„ç†**ä¸»é¢˜**å’Œ**è§‚å¯Ÿè€…**ä¹‹é—´å®ç°è®¢é˜…çš„é€»è¾‘ã€‚\n\nçœ‹äº†åŠå¤©ï¼Œä½ å¯èƒ½ä¸€ç›´å¾ˆå¥½å¥‡ï¼Œè¿™ä¸ªObservableOnSubscribeæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿä»–å…¶å®å¾ˆç®€å•ã€‚\n\n```java\n/**\n * A functional interface that has a {@code subscribe()} method that receives\n * an instance of an {@link ObservableEmitter} instance that allows pushing\n * events in a cancellation-safe manner.\n *\n * @param <T> the value type pushed\n */\npublic interface ObservableOnSubscribe<T> {\n\n    /**\n     * Called for each Observer that subscribes.\n     * @param e the safe emitter instance, never null\n     * @throws Exception on error\n     */\n    void subscribe(@NonNull ObservableEmitter<T> e) throws Exception;\n}\n```\n\nÎµ=(Â´Î¿ï½€*)))å”‰ï¼Œæ€ä¹ˆåˆä¸€ä¸ªsubscribeï¼Œè¿™åˆæ˜¯å•¥ï¼Ÿä¸è¦æ…Œï¼Œçœ‹æ³¨é‡Šã€‚æ„æ€æ˜¯è¯´ï¼Œè¿™é‡Œçš„subscribe æ¥æ”¶åˆ°ä¸€ä¸ªObservableEmitterå®ä¾‹åï¼Œå°±ä¼šå…è®¸ä»–ä»¥ä¸€ç§å¯ä»¥å®‰å…¨å–æ¶ˆï¼ˆä¹Ÿå°±æ˜¯ä¸€å®šèƒ½å–æ¶ˆï¼‰çš„å½¢å¼å‘é€äº‹ä»¶ã€‚\n\n**å°±æ˜¯è¯´ä¼šæœ‰æŸä¸ªå¯¹è±¡ï¼Œç»™ä»–ä¸€ä¸ªObservableEmitteçš„å®ä¾‹ï¼Œæ²¡ç»™ä»–ä¹‹å‰ä»–æ˜¯ä¸ä¼šä¸»åŠ¨å‘é€äº‹ä»¶çš„ï¼Œä¼šä¸€ç›´æ†‹ç€ã€‚**ï¼Œåˆ°è¿™é‡Œï¼Œä½ æ˜¯ä¸æ˜¯æƒ³åˆ°äº†ä»€ä¹ˆï¼Œæˆ‘ä»¬çŸ¥é“åœ¨RxJava ä¸­åªæœ‰è§‚å¯Ÿè€…ï¼ˆä¸‹æ¸¸ï¼‰è®¢é˜…(subscribe)äº†ä¸»é¢˜ï¼ˆä¸Šæ¸¸ï¼‰ï¼Œä¸»é¢˜æ‰ä¼šå‘é€äº‹ä»¶ã€‚è¿™å°±æ˜¯å’Œæ™®é€šçš„è§‚å¯Ÿè€…æ¨¡å¼æœ‰åŒºåˆ«çš„åœ°æ–¹ä¹‹ä¸€ã€‚\n\nå¥½äº†ï¼Œæœ€åå†æ¥çœ‹çœ‹è¿™ä¸ªç¥ç§˜çš„ObservableEmitteræ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼Ÿ\n\n```java\npublic interface ObservableEmitter<T> extends Emitter<T> {\n\n    void setDisposable(@Nullable Disposable d);\n\n\n    void setCancellable(@Nullable Cancellable c);\n\n\n    boolean isDisposed();\n\n    ObservableEmitter<T> serialize();\n\n      /**\n     * Attempts to emit the specified {@code Throwable} error if the downstream\n     * hasn't cancelled the sequence or is otherwise terminated, returning false\n     * if the emission is not allowed to happen due to lifecycle restrictions.\n     * <p>\n     * Unlike {@link #onError(Throwable)}, the {@code RxJavaPlugins.onError} is not called\n     * if the error could not be delivered.\n     * @param t the throwable error to signal if possible\n     * @return true if successful, false if the downstream is not able to accept further\n     * events\n     * @since 2.1.1 - experimental\n     */\n    boolean tryOnError(@NonNull Throwable t);\n}\n```\n\n**è¿™é‡Œå¯ä»¥å…³æ³¨ä¸€ä¸‹tryOnErrorè¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°ä»–ä¼šæŠŠæŸäº›ç±»å‹çš„errorä¼ é€’åˆ°ä¸‹æ¸¸ã€‚**\n\no(â•¥ï¹â•¥)oï¼Œåˆæ˜¯ä¸€ä¸ªæ¥å£ï¼Œè€Œä¸”è¿˜ç»§æ‰¿äº†å¦ä¸€ä¸ªæ¥å£ï¼Œä»€ä¹ˆæƒ…å†µï¼Ÿç»§ç»­çœ‹\n\n```java\npublic interface Emitter<T> {\n\n    void onNext(@NonNull T value);\n\n  \n    void onError(@NonNull Throwable error);\n\n   \n    void onComplete();\n}\n```\n\næƒŠä¸æƒŠå–œï¼Œæ„ä¸æ„å¤–ï¼Ÿ å“ˆå“ˆï¼Œç»ˆäºæ‰¾åˆ°ä½ äº†ï¼Œç†Ÿæ‚‰çš„onNextï¼ŒonError,onComplete.åŸæ¥åœ¨è¿™é‡Œã€‚\n\n**è¿™é‡Œæœ‰ä¸ªé—®é¢˜å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œåœ¨æŠ½è±¡è§‚å¯Ÿè€…ä¸­ï¼Œå®šä¹‰äº†å››ä¸ªå¤„ç†äº‹ä»¶çš„æ–¹æ³•ï¼Œè¿™é‡Œåªæœ‰ä¸‰ä¸ªï¼ŒæŒ‰ç…§å¯¹åº”å…³ç³»æ¥è¯´ä¼¼ä¹ç¼ºäº†ä¸€ä¸ªonSubscribeï¼Œè¿™åˆæ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿåé¢ä¼šæœ‰åˆ†æï¼Œå¯ä»¥è‡ªå·±å…ˆæƒ³æƒ³**\n\nè¿™ä¸¤ä¸ªæ¥å£çš„å«ä¹‰å¾ˆæ˜æ˜¾äº†ï¼Œæ€»ç»“ä¸€ä¸‹ï¼š\n\n- Emitter å®šä¹‰äº†å¯ä»¥å‘é€çš„äº‹ä»¶çš„ä¸‰ç§æœºåˆ¶\n- ObservableEmitter åœ¨Emitter åšäº†æ‰©å±•ï¼Œæ·»åŠ äº†Disposableç›¸å…³çš„æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å–æ¶ˆäº‹ä»¶çš„å‘é€ã€‚\n\nå¥½äº†ï¼Œç»•äº†ä¸€å¤§åœˆï¼Œå°±ä¸ºäº†ä¸€è¡Œä»£ç ï¼š\n\n\n```java\n  Observable mObservable=new ObservableCreate(new ObservableOnSubscribe())\n```\n\næ€»ç»“ä¸€ä¸‹å…·ä½“ä¸»é¢˜ï¼ˆä¸Šæ¸¸ï¼‰çš„åˆ°åº•å¹²äº†å•¥ï¼š\n\n- åˆ›å»ºäº†ä¸€ä¸ªObservableCreate çš„å®ä¾‹å¯¹è±¡\n- ObservableCreate å†…æŒæœ‰ObservableOnSubscribe å¯¹è±¡çš„å¼•ç”¨\n- ObservableOnSubscribe æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªsubscribeæ–¹æ³•ï¼Œè°ƒç”¨ä»–ä¹‹åï¼Œä¼šç”¨å…¶ObservableEmitterå®ä¾‹å¼€å§‹å‘é€äº‹ä»¶ã€‚\n- ObservableEmitter ç»§æ‰¿è‡ªEmitteã€‚\n\n#### å¦‚ä½•å®ç°è®¢é˜…ã€å‘é€äº‹ä»¶å’Œæ¥æ”¶äº‹ä»¶\n\nä¸ºäº†æ–¹ä¾¿å™è¿°ï¼ŒæŠŠé—®é¢˜3å’Œ4è¿åœ¨ä¸€èµ·è¯´äº†ã€‚\n\né€šè¿‡ä¸Šé¢çš„å™è¿°ï¼Œç°åœ¨å…·ä½“ä¸»é¢˜å’Œå…·ä½“çš„è§‚å¯Ÿè€…éƒ½åˆ›å»ºå¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®ç°äºŒè€…çš„è®¢é˜…å…³ç³»ã€‚\n\n```\nmObservable.subscribe(mObserver);\n```\n\n>è¿™é‡Œéœ€è¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯ï¼Œæ˜¯è§‚å¯Ÿè€…ï¼ˆä¸‹æ¸¸ï¼‰è®¢é˜…äº†ä¸»é¢˜ï¼ˆä¸Šæ¸¸ï¼‰ï¼Œè™½ç„¶ä»ä»£ç ä¸Šçœ‹å¥½åƒäº†å‰è€…è®¢é˜…äº†åè€…ï¼Œä¸è¦ææ··äº†ã€‚\n\næˆ‘ä»¬çœ‹Observableçš„subscribe() æ–¹æ³•ï¼š\n\n```java\n    public final void subscribe(Observer<? super T> observer) {\n        ObjectHelper.requireNonNull(observer, \"observer is null\");\n        try {\n            observer = RxJavaPlugins.onSubscribe(this, observer);\n\n            ObjectHelper.requireNonNull(observer, \"Plugin returned null Observer\");\n\n            subscribeActual(observer);\n        } catch (NullPointerException e) { // NOPMD\n            throw e;\n        } catch (Throwable e) {\n         â€¦â€¦\n        }\n    }\n```\n\nè¿™ä¸ªå‰é¢å·²ç»æåˆ°è¿‡äº†ï¼ŒObservableå¹¶æ²¡æœ‰çœŸæ­£çš„å»å®ç°subscribe,è€Œæ˜¯æŠŠä»–è½¬æ¥ç»™äº†subscribeActual()æ–¹æ³•ã€‚\n\n\nå‰é¢å·²ç»è¯´è¿‡ï¼ŒObservableçš„å®ä¾‹æ˜¯ä¸€ä¸ªObservableCreateå¯¹è±¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åˆ°è¿™ä¸ªç±»é‡Œå»çœ‹çœ‹subscribeActual()çš„å®ç°ã€‚\n\n```java\n\t// ä¸ºäº†æ–¹ä¾¿ï¼Œé¡ºä¾¿å†çœ‹ä¸€çœ¼æ„é€ å‡½æ•°\n    public ObservableCreate(ObservableOnSubscribe<T> source) {\n        this.source = source;\n    }\n    @Override\n    protected void subscribeActual(Observer<? super T> observer) {\n        CreateEmitter<T> parent = new CreateEmitter<T>(observer);\n        observer.onSubscribe(parent);\n\n        try {\n            source.subscribe(parent);\n        } catch (Throwable ex) {\n            Exceptions.throwIfFatal(ex);\n            parent.onError(ex);\n        }\n    }\n```\n\nCreateEmitter å®ç°äº†ä¹‹å‰æåˆ°çš„ObservableEmitteræ¥å£ã€‚è¿™é‡Œæœ‰ä¸€å¥å…³é”®çš„ä»£ç ï¼š\n\n```java\nobserver.onSubscribe(parent);\n```\n\nä¹‹å‰åœ¨çœ‹åˆ°Emitterçš„å®šä¹‰æ—¶ï¼Œæˆ‘ä»¬è¯´ç¼ºå°‘äº†onSubscribeæ–¹æ³•ï¼Œåˆ°è¿™é‡Œå°±æ˜ç™½äº†ã€‚**onSubscribeå¹¶ä¸æ˜¯ç”±ä¸»é¢˜ï¼ˆä¸Šæ¸¸ï¼‰ä¸»åŠ¨å‘é€çš„äº‹ä»¶ï¼Œè€Œæ˜¯æœ‰è§‚å¯Ÿè€…ï¼ˆä¸‹æ¸¸ï¼‰è‡ªå·±è°ƒç”¨çš„ä¸€ä¸ªäº‹ä»¶ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿è·å–Emitterçš„å®ä¾‹å¯¹è±¡ï¼Œå‡†ç¡®çš„è¯´åº”è¯¥æ˜¯Disposableçš„å®ä¾‹å¯¹è±¡ï¼Œè¿™æ ·ä¸‹æ¸¸å°±å¯ä»¥æ§åˆ¶ä¸Šæ¸¸äº†ã€‚**\n\næ¥ä¸‹æ¥å°±æ›´ç®€å•äº†ï¼Œsource æ˜¯ObservableOnSubscribeï¼ŒæŒ‰ç…§ä¹‹å‰çš„é€»è¾‘ï¼Œè°ƒç”¨å…¶subscribeæ–¹æ³•ï¼Œç»™ä»–ä¸€ä¸ªObservableEmitterå¯¹è±¡å®ä¾‹ï¼ŒObservableEmitterå°±ä¼šå¼€å§‹å‘é€äº‹ä»¶åºåˆ—ã€‚è¿™æ ·ï¼Œä¸€æ—¦å¼€å§‹è®¢é˜…äº†ï¼Œä¸»é¢˜ï¼ˆä¸Šæ¸¸ï¼‰å°±å¼€å§‹å‘é€äº‹ä»¶äº†ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„onNext,onComplete,onError æ–¹æ³•çœŸæ­£çš„å¼€å§‹æ‰§è¡Œäº†ã€‚\n\næ¥ç€çœ‹çœ‹CreateEmitterçš„å®ç°ã€‚\n\n```java\n\npublic final class ObservableCreate<T> extends Observable<T> {\n    final ObservableOnSubscribe<T> source;\n\n    public ObservableCreate(ObservableOnSubscribe<T> source) {\n        this.source = source;\n    }\n\n    @Override\n    protected void subscribeActual(Observer<? super T> observer) {\n        CreateEmitter<T> parent = new CreateEmitter<T>(observer);\n        observer.onSubscribe(parent);\n        â€¦â€¦\n    }\n\n    static final class CreateEmitter<T>\n    extends AtomicReference<Disposable>\n    implements ObservableEmitter<T>, Disposable {\n\n\n        private static final long serialVersionUID = -3434801548987643227L;\n\n        final Observer<? super T> observer;\n\n        CreateEmitter(Observer<? super T> observer) {\n            this.observer = observer;\n        }\n\n        @Override\n        public void onNext(T t) {\n            if (t == null) {\n                onError(new NullPointerException(\"onNext called with null. Null values are generally not allowed in 2.x operators and sources.\"));\n                return;\n            }\n            if (!isDisposed()) {\n                observer.onNext(t);\n            }\n        }\n\n        @Override\n        public void onError(Throwable t) {\n            if (!tryOnError(t)) {\n                RxJavaPlugins.onError(t);\n            }\n        }\n\n        @Override\n        public boolean tryOnError(Throwable t) {\n            if (t == null) {\n                t = new NullPointerException(\"onError called with null. Null values are generally not allowed in 2.x operators and sources.\");\n            }\n            if (!isDisposed()) {\n                try {\n                    observer.onError(t);\n                } finally {\n                    dispose();\n                }\n                return true;\n            }\n            return false;\n        }\n\n        @Override\n        public void onComplete() {\n            if (!isDisposed()) {\n                try {\n                    observer.onComplete();\n                } finally {\n                    dispose();\n                }\n            }\n        }\n\n        @Override\n        public void setDisposable(Disposable d) {\n            DisposableHelper.set(this, d);\n        }\n\n        @Override\n        public void setCancellable(Cancellable c) {\n            setDisposable(new CancellableDisposable(c));\n        }\n\n        @Override\n        public ObservableEmitter<T> serialize() {\n            return new SerializedEmitter<T>(this);\n        }\n\n        @Override\n        public void dispose() {\n            DisposableHelper.dispose(this);\n        }\n\n        @Override\n        public boolean isDisposed() {\n            return DisposableHelper.isDisposed(get());\n        }\n    }\n}\n```\n\n- ä»–çš„æ„é€ å‡½æ•°ï¼Œéœ€è¦ä¸€ä¸ªè§‚å¯Ÿè€…çš„å®ä¾‹ï¼›\n- ä»–å®ç°äº†ObservableEmitteræ¥å£ï¼Œå¹¶ä¾æ¬¡å®ç°ä»–çš„ä¸‰ä¸ªæ–¹æ³•ï¼›\n  - åœ¨æ¯ä¸€æ¬¡çš„onNextäº‹ä»¶ä¸­ï¼Œä»–ä¸å†æ¥å—å‚æ•°ä¸ºnullçš„ç±»å‹ï¼Œåœ¨äº‹ä»¶åºåˆ—æ²¡æœ‰ä¸­æ–­çš„æƒ…å†µä¸‹ä¼šæŠŠä¸»é¢˜ï¼ˆä¸Šæ¸¸ï¼‰å‘é€çš„äº‹ä»¶TåŸå°ä¸åŠ¨çš„ä¼ é€’ç»™è§‚å¯Ÿè€…(ä¸‹æ¸¸ï¼‰ã€‚\n  - onCompleteäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä»–ä¹Ÿä¼šé€šçŸ¥ä¸‹æ¸¸ï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™ä¸­æ–­äº‹ä»¶åºåˆ—\n  - onError äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå¹¶æ²¡æœ‰ç›´æ¥ä¼ é€’åˆ°ä¸‹æ¸¸ï¼Œè€Œæ˜¯åœ¨å…¶å†…éƒ¨å¤„ç†\n  - tryOnError äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰ä¼šæŠŠæŸäº›ç‰¹å®šç±»å‹çš„é”™è¯¯ä¼ é€’åˆ°ä¸‹æ¸¸ã€‚\n- ä»–å®ç°äº†Disposableæ¥å£ï¼Œä¸‹æ¸¸æ ¹æ®è·å–åˆ°çš„Emitterçš„å®ä¾‹å¯¹è±¡ï¼Œå¯ä»¥æ–¹ä¾¿çš„è·å–äº‹ä»¶åºåˆ—çš„ä¿¡æ¯ï¼Œç”šè‡³æ˜¯å¯ä»¥ä¸»åŠ¨å…³é—­äº‹ä»¶åºåˆ—ï¼ŒåŠæ–­å¼€è§‚å¯Ÿè€…æ¨¡å¼ä¸­ä¸»é¢˜å’Œè§‚å¯Ÿè€…é—´çš„è®¢é˜…å…³ç³»ã€‚\n\n\n## RxJava ä¸­å¯¹å¸¸è§„çš„è§‚å¯Ÿè€…æ¨¡å¼åšäº†æ€æ ·è°ƒæ•´ï¼Œå¸¦æ¥äº†ä»€ä¹ˆå¥½å¤„ï¼Ÿ\n\næœ€åå†æ¥ç®€å•è¯´ä¸€ä¸‹ï¼ŒRxJavaä¸­å¯¹å¸¸è§„çš„è§‚å¯Ÿè€…æ¨¡å¼åšäº†æ€æ ·çš„è°ƒæ•´ï¼Œæœ‰ä»€ä¹ˆå€¼å¾—å€Ÿé‰´çš„åœ°æ–¹ã€‚å¤§éƒ¨åˆ†ä¼˜ç‚¹åœ¨ä¸Šé¢å·²ç»æåŠäº†ï¼Œè¿™é‡Œå°±æ¥æ€»ç»“ä¸€ä¸‹ã€‚\n\n- è§‚å¯Ÿè€…è®¢é˜…ä¸»é¢˜åï¼Œä¸»é¢˜æ‰ä¼šå¼€å§‹å‘é€äº‹ä»¶\n- RxJavaä¸­Observeré€šè¿‡onSubscribeè·å–äº†å‘é€äº‹ä»¶ä¸­çš„Disposableå¯¹è±¡ï¼Œè¿™æ ·ä»–å°±å¯ä»¥ä¸»åŠ¨çš„è·å–è®¢é˜…å…³ç³»ä¸­äºŒè€…çš„çŠ¶æ€ï¼Œç”šè‡³æ˜¯æ§åˆ¶æˆ–è€…æ˜¯ä¸­æ–­äº‹ä»¶åºåˆ—çš„å‘é€ã€‚åœ¨å¸¸è§„çš„è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œä¸»é¢˜æœ‰æƒåˆ©æ·»åŠ è®¢é˜…è€…ï¼Œä½†ä¹Ÿèƒ½æ˜¯ç”±ä»–ç§»é™¤ç‰¹å®šçš„è®¢é˜…è€…ï¼Œå› ä¸ºåªæœ‰ä»–æŒæœ‰æ‰€æœ‰è®¢é˜…è€…çš„é›†åˆ\n- æŠ½è±¡ä¸»é¢˜ï¼ˆä¸Šæ¸¸ï¼‰å¹¶æ²¡æœ‰ç›´æ¥æ§åˆ¶onNextï¼ŒonComplete,onErroräº‹ä»¶çš„å‘é€ï¼Œè€Œæ˜¯åªå…³æ³¨Emitter å®ä¾‹çš„å‘é€ï¼ŒObservableOnSubscribeæ¥å£ç›‘å¬ObservableEmitterå¯¹è±¡çš„å‘é€ï¼Œä¸€æ—¦æ¥å—åˆ°æ­¤å¯¹è±¡å°±ä¼šé€šè¿‡ä»–å¼€å§‹å‘é€å…·ä½“çš„äº‹ä»¶ï¼Œè¿™é‡Œå¯ä»¥æœ‰ç‚¹è§‚å¯Ÿè€…æ¨¡å¼åµŒå¥—çš„æ„å‘³ã€‚\n\n\n****\n\nå¥½äº†ï¼Œä»¥ä¸Šå°±æ˜¯ä»è§‚å¯Ÿè€…æ¨¡å¼çš„è§’åº¦å‡ºå‘ï¼Œå¯¹RxJavaçš„ä¸€æ¬¡è§£è¯»ï¼Œæœ‰ä»€ä¹ˆç–æ¼æˆ–ç†è§£é”™è¯¯çš„åœ°æ–¹ï¼Œæ¬¢è¿è¯»è€…æŒ‡å‡ºï¼Œå…±åŒè¿›æ­¥ï¼\n\n","tags":["Androidæºç "],"categories":["Android è¿›é˜¶"]},{"title":"ä»£ç†æ¨¡å¼","url":"%2F2018%2F01%2F07%2F%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%2F","content":"\n## ä»‹ç»\n\nä»£ç†æ¨¡å¼ä¹Ÿç§°ä¸ºå§”æ‰˜æ¨¡å¼ï¼Œæ˜¯ä¸€ç§**ç»“æ„æ€§**è®¾è®¡æ¨¡å¼ã€‚\n\nè¯´åˆ°ä»£ç†ï¼Œå¯èƒ½å¤§éƒ¨åˆ†äººéƒ½ä¼šæœ‰ä¸€ç§é™Œç”Ÿåˆç†Ÿæ‚‰çš„æ„Ÿè§‰ï¼Œæ—¥å¸¸ç”Ÿæ´»ä¸­å¥½åƒéƒ½èƒ½é‡åˆ°ï¼Œæ¯”å¦‚ä»£ç†ä¸Šç½‘ï¼Œæ‹›å•†ä»£ç†ï¼Œå•†åŠ¡ä»£ç†ç­‰ï¼›ä½†åˆè¯´ä¸å‡ºä¸ªå…·ä½“çš„ä¸€äºŒä¸‰æ¥ï¼›ä»£ç†è¿™ä¸ªäº‹æƒ…å¦‚æœæˆ‘ä»¬æ¢ä¸ªè§’åº¦ï¼Œä»å§”æ‰˜è€…çš„è§’è‰²å‡ºå‘ï¼Œæˆ‘ä»¬æ‰¾ä»£ç†ä¸Šç½‘ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨è®¿é—®æŸäº›ç½‘ç«™æ—¶å­˜åœ¨å›°éš¾ï¼Œéœ€è¦æœ‰ä¸ªè§’è‰²æ¥é—´æ¥çš„å¸®æˆ‘ä»¬å®ç°è¿™ä¸ªåŠŸèƒ½ï¼›æˆ‘ä»¬æ‰¾å•†åŠ¡ä»£ç†ï¼Œå¯èƒ½æ˜¯å› ä¸ºè®¸å¤šäº‹æˆ‘ä»¬ä¸åœ¨è¡Œæˆ–è€…å…¶ä»–åŸå› ï¼Œéœ€è¦æ‰¾ä¸“ä¸šçš„ä¸­é—´äººæ¥å¸®æˆ‘ä»¬åšäº‹ã€‚å› ä¸ºï¼Œæ—¥å¸¸ç”Ÿæ´»ä¸­æˆ‘ä»¬æ›´å¤šæ‰®æ¼”çš„æ˜¯å§”æ‰˜äººçš„è§’è‰²ï¼Œä»£ç†ä»¥ä¸€ç§ä¸­é—´äººçš„è§’è‰²ï¼Œå¸®æˆ‘ä»¬æ˜¯å¤„ç†æˆ‘ä»¬æ— èƒ½ä¸ºåŠ›çš„äº‹æƒ…ã€‚\n\n<!--more-->\n\nå› æ­¤ï¼Œä»å†™ä»£ç çš„è§’åº¦å‡ºå‘ï¼Œå½“æˆ‘ä»¬é‡åˆ°ä»¥ä¸‹åœºæ™¯ï¼š\n\n- æ— æ³•ç›´æ¥è®¿é—®æŸä¸ªå¯¹è±¡\n- ä¸æƒ³ç›´æ¥è®¿é—®æŸä¸ªå¯¹è±¡\n- è®¿é—®æŸä¸ªå¯¹è±¡å­˜åœ¨å›°éš¾\n\nè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸€ä¸ªä»£ç†ï¼Œé€šè¿‡å®ƒæ¥é—´æ¥è®¿é—®çœŸæ­£çš„å¯¹è±¡ã€‚\n\n\n\n## å®šä¹‰åŠUMLå›¾\n\n### å®šä¹‰ï¼š \n\n**ä¸ºç›®æ ‡å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ï¼Œå®¢æˆ·ç«¯é€šè¿‡ä»£ç†å»è®¿é—®ç›®æ ‡å¯¹è±¡ã€‚**\n\n\n### UML å›¾\n\n\n\n![](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1514862791977&di=a2474587175e0bb92b0178421e86d125&imgtype=jpg&src=http%3A%2F%2Fimg0.imgtn.bdimg.com%2Fit%2Fu%3D3669500640%2C1002167682%26fm%3D214%26gp%3D0.jpg)\n\n\nä»ä»£ç†æ¨¡å¼çš„UML ç±»å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“è®ºï¼š\n\n- ä»£ç†å¯¹è±¡å’Œå§”æ‰˜å¯¹è±¡éœ€è¦å®ç°ç›¸åŒçš„æ¥å£ï¼ˆæŠ½è±¡ç±»ï¼‰\n- ä»£ç†å¯¹è±¡æŒæœ‰å§”æ‰˜å¯¹è±¡çš„å¼•ç”¨\n\nå¯ä»¥çœ‹åˆ°ï¼Œä»£ç†æ¨¡å¼éå¸¸ç®€æ´ï¼Œæ€»å…±å°±ä¸‰ä¸ªè§’è‰²ï¼ŒåŒ…æ‹¬**æŠ½è±¡ä¸»é¢˜ï¼Œå§”æ‰˜è€…å’Œä»£ç†è€…ã€‚**ä¸‹é¢ç”¨ä»£ç ç®€å•å®ç°ä¸€ä¸‹åŸºç¡€çš„ä»£ç†æ¨¡å¼ã€‚\n\n```java\npublic interface Subject {\n    void doSomething();\n}\n\npublic class RealSubject implements Subject {\n    @Override\n    public void doSomething() {\n        System.out.println(\"This is real doSomeThing\");\n    }\n}\n\npublic class ProxySubject implements Subject {\n\n    private Subject mSubject;\n    // ä»£ç†ç±»æŒæœ‰å§”æ‰˜ç±»çš„å¼•ç”¨\n    public ProxySubject(Subject realSubject) {\n        mSubject = realSubject;\n    }\n\n    @Override\n    public void doSomething() {\n        mSubject.doSomething();\n    }\n}\n\npublic class Client {\n    public static void main(String[] args) {\n        //åˆ›å»ºå§”æ‰˜ç±»\n        Subject mRealSubject=new RealSubject();\n        //åˆ›å»ºä»£ç†ç±»\n        ProxySubject mProxy = new ProxySubject(mRealSubject);\n        //ç”±ä»£ç†ç±»å»åšå…·ä½“çš„æ“ä½œ\n        mProxy.doSomething();\n    }\n}\n\n```\n\nå¯ä»¥çœ‹åˆ°RealSubjectå’ŒProxySubjectéƒ½å®ç°äº†æ¥å£Subjectã€‚åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ProxySubjectçš„å®ä¾‹è°ƒç”¨doSomethingæ–¹æ³•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨RealSubjectçš„å®ä¾‹æ¥å®ç°ã€‚\n\nä½ å¯èƒ½ä¼šå¥½å¥‡ï¼Œè¿™ä¹ˆåšçš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç›´æ¥ç”¨RealSubjectçš„å®ä¾‹æ¥è°ƒç”¨doSomethingæ–¹æ³•ä¸ä¹Ÿå¯ä»¥å—ï¼Ÿä½•å¿…å¤šæ­¤ä¸€ä¸¾ã€‚è¯•æƒ³ï¼Œå¦‚æœç°åœ¨æœ‰å¾ˆå¤šä¸ªå§”æ‰˜ç±»ï¼Œä»–ä»¬å„è‡ªçš„å®ç°éƒ½ä¸åŒï¼Œå®¢æˆ·ç«¯åªå…³å¿ƒdoSomething çš„è°ƒç”¨ï¼Œè€Œä¸å…³å¿ƒå…·ä½“çš„å®ç°ï¼Œè¿™æ ·ä»£ç†ç±»å°±å¯ä»¥åœ¨å…¶å†…éƒ¨å±è”½å§”æ‰˜ç±»ä¹‹é—´çš„å·®å¼‚äº†ã€‚è¿™ä¹ˆè¯´å¯èƒ½æœ‰ç‚¹æ™•ï¼Œä¸‹é¢å°±é€šè¿‡Androidæºç ä¸­çš„å®ç°æ¥æ„Ÿå—ä¸€ä¸‹ã€‚\n\n## Android ä¸­çš„ä»£ç†æ¨¡å¼\n\n\nå¹³æ—¶å†™ä»£ç çš„æ—¶å€™ï¼Œå¯èƒ½æ„Ÿè§‰ä»£ç†æ¨¡å¼æ²¡æ€ä¹ˆé‡åˆ°è¿‡ã€‚å…¶å®ä¸ç„¶ï¼Œç”šè‡³å¯ä»¥è¯´ä»£ç†æ¨¡å¼æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨åˆ°çš„ä¸€ç§è®¾è®¡æ¨¡å¼ã€‚è¿™é‡Œå°±æ¥çœ‹çœ‹å‡ ä¹å¤©å¤©éƒ½åœ¨ä½¿ç”¨çš„AppCompatActivityã€‚\n\næœ€æ—©çš„æ—¶å€™ï¼Œæˆ‘ä»¬åˆ›å»ºè‡ªå·±çš„Activityéƒ½æ˜¯ç›´æ¥ç»§æ‰¿android.app.Activityã€‚åæ¥éšç€Androidç‰ˆæœ¬çš„å‡çº§ï¼Œæˆ‘ä»¬åˆ›å»ºçš„Activityä¼šç»§æ‰¿AppCompatActivityã€‚è¿™é‡Œçš„Compatå…¶å®å°±æ˜¯Compatible(å…¼å®¹)çš„ç¼©å†™ï¼Œé‚£ä¹ˆä»–æ˜¯æ€ä¹ˆå®ç°å…¼å®¹çš„å‘¢ã€‚\n\n#### onCreate\n\nonCreate()æ–¹æ³•æ˜¯æ•´ä¸ªActivityç”Ÿå‘½å‘¨æœŸçš„å¼€å§‹ã€‚AppCompatActivityåˆæ˜¯æ€ä¹ˆå®ç°ä»–çš„å‘¢ã€‚\n\n**AppCompatActivity-onCreate()**\n\n```java\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        final AppCompatDelegate delegate = getDelegate();\n        delegate.installViewFactory();\n        delegate.onCreate(savedInstanceState);\n\t\tâ€¦â€¦\n    }\n```\n\nå¯ä»¥çœ‹åˆ°è¿™é‡Œä»–å¹¶æ²¡å…·ä½“å»å®ç°onCreate,è€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªAppCompatDelegateå®ä¾‹çš„onCreate()æ–¹æ³•å»å®ç°ã€‚ç»§ç»­çœ‹getDelegate çš„å®ç°ã€‚\n\n\n**AppCompatActivity-getDelegate()**\n\n```java\n    @NonNull\n    public AppCompatDelegate getDelegate() {\n        if (mDelegate == null) {\n            mDelegate = AppCompatDelegate.create(this, this);\n        }\n        return mDelegate;\n    }\n```\n\nå¯ä»¥çœ‹åˆ°è¿™ä¸ªå®ä¾‹åˆ›å»ºæ˜¯åœ¨AppCompatDelegateç±»ä¸­ã€‚æ¥ç€çœ‹createçš„å®ç°\n\n\n**AppCompatDelegate-create()**\n\n```java\n    public static AppCompatDelegate create(Activity activity, AppCompatCallback callback) {\n        return create(activity, activity.getWindow(), callback);\n    }\n\n    private static AppCompatDelegate create(Context context, Window window,\n            AppCompatCallback callback) {\n        if (Build.VERSION.SDK_INT >= 24) {\n            return new AppCompatDelegateImplN(context, window, callback);\n        } else if (Build.VERSION.SDK_INT >= 23) {\n            return new AppCompatDelegateImplV23(context, window, callback);\n        } else if (Build.VERSION.SDK_INT >= 14) {\n            return new AppCompatDelegateImplV14(context, window, callback);\n        } else if (Build.VERSION.SDK_INT >= 11) {\n            return new AppCompatDelegateImplV11(context, window, callback);\n        } else {\n            return new AppCompatDelegateImplV9(context, window, callback);\n        }\n    }\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå°±ä¸åŒçš„Androidç‰ˆæœ¬ï¼Œåˆ†åˆ«è¿”å›äº†ä¸åŒçš„AppCompatDelegateã€‚å¦‚æœå»çœ‹æºç ï¼ˆè¿™é‡Œçš„æºç åˆ†æä¸æ˜¯é‡ç‚¹ï¼Œå°±ä¸è´´å‡ºäº†ï¼Œç›´æ¥ç»™å‡ºç»“è®ºï¼‰ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œä»\nAppCompatDelegateImplNåˆ°AppCompatDelegateImplV9ï¼Œæ˜¯å­ç±»åˆ°çˆ¶ç±»çš„å…³ç³»ï¼Œä¹‹é—´æ˜¯ä¾æ¬¡ç»§æ‰¿ã€‚è€ŒAppCompatDelegateImplV9åˆç»§æ‰¿è‡ªAppCompatDelegateImplBaseï¼ˆæŠ½è±¡ç±»ï¼‰ï¼Œè€Œè¿™ä¸ªAppCompatDelegateImplBaseåˆ™æ˜¯ç»§æ‰¿è‡ªAppCompatDelegateã€‚\n\nåˆ°è¿™é‡Œï¼Œç»“åˆä¸€å¼€å§‹æˆ‘ä»¬æ‰€è¯´çš„ä»£ç†æ¨¡å¼çš„å†…å®¹ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æ€»ç»“å‡ºä»¥ä¸‹ç»“è®ºï¼š\n\n- AppCompatDelegate åŒæ—¶å…¼é¡¾äº†**æŠ½è±¡ä¸»é¢˜å’Œä»£ç†ç±»**çš„è§’è‰²\n- AppCompatDelegateImplNï¼ŒAppCompatDelegateImplV23ç­‰è¿™äº›éƒ½æ˜¯**å§”æ‰˜ç±»**ï¼Œä»–ä»¬éƒ½ç»§æ‰¿è‡ªAppCompatDelegateæ–¹æ³•ã€‚\n\né€šè¿‡[AppCompatDelegate.java](https://www.androidos.net.cn/android/8.0.0_r4/xref/frameworks/support/v7/appcompat/src/android/support/v7/app/AppCompatDelegate.java)(ç‚¹å‡»å¯ç›´æ¥æŸ¥çœ‹)çš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªæŠ½è±¡ç±»å†…éƒ¨å®šä¹‰äº†ä¸€ç³»åˆ—å’Œ Activity ç›¸å…³çš„æŠ½è±¡æ–¹æ³•ï¼ŒåŒ…æ‹¬Activityç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ŒsetContentViewï¼ŒsetSupportActionBarç­‰ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œ**å­ç±»é€šè¿‡ç»§æ‰¿çˆ¶ç±»ï¼Œå¯ä»¥æ‰©å±•ï¼ˆspuer)æˆ–ç›´æ¥è¦†ç›–çˆ¶ç±»çš„æ–¹æ³•å®ç°ã€‚** AppCompatDelegateImplV9 è¿™ä¸ªç±»æ˜¯AppCompatDelegateçš„å…·ä½“å®ç°ï¼Œä¹‹åçš„ç‰ˆæœ¬ï¼Œå°±å¯ä»¥é€šè¿‡ç»§æ‰¿AppCompatDelegateImplV9æ¥æ‰©å±•æˆ–ä¿®æ”¹ä¸€äº›æ–¹æ³•å®ç°ï¼Œé€šè¿‡AppCompatDelegate åœ¨createæ–¹æ³•ä¸­åˆ›å»ºä¸åŒçš„å§”æ‰˜ç±»æ¥å®Œæˆä¸åŒçš„å®ç°ï¼Œè€Œæˆ‘ä»¬åŸå…ˆå†™å¥½çš„ä»£ç ä¹Ÿä¸ä¼šè¢«ç ´åï¼Œå¯ä»¥çœ‹åˆ°Androidæºç å¯¹Activityå…¼å®¹è¿™ä¸ªäº‹åšçš„éå¸¸å·§å¦™ã€‚AppCompatDelegateä¸»è¦æ˜¯å¯¹ActionBarçš„å…¼å®¹åŠå¤œé—´æ¨¡å¼çš„å¤„ç†åšäº†ä¸€äº›æ–¹ä¾¿å¼€å‘è€…å®ç°çš„å¤„ç†ï¼›è¿™é‡Œå°±ä¸å†å…·ä½“åˆ†æäº†ã€‚\n\nå½“ç„¶ï¼Œä»£ç†æ¨¡å¼è¿™ä¸ªå‡ ä¹æ‰¾ä¸åˆ°ç¼ºç‚¹çš„è®¾è®¡æ¨¡å¼ï¼Œåœ¨Androidæºç ä¸­çš„åº”ç”¨ä¹Ÿæ˜¯æ¯”è¾ƒå¹¿æ³›ï¼ŒåŸºæœ¬ä¸Šå…³äºå…¼å®¹æ€§çš„å®ç°ï¼Œéƒ½ä¼šç”¨åˆ°ä»¥ä¸Šæ€è·¯ï¼Œæ¯”å¦‚NotificationCompatImplå‡ ä¹ä½¿ç”¨äº†å’ŒAppCompatDelegateåŒæ ·çš„æ€è·¯ï¼Œå®ç°äº†åœ¨æ‰‹æœºé€šçŸ¥æ ä¸­å®ç°ä¸åŒçš„é€šçŸ¥æ ·å¼ã€‚é™¤äº†å…¼å®¹æ€§çš„å¤„ç†ï¼Œå¦å¤–ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„å®ç°å°±æ˜¯Binderäº†ï¼Œä½œä¸ºè·¨è¿›ç¨‹é€šä¿¡çš„æ ¸å¿ƒç†å¿µï¼ŒBinderå·§å¦™çš„ä½¿ç”¨äº†ä»£ç†æ¨¡å¼ï¼Œå¤„ç†äº†æˆ‘ä»¬æ— æ³•åœ¨ä¸åŒåº”ç”¨ä¹‹é—´å…±äº«å’Œä¼ é€’æ•°æ®çš„é—®é¢˜ã€‚å…³äºBinderçš„åˆ†æï¼Œç½‘ä¸ŠçœŸçš„å¤ªå¤šäº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹è¿™ç¯‡[ä»£ç†æ¨¡å¼åœ¨Binderä¸­çš„ä½¿ç”¨](http://blog.csdn.net/singwhatiwanna/article/details/44590179).\n\n## åŠ¨æ€ä»£ç†\n\nä»¥ä¸Šçš„åˆ†æä¸­ï¼Œå§”æ‰˜ç±»æ˜¯ç”±æˆ‘ä»¬ç›´æ¥åˆ›å»ºå¥½çš„ï¼›ç°å®ä¸­å¯èƒ½è¿˜æœ‰è¿™æ ·ä¸€ç§åœºæ™¯ï¼Œå§”æ‰˜ç±»å¹¶ä¸æ˜¯åœ¨ç¨‹åºç¼–è¯‘çš„æ—¶å€™åˆ›å»ºï¼Œè€Œæ˜¯åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­é€šè¿‡Javaçš„åå°„æœºåˆ¶åŠ¨æ€çš„è¿›è¡Œåˆ›å»ºï¼Œè¿™æ ·çš„ä»£ç†æ¨¡å¼æˆä¸ºåŠ¨æ€ä»£ç†ï¼Œå¯¹åº”çš„ä¹‹å‰æˆ‘ä»¬æ‰€è¯´çš„å°±æ˜¯é™æ€ä»£ç†äº†ã€‚\n\nå…¶å®ï¼ŒåŠ¨æ€ä»£ç†çš„å®ç°æ²¡æœ‰ä»€ä¹ˆå¯è¯´çš„ï¼Œè¯´ç™½äº†éƒ½æ˜¯æ¨¡æ¿ä»£ç ï¼ŒJavaä¸ºå¼€å‘è€…æä¾›äº†InvocationHandler,å®ç°è¯¥æ¥å£é‡å†™å…¶invoke æ–¹æ³•å³å¯ã€‚\n\nè¿˜æ˜¯ä»¥ä¹‹å‰çš„Subjectä¸ºä¾‹\n\n```java\npublic interface Subject {\n    void doSomething();\n}\n\npublic class RealSubject implements Subject {\n    @Override\n    public void doSomething() {\n        System.out.println(\"This is real doSomeThing\");\n    }\n}\n\n\npublic class DynamicProxyHandler implements InvocationHandler {\n    private Object mObject;\n\n\n    public DynamicProxyHandler(Object object) {\n        mObject = object;\n    }\n\n    @Override\n    public Object invoke(Object o, Method method, Object[] objects) throws Throwable {\n        return method.invoke(mObject, objects);\n    }\n}\n\n\npublic class MainClass {\n    public static void main(String[] args) {\n        // å§”æ‰˜ç±»\n        Subject mRealSubject = new RealSubject();\n        // å§”æ‰˜ç±»classLoader\n        ClassLoader mClassLoader = mRealSubject.getClass().getClassLoader();\n        // å§”æ‰˜ç±»å¯¹åº”çš„ProxyHandler\n        DynamicProxyHandler mProxyHandler = new DynamicProxyHandler(mRealSubject);\n        Class[] mClasses = new Class[]{Subject.class};\n        // ä»£ç†ç±»\n        Subject proxySubject = (Subject) Proxy.newProxyInstance(mClassLoader, mClasses, mProxyHandler);\n        // ä»£ç†ç±»è°ƒç”¨æ–¹æ³•\n        proxySubject.doSomething();\n        \n    }\n}\n\n```\n\nè¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼ŒDynamicProxyHandlerå†…éƒ¨æŒæœ‰çš„å¹¶ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„å¯¹è±¡ï¼Œè€Œæ˜¯Objectç±»ï¼Œè€Œåœ¨å…¶invokeæ–¹æ³•ä¸­ï¼Œåˆä¼šæ ¹æ®å…·ä½“çš„Objectå¯¹è±¡åŠå‚æ•°è°ƒç”¨å…¶å¯¹åº”çš„æ–¹æ³•ã€‚è¿™æ ·å½“æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯è°ƒç”¨æ—¶ï¼Œå®Œå…¨æ˜¯æ ¹æ®å§”æ‰˜ç±»é€šè¿‡Proxy.newProxyInstanceæ–¹æ³•åŠ¨æ€çš„åˆ›å»ºä»£ç†ç±»ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡å§”æ‰˜ç±»RealSubjectåŠ¨æ€çš„åˆ›å»ºäº†ä¸€ä¸ªä»£ç†ç±»ï¼Œé€šè¿‡ä»£ç†ç±»è°ƒç”¨æŠ½è±¡ä¸»é¢˜ä¸­å®šä¹‰å¥½çš„æ–¹æ³•ï¼Œå®é™…ä¸Šå°±ä¼šè°ƒç”¨å§”æ‰˜ç±»ä¸­çš„å…·ä½“å®ç°ã€‚è€Œåœ¨Javaä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„æœºåˆ¶ï¼ŒåŠ¨æ€çš„åˆ›å»ºç±»åŠå…¶å®ä¾‹ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡ä¸åŒçš„å§”æ‰˜ç±»ï¼Œæ›´çµæ´»çš„åˆ›å»ºä»£ç†ç±»ï¼Œä»è€Œå®ç°ä¸åŒçš„åŠŸèƒ½ã€‚\n\nå…³äºåŠ¨æ€ä»£ç†ï¼Œè¿™ç¯‡[ååˆ†é’Ÿç†è§£Javaä¹‹åŠ¨æ€ä»£ç†](https://www.jianshu.com/p/cbd58642fc08)åˆ†æçš„éå¸¸å¥½ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å†çœ‹çœ‹ã€‚\n\n\nåœ¨Androidä¸­ï¼Œå…³äºåŠ¨æ€ä»£ç†çš„ä½¿ç”¨ï¼Œæœ€ç»å…¸çš„è«è¿‡äºè¿™å‡ å¹´æœ€ç«çƒ­çš„Retrofitäº†ã€‚è¿™é‡Œå¯ä»¥ç®€å•çœ‹ä¸€ä¸‹ã€‚\n\n```java\n\npublic interface GitHubService {\n  @GET(\"users/{user}/repos\")\n  Call<List<Repo>> listRepos(@Path(\"user\") String user);\n}\n\nGitHubService service = retrofit.create(GitHubService.class);\nCall<List<Repo>> repos = service.listRepos(\"octocat\");\n``` \n\nä¸Šé¢çš„å®ç°ï¼Œç°åœ¨å¤§å®¶åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œå½“æˆ‘ä»¬ç”¨Retrofitå®ä¾‹ï¼Œè°ƒç”¨å…¶createæ–¹æ³•æ—¶ï¼Œåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ\n\n```java\n  public <T> T create(final Class<T> service) {\n    Utils.validateServiceInterface(service);\n    if (validateEagerly) {\n      eagerlyValidateMethods(service);\n    }\n    return (T) Proxy.newProxyInstance(service.getClassLoader(), new Class<?>[] { service },\n        new InvocationHandler() {\n          private final Platform platform = Platform.get();\n\n          @Override public Object invoke(Object proxy, Method method, @Nullable Object[] args)\n              throws Throwable {\n            // If the method is a method from Object then defer to normal invocation.\n            if (method.getDeclaringClass() == Object.class) {\n              return method.invoke(this, args);\n            }\n            if (platform.isDefaultMethod(method)) {\n              return platform.invokeDefaultMethod(method, service, proxy, args);\n            }\n            ServiceMethod<Object, Object> serviceMethod =\n                (ServiceMethod<Object, Object>) loadServiceMethod(method);\n            OkHttpCall<Object> okHttpCall = new OkHttpCall<>(serviceMethod, args);\n            return serviceMethod.callAdapter.adapt(okHttpCall);\n          }\n        });\n  }\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„åŠ¨æ€ä»£ç†å®ç°ï¼Œ**é€šè¿‡serviceMethod.callAdapter.adaptè¿”å›äº†ä¸€ä¸ªserviceå¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­é‡Œï¼Œå°±æ˜¯è¿”å›äº†ä¸€ä¸ªGitHubServiceçš„ä»£ç†å¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™æ ·ä¸€ä¸ªå¯¹è±¡å»è°ƒç”¨GitHubServiceä¸­å®šä¹‰å¥½çš„å„ç§ç½‘ç»œè¯·æ±‚ï¼Œè€Œä¸ç”¨åœ¨ä½¿ç”¨çš„æ—¶å€™å†å»å†³å®šæ˜¯POSTè¯·æ±‚è¿˜æ˜¯GETè¯·æ±‚,å‚æ•°æ˜¯æ”¾åœ¨Bodyé‡Œè¿˜æ˜¯paramsé‡Œï¼Œå› ä¸ºRetrofit é€šè¿‡æŠŠåå°„æ³¨è§£å’ŒåŠ¨æ€ä»£ç†çš„å·§å¦™ç»“åˆï¼Œå±è”½äº†å¤æ‚çš„å‚æ•°æ‹¼æ¥æ“ä½œï¼ŒæŠŠæ‰€æœ‰æˆ‘ä»¬éœ€è¦å¯¹OKHttpçš„è¿›è¡Œä¼ é€’çš„å‚æ•°ï¼ŒåŠ¨æ€çš„å¸®æˆ‘ä»¬ä¼ é€’äº†**ï¼Œä¸€æ—¦åœ¨æ¥å£ä¸­å®šä¹‰å¥½äº†ä½¿ç”¨æ–¹å¼ï¼Œå°±å¯ä»¥éå¸¸æ–¹ä¾¿çš„è·å–åˆ°okhttpä¸­æœ€å…³é”®çš„Calläº†ï¼Œæœ‰äº†Callæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡executeæˆ–è€…æ˜¯enqueueå‘èµ·ç½‘ç»œè¯·æ±‚äº†ã€‚\n\n## æ€»ç»“\n\nä»¥ä¸Šå°±æ˜¯å¯¹ä»£ç†æ¨¡å¼çš„åˆ†æï¼Œæ€»çš„æ¥è¯´ä»£ç†æ¨¡å¼çš„ç»“æ„éå¸¸ç®€å•ï¼›åŒ…æ‹¬**æŠ½è±¡ä¸»é¢˜ï¼Œå§”æ‰˜ç±»ï¼Œä»£ç†ç±»**ä¸‰ä¸ªæ ¸å¿ƒè§’è‰²ï¼Œä»å¤§çš„æ–¹å‘ä¸Šå¯ä»¥åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ä¸¤å¤§ç±»ï¼›é€šè¿‡é™æ€ä»£ç†çš„æ–¹å¼ï¼Œåœ¨å¼€å‘è¿­ä»£çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºå®ç°å…¼å®¹æ€§æä¾›äº†ä¸€ç§éå¸¸å‹å¥½çš„å®ç°æ€è·¯ï¼›åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„å¯¹è±¡ä¹‹é—´æœ‰ç€å¼ºçƒˆçš„è€¦åˆï¼Œå¯æ˜¯æ€è€ƒä¸€ä¸‹æ˜¯å¦å¯ä»¥é€šè¿‡ä»£ç†æ¨¡å¼è§£è€¦ï¼›åŒæ—¶ï¼Œå½“æˆ‘ä»¬éœ€è¦æ‰©å±•æŸä¸ªç±»çš„éƒ¨åˆ†åŠŸèƒ½æ—¶ï¼Œä½†åˆä¸æƒ³å»ç ´ååŸæœ‰çš„åŠŸèƒ½æˆ–è€…æ˜¯æ ¹æœ¬æ— æ³•ä¿®æ”¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä»£ç†æ¨¡å¼ï¼Œä½†ä¹Ÿè¦æ˜ç™½ï¼Œé€šè¿‡ä»£ç†æ¨¡å¼æˆ‘ä»¬èƒ½åšçš„ä¹Ÿåªèƒ½æ˜¯åŠŸèƒ½æ‰©å±•ï¼Œæƒ³è¦æ›´æ–°å§”æ‰˜ç±»ä¸­å·²ç»å®ç°çš„å†…å®¹æˆ‘ä»¬æ˜¯æ— èƒ½ä¸ºåŠ›çš„ã€‚\n\n\nåŠ¨æ€ä»£ç†ï¼Œå¯ä»¥æ ¹æ®è¿è¡Œæ—¶çš„å§”æ‰˜ç±»åŠ¨æ€çš„ç”Ÿæˆä»£ç†ç±»ï¼Œè¿™æ ·å°±å‡è½»äº†ä»£ç†ç±»çš„è´Ÿæ‹…ï¼Œé¿å…åœ¨ç¼–ç é˜¶æ®µå°±å…·ä½“çš„å§”æ‰˜ç±»å†åšå„ç§åˆ¤æ–­äº†ã€‚\n\nä»£ç†æ¨¡å¼å¾ˆç®€å•ï¼Œä¹Ÿå¾ˆå®ç”¨ï¼Œä½†ä¸è¦å¿˜è®°**ä»£ç†ç±»**å’Œ**å§”æ‰˜ç±»**éœ€è¦å®ç°åŠŸèƒ½çš„æ¥å£æˆ–æŠ½è±¡ç±»ï¼Œä¸è¦å¿½ç•¥äº†è¿™ä¸€ç‚¹ã€‚\n\n****\n\n\n\n\n\n\n\n\n\n\n\n","categories":["è®¾è®¡æ¨¡å¼"]},{"title":"Android æ’ä»¶åŒ–å’Œçƒ­ä¿®å¤çš„å‰ç”Ÿä»Šä¸–","url":"%2F2017%2F11%2F28%2FAndroid%20%E6%8F%92%E4%BB%B6%E5%8C%96%E5%92%8C%E7%83%AD%E4%BF%AE%E5%A4%8D%E7%9A%84%E5%89%8D%E7%94%9F%E4%BB%8A%E4%B8%96%2F","content":"\n## æ¦‚è¿°\n\nåœ¨Androidå¼€å‘ä¸­ï¼Œæ’ä»¶åŒ–å’Œçƒ­ä¿®å¤çš„è¯é¢˜è¶Šæ¥è¶Šå¤šçš„è¢«å¤§å®¶æåŠï¼ŒåŒæ—¶éšç€æŠ€æœ¯çš„è¿­ä»£ï¼Œå„ç§æ¡†æ¶çš„å‘å±•æ›´æ–°ï¼Œæ’ä»¶åŒ–å’Œçƒ­ä¿®å¤çš„æ¡†æ¶ä¼¼ä¹å·²ç»æ—¥è¶‹æˆç†Ÿï¼Œè®¸å¤šå¼€å‘è€…ä¹ŸæŠŠè¿™ä¸¤é¡¹æŠ€æœ¯è¿ç”¨åˆ°å®é™…å¼€å‘åä½œå’Œæ­£å¼çš„äº§å“å½“ä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åŠ¿å¿…éœ€è¦äº†è§£ä¸€ä¸‹è¿™ä¸¤é—¨æŠ€æœ¯ã€‚\n\n\n## æ’ä»¶åŒ–å’Œçƒ­ä¿®å¤\n\né¦–å…ˆéœ€è¦æ˜ç¡®çš„ä¸€ç‚¹ï¼Œ**æ’ä»¶åŒ–å’Œçƒ­ä¿®å¤**ä¸æ˜¯åŒä¸€ä¸ªæ¦‚å¿µï¼Œè™½ç„¶ç«™åœ¨æŠ€æœ¯å®ç°çš„è§’åº¦æ¥è¯´ï¼Œä»–ä»¬éƒ½æ˜¯ä»ç³»ç»ŸåŠ è½½å™¨çš„è§’åº¦å‡ºå‘ï¼Œæ— è®ºæ˜¯é‡‡ç”¨hookæ–¹å¼ï¼Œäº¦æˆ–æ˜¯ä»£ç†æ–¹å¼æˆ–è€…æ˜¯å…¶ä»–åº•å±‚å®ç°ï¼Œéƒ½æ˜¯é€šè¿‡â€œ**æ¬ºéª—**â€Android ç³»ç»Ÿçš„æ–¹å¼æ¥è®©**å®¿ä¸»**æ­£å¸¸çš„åŠ è½½å’Œè¿è¡Œ**æ’ä»¶ï¼ˆè¡¥ä¸ï¼‰**ä¸­çš„å†…å®¹ï¼›ä½†æ˜¯äºŒè€…çš„å‡ºå‘ç‚¹æ˜¯ä¸åŒçš„ã€‚**æ’ä»¶åŒ–**é¡¾åæ€ä¹‰ï¼Œæ›´å¤šæ˜¯æƒ³æŠŠéœ€è¦å®ç°çš„æ¨¡å—æˆ–åŠŸèƒ½å½“åšä¸€ä¸ªç‹¬ç«‹çš„æå–å‡ºæ¥ï¼Œå‡å°‘**å®¿ä¸»**çš„è§„æ¨¡ï¼Œå½“éœ€è¦ä½¿ç”¨åˆ°ç›¸åº”çš„åŠŸèƒ½æ—¶å†å»åŠ è½½ç›¸åº”çš„æ¨¡å—ã€‚**çƒ­ä¿®å¤**åˆ™å¾€å¾€æ˜¯ä»ä¿®å¤bugçš„è§’åº¦å‡ºå‘ï¼Œå¼ºè°ƒçš„æ˜¯åœ¨ä¸éœ€è¦äºŒæ¬¡å®‰è£…åº”ç”¨çš„å‰æä¸‹ä¿®å¤å·²çŸ¥çš„bugã€‚\n\n<!--more-->\n\nä¸ºäº†æ–¹ä¾¿å™è¿°ï¼Œåšä»¥ä¸‹ç§°è°“çº¦å®šï¼š\n> å®¿ä¸»ï¼š å°±æ˜¯å½“å‰è¿è¡Œçš„APP\n> æ’ä»¶ï¼š ç›¸å¯¹äºæ’ä»¶åŒ–æŠ€æœ¯æ¥è¯´ï¼Œå°±æ˜¯è¦åŠ è½½è¿è¡Œçš„apkç±»æ–‡ä»¶\n> è¡¥ä¸ï¼š ç›¸å¯¹äºçƒ­ä¿®å¤æŠ€æœ¯æ¥è¯´ï¼Œå°±æ˜¯è¦åŠ è½½è¿è¡Œçš„*.patch,*.dex,*.apkç­‰ä¸€ç³»åˆ—åŒ…å«dexä¿®å¤å†…å®¹çš„æ–‡ä»¶ã€‚\n\nä»¥ä¸‹æåˆ°å†…å®¹ä¸­çš„å®¿ä¸»å’Œæ’ä»¶ï¼ˆè¡¥ä¸ï¼‰ï¼Œå‡æ˜¯ä¸Šè¿°å«ä¹‰ï¼Œä¸å†èµ˜è¿°ã€‚\n\n\n![Androidæ’ä»¶åŒ–æŠ€æœ¯çš„å…¸å‹åº”ç”¨](http://s1.knowsky.com/20170206/e4as0errukk22.png)\n\nä¸Šå›¾å°±æ˜¯å¯¹Androidæ’ä»¶åŒ–å’Œçƒ­ä¿®å¤ä¹‹é—´å…³ç³»çš„ä½“ç°ã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œåœ¨æŸäº›å¼€å‘å›¢é˜Ÿä¸­ï¼Œä¼šæŠŠçƒ­ä¿®å¤çš„æŠ€æœ¯ï¼Œä½œä¸ºåœ¨APPç«¯éƒ¨ç½²æ—¥å¸¸æ´»åŠ¨çš„åŠŸèƒ½æ¥ç”¨ã€‚è™½ç„¶ï¼Œå®é™…æ•ˆæœæ¥çœ‹æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†é•¿æœŸä½¿ç”¨è¿˜æ˜¯å€¼å¾—å•†æ¦·çš„ã€‚\n\næ—©æœŸå¾ˆå¤šåº”ç”¨çš„åŠ¨æ€æ¢è‚¤åŠŸèƒ½ï¼Œå°±æ˜¯å‚è€ƒäº†Android æ’ä»¶åŒ–çš„æŠ€æœ¯ï¼Œæœ€æ—©çš„æ–°æµªå¾®åšå¤œé—´æ¨¡å¼å°±æ˜¯é€šè¿‡ä¸‹è½½ä¸€ä¸ªå¤œé—´æ¨¡å¼çš„apkæ–‡ä»¶å®Œæˆï¼Œå½“æ—¶åšä¸ºå¼€å‘è€…çš„è‡ªå·±ï¼Œæ„Ÿè§‰å¾ˆé«˜çº§ã€‚å…³äºåŠ¨æ€åŠ è½½çš„åº”ç”¨ï¼Œå…¶å®æœ‰å¾ˆå¤šå¯ä»¥æ‰©å±•çš„æ€è·¯ï¼Œæ¯”å¦‚ç‰¹å®šèŠ‚æ—¥çš„ä¿ƒé”€æ´»åŠ¨ï¼Œé€ƒé¿å®¡æ ¸æœºåˆ¶çš„åŠ¨æ€å¹¿å‘ŠåŠ è½½éƒ½æ˜¯Androidæ’ä»¶åŒ–æŠ€æœ¯å¯ä»¥è€ƒè™‘çš„å®ç°ï¼Œæ›´å¤šå†…å®¹å¯ä»¥å‚è€ƒ[**AndroidåŠ¨æ€åŠ è½½æŠ€æœ¯ ç®€å•æ˜“æ‡‚çš„ä»‹ç»æ–¹å¼**](https://segmentfault.com/a/1190000004062866)\n\n\n\n\nä¸‹é¢å°±ä»æ’ä»¶åŒ–æŠ€æœ¯çš„å‘å±•æºå¤´ï¼Œé€æ­¥å™è¿°ä¸€ä¸‹äºŒè€…çš„å‘å±•å†ç¨‹åŠç°çŠ¶ï¼Œäº†è§£ä¸€ä¸‹æ—¶è‡³ä»Šæ—¥ï¼Œçƒ­ä¿®å¤æ¡†æ¶çš„å‘å±•åˆ°äº†å„ç§åœ°æ­¥ï¼Œæ€»ä½“æ¢³ç†ä¸€ä¸‹çƒ­ä¿®å¤çš„åŸç†ï¼Œå¯¹ç°æœ‰çš„æ¡†æ¶æœ‰ä¸€ä¸ªäº†è§£ã€‚\n\n\n## æ’ä»¶åŒ–\n\n### å‘å±•å†ç¨‹åŠç°çŠ¶\n\nå…³äºæ’ä»¶åŒ–æŠ€æœ¯çš„èµ·æºå¯ä»¥è¿½æº¯åˆ°5å¹´å‰\n- 2012å¹´çš„ [AndroidDynamicLoader](https://github.com/mmin18/AndroidDynamicLoader) ï¼Œä»–çš„åŸç†æ˜¯åŠ¨æ€åŠ è½½ä¸åŒçš„Fragmentå®ç°UIæ›¿æ¢ï¼Œå¯ä»¥è¯´æ˜¯å¼€å±±é¼»ç¥–äº†ï¼Œä½†æ˜¯è¿™ç§æ–¹æ¡ˆå¯æ‰©å±•æ€§ä¸å¼ºã€‚\n- å†åˆ°åæ¥å‡ºç°äº†23Code,ä»–å¯ä»¥ç›´æ¥ä¸‹è½½ä¸€ä¸ªè‡ªå®šä¹‰æ§ä»¶çš„demoï¼Œå¹¶ä¸”è¿è¡Œèµ·æ¥ã€‚\n- 2014å¹´ä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„å¹´ä»½ï¼Œä»»ç‰åˆšï¼ˆä¿—ç§°ä¸»å¸­ï¼‰å‘å¸ƒäº†[dynamic-load-apk](https://github.com/singwhatiwanna/dynamic-load-apk),ä¹Ÿå«åšDLã€‚åœ¨è¿™ä¸ªæ¡†æ¶é‡Œæä¾›äº†ä¸¤ä¸ªå¾ˆé‡è¦çš„æ€è·¯ï¼š\n  - å¦‚ä½•ç®¡ç†æ’ä»¶å†…Activityçš„ç”Ÿå‘½å‘¨æœŸï¼š ä½¿ç”¨ DLProxyActivity é‡‡ç”¨é™æ€ä»£ç†çš„æ–¹å¼å»è°ƒç”¨æ’ä»¶ä¸­Activityçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚\n  - å¦‚ä½•åŠ è½½æ’ä»¶å†…çš„èµ„æºæ–‡ä»¶ï¼šé€šè¿‡åå°„è°ƒç”¨AssetManager ä¸­åˆ°çš„addAssetPathæ–¹æ³•å°±å¯ä»¥å°†ç‰¹å®šè·¯å¾„çš„èµ„æºåŠ è½½åˆ°ç³»ç»Ÿå†…å­˜ä¸­ä½¿ç”¨ã€‚\n\n  ä»¥ä¸Šä¸¤ç‚¹ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸æœ‰æ„ä¹‰çš„ï¼Œå°¤å…¶æ˜¯ç¬¬äºŒç‚¹å…³äºæ’ä»¶èµ„æºçš„è®°è½½ï¼Œæ˜¯åæœŸå‡ºç°çš„è®¸å¤šæ¡†æ¶çš„å‚è€ƒæ€è·¯ã€‚è¿™ä¸ªæ¡†æ¶ä¹Ÿæœ‰ä¸€äº›å±€é™ï¼Œä¸æ”¯æŒæ’ä»¶å†…Serviceã€BroadcastReceiverç­‰éœ€è¦æ³¨å†Œæ‰èƒ½ä½¿ç”¨çš„ç»„ä»¶ï¼ŒåŒæ—¶æ’ä»¶apkä¹Ÿéœ€è¦æŒ‰ç…§å…¶å¼€å‘è§„èŒƒæ¥å®ç°ï¼Œæ€»ä½“æ¥è¯´è¿˜æ˜¯æœ‰ä¸€å®šçš„æˆæœ¬ï¼Œä½†æ— è®ºæ€æ ·éƒ½æ˜¯ä¸€ä¸ªå¾ˆæœ‰ä»·å€¼çš„æ¡†æ¶ã€‚ï¼ˆè¯è¯´è¿™ä¸ªæ¡†æ¶è²Œä¼¼å·²ç»ä¸å†ç»´æŠ¤äº†ï¼Œæœ€è¿‘ä¸€æ¬¡å…³äºä»£ç çš„æ›´æ–°éƒ½æ˜¯2å¹´å‰äº†ï¼Œo(â•¥ï¹â•¥)oï¼‰ã€‚\n- 2015å¹´ [DroidPlugin](https://github.com/DroidPluginTeam/DroidPlugin) \n**[DroidPlugin æ˜¯Andy Zhangåœ¨Androidç³»ç»Ÿä¸Šå®ç°äº†ä¸€ç§æ–°çš„ æ’ä»¶æœºåˆ¶ :å®ƒå¯ä»¥åœ¨æ— éœ€å®‰è£…ã€ä¿®æ”¹çš„æƒ…å†µä¸‹è¿è¡ŒAPKæ–‡ä»¶,æ­¤æœºåˆ¶å¯¹æ”¹è¿›å¤§å‹APPçš„æ¶æ„ï¼Œå®ç°å¤šå›¢é˜Ÿåä½œå¼€å‘å…·æœ‰ä¸€å®šçš„å¥½å¤„ã€‚](https://github.com/DroidPluginTeam/DroidPlugin/blob/master/readme_cn.md)** è¿™æ®µè¯æ˜¯DroidPluginåœ¨Github README æ–‡æ¡£ä¸­çš„ä»‹ç»ã€‚è¿™æ¬¾æ¥è‡ª360çš„æ’ä»¶åŒ–æ¡†æ¶.\n- 2015å¹´ [DynamicAPK](https://github.com/CtripMobile/DynamicAPK) è¿™ä¸ªå°±â€¦â€¦ï¼Œè²Œä¼¼å› ä¸ºLicenseçš„åŸå› å·²ç»å®Œå…¨ä¸æ›´æ–°äº†ã€‚\n\n- 2017 [RePlugin](https://github.com/Qihoo360/RePlugin) è¿™æ˜¯360 å¼€æºçš„æ’ä»¶åŒ–æ¡†æ¶ï¼ŒæŒ‰ç…§ä»–è‡ªå·±çš„è¯´æ³•ï¼Œç›¸è¾ƒäºå…¶ä»–æ¡†æ¶ï¼Œä»–å¯¹ç³»ç»Ÿçš„hookåªæœ‰ä¸€å¤„ï¼Œé‚£å°±æ˜¯ClassLoaderï¼Œè¿™æ ·ä»ç†è®ºæ¥è¯´ï¼Œè²Œä¼¼ä¼šæœ‰æ›´å¥½çš„ç¨³å®šæ€§ã€‚\n\n- 2017å¹´ [atlas](https://github.com/alibaba/atlas)è¿™ä¸ªæ˜¯é˜¿é‡Œä»Šå¹´åˆšåˆšå¼€æºçš„æ’ä»¶åŒ–å¼€å‘æ¡†æ¶ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸å¼ºå¤§ï¼›å…·ä½“åŸç†å‚è€ƒ[è¯¦è§£ Atlas æ¡†æ¶åŸç†](https://www.xttblog.com/?p=1141)ï¼›è¿˜æ²¡æœ‰ç”¨è¿‡ã€‚\n\n- [Small](https://github.com/wequick/Small)  æœ€åå†è¯´ä¸€ä¸‹Smallï¼Œä¸ªäººæ„Ÿè§‰Small æ‰€æä¾›äº†ä¸€ç§æ¯”æ’ä»¶åŒ–æ›´é«˜å±‚æ¬¡çš„æ¦‚å¿µï¼Œç»„ä»¶åŒ–ï¼›æŠŠä¸€ä¸ªå®Œæ•´çš„APPçœ‹æˆæ˜¯ç”±è®¸å¤šå¯ä»¥å¤ç”¨æ¨¡å—ç»„ä»¶ç»„æˆï¼ˆè¿™ä¸ªæœ‰ç‚¹åƒReact Nativeçš„å¼€å‘ç†å¿µï¼‰ï¼›å¼€å‘èµ·æ¥åƒæ˜¯æ­ç§¯æœ¨çš„æ„Ÿè§‰ã€‚æœ‰å…´è¶£çš„å¯ä»¥å»[Smallå®˜ç½‘](http://code.wequick.net/Small/cn/home)äº†è§£ä¸€ä¸‹ã€‚\n\n\n## çƒ­ä¿®å¤\n\nç›¸è¾ƒäºæ’ä»¶åŒ–ï¼Œçƒ­ä¿®å¤æŠ€æœ¯çš„ä½¿ç”¨æ›´åŠ çš„é¢‘ç¹ï¼Œå› ä¸ºè¿™é¡¹æŠ€æœ¯åˆ‡å®å…³åˆ‡åˆ°æˆ‘ä»¬å®é™…å¼€å‘çš„äº§å“ï¼Œèƒ½å¤Ÿæ›´å¿«é€Ÿæ›´ä¾¿æ·çš„ä¿®å¤çº¿ä¸Šbugï¼Œæ‰èƒ½å¸¦æ¥æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚å› æ­¤ä¸‹é¢å°±ç»“åˆçƒ­ä¿®å¤çš„åŸç†äº†è§£ä¸€ä¸‹çƒ­ä¿®å¤çš„ä½¿ç”¨åŠå‘å±•ç°çŠ¶ã€‚\n\n> ä»¥ä¸‹æ‰€æœ‰åˆ†ææºè‡ªçƒ­ä¿®å¤ç›¸å…³æ–‡ç« ï¼Œè¿™é‡Œåªæ˜¯æŠŠç»“è®ºæ•´ç†äº†å‡ºæ¥ã€‚å…·ä½“åˆ†æå°±ä¸å†æ‹¾äººç‰™æ…§äº†ï¼Œå¯¹å®ç°ç»†èŠ‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥æŸ¥çœ‹ç›¸åº”çš„é“¾æ¥ã€‚\n\n\n### ç±»åŠ è½½åŸç†\n\nè¯´èµ·çƒ­ä¿®å¤å°±ä¸å¾—ä¸æç±»çš„åŠ è½½æœºåˆ¶ï¼Œå’Œå¸¸è§„çš„JVMç±»ä¼¼ï¼Œåœ¨Androidä¸­ç±»çš„åŠ è½½ä¹Ÿæ˜¯é€šè¿‡ClassLoaderæ¥å®Œæˆï¼Œå…·ä½“æ¥è¯´å°±æ˜¯PathClassLoader å’Œ DexClassLoader è¿™ä¸¤ä¸ªAndroidä¸“ç”¨çš„ç±»åŠ è½½å™¨ï¼Œè¿™ä¸¤ä¸ªç±»çš„åŒºåˆ«å¦‚ä¸‹ï¼š\n\n- PathClassLoaderï¼šåªèƒ½åŠ è½½å·²ç»å®‰è£…åˆ°Androidç³»ç»Ÿä¸­çš„apkæ–‡ä»¶ï¼ˆ/data/appç›®å½•ï¼‰ï¼Œæ˜¯Androidé»˜è®¤ä½¿ç”¨çš„ç±»åŠ è½½å™¨ã€‚\n- DexClassLoaderï¼šå¯ä»¥åŠ è½½ä»»æ„ç›®å½•ä¸‹çš„dex/jar/apk/zipæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸€å¼€å§‹æåˆ°çš„è¡¥ä¸ã€‚\n\nè¿™ä¸¤ä¸ªç±»éƒ½æ˜¯ç»§æ‰¿è‡ªBaseDexClassLoaderï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹BaseDexClassLoaderçš„æ„é€ å‡½æ•°ã€‚\n\n```java\n    public BaseDexClassLoader(String dexPath, File optimizedDirectory,\n            String libraryPath, ClassLoader parent) {\n        super(parent);\n        this.pathList = new DexPathList(this, dexPath, libraryPath, optimizedDirectory);\n    }\n```\nè¿™ä¸ªæ„é€ å‡½æ•°åªåšäº†ä¸€ä»¶äº‹ï¼Œå°±æ˜¯é€šè¿‡ä¼ é€’è¿›æ¥çš„ç›¸å…³å‚æ•°ï¼Œåˆå§‹åŒ–äº†ä¸€ä¸ªDexPathListå¯¹è±¡ã€‚**DexPathListçš„æ„é€ å‡½æ•°ï¼Œå°±æ˜¯å°†å‚æ•°ä¸­ä¼ é€’è¿›æ¥çš„ç¨‹åºæ–‡ä»¶ï¼ˆå°±æ˜¯è¡¥ä¸æ–‡ä»¶ï¼‰å°è£…æˆElementå¯¹è±¡ï¼Œå¹¶å°†è¿™äº›å¯¹è±¡æ·»åŠ åˆ°ä¸€ä¸ªElementçš„æ•°ç»„é›†åˆdexElementsä¸­å»**ã€‚\n\n\n>ClassLoaer çš„åŠ è½½æœºåˆ¶æ˜¯ä¸€ç§ç‰¹åˆ«èªæ˜çš„æ–¹å¼ï¼Œ**åŒäº²å§”æ‰˜æœºåˆ¶**ï¼Œåœ¨è¿™ç§æœºåˆ¶ä¸‹ï¼Œä¸€ä¸ªClassåªä¼šè¢«åŠ è½½ä¸€æ¬¡ã€‚\n\n\nå¯¹äºClassLoaderåŠ è½½æœºåˆ¶åŠåŒäº²å§”æ‰˜æœºåˆ¶çš„åˆ†æå¯ä»¥å‚è€ƒ[Androidè§£æClassLoaderï¼ˆä¸€ï¼‰Javaä¸­çš„ClassLoader](http://liuwangshu.cn/application/classloader/1-java-classloader-.html)ã€‚\n\n\nè¿™é‡Œéœ€è¦æ˜ç™½çš„ä¸€ç‚¹æ˜¯å¯¹äºä¸€ä¸ªClassLoaderï¼ˆç±»åŠ è½½å™¨ï¼‰æ¥è¯´ï¼Œå°†ä¸€ä¸ªå…·ä½“çš„ç±»ï¼ˆclassï¼‰åŠ è½½åˆ°å†…å­˜ä¸­å…¶å®æ˜¯ç”±è™šæ‹Ÿæœºå®Œæˆçš„ï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œæˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹åº”è¯¥æ˜¯**å¦‚ä½•å»æ‰¾åˆ°è¿™ä¸ªéœ€è¦åŠ è½½çš„ç±»**ã€‚\n\nå‡è®¾æˆ‘ä»¬ç°åœ¨è¦å»æŸ¥æ‰¾ä¸€ä¸ªåä¸ºnameçš„classï¼Œé‚£ä¹ˆDexClassLoaderå°†é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°ï¼š\n\n- åœ¨DexClassLoaderçš„findClass æ–¹æ³•ä¸­é€šè¿‡ä¸€ä¸ªDexPathListå¯¹è±¡findClass()æ–¹æ³•æ¥è·å–class\n- åœ¨DexPathListçš„findClass æ–¹æ³•ä¸­ï¼Œå¯¹ä¹‹å‰æ„é€ å¥½dexElementsæ•°ç»„é›†åˆè¿›è¡Œéå†ï¼Œä¸€æ—¦æ‰¾åˆ°ç±»åä¸nameç›¸åŒçš„ç±»æ—¶ï¼Œå°±ç›´æ¥è¿”å›è¿™ä¸ªclassï¼Œæ‰¾ä¸åˆ°åˆ™è¿”å›nullã€‚\n\næ€»çš„æ¥è¯´ï¼Œ**é€šè¿‡DexClassLoaderæŸ¥æ‰¾ä¸€ä¸ªç±»ï¼Œæœ€ç»ˆå°±æ˜¯å°±æ˜¯åœ¨ä¸€ä¸ªæ•°ç»„ä¸­æŸ¥æ‰¾ç‰¹å®šå€¼çš„æ“ä½œã€‚**\n\nç»¼åˆä»¥ä¸Šæ‰€æœ‰çš„è§‚ç‚¹ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ä¸€ç§éå¸¸ç®€å•ç²—æš´çš„çƒ­ä¿®å¤æ–¹æ¡ˆã€‚å‡è®¾ç°åœ¨ä»£ç ä¸­çš„æŸä¸€ä¸ªç±»æˆ–è€…æ˜¯æŸå‡ ä¸ªç±»æœ‰bugï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨ä¿®å¤å®Œbugä¹‹åï¼Œå¯ä»¥**å°†è¿™äº›ä¸ªç±»æ‰“åŒ…æˆä¸€ä¸ªè¡¥ä¸æ–‡ä»¶ï¼Œç„¶åé€šè¿‡è¿™ä¸ªè¡¥ä¸æ–‡ä»¶å°è£…å‡ºä¸€ä¸ªElementå¯¹è±¡ï¼Œå¹¶ä¸”å°†è¿™ä¸ªElementå¯¹è±¡æ’åˆ°åŸæœ‰dexElementsæ•°ç»„çš„æœ€å‰ç«¯**ï¼Œè¿™æ ·å½“DexClassLoaderå»åŠ è½½ç±»æ—¶ï¼Œä¼˜å…ˆä¼šä»æˆ‘ä»¬æ’å…¥çš„è¿™ä¸ªElementä¸­æ‰¾åˆ°ç›¸åº”çš„ç±»ï¼Œè™½ç„¶é‚£ä¸ªæœ‰bugçš„ç±»è¿˜å­˜åœ¨äºæ•°ç»„ä¸­åé¢çš„Elementä¸­ï¼Œä½†ç”±äºåŒäº²åŠ è½½æœºåˆ¶çš„ç‰¹ç‚¹ï¼Œè¿™ä¸ªæœ‰bugçš„ç±»å·²ç»æ²¡æœ‰æœºä¼šè¢«åŠ è½½äº†ï¼Œè¿™æ ·ä¸€ä¸ªbugå°±åœ¨æ²¡æœ‰é‡æ–°å®‰è£…åº”ç”¨çš„æƒ…å†µä¸‹ä¿®å¤äº†ã€‚\n\næœ‰äº†ä¸Šé¢çš„æ€è·¯ï¼Œå…¶å®æˆ‘ä»¬å°±å¯ä»¥è‡ªå·±åŠ¨æ‰‹å»å®ç°ä¸€ä¸ªç®€å•çš„çƒ­ä¿®å¤æ¡†æ¶äº†ã€‚è¿™é‡Œæ¨èä¸€ç¯‡\n[çƒ­ä¿®å¤â€”â€”æ·±å…¥æµ…å‡ºåŸç†ä¸å®ç°](https://juejin.im/post/5a0ad2b551882531ba1077a2)ï¼Œæ–‡ä¸­ä½œè€…æ·±å…¥åˆ†æäº†çƒ­ä¿®å¤åŸç†ï¼Œå¹¶åŸºäºä»¥ä¸ŠåŸç†å®ç°äº†ä¸€ä¸ªåŸºç¡€çš„çƒ­ä¿®å¤æ¡†æ¶ï¼Œå®ç°è¿‡ç¨‹åˆ†æçš„éå¸¸ç»†è‡´æ·±å…¥ï¼Œéå¸¸é€‚åˆåšä¸ºçƒ­ä¿®å¤å…¥é—¨åŸç†çš„äº†è§£ã€‚\n\n### QQ ç©ºé—´è¶…çº§è¡¥ä¸æ–¹æ¡ˆ\n\nçœ‹å®Œä¸Šé¢çš„åŸç†ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—çƒ­ä¿®å¤å¾ˆç®€å•ï¼Œæ²¡ä»€ä¹ˆå¯ç ”ç©¶çš„å‘¢ï¼Ÿå…¶å®ä¸ç„¶ï¼ŒJavaæ˜¯ä¸€é—¨é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ç±»ä¼šæœ‰ç»§æ‰¿å…³ç³»ï¼Œä¼šç›¸äº’ä¾èµ–å¼•ç”¨ã€‚åŒæ—¶Androidè™šæ‹Ÿæœºå’Œå¸¸è§„çš„JVM ä¸åŒï¼ŒåŠ è½½çš„å¹¶ä¸æ˜¯.classè€Œæ˜¯dex(å‡†ç¡®çš„æ¥è¯´æ˜¯ç»è¿‡ä¼˜åŒ–çš„odex)ï¼Œåœ¨è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ä¸­ï¼ŒåŠ¿å¿…ä¼šæœ‰ä¸€äº›æ–°çš„é—®é¢˜å€¼å¾—æˆ‘ä»¬å»å…³æ³¨ã€‚è¿™ä¸ªé—®é¢˜å°±æ˜¯çš„CLASS_ISPREVERIFIEDï¼Œä»€ä¹ˆæ„æ€å‘¢ã€‚\n\n>- åœ¨apkå®‰è£…çš„æ—¶å€™ç³»ç»Ÿä¼šå°†dexæ–‡ä»¶ä¼˜åŒ–æˆodexæ–‡ä»¶ï¼Œåœ¨ä¼˜åŒ–çš„è¿‡ç¨‹ä¸­ä¼šæ¶‰åŠä¸€ä¸ªé¢„æ ¡éªŒçš„è¿‡ç¨‹\n>- å¦‚æœä¸€ä¸ªç±»çš„staticæ–¹æ³•ï¼Œprivateæ–¹æ³•ï¼Œoverrideæ–¹æ³•ä»¥åŠæ„é€ å‡½æ•°ä¸­å¼•ç”¨äº†å…¶ä»–ç±»ï¼Œè€Œä¸”è¿™äº›ç±»éƒ½å±äºåŒä¸€ä¸ªdexæ–‡ä»¶ï¼Œæ­¤æ—¶è¯¥ç±»å°±ä¼šè¢«æ‰“ä¸ŠCLASS_ISPREVERIFIED \n>- å¦‚æœåœ¨è¿è¡Œæ—¶è¢«æ‰“ä¸ŠCLASS_ISPREVERIFIEDçš„ç±»å¼•ç”¨äº†å…¶ä»–dexçš„ç±»ï¼Œå°±ä¼šæŠ¥é”™\n>- æ­£å¸¸çš„åˆ†åŒ…æ–¹æ¡ˆä¼šä¿è¯ç›¸å…³ç±»è¢«æ‰“å…¥åŒä¸€ä¸ªdexæ–‡ä»¶\n>- æƒ³è¦ä½¿å¾—patchå¯ä»¥è¢«æ­£å¸¸åŠ è½½ï¼Œå°±å¿…é¡»ä¿è¯ç±»ä¸ä¼šè¢«æ‰“ä¸ŠCLASS_ISPREVERIFIEDæ ‡è®°ã€‚è€Œè¦å®ç°è¿™ä¸ªç›®çš„å°±å¿…é¡»è¦åœ¨åˆ†å®ŒåŒ…åçš„classä¸­æ¤å…¥å¯¹å…¶ä»–dexæ–‡ä»¶ä¸­ç±»çš„å¼•ç”¨\n \n*ä»¥ä¸Šå†…å®¹æ‘˜è‡ª[Androidçƒ­ä¿®å¤æŠ€æœ¯â€”â€”QQç©ºé—´è¡¥ä¸æ–¹æ¡ˆè§£æ(2) ](https://yq.aliyun.com/articles/70321?spm=5176.100239.blogcont70320.23.Bhmli6)*\n\n**è¦åœ¨å·²ç»ç¼–è¯‘å®Œæˆåçš„ç±»ä¸­æ¤å…¥å¯¹å…¶ä»–ç±»çš„å¼•ç”¨ï¼Œå°±éœ€è¦æ“ä½œå­—èŠ‚ç ï¼Œæƒ¯ç”¨çš„æ–¹æ¡ˆæ˜¯æ’æ¡©ã€‚å¸¸è§çš„å·¥å…·æœ‰javaassistï¼Œasmç­‰**\n\nQQ ç©ºé—´è¡¥ä¸æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨javaassist æ’æ¡©çš„æ–¹å¼è§£å†³äº†CLASS_ISPREVERIFIEDçš„éš¾é¢˜ã€‚\n\n\n### Tinker \n\nQQç©ºé—´è¶…çº§è¡¥ä¸ï¼Œ**â€œè¶…çº§è¡¥ä¸â€**å¾ˆå¤šæƒ…å†µä¸‹æ„å‘³ç€è¡¥ä¸æ–‡ä»¶å¾ˆå¤§ï¼Œè€Œå°†è¿™æ ·ä¸€ä¸ªå¤§æ–‡ä»¶å¤¹åŠ è½½åœ¨å†…å­˜ä¸­æ„å»ºä¸€ä¸ªElementå¯¹è±¡ï¼Œæ’å…¥åˆ°æ•°ç»„æœ€å‰ç«¯æ˜¯éœ€è¦è€—è´¹æ—¶é—´çš„,æ— ç–‘ä¼šå°è±¡åº”ç”¨å¯åŠ¨çš„é€Ÿåº¦ã€‚å› æ­¤Tinker æå‡ºäº†å¦å¤–ä¸€ç§æ€è·¯ã€‚\n\n![](https://raw.githubusercontent.com/Tencent/tinker/master/assets/tinker.png)\n\nå›¾ç‰‡æºè‡ªhttps://github.com/Tencent/tinker\n\nTinkerçš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼Œé€šè¿‡ä¿®å¤å¥½çš„class.dex å’ŒåŸæœ‰çš„class.dexæ¯”è¾ƒå·®ç”Ÿå·®é‡åŒ…è¡¥ä¸æ–‡ä»¶patch.dexï¼Œåœ¨æ‰‹æœºä¸Šè¿™ä¸ªpatch.dexåˆä¼šå’ŒåŸæœ‰çš„class.dex åˆå¹¶ç”Ÿæˆæ–°çš„æ–‡ä»¶fix_class.dexï¼Œç”¨è¿™ä¸ªæ–°çš„fix_class.dex æ•´ä½“æ›¿æ¢åŸæœ‰çš„dexPathListçš„ä¸­çš„å†…å®¹ï¼Œå¯ä»¥è¯´æ˜¯ä»æ ¹æœ¬ä¸ŠæŠŠbugç»™å¹²æ‰äº†ã€‚\n\nTinker æä¾›çš„æ€è·¯å¯ä»¥è¯´æ˜¯éå¸¸æ–°å¥‡ï¼Œä¹Ÿéå¸¸å€¼å¾—æˆ‘ä»¬å»å­¦ä¹ ã€‚ä¸Šå›¾ä¸­è¿‡ç¨‹çœ‹ä¼¼ç®€å•ï¼Œä½†å…¶å®å…·ä½“å®ç°èµ·æ¥è¿˜çœŸçš„ä¸ç®€å•ã€‚ä½ æœ‰æƒ³è¿‡ä¸¤ä¸ª.dex æ˜¯å¦‚ä½•æ¯”è¾ƒå¾—å‡ºå·®å¼‚åŒ–æ–‡ä»¶patch.dex çš„å—ï¼Ÿæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹é¸¿ç¿”çš„è¿™ç¯‡åˆ†æ[Android çƒ­ä¿®å¤ Tinker æºç åˆ†æä¹‹DexDiff / DexPatch](http://blog.csdn.net/lmj623565791/article/details/60874334)\n\nå½“ç„¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œpatch.dexå’ŒåŸå…ˆçš„class.dex åˆå¹¶çš„æ—¶å€™éœ€è¦æ–°çš„è¿›ç¨‹å»å®Œæˆï¼ŒåŒæ—¶è€ƒè™‘çš„ç°åœ¨å¤§å¤šæ•°åº”ç”¨çš„è§„æ¨¡ï¼Œmultidexå·²ç»æ˜¯å¾ˆå¸¸è§çš„äº‹æƒ…äº†ï¼Œå› æ­¤å¤šä¸ªdex ä¹‹é—´çš„åˆå¹¶ç­–ç•¥åŠæˆåŠŸç‡ï¼Œéƒ½æ˜¯åœ¨ä½¿ç”¨Tinkeræ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚\n\nå…³äºTinker æ›´å¤šç»†èŠ‚å¯ä»¥å‚è€ƒ [å¾®ä¿¡Androidçƒ­è¡¥ä¸å®è·µæ¼”è¿›ä¹‹è·¯](https://github.com/WeMobileDev/article/blob/master/å¾®ä¿¡Androidçƒ­è¡¥ä¸å®è·µæ¼”è¿›ä¹‹è·¯.md)\n\n\n**Tinker æä¾›çš„æ–‡æ¡£åŠexampleéå¸¸å®Œå–„ï¼Œå¯¹äºæœ‰å…´è¶£æ¥å…¥çš„å¼€å‘è€…å¯ä»¥è¯´æ˜¯éå¸¸å‹å¥½äº†ï¼Œä½†æ€»ä½“æ¥è¯´æ¥å…¥è¿‡ç¨‹è¿˜æ˜¯æœ‰äº›å¤æ‚ï¼Œå¯¹æ•´ä¸ªé¡¹ç›®çš„ä¾µå…¥è¿˜æ˜¯è¾ƒå¼ºï¼ŒTinkeræ˜¯ä¸ªäººå”¯ä¸€ä½¿ç”¨è¿‡çš„çƒ­ä¿®å¤çš„æ¡†æ¶ï¼Œæ€»ä½“æ¥è¯´è¿˜æ˜¯ä¸é”™çš„ï¼Œé€šè¿‡æ¥å…¥åˆ°å®é™…åº”ç”¨ä¸­ï¼Œå¯¹gradleä¹Ÿæœ‰äº†æ–°çš„è®¤è¯†ï¼Œå¯¹gradleæœ‰å…´è¶£çš„åŒå­¦ï¼Œå…¶å®å¯ä»¥çœ‹çœ‹tinkerçš„gradleæ¥å…¥æ–¹å¼**\n### HotFix\n\nä»¥ä¸Šæåˆ°çš„ä¸¤ç§æ–¹å¼ï¼Œè™½ç„¶ç­–ç•¥æœ‰æ‰€ä¸åŒï¼Œä½†æ€»çš„æ¥è¯´éƒ½æ˜¯ä»ä¸Šå±‚ClassLoaderçš„è§’åº¦å‡ºå‘ï¼Œç”±äºClassLoaderçš„ç‰¹ç‚¹ï¼Œå¦‚æœæƒ³è¦æ–°çš„è¡¥ä¸æ–‡ä»¶å†æ¬¡ç”Ÿæ•ˆï¼Œæ— è®ºä½ æ˜¯æ’æ¡©è¿˜æ˜¯æå‰åˆå¹¶ï¼Œéƒ½éœ€è¦é‡æ–°å¯åŠ¨åº”ç”¨æ¥åŠ è½½æ–°çš„DexPathListã€‚è¿™æ ·å°±æ— æ³•åœ¨ç”¨æˆ·ç¥ä¸çŸ¥é¬¼ä¸è§‰çš„æƒ…å†µä¸‹æŠŠbugä¿®å¤äº†ï¼ŒHotFixåœ¨è¿™æ–¹é¢å°±æœ‰ç»å¯¹çš„ä¼˜åŠ¿äº†ã€‚\n\n>HotFix(å³AndFixï¼‰ï¼Œæ˜¯åœ¨AndFix çš„åŸºç¡€ä¹‹ä¸Šæä¾›äº†è¡¥ä¸å®‰å…¨æœåŠ¡åŠç‰ˆæœ¬ç®¡ç†ç­‰ç›¸å…³å†…å®¹ï¼Œæ–¹ä¾¿å¹¿å¤§çš„å¼€å‘äººå‘˜ä½¿ç”¨ã€‚\n\nAndFix æä¾›äº†ä¸€ç§è¿è¡Œæ—¶åœ¨Nativeä¿®æ”¹FiledæŒ‡é’ˆçš„æ–¹å¼ï¼Œå®ç°æ–¹æ³•çš„æ›¿æ¢ï¼Œè¾¾åˆ°å³æ—¶ç”Ÿæ•ˆæ— éœ€é‡å¯ï¼Œå¯¹åº”ç”¨æ— æ€§èƒ½æ¶ˆè€—çš„ç›®çš„ã€‚\n\n![AndFixåŸç†å›¾](https://github.com/alibaba/AndFix/raw/master/images/principle.png)\n\næ›´å¤šç»†å¯ä»¥å‚è€ƒ[https://github.com/alibaba/AndFix](https://github.com/alibaba/AndFix)ï¼ŒNativeå±‚ä¸æ€ä¹ˆç†è§£ï¼Œå°±ä¸å¼ºè¡Œè£…é€¼äº†o(â•¯â–¡â•°)oã€‚\n\nç”±äºä»–æ˜¯Nativeå±‚æ“ä½œï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬åœ¨Javaå±‚ä¸­æ–°å¢å­—æ®µï¼Œæˆ–è€…æ˜¯ä¿®æ”¹ç±»çš„æ–¹æ³•ï¼Œä»–æ˜¯æ— èƒ½ä¸ºåŠ›çš„ã€‚åŒæ—¶ç”±äºAndroidåœ¨å›½å†…å˜æˆäº†å®‰å“ï¼Œå„å¤§æ‰‹æœºå‚å•†å®šåˆ¶äº†è‡ªå·±çš„ROMï¼Œæ‰€ä»¥å¾ˆå¤šåº•å±‚å®ç°çš„å·®å¼‚ï¼Œå¯¼è‡´AndFixçš„å…¼å®¹æ€§å¹¶ä¸æ˜¯å¾ˆå¥½ã€‚\n\n\n### Sophix\n\n**é˜¿é‡Œæ¨å‡ºä¸šç•Œé¦–ä¸ªéä¾µå…¥å¼çƒ­ä¿®å¤æ–¹æ¡ˆSophixï¼Œé¢ è¦†ç§»åŠ¨ç«¯ä¼ ç»Ÿå‘ç‰ˆæ›´æ–°æµç¨‹ï¼**\n\nè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡äº†è§£åˆ°Sophixæ—¶çœ‹åˆ°çš„æ–‡ç« æ ‡é¢˜[åŸæ–‡é“¾æ¥](http://mp.weixin.qq.com/s/5KjSPvUflbg0pVRIjtLiRA?spm=5176.100239.blogcont102404.14.ARzI6c);å¯¹äºæŠ€æœ¯ç±»çš„æ–‡ç« æ¥è¯´ï¼Œæ•¢äºä½¿ç”¨**é¢ è¦†**è¿™ä¸¤ä¸ªå­—ï¼Œè¦ä¹ˆæ˜¯æ ‡é¢˜å…šï¼›è¦ä¹ˆå°±æ˜¯çœŸçš„å¾ˆæœ‰è´§ã€‚\n\nSophix å¯ä»¥è¯´æ˜¯åšé‡‡ä¼—é•¿ï¼Œå‰é¢æåˆ°çš„TinkeråŠAndFix éƒ½åœ¨æŸä¸€æ–¹é¢å­˜åœ¨ç¼ºé™·ã€‚å› æ­¤Sophix ä¾¿å–é•¿è¡¥çŸ­ï¼Œé‡‡ç”¨**å…¨é‡æ›¿æ¢**çš„æ€è·¯ï¼Œä»ä¸€ç§æ›´é«˜çš„å±‚æ¬¡å®ç°äº†çƒ­ä¿®å¤ã€‚è¿™è²Œä¼¼ä¹Ÿæ˜¯äº‹ç‰©å‘å±•çš„ä¸€è´¯è§„å¾‹ï¼Œåæ¥çš„æ–°ç”Ÿäº‹ç‰©æ€»ç»“å‰äººçš„ç»éªŒæ•™è®­ï¼Œå¸æ”¶å¥½çš„æ€æƒ³ï¼Œå˜å¾—æ›´å¥½ã€‚\n\nå…³äºSophix çš„åŸç†çœ‹äº†å¾ˆå¤šç¯‡æ–‡ç« ï¼Œæ„Ÿè§‰è¿™ç¯‡[å¹²è´§æ»¡æ»¡ï¼ŒAndroidçƒ­ä¿®å¤æ–¹æ¡ˆä»‹ç»](https://yq.aliyun.com/articles/231111?utm_content=m_34179)åˆ†æçš„ä¸é”™ï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹ä¸€ä¸‹ã€‚\n\næ€»çš„æ¥è¯´ï¼ŒSophixåº”è¯¥æ˜¯ç°æœ‰æœ€æˆç†Ÿçš„çƒ­ä¿®å¤æ–¹æ¡ˆäº†ã€‚\n\n### å…¶ä»–åŠæ€»ç»“\n\nå½“ç„¶å°±çƒ­ä¿®å¤çš„å®ç°ï¼Œå„ä¸ªå¤§å‚è¿˜æœ‰å„è‡ªçš„å®ç°ï¼Œæ¯”å¦‚é¥¿äº†å—çš„[Amigo](https://github.com/eleme/Amigo),ç¾å›¢çš„[Robust](https://github.com/Meituan-Dianping/Robust),å®ç°åŠä¼˜ç¼ºç‚¹å„æœ‰å·®å¼‚ï¼Œä½†æ€»çš„æ¥è¯´å°±æ˜¯ä¸¤å¤§ç±»\n\n- ClassLoader åŠ è½½æ–¹æ¡ˆ\n- Nativeå±‚æ›¿æ¢æ–¹æ¡ˆ\n\næˆ–è€…æ˜¯å‚è€ƒAndroid Studio Instant Run çš„æ€è·¯å®ç°ä»£ç æ•´ä½“çš„å¢é‡æ›´æ–°ã€‚ä½†è¿™æ ·åŠ¿å¿…ä¼šå¸¦æ¥æ€§èƒ½çš„å½±å“ã€‚\n\nç»¼ä¸Šæ‰€è¿°ï¼Œå…¶å®å¯¹äºçƒ­ä¿®å¤å¾ˆéš¾æœ‰ä¸€ç§ååˆ†å®Œç¾çš„è§£å†³æ–¹æ¡ˆã€‚åœ¨Androidå¼€å‘ä¸­ï¼Œå››å¤§ç»„ä»¶ä½¿ç”¨å‰éœ€è¦åœ¨AndroidManifestä¸­æå‰å£°æ˜ï¼Œè€Œå¦‚æœéœ€è¦ä½¿ç”¨çƒ­ä¿®å¤çš„æ–¹å¼ï¼Œæ— è®ºæ˜¯æå‰å å‘äº¦æˆ–æ˜¯åŠ¨æ€ä¿®æ”¹ï¼Œéƒ½ä¼šå¸¦æ¥å¾ˆå¼ºçš„ä¾µå…¥æ€§ï¼ˆå› æ­¤ï¼ŒSophixæ˜¯ä¸æ”¯æŒå››å¤§ç»„ä»¶ä¿®å¤çš„ï¼Œè¿™ä¹Ÿæ˜¯å…¶éä¾µå…¥æ€§è®¾è®¡ç†å¿µæ— æ³•é¿å…çš„äº‹æƒ…äº†ï¼Œä¸çŸ¥é“ä»¥åä¼šä¸ä¼šæœ‰æ–°çš„åŠæ³•ï¼‰ã€‚å†è€…Androidç¢ç‰‡åŒ–çš„é—®é¢˜ï¼Œå¯¹çƒ­ä¿®å¤æ–¹æ¡ˆçš„é€‚é…ä¹Ÿæ˜¯ä¸€ä¸ªè€ƒéªŒã€‚é€šè¿‡æŸ¥çœ‹å‡ å¤§ä»¥å¼€æºåœ¨Githubä¸Šçš„çƒ­ä¿®å¤æ–¹æ¡ˆï¼Œåœ¨issueä¸­å¯ä»¥çœ‹åˆ°æåˆ°æœ€å¤šçš„é—®é¢˜è¿˜æ˜¯å…¼å®¹æ€§ã€‚\n\nå› æ­¤ï¼Œé¢å¯¹å®é™…çš„å¼€å‘ï¼Œé€‰æ‹©ä½¿ç”¨æˆ–è€…è¯´é€‰æ‹©å“ªç§æ–¹æ¡ˆï¼Œå¿…é¡»ç¬¦åˆå®é™…çš„åº”ç”¨çš„åœºæ™¯ï¼Œä¸€å¥è¯ï¼Œæ²¡æœ‰æœ€å¥½çš„ï¼Œåªæœ‰åˆé€‚çš„ã€‚\n\n\n******\n\nå¥½äº†ï¼Œæ’ä»¶åŒ–å’Œçƒ­ä¿®å¤çŸ¥è¯†å°±æ¢³ç†åˆ°è¿™é‡Œäº†ã€‚\n\n## ç›¸å…³å†…å®¹\n\n[AndroidåŠ¨æ€åŠ è½½æŠ€æœ¯ ç®€å•æ˜“æ‡‚çš„ä»‹ç»æ–¹å¼](https://segmentfault.com/a/1190000004062866)\n[Android æ’ä»¶åŒ–çš„ è¿‡å» ç°åœ¨ æœªæ¥](https://www.kymjs.com/code/2016/05/04/01/)\n[ZeusPlugin: æŒé˜…APPæ’ä»¶è¡¥ä¸](http://www.jianshu.com/p/b1e7b6326330)\n[Androidæ’ä»¶åŒ–ï¼šä»å…¥é—¨åˆ°æ”¾å¼ƒ](http://www.infoq.com/cn/articles/android-plug-ins-from-entry-to-give-up)\n[Android å…¨é¢æ’ä»¶åŒ– RePlugin æµç¨‹ä¸æºç è§£æ](https://juejin.im/post/59752eb1f265da6c3f70eed9)\n[ã€Šå…¨é¢æ’ä»¶åŒ–â€”â€”RePluginçš„ä½¿å‘½ã€‹](https://mp.weixin.qq.com/s?__biz=MzA3ODg4MDk0Ng==&amp;mid=2651113434&amp;idx=1&amp;sn=99a473c6fad2f7b366b2cba2afb96f7a&amp;chksm=844c6e07b33be7112222c0d78be23979912f12d6c99ad2c7bfac766e67e4be4619709f170b09&amp;mpshare=1&amp;scene=1&amp;)\n[è¯¦è§£ Atlas æ¡†æ¶åŸç†](https://www.xttblog.com/?p=1141)\n[çƒ­ä¿®å¤â€”â€”æ·±å…¥æµ…å‡ºåŸç†ä¸å®ç°](https://juejin.im/post/5a0ad2b551882531ba1077a2)\n[Androidè§£æClassLoaderï¼ˆä¸€ï¼‰Javaä¸­çš„ClassLoader](http://liuwangshu.cn/application/classloader/1-java-classloader-.html)\n[Androidçƒ­ä¿®å¤æŠ€æœ¯â€”â€”QQç©ºé—´è¡¥ä¸æ–¹æ¡ˆè§£æ(2) ](https://yq.aliyun.com/articles/70321?spm=5176.100239.blogcont70320.23.Bhmli6)\n[Androidçƒ­ä¿®å¤æŠ€æœ¯â€”â€”QQç©ºé—´è¡¥ä¸æ–¹æ¡ˆè§£æ(3)](https://yq.aliyun.com/articles/70337?spm=5176.100239.blogcont70321.18.sDlCFI)\n[å¾®ä¿¡Androidçƒ­è¡¥ä¸å®è·µæ¼”è¿›ä¹‹è·¯](https://github.com/WeMobileDev/article/blob/master/å¾®ä¿¡Androidçƒ­è¡¥ä¸å®è·µæ¼”è¿›ä¹‹è·¯.md)\n[Androidçƒ­ä¿®å¤æŠ€æœ¯æ€»ç»“ ](https://yq.aliyun.com/articles/184258?spm=5176.100239.blogcont70337.29.WSmFxM)\n[å¹²è´§æ»¡æ»¡ï¼ŒAndroidçƒ­ä¿®å¤æ–¹æ¡ˆä»‹ç»](https://yq.aliyun.com/articles/231111?utm_content=m_34179)\n","tags":["çƒ­ä¿®å¤"],"categories":["Android è¿›é˜¶"]},{"title":"è‡ªå®šä¹‰Viewé«˜ä»¿æ‡‚çƒå¸æˆ‘æ˜¯æ•™ç»ƒæ•ˆæœ","url":"%2F2017%2F07%2F23%2F%E8%87%AA%E5%AE%9A%E4%B9%89View%E9%AB%98%E4%BB%BF%E6%87%82%E7%90%83%E5%B8%9D%E6%88%91%E6%98%AF%E6%95%99%E7%BB%83%E6%95%88%E6%9E%9C%2F","content":"\n## å‰è¨€\n\nè¿™å‡ å¤©å¾ˆå¤šæ¬§æ´²çƒé˜Ÿæ¥ä¸­å›½è¿›è¡Œçƒ­èº«èµ›ï¼Œä¸çŸ¥é“å–œæ¬¢è¶³çƒçš„å„ä½å°ä¼™ä¼´ä»¬æœ‰æ²¡æœ‰çœ‹çƒã€‚å–œæ¬¢è¶³çƒçš„æœ‹å‹å¯èƒ½çŸ¥é“æ‡‚çƒå¸APPï¼Œé„™äººä¹Ÿç»å¸¸ä½¿ç”¨è¿™ä¸ªåº”ç”¨ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæˆ‘æ˜¯æ•™ç»ƒçš„åŠŸèƒ½æŒºå¥½ç©,å°±æ˜¯å¯ä»¥æ¨¡æ‹Ÿæ•™ç»ƒå‘˜çš„èº«ä»½ï¼Œæ’å…µå¸ƒé˜µï¼›æœ¬ç€å¥½å¥‡å¿ƒç®€å•æ¨¡ä»¿äº†ä¸€ä¸‹ï¼Œåœ¨è¿™é‡Œå’Œå¤§å®¶åˆ†äº«ã€‚\n\n\n## æ•ˆæœå›¾\n\nè€è§„çŸ©ï¼Œå…ˆä¸Šæ•ˆæœå›¾çœ‹çœ‹æ¨¡ä»¿çš„åƒä¸ã€‚\n\n\n![add_player](https://user-gold-cdn.xitu.io/2017/7/23/68d1796a8b77eaee289378a8686b508f)\n\n\n![move_player](https://user-gold-cdn.xitu.io/2017/7/23/bd8a6abef46a6e25d06a447ec5e68c87)\n\nç©è¿‡æˆ‘æ˜¯æ•™ç»ƒè¿™ä¸ªåŠŸèƒ½çš„å°ä¼™ä¼´å¯ä»¥å¯¹æ¯”ä¸€ä¸‹ã€‚\n\næ€»çš„æ¥è¯´ï¼Œè¿™æ ·çš„ä¸€ä¸ªæ•ˆæœï¼Œå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªviewéšç€æ‰‹æŒ‡åœ¨å±å¹•ä¸Šç§»åŠ¨çš„æ•ˆæœï¼Œå¤–åŠ ä¸€ä¸ªå›¾ç‰‡æ›¿æ¢çš„åŠ¨ç”»ã€‚ä½†å°±æ˜¯è¿™äº›çœ‹ä¼¼ç®€å•çš„æ•ˆæœï¼Œåœ¨å®ç°çš„è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯é‡åˆ°äº†å¾ˆå¤šå‘ï¼Œæ¶¨äº†è®¸å¤šæ–°å§¿åŠ¿ã€‚å¥½äº†ï¼ŒåºŸè¯ä¸è¯´ï¼Œä»£ç èµ°èµ·(ï½¡â—•Ë‡âˆ€Ë‡â—•)ã€‚\n\n<!--more-->\n\n## è‡ªå®šä¹‰View-BallGameView\n\næ•´ä¸ªå†…å®¹ä¸­æœ€æ ¸å¿ƒçš„å°±æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰View-BallGameViewï¼Œå°±æ˜¯å±å¹•ä¸­ç»¿è‰²èƒŒæ™¯ï¼Œæœ‰æ°”æ³¡å’Œçƒå‘˜å›¾ç‰‡çš„æ•´ä¸ªviewã€‚\n\n*è¯´åˆ°è‡ªå®šä¹‰Viewï¼Œè€ç”Ÿå¸¸è°ˆï¼Œå¤§å®¶ä¸€ç›´éƒ½åœ¨å­¦ä¹ ï¼Œå´æ°¸è¿œéƒ½è§‰å¾—è‡ªå·±æ²¡æœ‰å­¦ä¼šï¼Œä½†æ˜¯è‡ªå®šä¹‰Viewçš„çŸ¥è¯†æœ¬æ¥å°±å¾ˆå¤šå‘€ï¼Œæƒ³è¦ç†Ÿç»ƒæŒæ¡ï¼Œå¿…é¡»å‡ä»¥æ—¶æ—¥*ã€‚\n\n\næ—¢ç„¶æ˜¯è‡ªå®šViewå°±ä»å¤§å®¶æœ€å…³å¿ƒçš„ä¸¤ä¸ªæ–¹æ³• onMeasureå’ŒonDraw ä¸¤ä¸ªæ–¹æ³•è¯´èµ·ã€‚è¿™é‡Œç”±äºæ˜¯çº¯ç²¹ç»§æ‰¿è‡ªViewï¼Œå°±ä¸è€ƒè™‘onLayoutçš„å®ç°äº†ã€‚\n\n#### æµ‹é‡-onMeasure\n\n```java\n    @Override\n    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n        super.onMeasure(widthMeasureSpec, heightMeasureSpec);\n        int viewW = screenW;\n        int viewH = (int) (screenW * 1.3);\n        setMeasuredDimension(viewW, viewH);\n    }\n```\n\nè¿™é‡ŒonMeasure()æ–¹æ³•çš„å®ç°å¾ˆç®€å•ï¼Œç®€å•çš„ç”¨å±å¹•çš„å®½åº¦è§„å®šäº†æ•´ä¸ªView çš„å®½é«˜ï¼›è‡³äº1.3è¿™ä¸ªå€æ•°ï¼Œå®Œå…¨ä¸€ä¸ªä¼°ç®—å€¼ï¼Œä¸å¿…æ·±ç©¶ã€‚\n\n#### ç»˜åˆ¶-onDraw\n\nonDraw()æ–¹æ³•æ˜¯æ•´ä¸ªViewä¸­æœ€æ ¸å¿ƒçš„æ–¹æ³•ã€‚\n\n```java\n@Override\n    protected void onDraw(Canvas canvas) {\n        super.onDraw(canvas);\n        //ç»˜åˆ¶èƒŒæ™¯\n        canvas.drawBitmap(backgroundBitmap, bitmapRect, mViewRect, mPaint);\n        //ç»˜åˆ¶æç¤ºæ–‡å­—é€æ˜èƒŒæ™¯\n        canvas.drawRoundRect(mRoundRect, 8, 8, mRectPaint);\n        //ç»˜åˆ¶åº•éƒ¨æç¤ºæ–‡å­— ( TextPiant æ–‡å­—å‚ç›´å±…ä¸­å®ç° http://blog.csdn.net/hursing/article/details/18703599)\n        Paint.FontMetricsInt fontMetrics = mTipPaint.getFontMetricsInt();\n        float baseY=(mRoundRect.bottom+mRoundRect.top)/2-(fontMetrics.top+fontMetrics.bottom)/2;\n        canvas.drawText(tips, screenW / 2, baseY, mTipPaint);\n\n\n        //ç»˜åˆ¶åˆå§‹çš„11ä¸ªæ°”æ³¡\n        for (int i = 0; i < players.length; i++) {\n            //ç»˜åˆ¶å½“å‰é€‰ä¸­çš„çƒå‘˜\n            if (i == currentPos) {\n\n                if (players[i].isSetReal()) {\n                    //ç»˜åˆ¶çƒå‘˜å¤´åƒ\n                    canvas.drawBitmap(players[i].getBitmap(), positions[i].x - playW / 2,\n                            positions[i].y - playW / 2, mPaint);\n                    //ç»˜åˆ¶é€‰ä¸­çƒå‘˜é‡‘è‰²åº•åº§\n                    canvas.drawBitmap(playSelectedBitmap, positions[i].x - goldW / 2,\n                            positions[i].y - goldH / 2, mPaint);\n\n                    //ç»˜åˆ¶çƒå‘˜å§“å\n                    canvas.drawText(players[i].getName(), positions[i].x,\n                            positions[i].y + playW, mTextPaint);\n\n                } else {\n                    canvas.drawBitmap(selectedBitmap, positions[i].x - playW / 2,\n                            positions[i].y - playW / 2, mPaint);\n                }\n\n\n            } else {\n                canvas.drawBitmap(players[i].getBitmap(), positions[i].x - playW / 2,\n                        positions[i].y - playW / 2, mPaint);\n                if (players[i].isSetReal()) {\n\n                    //ç»˜åˆ¶çƒå‘˜å§“å\n                    canvas.drawText(players[i].getName(), positions[i].x,\n                            positions[i].y + playW, mTextPaint);\n                    //ç»˜åˆ¶å·²è®¾ç½®æ­£å¸¸å›¾ç‰‡çƒå‘˜èƒŒæ™¯\n                    canvas.drawBitmap(playeBgBitmap, positions[i].x - grayW / 2,\n                            positions[i].y + 200, mPaint);\n                }\n            }\n        }\n    }\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œåœ¨onDrawæ–¹æ³•é‡Œï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨äº†canvas.drawBitmap æ–¹æ³•ï¼Œç»˜åˆ¶äº†å¾ˆå¤šå›¾ç‰‡ã€‚ä¸‹é¢å°±ç®€å•äº†è§£ä¸€ä¸‹canvas.drawBitmap é‡Œçš„ä¸¤ä¸ªé‡è½½æ–¹æ³•ã€‚\n\n- drawBitmap(Bitmap bitmap,Rect src,Rect dst,Paint paint) \n\n```java\n/**\n     * Draw the specified bitmap, scaling/translating automatically to fill\n     * the destination rectangle. If the source rectangle is not null, it\n     * specifies the subset of the bitmap to draw.\n     *\n     *\n     * @param bitmap The bitmap to be drawn\n     * @param src    May be null. The subset of the bitmap to be drawn\n     * @param dst    The rectangle that the bitmap will be scaled/translated\n     *               to fit into\n     * @param paint  May be null. The paint used to draw the bitmap\n     */\n    public void drawBitmap(@NonNull Bitmap bitmap, @Nullable Rect src, @NonNull Rect dst,\n            @Nullable Paint paint) {\n       \n    }\n```\n\ndrawBitmap(Bitmap bitmap,Rect src,Rect dst,Paint paint),è¿™ä¸ªé‡è½½æ–¹æ³•ä¸»è¦æ˜¯é€šè¿‡ä¸¤ä¸ªRectangle å†³å®šäº†bitmapä»¥æ€æ ·çš„å½¢å¼ç»˜åˆ¶å‡ºæ¥ã€‚**ç®€å•æ¥è¯´ï¼Œsrc è¿™ä¸ªé•¿æ–¹å½¢å†³å®šäº†â€œæˆªå–â€bitmapçš„å¤§å°ï¼Œdst å†³å®šäº†æœ€ç»ˆç»˜åˆ¶å‡ºæ¥æ—¶Bitmapåº”è¯¥å æœ‰çš„å¤§å°ã€‚**ã€‚å°±æ‹¿ä¸Šé¢çš„ä»£ç æ¥è¯´\n\n```java\n        backgroundBitmap = BitmapFactory.decodeResource(res, R.drawable.battle_bg);\n        //ç¡®ä¿æ•´å¼ èƒŒæ™¯å›¾ï¼Œéƒ½èƒ½å®Œæ•´çš„æ˜¾ç¤ºå‡ºæ¥\n        bitmapRect = new Rect(0, 0, backgroundBitmap.getWidth(), backgroundBitmap.getHeight());\n        //ç›®æ ‡åŒºåŸŸï¼Œåœ¨æ•´ä¸ªè§†å›¾çš„å¤§å°ä¸­ï¼Œç»˜åˆ¶Bitmap\n        mViewRect = new Rect(0, 0, viewW, viewH);\n        //ç»˜åˆ¶èƒŒæ™¯\n        canvas.drawBitmap(backgroundBitmap, bitmapRect, mViewRect, mPaint);\n\n```\n\nbitmapRect æ˜¯æ•´ä¸ªbackgroundBitmapçš„å¤§å°ï¼ŒmViewRectä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨onMeasureé‡Œè§„å®šçš„æ•´ä¸ªè§†å›¾çš„å¤§å°ï¼Œè¿™æ ·ç›¸å½“äºæŠŠbattle_bgè¿™å¼ å›¾ç‰‡ï¼Œä»¥scaleType=\"fitXY\"çš„å½¢å¼ç”»åœ¨äº†è§†å›¾å¤§å°çš„åŒºåŸŸå†…ã€‚è¿™æ ·ï¼Œä½ åº”è¯¥ç†è§£è¿™ä¸ªé‡è½½æ–¹æ³•çš„å«ä¹‰äº†ã€‚\n\n- drawBitmap(Bitmap bitmap, float left, float top, Paint paint)\n\n```\n    /**\n     * Draw the specified bitmap, with its top/left corner at (x,y), using\n     * the specified paint, transformed by the current matrix.\n     *\n     *\n     * @param bitmap The bitmap to be drawn\n     * @param left   The position of the left side of the bitmap being drawn\n     * @param top    The position of the top side of the bitmap being drawn\n     * @param paint  The paint used to draw the bitmap (may be null)\n     */\n    public void drawBitmap(@NonNull Bitmap bitmap, float left, float top, @Nullable Paint paint) {\n\n    }\n```\n\nè¿™ä¸ªé‡è½½æ–¹æ³•åº”è¯¥å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œleftï¼Œtop è§„å®šäº†ç»˜åˆ¶Bitmapçš„å·¦ä¸Šè§’çš„åæ ‡ï¼Œç„¶åæŒ‰ç…§å…¶å¤§å°æ­£å¸¸ç»˜åˆ¶å³å¯ã€‚\n\nè¿™é‡Œæˆ‘ä»¬æ‰€æœ‰çš„æ°”æ³¡ï¼ˆçƒå‘˜ä½ç½®ï¼‰éƒ½æ˜¯ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ç»˜åˆ¶çš„ã€‚è¶³çƒåœºä¸Šæœ‰11ä¸ªçƒå‘˜ï¼Œå› æ­¤æˆ‘ä»¬é€šè¿‡æ•°ç»„é¢„å…ˆå®šä¹‰äº†11ä¸ªæ°”æ³¡çš„åˆå§‹ä½ç½®ï¼Œç„¶åé€šè¿‡å…¶åæ ‡ä½ç½®ï¼Œç»˜åˆ¶ä»–ä»¬ã€‚ä¸ºäº†ç»˜åˆ¶ç²¾ç¡®ï¼Œéœ€è¦å‡å»æ¯å¼ å›¾ç‰‡è‡ªèº«çš„å®½é«˜ï¼Œè¿™åº”è¯¥æ˜¯å¾ˆä¼ ç»Ÿçš„åšæ³•äº†ã€‚\n\n\nåŒæ—¶ï¼Œåœ¨ä¹‹åçš„è§¦æ‘¸åé¦ˆæœºåˆ¶ä¸­ï¼Œæˆ‘ä»¬ä¼šæ ¹æ®æ‰‹æŒ‡çš„æ»‘åŠ¨ï¼Œä¿®æ”¹è¿™äº›åæ ‡å€¼ï¼Œè¿™æ ·å°±å¯ä»¥éšæ„ç§»åŠ¨çƒå‘˜åœ¨åœºä¸Šçš„ä½ç½®äº†ï¼›å…·ä½“å®ç°ï¼Œç»“åˆä»£ç ä¸­çš„æ³¨é‡Šåº”è¯¥å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œå°±ä¸å†èµ˜è¿°ï¼›å¯ä»¥æŸ¥çœ‹å®Œæ•´æºç [BallGameView](https://github.com/REBOOTERS/AndroidAnimationExercise/blob/dev/app/src/main/java/home/smart/fly/animations/customview/views/BallGameView.java)ã€‚\n\n\n##### æ–‡å­—å±…ä¸­ç»˜åˆ¶\n\nè¿™é‡Œå†è¯´ä¸€ä¸ªåœ¨ç»˜åˆ¶è¿‡ç¨‹ä¸­é‡åˆ°ä¸€ä¸ªå°é—®é¢˜ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ•´ä¸ªè§†å›¾åº•éƒ¨ï¼Œç»˜åˆ¶äº†ä¸€ä¸ªåŠé€æ˜çš„åœ†è§’çŸ©å½¢ï¼Œå¹¶åœ¨ä»–ä¸Šé¢ç»˜åˆ¶äº†ä¸€è¡Œé»„è‰²çš„æ–‡å­—ï¼Œè¿™è¡Œæ–‡å­—åœ¨æ°´å¹³å’Œå‚ç›´æ–¹å‘éƒ½æ˜¯å±…ä¸­çš„ï¼›ä½¿ç”¨TextPaint ç»˜åˆ¶æ–‡å­—å®ç°æ°´å¹³å±…ä¸­æ˜¯å¾ˆå®¹æ˜“çš„äº‹æƒ…ï¼Œåªéœ€è¦è®¾ç½®mTipPaint.setTextAlign(Paint.Align.CENTER)å³å¯ï¼Œä½†æ˜¯åœ¨å‚ç›´æ–¹å‘å®ç°å±…ä¸­ï¼Œå°±æ²¡é‚£ä¹ˆç®€å•äº†ï¼Œè¿™é‡Œéœ€è¦è€ƒè™‘ä¸€ä¸ªæ–‡æœ¬ç»˜åˆ¶æ—¶**åŸºçº¿**çš„é—®é¢˜ï¼Œå…·ä½“ç»†èŠ‚å¯ä»¥å‚è€ƒ[è¿™ç¯‡æ–‡ç« ](http://blog.csdn.net/hursing/article/details/18703599)ï¼Œåˆ†æçš„å¾ˆè¯¦ç»†ã€‚\n\næˆ‘ä»¬åœ¨è¿™é‡Œä¸ºäº†ä½¿æ–‡å­—åœ¨åœ†è§’çŸ©å½¢ä¸­å±…ä¸­ï¼Œå¦‚ä¸‹å®ç°ã€‚\n\n```\n        canvas.drawRoundRect(mRoundRect, 8, 8, mRectPaint);\n        Paint.FontMetricsInt fontMetrics = mTipPaint.getFontMetricsInt();\n        float baseY = (mRoundRect.bottom + mRoundRect.top) / 2 - (fontMetrics.top + fontMetrics.bottom) / 2;\n        canvas.drawText(tips, screenW / 2, baseY, mTipPaint);\n```\n\nåœ†è§’çŸ©å½¢çš„å‚ç›´ä¸­å¿ƒç‚¹çš„åŸºç¡€ä¸Šï¼Œå†ä¸€æ¬¡åšä¿®æ­£ï¼Œç¡®ä¿å®ç°çœŸæ­£çš„å‚ç›´å±…ä¸­ã€‚\n\n\n\nå¥½äº†ï¼Œç»“åˆ[æ‰”ç‰©çº¿](https://juejin.im/user/552f20a7e4b060d72a89d87f)å¤§ç¥æ‰€æ€»ç»“çš„è‡ªå®šä¹‰Viewå…³é”®æ­¥éª¤ï¼Œä»¥ä¸Šä¸¤ç‚¹ç®—æ˜¯å®Œæˆäº†**ç»˜åˆ¶å’Œå¸ƒå±€**çš„å·¥ä½œ,ä¸‹é¢å°±çœ‹çœ‹**è§¦æ‘¸åé¦ˆ**çš„å®ç°ã€‚\n\n\n\n#### è§¦æ‘¸åé¦ˆ-onTouchEvent\n\nè¿™é‡Œè§¦æ‘¸åé¦ˆæœºåˆ¶ï¼Œä½¿ç”¨åˆ°äº†GestureDetectorè¿™ä¸ªç±»ï¼›è¿™ä¸ªç±»å¯ä»¥ç”¨æ¥è¿›è¡Œæ‰‹åŠ¿æ£€æµ‹ï¼Œç”¨äºè¾…åŠ©æ£€æµ‹ç”¨æˆ·çš„å•å‡»ã€æ»‘åŠ¨ã€é•¿æŒ‰ã€åŒå‡»ç­‰è¡Œä¸ºã€‚å†…éƒ¨æä¾›äº†OnGestureListenerã€OnDoubleTapListenerå’ŒOnContextClickListenerä¸‰ä¸ªæ¥å£ï¼Œå¹¶æä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œæ¯”å¦‚å¸¸è§çš„\n- onSingleTapUp ï¼š æ‰‹æŒ‡è½»è§¦å±å¹•ç¦»å¼€\n- onScroll : æ»‘åŠ¨\n- onLongPressï¼š é•¿æŒ‰\n- onFlingï¼š æŒ‰ä¸‹åï¼Œå¿«é€Ÿæ»‘åŠ¨æ¾å¼€ï¼ˆç±»ä¼¼åˆ‡æ°´æœçš„æ‰‹åŠ¿ï¼‰\n- onDoubleTap : åŒå‡»\n\n\nå¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨è¿™ä¸ªç±»å¯ä»¥æ›´åŠ ç²¾ç¡®çš„å¤„ç†æ‰‹åŠ¿æ“ä½œã€‚\n\n\n**è¿™é‡Œå¼•å…¥GestureDetectorçš„åŸå› æ˜¯è¿™æ ·çš„ï¼Œå•ç‹¬åœ¨onTouchEventå¤„ç†æ‰€æœ‰äº‹ä»¶æ—¶ï¼Œåœ¨æ‰‹æŒ‡ç‚¹å‡»å±å¹•çš„ç¬é—´ï¼Œå¾ˆå®¹æ˜“è§¦å‘MotionEvent.ACTION_MOVEäº‹ä»¶ï¼Œå¯¼è‡´æ¯æ¬¡è§¦ç¢°æ°”æ³¡ï¼Œè¢«ç‚¹å‡»æ°”æ³¡çš„ä½ç½®éƒ½ä¼šç¨å¾®é¢¤æŠ–ä¸€ä¸‹ï¼Œä½ç½®å‘ç”Ÿè½»å¾®çš„åç§»ï¼Œä½“éªŒååˆ†ç³Ÿç³•ã€‚é‡‡ç”¨GestureDetectorå¯¹æ‰‹æŒ‡æ»‘åŠ¨çš„å¤„ç†ï¼Œå¯¹ç‚¹å‡»å’Œæ»‘åŠ¨çš„æ£€æµ‹æ˜¾å¾—æ›´åŠ ç²¾ç¡®**\n\n\n```java\n@Override\n    public boolean onTouchEvent(MotionEvent event) {\n        if (mValueAnimator != null) {\n            if (mValueAnimator.isRunning()) {\n                return false;\n            }\n        }\n        m_gestureDetector.onTouchEvent(event);\n        int lastX = (int) event.getX();\n        int lastY = (int) event.getY();\n\n\n        if (event.getAction() == MotionEvent.ACTION_DOWN) {\n            for (int i = 0; i < positions.length; i++) {\n                int deltaX = positions[i].x - lastX;\n                int deltaY = positions[i].y - lastY;\n\n                // æ‰‹æŒ‡ -- ACTION_DOWN æ—¶ï¼Œè½åœ¨äº†æŸä¸€ä¸ªæ°”æ³¡ä¸Šæ—¶ï¼Œåˆ·æ–°é€‰ä¸­æ°”æ³¡ï¼ˆçƒå‘˜ï¼‰çš„bitmap\n                if (Math.abs(deltaX) < playW / 2 && Math.abs(deltaY) < playW / 2) {\n                    position = i;\n                    currentPos = i;\n                    invalidate();\n                    moveEnable = true;\n                    Log.e(TAG, \"onTouchEvent: position= \" + position);\n                    return true;\n                }\n\n\n            }\n\n            //æ²¡æœ‰ç‚¹å‡»ä¸­ä»»æ„ä¸€ä¸ªæ°”æ³¡ï¼Œç‚¹å‡»åœ¨å¤–éƒ¨æ˜¯ï¼Œé‡ç½®æ°”æ³¡ï¼ˆçƒå‘˜ï¼‰çŠ¶æ€\n            resetBubbleView();\n            moveEnable = false;\n            return false;\n        }\n\n\n        return super.onTouchEvent(event);\n\n    }\n```\n\nè¿™é‡Œm_gestureDetector.onTouchEvent(event)ï¼Œè¿™æ ·å°±å¯ä»¥è®©GestureDetectoråœ¨ä»–è‡ªå·±çš„å›è°ƒæ–¹æ³•OnGestureListeneré‡Œï¼Œå¤„ç†è§¦æ‘¸äº‹ä»¶ã€‚\n\nä¸Šé¢çš„é€»è¾‘å¾ˆç®€å•ï¼ŒåŠ¨ç”»æ­£åœ¨è¿›è¡Œæ˜¯ï¼Œç›´æ¥è¿”å›ã€‚MotionEvent.ACTION_DOWNäº‹ä»¶å‘ç”Ÿæ—¶çš„å¤„ç†é€»è¾‘ï¼Œé€šè¿‡æ³¨é‡Šå¾ˆå®¹æ˜“ç†è§£ï¼Œå°±ä¸å†èµ˜è¿°ã€‚\n\nå½“æˆ‘ä»¬ç‚¹å‡»åˆ°æŸä¸ªæ°”æ³¡æ—¶ï¼Œå°±è·å–åˆ°äº†å½“å‰é€‰ä¸­ä½ç½®currentPosï¼›ä¸‹é¢çœ‹çœ‹GestureDetectorçš„å›è°ƒæ–¹æ³•ï¼Œæ˜¯æ€æ ·å¤„ç†æ»‘åŠ¨äº‹ä»¶çš„ã€‚\n\n\n```\nGestureDetector.OnGestureListener onGestureListener = new GestureDetector.SimpleOnGestureListener() {\n        @Override\n        public boolean onScroll(MotionEvent e1, MotionEvent e2, float distanceX, float distanceY) {\n            if (moveEnable) {\n                positions[position].x -= distanceX;\n                positions[position].y -= distanceY;\n\n\n                //æ»‘åŠ¨æ—¶ï¼Œè€ƒè™‘ä¸€ä¸‹ä¸Šä¸‹è¾¹ç•Œçš„é—®é¢˜ï¼Œä¸è¦æŠŠçƒå‘˜ç§»é™¤åœºå¤–\n                // æ¨ªå‘å°±ä¸è€ƒè™‘äº†ï¼Œå› ä¸ºåº•å›¾æ˜¯3D æ‘†æ”¾çš„ï¼Œä¸Šçª„ä¸‹å®½ï¼Œæ— æ³•è®¡ç®—\n                // ä¸»è¦é™åˆ¶ä¸€ä¸‹ï¼Œçºµå‘æ»‘åŠ¨å€¼\n                if (positions[position].y < minY) {\n                    positions[position].y = minY;\n                } else if (positions[position].y > maxY) {\n                    positions[position].y = maxY;\n                }\n\n                Log.e(TAG, \"onScroll: y=\" + positions[position].y);\n\n                //è·Ÿéšæ‰‹æŒ‡ï¼Œç§»åŠ¨æ°”æ³¡ï¼ˆçƒå‘˜ï¼‰\n                invalidate();;\n            }\n            return true;\n        }\n    };\n```\nSimpleOnGestureListener é»˜è®¤å®ç°äº†OnGestureListenerï¼ŒOnDoubleTapListener, OnContextClickListenerè¿™ä¸‰ä¸ªæ¥å£ä¸­æ‰€æœ‰çš„æ–¹æ³•ï¼Œå› æ­¤éå¸¸æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨GestureDetectorè¿›è¡Œç‰¹å®šæ‰‹åŠ¿çš„å¤„ç†ã€‚\n\n\nè¿™é‡Œçš„å¤„ç†å¾ˆç®€å•ï¼Œå½“æ°”æ³¡è¢«é€‰ä¸­æ—¶moveEnable=trueï¼Œé€šè¿‡onScrollå›è°ƒæ–¹æ³•è¿”å›çš„è·ç¦»ï¼Œä¸æ–­æ›´æ–°å½“å‰ä½ç½®çš„åæ ‡ï¼ŒåŒæ—¶è®°å¾—é™åˆ¶ä¸€ä¸‹æ‰‹åŠ¿æ»‘åŠ¨çš„è¾¹ç•Œï¼Œæ€»ä¸èƒ½æŠŠçƒå‘˜ç§»åŠ¨åˆ°åœºåœ°å¤–é¢å§o(â•¯â–¡â•°)oï¼Œæœ€åçš„postInvalidate()æ˜¯å…³é”®ï¼Œè§¦å‘onDrawæ–¹æ³•ï¼Œå®ç°é‡æ–°ç»˜åˆ¶ã€‚\n\n**è¿™é‡Œæœ‰ä¸€ä¸ªç»†èŠ‚ï¼Œä¸çŸ¥ä½ å‘ç°æ²¡æœ‰ï¼Œæˆ‘ä»¬åœ¨æ›´æ–°åæ ‡çš„æ—¶å€™ï¼Œæ¯æ¬¡éƒ½æ˜¯åœ¨å½“å‰åæ ‡çš„ä½ç½®ï¼Œå‡å»äº†æ»‘åŠ¨è·ç¦»ï¼ˆdistanceX/distanceY)ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆ(âŠ™oâŠ™)?ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯åŠ å‘¢ï¼Ÿ**\n\næˆ‘ä»¬å¯ä»¥çœ‹çœ‹è¿™ä¸ªå›è°ƒæ–¹æ³•çš„å®šä¹‰\n\n```java\n       /**\n         * Notified when a scroll occurs with the initial on down {@link MotionEvent} and the\n         * current move {@link MotionEvent}. The distance in x and y is also supplied for\n         * convenience.\n         *\n         * @param e1 The first down motion event that started the scrolling.\n         * @param e2 The move motion event that triggered the current onScroll.\n         * @param distanceX The distance along the X axis that has been scrolled since the last\n         *              call to onScroll. This is NOT the distance between {@code e1}\n         *              and {@code e2}.\n         * @param distanceY The distance along the Y axis that has been scrolled since the last\n         *              call to onScroll. This is NOT the distance between {@code e1}\n         *              and {@code e2}.\n         * @return true if the event is consumed, else false\n         */\n        boolean onScroll(MotionEvent e1, MotionEvent e2, float distanceX, float distanceY);\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œç‰¹å®šå¼ºè°ƒäº†**This is NOT the distance between {@code e1}and {@code e2}**ï¼Œå°±æ˜¯è¯´è¿™ä¸ªè·ç¦»å¹¶ä¸æ˜¯ä¸¤æ¬¡äº‹ä»¶e1å’Œe2 ä¹‹é—´çš„è·ç¦»ã€‚é‚£ä¹ˆè¿™ä¸ªè·ç¦»åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé‚£æˆ‘ä»¬å°±æ‰¾ä¸€æ‰¾åˆ°åº•æ˜¯åœ¨å“ªé‡Œè§¦å‘äº†è¿™ä¸ªå›è°ƒæ–¹æ³•.\n\næœ€ç»ˆåœ¨GestureDetectorç±»çš„onTouchEvent()æ–¹æ³•é‡Œæ‰¾åˆ°äº†è§¦å‘è¿™ä¸ªæ–¹æ³•å‘ç”Ÿçš„åœ°æ–¹ï¼š\n\n\n```java\npublic boolean onTouchEvent(MotionEvent ev) {\n\n\t.....\n\n        final boolean pointerUp =\n                (action & MotionEvent.ACTION_MASK) == MotionEvent.ACTION_POINTER_UP;\n        final int skipIndex = pointerUp ? ev.getActionIndex() : -1;\n\n        // Determine focal point\n        float sumX = 0, sumY = 0;\n        final int count = ev.getPointerCount();\n        for (int i = 0; i < count; i++) {\n            if (skipIndex == i) continue;\n            sumX += ev.getX(i);\n            sumY += ev.getY(i);\n        }\n        final int div = pointerUp ? count - 1 : count;\n        final float focusX = sumX / div;\n        final float focusY = sumY / div;\n\n        boolean handled = false;\n\n        switch (action & MotionEvent.ACTION_MASK) {\n\n        case MotionEvent.ACTION_MOVE:\n            if (mInLongPress || mInContextClick) {\n                break;\n            }\n            final float scrollX = mLastFocusX - focusX;\n            final float scrollY = mLastFocusY - focusY;\n            if (mIsDoubleTapping) {\n                // Give the move events of the double-tap\n                handled |= mDoubleTapListener.onDoubleTapEvent(ev);\n            } else if (mAlwaysInTapRegion) {\n                final int deltaX = (int) (focusX - mDownFocusX);\n                final int deltaY = (int) (focusY - mDownFocusY);\n                int distance = (deltaX * deltaX) + (deltaY * deltaY);\n                if (distance > mTouchSlopSquare) {\n                    handled = mListener.onScroll(mCurrentDownEvent, ev, scrollX, scrollY);\n                    mLastFocusX = focusX;\n                    mLastFocusY = focusY;\n                    mAlwaysInTapRegion = false;\n                    mHandler.removeMessages(TAP);\n                    mHandler.removeMessages(SHOW_PRESS);\n                    mHandler.removeMessages(LONG_PRESS);\n                }\n                if (distance > mDoubleTapTouchSlopSquare) {\n                    mAlwaysInBiggerTapRegion = false;\n                }\n            } else if ((Math.abs(scrollX) >= 1) || (Math.abs(scrollY) >= 1)) {\n                handled = mListener.onScroll(mCurrentDownEvent, ev, scrollX, scrollY);\n                mLastFocusX = focusX;\n                mLastFocusY = focusY;\n            }\n            break;\n\n        \n        return handled;\n    }\n```\n\nè¿™é‡Œè¿˜æ¶‰åŠåˆ°å¤šæŒ‡è§¦æ§çš„è€ƒè™‘ï¼Œæƒ…å†µè¾ƒä¸ºå¤æ‚ï¼›ç®€å•è¯´ä¸€ä¸‹ç»“è®ºï¼Œ**åœ¨ACTION_MOVEæ—¶ï¼Œä¼šä»ä¸Šä¸€æ¬¡æ‰‹æŒ‡ç¦»å¼€çš„è·ç¦»ï¼Œå‡å»æ­¤æ¬¡æ‰‹æŒ‡è§¦ç¢°çš„ä½ç½®ï¼›è¿™æ ·å½“scrollX>0æ—¶ï¼Œå°±æ˜¯åœ¨å‘å³æ»‘åŠ¨ï¼Œåä¹‹å‘å·¦ï¼›scrollY > 0 æ—¶ï¼Œæ˜¯åœ¨å‘ä¸Šæ»‘åŠ¨ï¼Œåä¹‹å‘ä¸‹**ï¼›å› æ­¤ï¼Œè¿™ä¸¤ä¸ªè·ç¦»å’Œæˆ‘ä»¬ä¹ ä»¥ä¸ºå¸¸çš„æ–¹å‘æ°å¥½éƒ½æ˜¯ç›¸åçš„ï¼Œå› æ­¤ï¼Œåœ¨æ›´æ–°åæ ‡æ—¶ï¼Œéœ€è¦åšç›¸åçš„å¤„ç†ã€‚\n\n**æœ‰å…´è¶£çš„åŒå­¦ï¼Œå¯ä»¥æŠŠä¸Šé¢çš„â€œ-â€æ”¹æˆâ€œ+â€ï¼Œå°è¯•è¿è¡Œä¸€ä¸‹ä»£ç ï¼Œå°±ä¼šæ˜ç™½å…¶ä¸­çš„é“ç†äº†ã€‚**\n\nå¥½äº†ï¼Œåˆ°äº†è¿™é‡ŒæŒ‰ç…§**ç»˜åˆ¶ï¼Œå¸ƒå±€ï¼Œè§¦æ‘¸åé¦ˆ**çš„é¡ºåºæˆ‘ä»¬å·²ç»å®Œæˆäº†BallGameViewè¿™ä¸ªè‡ªå®šä¹‰Viewè‡ªå·±çš„å†…å®¹äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜çœ‹åˆ°åœ¨ç‚¹å‡»ä¸‹é¢çš„çƒå‘˜å¤´åƒæ—¶ï¼Œè¿˜æœ‰ä¸€ä¸ªç®€å•çš„åŠ¨ç”»ï¼Œä¸‹é¢å°±çœ‹çœ‹åŠ¨ç”»æ˜¯å¦‚ä½•å®ç°çš„ã€‚\n\n\n## åŠ¨ç”»æ•ˆæœ\n\né¦–å…ˆè¯´æ˜ä¸€ä¸‹ï¼Œåº•éƒ¨çƒå‘˜åˆ—è¡¨æ˜¯ä¸€ä¸ªæ¨ªå‘çš„RecyclerViewï¼Œè¿™æ ·ä¸€ä¸ªæ¨ªå‘æ»‘åŠ¨çš„åŒåˆ—å±•ç¤ºçš„RecyclerView åº”è¯¥å¾ˆç®€å•äº†ï¼Œè¿™é‡Œå°±ä¸å†è¯¦è¿°ã€‚æ–‡æœ«æœ‰æºç ï¼Œæœ€åå¯ä»¥æŸ¥çœ‹ã€‚\n\nè¿™é‡Œçœ‹ä¸€ä¸‹æ¯ä¸€ä¸ªRecyclerViewä¸­itemçš„ç‚¹å‡»äº‹ä»¶\n\n\n```java\n\n@Override\n    public void onRVItemClick(ViewGroup parent, View itemView, int position) {\n\n        if (mPlayerBeanList.get(position).isSelected()) {\n            Toast.makeText(mContext, \"çƒå‘˜å·²è¢«é€‰æ‹©!\", Toast.LENGTH_SHORT).show();\n        } else {\n            View avatar = itemView.findViewById(R.id.img);\n            int width = avatar.getWidth();\n            int height = avatar.getHeight();\n            Bitmap bitmap = Tools.View2Bitmap(avatar, width, height);\n            int[] location = new int[2];\n            itemView.getLocationOnScreen(location);\n            if (bitmap != null) {\n                mGameView.updatePlayer(bitmap, mPlayerBeanList.get(position).getName(), location, content);\n            }\n\n        }\n\n    }\n```\n\nè¿™é‡Œå¯ä»¥çœ‹åˆ°è°ƒç”¨äº†GameViewçš„updatePlayeræ–¹æ³•ï¼š\n\n```java\n/**\n     * åœ¨ä¸‹æ–¹çƒå‘˜åŒºåŸŸï¼Œé€‰ä¸­çƒå‘˜åï¼Œæ ¹æ®ä½ç½®æ‰§è¡ŒåŠ¨ç”»ï¼Œå°†çƒå‘˜æ”¾ç½®åœ¨é€‰ä¸­çš„æ°”æ³¡ä¸­\n     *\n     * @param bitmap      è¢«é€‰ä¸­çƒå‘˜bitmap\n     * @param name        è¢«é€‰ä¸­çƒå‘˜åå­—\n     * @param location    è¢«é€‰ä¸­çƒå‘˜åœ¨å±å¹•ä¸­ä½ç½®\n     * @param contentView æ ¹è§†å›¾ï¼ˆæ–¹ä¾¿å®ç°åŠ¨ç”»ï¼‰\n     */\n    public void updatePlayer(final Bitmap bitmap, final String name, int[] location, final ViewGroup contentView) {\n\n        Path mPath = new Path();\n        mPath.moveTo(location[0] + bitmap.getWidth() / 2, location[1] - bitmap.getHeight() / 2);\n        mPath.lineTo(positions[currentPos].x - playW / 2, positions[currentPos].y - playW / 2);\n\n\n        final ImageView animImage = new ImageView(getContext());\n        animImage.setImageBitmap(bitmap);\n        RelativeLayout.LayoutParams params = new RelativeLayout.LayoutParams(120, 120);\n        contentView.addView(animImage, params);\n\n\n        final float[] animPositions = new float[2];\n        final PathMeasure mPathMeasure = new PathMeasure(mPath, false);\n\n        mValueAnimator = ValueAnimator.ofFloat(0, mPathMeasure.getLength());\n        mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n            @Override\n            public void onAnimationUpdate(ValueAnimator animation) {\n                float value = (float) animation.getAnimatedValue();\n                mPathMeasure.getPosTan(value, animPositions, null);\n\n                animImage.setTranslationX(animPositions[0]);\n                animImage.setTranslationY(animPositions[1]);\n\n            }\n        });\n\n        mValueAnimator.addListener(new AnimatorListenerAdapter() {\n            @Override\n            public void onAnimationEnd(Animator animation) {\n                super.onAnimationEnd(animation);\n\n                contentView.removeView(animImage);\n\n                players[currentPos].setBitmap(bitmap);\n                players[currentPos].setSetReal(true);\n                players[currentPos].setName(name);\n\n                invalidate();\n\n\n            }\n        });\n        mValueAnimator.setDuration(500);\n        mValueAnimator.setInterpolator(new AccelerateInterpolator());\n        mValueAnimator.start();\n\n\n    }\n```\n\nè¿™ä¸ªåŠ¨ç”»ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªä¸€é˜¶è´å¡å°”æ›²çº¿ã€‚æ ¹æ®RecyclerViewä¸­itemåœ¨å±å¹•ä¸­çš„ä½ç½®ï¼Œæ„é€ ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„ImageViewæ·»åŠ åˆ°æ ¹è§†å›¾ä¸­ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå±æ€§åŠ¨ç”»ï¼Œåœ¨å±æ€§å€¼ä¸æ–­æ›´æ–°æ—¶ï¼Œåœ¨å›è°ƒæ–¹æ³•ä¸­ä¸æ–­è°ƒç”¨setTranslationæ–¹æ³•ï¼Œæ”¹å˜è¿™ä¸ªImageViewçš„ä½ç½®ï¼Œå‘ˆç°å‡ºåŠ¨ç”»çš„æ•ˆæœã€‚åŠ¨ç”»ç»“æŸåï¼Œå°†è¿™ä¸ªImageViewä»è§†å›¾ç§»é™¤ï¼ŒåŒæ—¶æ°”æ³¡ä¸­çš„æ•°æ®å³å¯ï¼Œæœ€åå†æ¬¡invalidateå¯¼è‡´æ•´ä¸ªè§†å›¾é‡æ–°ç»˜åˆ¶ï¼Œè¿™æ ·åŠ¨ç”»å®Œæˆæ—¶ï¼Œæ°”æ³¡å°±è¢«æ›¿æ¢ä¸ºçœŸå®çš„å¤´åƒäº†ã€‚\n\n\n\nåˆ°è¿™é‡Œï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰åŠŸèƒ½ï¼Œéƒ½å®ç°äº†ã€‚æœ€åå°±æ˜¯æŠŠè‡ªå·±æ’å‡ºæ¥çš„é˜µå‹ï¼Œä¿å­˜ä¸ºå›¾ç‰‡åˆ†äº«ç»™å°ä¼™ä¼´äº†ã€‚è¿™é‡Œä¸»è¦è¯´ä¸€ä¸‹ä¿å­˜å›¾ç‰‡çš„å®ç°ï¼›åˆ†äº«åŠŸèƒ½ï¼Œå°±ä¸ä½œä¸ºé‡ç‚¹è®¨è®ºäº†ã€‚\n\n## è‡ªå®šä¹‰Viewä¿å­˜ä¸ºBitmap\n\n\n```java\nprivate class SavePicTask extends AsyncTask<Bitmap, Void, String> {\n\n        @Override\n        protected String doInBackground(Bitmap... params) {\n            Bitmap mBitmap = params[0];\n            String filePath = \"\";\n            Calendar now = new GregorianCalendar();\n            SimpleDateFormat simpleDate = new SimpleDateFormat(\"yyyyMMddHHmmss\", Locale.getDefault());\n            String fileName = simpleDate.format(now.getTime());\n            //ä¿å­˜åœ¨åº”ç”¨å†…ç›®å½•ï¼Œå…å»ç”³è¯·è¯»å–æƒé™çš„éº»çƒ¦\n            File mFile = new File(mContext.getExternalFilesDir(Environment.DIRECTORY_PICTURES), fileName + \".jpg\");\n            try {\n                OutputStream mOutputStream = new FileOutputStream(mFile);\n                mBitmap.compress(Bitmap.CompressFormat.JPEG, 100, mOutputStream);\n                mOutputStream.flush();\n                mOutputStream.close();\n                filePath = mFile.getAbsolutePath();\n\n\n            } catch (FileNotFoundException e) {\n                e.printStackTrace();\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n\n\n            return filePath;\n        }\n    }\n```\n\n```java\n\n                mGameView.setDrawingCacheEnabled(true);\n                Bitmap mBitmap = mGameView.getDrawingCache();\n\n                if (mBitmap != null) {\n                    new SavePicTask().execute(mBitmap);\n                } else {\n                    Toast.makeText(mContext, \"fail\", Toast.LENGTH_SHORT).show();\n                }\n\n```\n\n\nä¸€ä¸ªå…¸å‹çš„AsyncTaskå®ç°ï¼Œæ–‡ä»¶æµçš„è¾“å‡ºï¼Œæ²¡ä»€ä¹ˆå¤šè¯´çš„ã€‚ä¸»è¦æ˜¯å­˜å‚¨ç›®å½•çš„é€‰æ‹©ï¼Œ**è¿™é‡Œæœ‰ä¸ªæŠ€å·§ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šé™åˆ¶ï¼Œå¹³æ—¶æˆ‘ä»¬åšå¼€å‘çš„æ—¶å€™ï¼Œå¯ä»¥ æŠŠä¸€äº›å­˜å‚¨è·¯å¾„åšå¦‚ä¸‹å®šä¹‰**\n\n\n- mContext.getExternalFilesDir(Environment.DIRECTORY_PICTURES)ï¼šä»£è¡¨/storage/emulated/0/Android/data/{packagname}/files/Pictures\n- mContext.getExternalCacheDir() ä»£è¡¨ /storage/emulated/0/Android/data/{packagname}/cache\n\nå¯¹äºmContext.getExternalFilesDirè¿˜å¯å®šä¹‰ä¸ºEnvironment.DIRECTORY_DOWNLOADSï¼ŒEnvironment.DIRECTORY_DOCUMENTSç­‰ç›®å½•ï¼Œå¯¹åº”çš„æ–‡ä»¶å¤¹åç§°ä¹Ÿä¼šå˜åŒ–ã€‚\n\nè¿™ä¸ªç›®å½•ä¸­çš„å†…å®¹ä¼šéšç€ç”¨æˆ·å¸è½½åº”ç”¨ï¼Œä¸€å¹¶åˆ é™¤ã€‚**æœ€é‡è¦çš„æ˜¯ï¼Œè¯»å†™è¿™ä¸ªç›®å½•æ˜¯ä¸éœ€è¦æƒé™çš„ï¼Œå› æ­¤çœå»äº†æ¯æ¬¡åšæƒé™åˆ¤æ–­çš„éº»çƒ¦ï¼Œè€Œä¸”ä¹Ÿé¿å…äº†æ²¡æœ‰æƒé™æ—¶çš„çª˜å¢ƒ**ã€‚\n\n\nåˆ°è¿™é‡Œï¼Œæ¨¡ä»¿åŠŸèƒ½ï¼Œå…¨éƒ¨éƒ½å®ç°äº†ã€‚ä¸‹é¢ç¨å¾®æ¥ä¸€ç‚¹é¢å¤–çš„æ‰©å±•ã€‚\n\næˆ‘ä»¬å¸Œæœ›**å›¾ç‰‡ä¿å­˜åå¯ä»¥åœ¨é€šçŸ¥æ æç¤ºç”¨æˆ·ï¼Œç‚¹å‡»é€šçŸ¥æ åå¯ä»¥é€šè¿‡æ‰‹æœºç›¸å†ŒæŸ¥çœ‹ä¿å­˜çš„å›¾ç‰‡ã€‚**\n\n\n## æ‰©å±•-Android  Notification & FileProvider çš„ä½¿ç”¨\n\n```\nprivate void SaveAndNotify() {\n        if (!TextUtils.isEmpty(picUrl)) {\n          \n            NotificationCompat.Builder mBuilder = new NotificationCompat.Builder(mContext);\n            mBuilder.setWhen(System.currentTimeMillis())\n                    .setTicker(\"ä¸‹è½½å›¾ç‰‡æˆåŠŸ\")\n                    .setContentTitle(\"ç‚¹å‡»æŸ¥çœ‹\")\n                    .setSmallIcon(R.mipmap.app_start)\n                    .setContentText(\"å›¾ç‰‡ä¿å­˜åœ¨:\" + picUrl)\n                    .setAutoCancel(true)\n                    .setOngoing(false);\n            //é€šçŸ¥é»˜è®¤çš„å£°éŸ³ éœ‡åŠ¨ å‘¼å¸ç¯\n            mBuilder.setDefaults(NotificationCompat.DEFAULT_ALL);\n\n            Intent mIntent = new Intent();\n            mIntent.setAction(Intent.ACTION_VIEW);\n            Uri contentUri;\n            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n                // å°†æ–‡ä»¶è½¬æ¢æˆcontent://Uriçš„å½¢å¼\n                contentUri = FileProvider.getUriForFile(mContext, getPackageName() + \".provider\", new File(picUrl));\n                // ç”³è¯·ä¸´æ—¶è®¿é—®æƒé™\n                mIntent.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);\n            } else {\n                contentUri = Uri.fromFile(new File(picUrl));\n            }\n\n            mIntent.setDataAndType(contentUri, \"image/*\");\n\n\n            PendingIntent mPendingIntent = PendingIntent.getActivity(mContext\n                    , 0, mIntent, PendingIntent.FLAG_UPDATE_CURRENT);\n            mBuilder.setContentIntent(mPendingIntent);\n            Notification mNotification = mBuilder.build();\n            mNotification.flags |= Notification.FLAG_AUTO_CANCEL;\n            NotificationManager mManager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);\n            mManager.notify(0, mNotification);\n        } else {\n            T.showSToast(mContext, \"å›¾ç‰‡ä¿å­˜å¤±è´¥\");\n        }\n    }\n```\n\nAndroid ç³»ç»Ÿä¸­çš„é€šçŸ¥æ ï¼Œéšç€ç‰ˆæœ¬çš„å‡çº§ï¼Œå·²ç»å½¢æˆäº†å›ºå®šäº†å†™æ³•ï¼Œåœ¨Builderæ¨¡å¼çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡é“¾å¼å†™æ³•ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„è®¾ç½®å„ç§å±æ€§ã€‚è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹PendingIntentçš„ç”¨æ³•ï¼Œæˆ‘ä»¬çŸ¥é“è¿™ä¸ªPendingIntent é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¤„äºPendingçŠ¶æ€ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»é€šçŸ¥æ ï¼Œå°±ä¼šè§¦å‘ä»–æ‰€åŒ…å«çš„Intentã€‚\n\nä¸¥æ ¼æ¥è¯´ï¼Œé€šè¿‡è‡ªå·±çš„åº”ç”¨æƒ³ç”¨æ‰‹æœºè‡ªå¸¦ç›¸å†Œæ‰“å¼€ä¸€å¼ å›¾ç‰‡æ˜¯æ— æ³•å®ç°çš„ï¼Œå› ä¸ºæ— æ³•ä¿è¯æ¯ä¸€ç§æ‰‹æœºä¸Šé¢ç›¸å†Œçš„åŒ…åæ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬åˆ›å»ºACTION=Intent.ACTION_VIEWçš„ Intentï¼Œå»åŒ¹é…ç³»ç»Ÿæ‰€æœ‰ç¬¦åˆè¿™ä¸ªAction çš„Activityï¼Œç³»ç»Ÿç›¸å†Œä¸€å®šæ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚\n\nåˆ°è¿™é‡Œï¼Œè¿˜æœ‰ä¸€å®šéœ€è¦æ³¨æ„ï¼ŒAndroid 7.0 å¼€å§‹ï¼Œæ— æ³•ä»¥file://xxxx å½¢å¼å‘å¤–éƒ¨åº”ç”¨æä¾›å†…å®¹äº†ï¼Œå› æ­¤éœ€è¦è€ƒè™‘ä½¿ç”¨FileProviderã€‚å½“ç„¶ï¼Œå¯¹è¿™ä¸ªé—®é¢˜ï¼ŒGoogleå®˜æ–¹æä¾›äº†å®Œæ•´çš„ä½¿ç”¨å®ä¾‹ï¼Œå®ç°èµ·æ¥éƒ½æ˜¯å¥—è·¯ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ã€‚\n\né‡ç‚¹è®°ä½ä¸‹é¢çš„å¯¹åº”å…³ç³»å³å¯ï¼š\n\n```\n <root-path/> ä»£è¡¨è®¾å¤‡çš„æ ¹ç›®å½•new File(\"/\");\n <files-path/> ä»£è¡¨context.getFilesDir()\n <cache-path/> ä»£è¡¨context.getCacheDir()\n <external-path/> ä»£è¡¨Environment.getExternalStorageDirectory()\n <external-files-path>ä»£è¡¨context.getExternalFilesDirs()\n <external-cache-path>ä»£è¡¨getExternalCacheDirs()\n```\n\n\næŒ‰ç…§ä¸Šé¢ï¼Œæˆ‘ä»¬å­˜å‚¨å›¾ç‰‡çš„ç›®å½•ï¼Œæˆ‘ä»¬åœ¨file_path.xml åšå¦‚ä¸‹å®šä¹‰å³å¯ï¼š\n\n```xml\n\n<paths xmlns:android=\"http://schemas.android.com/apk/res/android\">\n    <external-path\n        name=\"root\"\n        path=\"\"/>\n</paths>\n```\nåœ¨AndroidManifestä¸­å®Œæˆå¦‚ä¸‹é…ç½® ï¼š\n\n```\n        <!-- Android 7.0 FileUriExposedException -->\n        <provider\n            android:name=\"android.support.v4.content.FileProvider\"\n            android:authorities=\"${applicationId}.provider\"\n            android:exported=\"false\"\n            android:grantUriPermissions=\"true\">\n            <meta-data\n                android:name=\"android.support.FILE_PROVIDER_PATHS\"\n                android:resource=\"@xml/file_path\"/>\n        </provider>\n```\n\nè¿™æ ·ï¼Œå½“Build.VERSION.SDK_INTå¤§äºç­‰äº24åŠAndroid7.0æ—¶ï¼Œå¯ä»¥å®‰å¿ƒçš„ä½¿ç”¨FileProvideræ¥å’Œå¤–éƒ¨åº”ç”¨å…±äº«æ–‡ä»¶äº†ã€‚\n\n\n\n## æœ€å\n\nå¥½äº†ï¼Œä»ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰View å‡ºå‘ï¼Œåˆç‰µå‡ºäº†ä¸€å¤§å †å‘¨è¾¹çš„å†…å®¹ã€‚å¥½åœ¨ï¼Œæ€»ç®—å®Œæ•´çš„è¯´å®Œäº†ã€‚\n\n**ç‰¹åˆ«ç”³æ˜**\n\n>ä»¥ä¸Šä»£ç ä¸­æ‰€ç”¨åˆ°çš„å›¾ç‰‡èµ„æºï¼Œå…¨éƒ¨æºè‡ªæ‡‚çƒå¸APPå†…ï¼›æ­¤å¤„å¯¹åº”ç”¨è§£åŒ…ï¼Œåªæ˜¯æœ¬ç€å­¦ä¹ çš„ç›®çš„ï¼Œæ²¡æœ‰å…¶ä»–ä»»ä½•ç”¨æ„ã€‚\n\n\n\n******************\n\n**æºç åœ°å€ï¼š** [Github-AndroidAnimationExercise](https://github.com/REBOOTERS/AndroidAnimationExercise)ã€‚\n\næœ‰å…´è¶£çš„åŒå­¦æ¬¢è¿ star &  forkã€‚\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["è‡ªå®šä¹‰View"],"categories":["Android è¿›é˜¶"]},{"title":"ä»¿ç®€ä¹¦é•¿æŒ‰æ–‡ç« ç”Ÿæˆå›¾ç‰‡æ•ˆæœ","url":"%2F2017%2F03%2F19%2F%E4%BB%BF%E7%AE%80%E4%B9%A6%E9%95%BF%E6%8C%89%E6%96%87%E7%AB%A0%E7%94%9F%E6%88%90%E5%9B%BE%E7%89%87%E6%95%88%E6%9E%9C%2F","content":"\n\n## å‰è¨€\n\nä½¿ç”¨ç®€ä¹¦APPçš„åŒå­¦éƒ½çŸ¥é“ï¼Œç®€ä¹¦æœ‰è¿™æ ·ä¸€ä¸ªåŠŸèƒ½ï¼›æ–‡ç« é¡µé•¿æŒ‰å†…å®¹æ—¶åº•éƒ¨ä¼šå‡ºç°ä¸€ä¸ª**ç”Ÿæˆå›¾ç‰‡åˆ†äº«**çš„æŒ‰é’®ï¼Œç‚¹å‡»ä¹‹åå°±å¯ä»¥å°†å½“å‰çš„æ–‡ç« ç”Ÿæˆä¸€å¼ é•¿å›¾ç‰‡ï¼›è¿™å¼ å›¾ç‰‡å¯ä»¥ä¿å­˜åˆ°æœ¬åœ°æˆ–åˆ†äº«ç»™å¥½å‹ï¼ŒåŒæ—¶è¿˜å¯ä¸ºå›¾ç‰‡è®¾ç½®æˆä¸ºç™½å’Œé»‘ä¸¤ç§é£æ ¼ï¼Œå¾ˆæœ‰è‰ºæœ¯èŒƒã€‚ä¸ªäººä¸€ç›´å¾ˆå–œæ¬¢è¿™ä¸ªåŠŸèƒ½ã€‚\n\nä½†æ˜¯ä»æŸä¸€ä¸ªç‰ˆæœ¬å¼€å§‹ï¼Œè¿™ä¸ªåŠŸèƒ½å¼€å§‹æœ‰bugäº†ï¼Œç”Ÿæˆçš„å›¾ç‰‡åªæœ‰åº•éƒ¨çš„å›ºå®šæ ‡é¢˜ï¼Œè€Œæ²¡æœ‰æ–‡ç« å†…å®¹ï¼Œé•¿å›¾ä¹Ÿå˜æˆäº†å°çŸ­å›¾ã€‚å‘ç®€ä¹¦æ„è§åé¦ˆåï¼Œå¾—åˆ°çš„å›å¤æ˜¯ï¼Œä½¿ç”¨ç‚¹å‡»åˆ†äº«æŒ‰é’®ç”Ÿæˆå›¾ç‰‡åŠŸèƒ½ï¼›åˆ†äº«èœå•åŒ…å«çš„ç”Ÿæˆé•¿å›¾åŠŸèƒ½çš„ç¡®æ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯ï¼Œè¿˜æ˜¯å¾ˆæ€€å¿µä¹‹å‰é•¿æŒ‰ç”Ÿæˆå›¾ç‰‡çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä½œä¸ºä¸€åç¨‹åºçŒ¿ï¼›æ€€ç€å¥½å¥‡çš„å¿ƒæƒ…ï¼Œå†³å®šè‡ªå·±å»å®ç°è¿™æ ·ä¸€ä¸ªåŠŸèƒ½.\n\n## æ•ˆæœé¢„è§ˆ\n\nè€è§„çŸ©ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹å®ç°åçš„æ•ˆæœï¼›è™½ç„¶æ•´ä½“æ²¡æœ‰ç®€ä¹¦æœ‰èŒƒï¼Œä¸ªäººæ„Ÿè§‰è¿˜æ˜¯æŒºåƒçš„ã€‚\n\n\n![æ•ˆæœå›¾](https://user-gold-cdn.xitu.io/2017/3/19/5bfdffd406bed1f24293ff9cc5ffe3c8)\n\n<!--more-->\n\n## æ–‡ç« é¡µå®ç°\n\n#### å†…å®¹\n\næ–‡ç« é¡µå†…å®¹çš„å®ç°ï¼Œæ²¡æœ‰ä»€ä¹ˆéš¾ç‚¹ã€‚å¸ƒå±€æ€»çš„æ¥è¯´å¾ˆç®€å•ï¼ŒåŒ…å«æˆ·ä¿¡æ¯å’Œæ–‡ç« ä¿¡æ¯çš„ä¸€ä¸ªLinearLayoutï¼Œå¤–åŠ ä¸€ä¸ªWebViewå³å¯ã€‚æ•°æ®æ˜¯æ ¹æ®å¸ƒå±€ä¸­æ‰€éœ€çš„å†…å®¹ï¼Œå°è£…äº†ä¸€ä¸ªHtmlBean å¯¹è±¡ï¼Œè€Œè¿™ä¸ªå¯¹è±¡çš„åˆ™æ˜¯é€šè¿‡ä½¿ç”¨Jsoup è§£æå½“å‰é¡µé¢çš„HTMLæ–‡æ¡£å†…å®¹è·å¾—ï¼ˆè¿™é‡Œä½¿ç”¨Jsoup æ–¹å¼è·å–ç®€ä¹¦ç½‘é¡µå†…å®¹ï¼Œåªæ˜¯ä¸ªäººå­¦ä¹ ï¼Œæ²¡æœ‰å…¶ä»–ç”¨æ„ï¼‰ã€‚å…·ä½“å®ç°å¯æŸ¥çœ‹[æºç ](https://github.com/REBOOTERS/AndroidAnimationExercise)\n\n#### é•¿æŒ‰èœå•å®ç°\n\nè¿™é‡Œç‰¹æ„è¯´ä¸€ä¸‹ï¼Œé•¿æŒ‰å¼¹å‡ºåº•éƒ¨æŒ‰é’®çš„å®ç°æ–¹å¼ã€‚ä¸€èˆ¬æƒ…å†µä¸‹å¯¹äºé•¿æŒ‰æ•ˆæœçš„å®ç°ï¼Œæˆ‘ä»¬éƒ½ä¼šé€šè¿‡è®¾ç½®Viewçš„OnLongClickListeneäº‹ä»¶å»å®ç°ç›¸åº”çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¯¹äºè¿™é‡Œçš„WebViewå¯ä»¥å¦‚ä¸‹å®ç°ï¼š\n\n```java\n        mWebView.setOnCreateContextMenuListener(new View.OnCreateContextMenuListener() {\n            @Override\n            public void onCreateContextMenu(ContextMenu menu, View v, ContextMenu.ContextMenuInfo menuInfo) {\n                genImg.setVisibility(View.VISIBLE);\n                T.showSToast(mContext, \"å†æ¬¡ç‚¹å‡»æ–‡ç« å¯éšè—å›¾ç‰‡åˆ†äº«\");\n            }\n        });\n        // ç‚¹å‡»éšè—åº•éƒ¨æŒ‰é’®\n        mWebView.setOnTouchListener(new View.OnTouchListener() {\n            @Override\n            public boolean onTouch(View v, MotionEvent event) {\n                switch (event.getAction()) {\n                    case MotionEvent.ACTION_DOWN:\n                        lastTime = SystemClock.uptimeMillis();\n                        break;\n                    case MotionEvent.ACTION_UP:\n                        if (SystemClock.uptimeMillis() - lastTime < 300) {\n                            genImg.setVisibility(View.GONE);\n                        }\n                        break;\n                }\n                return false;\n            }\n        });\n```\n*****\nè¿™é‡Œé€šè¿‡ç›‘å¬WebViewçš„ContextMenu ç›‘å¬ä½•æ—¶æ˜¾ç¤ºåº•éƒ¨æŒ‰é’®ï¼›åŒæ—¶åœ¨onTouchæ–¹æ³•ä¸­éšè—åº•éƒ¨æŒ‰é’®ã€‚\n\n```java\n        genImg.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                genImg.setVisibility(View.INVISIBLE);\n                Intent intent = new Intent(FakeJianShuActivity.this, GenScreenShotActivity.class);\n                intent.putExtra(\"data\", mHtmlBean);\n                startActivity(intent);\n            }\n        });\n```\nç‚¹å‡»åº•éƒ¨çš„Buttonå°±ä¼šè·³è½¬åˆ°ç”Ÿæˆé•¿å›¾çš„ç•Œé¢ï¼ŒåŒæ—¶å°†ä¹‹å‰è·å–åˆ°çš„HTMLBeanå¯¹è±¡ä¼ é€’è¿‡å»ã€‚\n\n## é•¿å›¾æ•ˆæœå®ç°\n\nè¿™é‡Œé¦–å…ˆè¯´ä¸€ä¸‹å®ç°æ€è·¯ï¼ˆæ€è·¯æ¥æºäº[æ­¤](http://www.jianshu.com/p/c34aad68bf46)ï¼‰ã€‚\n- é¦–å…ˆé€šè¿‡WebViewåŠ è½½ä¸€ä¸ªæœ¬åœ°çš„Htmlé¡µé¢ï¼Œè¿™ä¸ªé¡µé¢åŒ…å«ä¸€äº›å›ºå®šï¼Œå®šä¹‰äº†ä¸€äº›æ ‡ç­¾ã€‚ç„¶åæ ¹æ®ä¼ é€’è¿‡æ¥çš„mHtmlBean å¯¹è±¡ä¸­çš„ä¿¡æ¯ï¼Œé€šè¿‡æ‰§è¡ŒJavaScriptåŠ¨æ€çš„æ›¿æ¢é™æ€HTMLé¡µé¢ä¸­çš„å†…å®¹ï¼›\n- å…³äºé»‘ç™½ä¸¤ç§é£æ ¼çš„å®ç°ï¼ŒåŒæ ·æ˜¯WebViewæ‰§è¡ŒJsï¼ŒåŠ¨æ€æ›¿æ¢HTMLä¸­CSS æ ·å¼ï¼Œä¿®æ”¹WebViewçš„èƒŒæ™¯è‰²å‘ˆç°å‡ºä¸¤ç§ä¸åŒçš„UI æ•ˆæœã€‚\n- é€šè¿‡WebViewçš„capturePicture å’ŒCanvas å¯ä»¥ç”Ÿæˆå‡ºå½“å‰WebViewçš„Bitmapå¯¹è±¡ï¼Œæœ‰äº†è¿™ä¸ªBitmapå°±å¯ä»¥å›¾ç‰‡ä¿å­˜çš„åŠŸèƒ½äº†ã€‚\n\nå¥½äº†ï¼Œä¸‹é¢å°±é€šè¿‡ä»£ç åˆ†åˆ«å®ç°ä¸Šè¿°æ­¥éª¤ã€‚\n\n#### Html é¡µé¢ï¼ˆJianShu.htmlï¼‰\n\n```html \n<html>\n<head>\n    <meta charset=\"utf-8\"/>\n</head>\n<body>\n<img src=\"mark.png\" width=\"13px\" height=\"20px\"\n     style=\"position:absolute;top: 0px;left: 12px;margin-bottom: 15px;\"/>\n<article id=\"content\" style=\"margin: 25px;\"></article>\n<script type=\"text/javascript\">\n        function changeContent(content) {\n            document.getElementById('content').innerHTML = content;\n        }\n\n</script>\n</body>\n</html>\n```\n\nè¿™ä¸ªHTMLé¡µé¢çš„å†…å®¹å¾ˆç®€å•ï¼Œåœ¨æ•´ä¸ªæ–‡æ¡£å·¦ä¸Šè§’æ”¾ç½®äº†ä¸€ä¸ªå°è§’æ ‡ï¼Œå°±æ˜¯ç®€ä¹¦APPç”Ÿæˆé•¿å›¾æ—¶çš„é‚£ä¸ªmark.\nåŒæ—¶å®šä¹‰äº†ä¸€ä¸ªJavaScript æ–¹æ³•ï¼ŒåŠŸèƒ½ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨ä¼ é€’çš„å‚æ•°contentæ›¿æ¢articleæ ‡ç­¾ä¸­çš„æ–‡æ¡£å†…å®¹ã€‚ \n\n#### è‡ªå®šä¹‰WebView \n\nä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰WebViewï¼Œè¿™é‡Œçœ‹ä¸€ä¸‹æ ¸å¿ƒé€»è¾‘ï¼š\n\n```java\npublic class FakeWebView extends WebView {\n     \n    private boolean isFirstLoad = false;\n\n    public void loadData(HtmlBean bean) {\n        assembleData(bean);\n        if (Build.VERSION.SDK_INT >= 21) {\n            isFirstLoad = true;\n            webView.setWebChromeClient(new WebChromeClient() {\n                @Override\n                public void onProgressChanged(WebView view, int newProgress) {\n                    if (newProgress == 100) {\n                        if (isFirstLoad) {\n                            isFirstLoad = false;\n                            Log.e(\"TAG\", \"onProgressChanged\");\n                            updateView();\n                        }\n                    }\n                }\n            });\n        } else {\n            isFirstLoad = true;\n            webView.setVisibility(View.INVISIBLE);\n\n            webView.setWebChromeClient(new WebChromeClient() {\n                @Override\n                public void onProgressChanged(WebView view, int newProgress) {\n                    if (newProgress == 100) {\n                        updateView();\n                        if (!isFirstLoad)\n                            webView.setVisibility(View.VISIBLE);\n                    }\n                }\n            });\n        }\n        webView.loadUrl(\"file:///android_asset/JianShu.html\");\n\n    }\n\n    private void assembleData(HtmlBean bean) {\n        final String data = bean.getContent();\n        final String title = bean.getTitle();\n        final String username = bean.getUsername();\n        final String publishTime = bean.getPublishTime();\n        String Title = \"<h2>\" + title + \"</h2>\";\n        String Footer = \"<p>\" + username + \"</p><p>\" + publishTime + \"</p>\";\n        content = Title + data + Footer;\n    }\n\n\n    public void updateView() {\n        if (mode == MODE_DAY) {\n            webView.setBackgroundColor(Color.WHITE);\n        } else {\n            webView.setBackgroundColor(Color.parseColor(\"#263238\"));\n            content = \"<div style=\\\"color: gray;display: inline;\\\">\" + content + \"</div>\";\n        }\n        webView.loadUrl(\"javascript:changeContent(\\\"\" + content.replace(\"\\n\", \"\\\\n\").replace(\"\\\"\", \"\\\\\\\"\").replace(\"'\", \"\\\\'\") + \"\\\")\");\n    }\n}\n```\n\nè¿™å‡ ä¸ªæ–¹æ³•æ˜¯ç”Ÿæˆé•¿å›¾æœ€æ ¸å¿ƒçš„æ–¹æ³•ã€‚åœ¨loadData æ–¹æ³•ä¸­é¦–å…ˆè°ƒç”¨äº†assembleDataï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ®mHtmlBean è¿™ä¸ªå¯¹è±¡ä¸­çš„æ•°æ®æ‹¼æ¥å‡ºä¸€æ®µ HTML æ–‡æ¡£ã€‚åœ¨webViewçš„loadUrl æ–¹æ³•ä¸­ä¼šä»æœ¬åœ°åŠ è½½ä¹‹å‰å®šä¹‰å¥½çš„JianShu.htmlè¿™ä¸ªé¡µé¢ã€‚ç„¶ååœ¨é¡µé¢åŠ è½½å®Œæˆï¼Œå³onProgressChanged å›è°ƒæ–¹æ³•ä¸­newProgress çš„å€¼ç­‰äº100æ—¶è°ƒç”¨updateViewæ–¹æ³•ï¼›è¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ®å½“å‰è®¾ç½®çš„æ¨¡å¼ï¼Œè®¾ç½®WebViewçš„èƒŒæ™¯ï¼Œå¦‚æœæ˜¯å¤œé—´æ¨¡å¼ï¼Œåˆ™ä¼šå¯¹assembleData ä¸­ç”Ÿæˆçš„æ–‡æ¡£å¤–éƒ¨åœ¨æ·»åŠ  ä¸€ä¸ªç°è‰²é£æ ¼çš„divæ ‡ç­¾ï¼Œå°†æ•´ä¸ªå†…å®¹åŒ…åœ¨è¿™ä¸ªdivæ ‡ç­¾ä¸­ï¼Œæœ€åWebViewæ‰§è¡ŒJSæ–¹æ³• changeContentï¼Œä¼ é€’çš„å‚æ•°å°±æ˜¯ä¹‹å‰æˆ‘ä»¬æ‹¼æ¥å¥½çš„å†…å®¹ã€‚è¿™æ ·æ•´ä¸ªWebViewåˆä¼šåˆ·æ–°ä¸€æ¬¡ï¼Œæ•´ä¸ªWebViewçš„å†…å®¹å°±æ˜¯æ–‡ç« å†…å®¹äº†ã€‚\n\n####  GenScreenShotActivity \n\n```java\n        mFakeWebView = (FakeWebView) findViewById(R.id.fakeWebView);\n        bean = (HtmlBean) getIntent().getSerializableExtra(\"data\");\n        RadioGroup changeMode = (RadioGroup) findViewById(R.id.changeMode);\n        changeMode.setOnCheckedChangeListener(new RadioGroup.OnCheckedChangeListener() {\n            @Override\n            public void onCheckedChanged(RadioGroup group, @IdRes int checkedId) {\n                if (checkedId == R.id.rb_day) {\n                    mFakeWebView.setMode(FakeWebView.MODE_DAY);\n                } else {\n                    mFakeWebView.setMode(FakeWebView.MODE_NIGHT);\n                }\n            }\n        });\n        mFakeWebView.loadData(bean);\n\n      /**\n     * @param mode\n     */\n    public void setMode(@ViewMode int mode) {\n        this.mode = mode;\n        updateView();\n    }\n```\n\nè¿™æ ·åœ¨Activityä¸­ï¼ŒmFakeWebViewå¯¹è±¡é€šè¿‡ä¸Šä¸€ä¸ªé¡µé¢ï¼ˆæ–‡ç« é¡µï¼‰ä¼ é€’çš„mHtmlBean å¯¹è±¡å°±å¯ä»¥æ›´æ–°å½“å‰è§†å›¾äº†ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡RadioButtonå®ç°é¡µé¢é£æ ¼çš„åˆ‡æ¢ã€‚\n\n#### ä¿å­˜å›¾ç‰‡\nè·ç¦»æˆ‘ä»¬æœ€åçš„ç›®æ ‡**ç”Ÿæˆé•¿å›¾ç‰‡**ï¼Œå‰é¢çš„å·¥ä½œå¯ä»¥è¯´åªæ˜¯å®Œæˆäº†50%ï¼Œå› ä¸ºåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬åªä¸è¿‡æ˜¯åœ¨WebViewä¸­æŠŠæ•´ä¸ªæ–‡ç« å†…å®¹åŠ è½½å‡ºæ¥è€Œå·²ï¼›é•¿å›¾è¿˜æ²¡æœ‰å‘¢ã€‚å› æ­¤ï¼Œä¸‹é¢çš„å·¥ä½œå°±æ˜¯é€šè¿‡WebView ç”Ÿæˆé•¿å›¾ã€‚\n\n```java \n    public Bitmap getScreenView(){\n        Picture snapShot = webView.capturePicture();\n        Bitmap bmp = Bitmap.createBitmap(snapShot.getWidth(),snapShot.getHeight(), Bitmap.Config.ARGB_8888);\n        Canvas canvas = new Canvas(bmp);\n        snapShot.draw(canvas);\n        return bmp;\n    }\n```\n\nWebVeiw å¾ˆäººæ€§åŒ–ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å¾—å½“å‰WebViewè§†å›¾**å¯è§ä¸ä¸å¯è§**éƒ¨åˆ†çš„Bitmapäº†ã€‚\nå…¶å®é€šè¿‡WebViewç”Ÿæˆå›¾ç‰‡å¹¶ä¸æ˜¯ä¸€ä»¶éš¾äº‹ï¼Œéš¾å¾—æ˜¯å¦‚ä½•æŠŠæˆ‘ä»¬è¿™é‡Œçš„å›¾ç‰‡ä¿å­˜ä¸‹æ¥ï¼›å› ä¸ºæˆ‘ä»¬è¿™é‡Œç”Ÿæˆçš„æ˜¯é•¿å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™å¼ ç…§ç‰‡çš„é«˜åº¦è¾¾åˆ°äº†æƒŠäººçš„ã€‚å› æ­¤è¿™é‡Œå°±è¦éœ€è¦ä¹‹å‰åœ¨[Bitmap åˆæ¢](http://www.jianshu.com/p/dc5e390d189a)ä¸­æåˆ°çš„ç¬¬ä¸€ç§å‹ç¼©æ–¹æ³•è¿›è¡Œæ–‡ä»¶å¤§å°çš„å‹ç¼©äº†ã€‚å…·ä½“å®ç°ï¼Œå°±ä¸å†é‡å¤è´´å‡ºä»£ç äº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯å‚è€ƒæ–‡æœ«Githubæºç ã€‚\n\n\n\nåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å®Œå…¨å®ç°äº†ä»¿ç…§ç®€ä¹¦é•¿æŒ‰ç”Ÿæˆå›¾ç‰‡çš„åŠŸèƒ½ã€‚é‚£ä¹ˆå›è¿‡å¤´å†æ¥çœ‹ï¼Œè¿™æ ·ä¸€ä¸ªåŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆåœ¨æˆ‘çš„æ‰‹æœºä¸Šï¼Œç®€ä¹¦APPçš„é•¿æŒ‰åŠŸèƒ½ä¼šæœ‰bugå‘¢ã€‚\n\n## ç¼ºé™·\n\næ–‡ç« è¯¦æƒ…é¡µçš„WebViewæ˜¯ç³»ç»Ÿè‡ªå¸¦çš„WebViewï¼Œåœ¨åŠ è½½å¸¦ ä»£ç çš„æ–‡ç« æ—¶ï¼Œæ²¡æœ‰å¯¹ä»£ç ç±»çš„å†…å®¹åšç‰¹æ®Šçš„è§£æï¼Œå› æ­¤æ— æ³•å¯¹ä»£ç é«˜äº®æ˜¾ç¤ºã€‚åªæ˜¯æœ€ä¸ºæ™®é€šçš„æ–‡æœ¬è¿›è¡Œäº†æ˜¾ç¤ºï¼Œå› æ­¤ç”Ÿæˆçš„é•¿å›¾ä¸­ä»£ç ä¹Ÿæ˜¯æ™®é€šæ–‡æœ¬ã€‚ç®€ä¹¦APPè¿˜æ˜¯é«˜å¤§ä¸Šå‘€ï¼Œå¯¹ä»£ç çš„é«˜äº®æ˜¾ç¤ºæ­£æ˜¯æ£’æ£’å“’ï¼\n\n## åè¯\n\nä¸€ä¸ªå¶ç„¶çš„æœºä¼šï¼Œåœ¨å°è¯•ç®€ä¹¦é•¿æŒ‰ç”Ÿæˆå›¾ç‰‡çš„åŠŸèƒ½æ—¶å‘ç°ï¼ŒåŸæ¥ç®€ä¹¦æ˜¯é€šè¿‡WebViewé€‰æ‹©çš„åŒºåŸŸç”Ÿæˆç¬¬äºŒé¡µçš„å†…å®¹ï¼›å› æ­¤å½“æˆ‘åœ¨æ–‡ç« é¡µç©ºç™½åŒºåŸŸé•¿æŒ‰åï¼Œç‚¹å‡»ç”Ÿæˆå›¾ç‰‡æ—¶å¿…ç„¶æ˜¯åªæœ‰ç©ºç™½çš„ï¼Œåªæœ‰åº•éƒ¨çš„ä¸€äº›å›ºå®šæ ‡ç­¾ã€‚å› æ­¤ï¼Œè¿™åº”è¯¥ä¸ç®—æ˜¯ä¸€ä¸ªbugï¼Œåªæ˜¯ä¸ºå¤§å®¶æä¾›äº†ä¸€ç§æ›´æ–¹ä¾¿çš„åŠŸèƒ½ï¼Œå¯ä»¥æŒ‰è‡ªå·±å–œæ¬¢çš„å†…å®¹ç”Ÿæˆæ›´æœ‰æ•ˆçš„é•¿å›¾ã€‚\n\n*******\næœ€å [Github AndroidAnimationExercise](https://github.com/REBOOTERS/AndroidAnimationExercise)ï¼Œè¿™æ˜¯ä¸€ä¸ªå¹³å¸¸è‡ªå·±å­¦ä¹ Androidå„ç§åŠ¨ç”»ã€è‡ªå®šä¹‰Viewçš„é›†åˆé¡¹ç›®ï¼Œæœ‰å…´è¶£çš„åŒå­¦æ¬¢è¿ star & fork ã€‚","tags":["è‡ªå®šä¹‰View"],"categories":["Android è¿›é˜¶"]},{"title":"2017 booklist","url":"%2F2017%2F03%2F01%2F2017-booklist%2F","content":"\n\n- å°¤ç“¦å°”Â·èµ«æ‹‰åˆ©-äººç±»ç®€å² Done\n- è‚¯Â·ç¦è±ç‰¹-ä¸–çºªä¸‰éƒ¨æ›²-å·¨äººçš„é™¨è½ Done\n- è‚¯Â·ç¦è±ç‰¹-ä¸–çºªä¸‰éƒ¨æ›²-ä¸–ç•Œçš„å‡›å†¬ Done\n- è‚¯Â·ç¦è±ç‰¹-ä¸–çºªä¸‰éƒ¨æ›²-æ°¸æ’çš„è¾¹ç¼˜ Done\n\n\ntodo\n\n- åˆ˜æ…ˆæ¬£-ä¸‰ä½“ Delayed\n","tags":["è¯»ä¹¦"]},{"title":"Android MVP ååˆ†é’Ÿå…¥é—¨ï¼","url":"%2F2017%2F01%2F24%2FAndroid%20MVP%20%E5%8D%81%E5%88%86%E9%92%9F%E5%85%A5%E9%97%A8%EF%BC%81%2F","content":"\n## å‰è¨€##\nåœ¨æ—¥å¸¸å¼€å‘APP çš„è¿‡ç¨‹ä¸­ï¼Œéšç€ä¸šåŠ¡çš„æ‰©å±•ï¼Œè§„æ¨¡çš„å˜åŒ–ã€‚æˆ‘ä»¬çš„ä»£ç è§„æ¨¡ä¹Ÿä¼šé€æ¸å˜å¾—åºå¤§ï¼Œæ¯ä¸€ä¸ªç±»é‡Œçš„ä»£ç ä¹Ÿä¼šé€æ¸å¢å¤šã€‚å°¤å…¶æ˜¯Activityå’ŒFragment ï¼Œç”±äºContext çš„å­˜åœ¨ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰å¯¹è§†å›¾çš„æ“ä½œæˆ‘ä»¬åªèƒ½åœ¨Activityå’ŒFragmentä¸­å®Œæˆï¼›å³ä¾¿æ˜¯å¯¹æŸäº›é€»è¾‘è¿›è¡Œå°è£…ï¼ŒActivityå’ŒFragment ä¾æ—§ä¼šæ˜¾å¾—è¿‡äºè‡ƒè‚¿ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ¢ä¸€ç§æ€è·¯å»å†™ä»£ç ï¼Œè¿™ä¸ªæ—¶å€™MVPæ¨¡å¼å°±åº”ç”¨è€Œç”Ÿäº†ï¼é‚£ä¹ˆMVP æ€ä¹ˆç”¨å‘¢ï¼Œä¸‹é¢å°±æ¥è¯´ä¸€è¯´ã€‚\n\nå‡è®¾ä½ ç°åœ¨å¦‚è¦å®ç°ä¸‹å›¾ä¸­çš„åŠŸèƒ½ï¼š\n\n\n![](https://lc-mhke0kuv.cn-n1.lcfile.com/ddbae96177704862aa4c.jpg)\n\nè¿™ä¸ªéœ€æ±‚å¾ˆç®€å•ï¼Œå°±æ˜¯ç‚¹å‡»æŒ‰é’®ï¼Œä¸‹è½½ä¸€å¼ å›¾ç‰‡ï¼Œæ˜¾ç¤ºä¸‹è½½è¿›åº¦ï¼›ä¸‹è½½å®Œæˆåï¼Œåœ¨ImageViewä¸­æ˜¾ç¤ºè¿™å¼ å›¾ç‰‡ã€‚\nä¸‹é¢æˆ‘ä»¬å°±åˆ†åˆ«ç”¨ä¼ ç»Ÿçš„æ–¹å¼ï¼ˆä¹Ÿå°±æ˜¯æ‰€è°“çš„MVC)å’ŒMVP æ¨¡å¼åˆ†åˆ«å–å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ç„¶ååˆ†æä¸€ä¸‹MVP åˆ°åº•å¥½åœ¨å“ªé‡Œã€‚\n\n<!--more-->\n\n## MVC##\n\n```java\npublic class MVCActivity extends AppCompatActivity {\n\n    private Context mContext;\n    private ImageView mImageView;\n    private MyHandler mMyHandler;\n    private ProgressDialog progressDialog;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_mvc);\n        mContext = this;\n        init();\n    }\n\n    private void init() {\n        //view init\n        mImageView = (ImageView) findViewById(R.id.image);\n        mMyHandler = new MyHandler();\n\n        progressDialog = new ProgressDialog(mContext);\n        progressDialog.setButton(DialogInterface.BUTTON_NEGATIVE, \"Cancle\", new DialogInterface.OnClickListener() {\n            @Override\n            public void onClick(DialogInterface dialog, int which) {\n                progressDialog.dismiss();\n            }\n        });\n        progressDialog.setCanceledOnTouchOutside(false);\n        progressDialog.setTitle(\"ä¸‹è½½æ–‡ä»¶\");\n        progressDialog.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);\n\n\n        //click-event\n        findViewById(R.id.downloadBtn).setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                progressDialog.show();\n                HttpUtil.HttpGet(Constants.DOWNLOAD_URL, new DownloadCallback(mMyHandler));\n            }\n        });\n\n        findViewById(R.id.downloadBtn1).setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                progressDialog.show();\n                HttpUtil.HttpGet(Constants.DOWNLOAD_ERROR_URL, new DownloadCallback(mMyHandler));\n            }\n        });\n\n    }\n\n\n    class MyHandler extends Handler {\n        @Override\n        public void handleMessage(Message msg) {\n            super.handleMessage(msg);\n            switch (msg.what) {\n                case 300:\n                    int percent = msg.arg1;\n                    if (percent < 100) {\n                        progressDialog.setProgress(percent);\n                    } else {\n                        progressDialog.dismiss();\n                        Glide.with(mContext).load(Constants.LOCAL_FILE_PATH).into(mImageView);\n                    }\n                    break;\n                case 404:\n                    progressDialog.dismiss();\n                    Toast.makeText(mContext, \"Download fail !\", Toast.LENGTH_SHORT).show();\n                    break;\n                default:\n                    break;\n            }\n        }\n    }\n}\n```\nç”¨mvcçš„æ–¹å¼ï¼Œä¸€ä¸ªActivityå°±èƒ½æå®šã€‚ä»£ç é€»è¾‘å¾ˆç®€å•ï¼Œç‚¹å‡»æŒ‰é’®åæ˜¾ç¤ºä¹‹å‰åˆå§‹åŒ–å¥½ProgressDialogï¼Œç„¶åå¼€å§‹ä¸‹è½½ä»»åŠ¡ï¼ˆè¿™é‡ŒHttpUtil å†…éƒ¨ç®€å•å°è£…äº†OKHttp çš„å¼‚æ­¥GETè¯·æ±‚ï¼Œå®ç°ä¸‹è½½æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°çš„åŠŸèƒ½ï¼Œå®ç°ç»†èŠ‚åœ¨æ­¤ä¸åšæ·±å…¥æ¢è®¨ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥æŸ¥çœ‹[æºç ](https://github.com/REBOOTERS/My-MVP))ï¼Œç„¶åå°†è¯·æ±‚ç»“æœé€šè¿‡Handlerè¿”å›ï¼Œåœ¨handleMessageä¸­æ ¹æ®è¿”å›æ•°æ®çš„ä¿¡æ¯åšå‡ºä¸åŒçš„UI å¤„ç†ï¼›ä¸‹è½½æˆåŠŸæ—¶åœ¨ImageViewä¸­æ˜¾ç¤ºå›¾ç‰‡ï¼Œä¸‹è½½å¤±è´¥æ—¶Toastæç¤ºã€‚\n\nå¯ä»¥å‘ç°ï¼Œåœ¨è¿™ç§æƒ…å†µä¹‹å‰ï¼ŒActivityçš„ä»»åŠ¡ååˆ†ç¹é‡ï¼Œæ—¢è¦è´Ÿè´£ä¸‹è½½ä»»åŠ¡çš„å…·ä½“å®æ–½ï¼Œè¿˜è¦æ ¹æ®ä¸‹è½½è¿›è¡Œå†æ¬¡çš„é€»è¾‘åˆ¤æ–­ï¼Œæ‰èƒ½å»æ›´æ–°UIã€‚è¿™é‡Œåªæ˜¯ä¸€ä¸ªç®€å•çš„ä»»åŠ¡ï¼Œä½ å¯èƒ½è§‰å¾—æ— æ‰€è°“ï¼Œä½†æ˜¯å®é™…å¼€å‘ä¸­ï¼Œä¸€ä¸ªActivityä¸­æœ‰è®¸å¤šçš„äº¤äº’äº‹ä»¶ï¼Œè¿™ä¸ªæ—¶å€™Activityçš„ä»£ç å°±æ˜¾å¾—ç‰¹åˆ«çš„åºå¤§ï¼›ä¸€æ—¦éœ€æ±‚å˜æ›´æˆ–å‡ºç°bugï¼Œé‚£ç®€ç›´å°±æ˜¯å™©æ¢¦ä¸€åœºã€‚\n\nå› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›Activityå¯ä»¥å˜æˆä¸‹é¢è¿™æ ·\n\n- ä»–è´Ÿè´£å‘èµ·å¤„ç†å’Œç”¨æˆ·äº¤äº’çš„å†…å®¹ï¼Œä½†åˆä¸è´Ÿè´£å…·ä½“çš„å®ç°ï¼›\n- éœ€è¦æ˜¾ç¤ºä»€ä¹ˆï¼Œä¸æ˜¾ç¤ºä»€ä¹ˆï¼Œä»€ä¹ˆä¸œè¥¿æ˜¾ç¤ºå¤šå°‘ï¼Œæœ‰ä¸ªä¸œè¥¿å¯ä»¥ç›´æ¥å‘Šè¯‰ä»–ï¼Œ\n- Activityä¸å†åšå¤æ‚çš„é€»è¾‘å¤„ç†ï¼›\n\nå…·ä½“åˆ°ä¸Šé¢çš„demoé‡Œå°±æ˜¯ï¼Œ**Activityè´Ÿè´£å‘èµ·ä¸‹è½½ä»»åŠ¡ï¼Œä½†æ˜¯ä¸è´Ÿè´£å…·ä½“å®ç°ï¼›ä»€ä¹ˆæ—¶å€™æ˜¾ç¤ºProgressDialogï¼Œæ˜¾ç¤ºå¤šå°‘ï¼Ÿä»€ä¹ˆæ—¶å€™æç¤ºé”™è¯¯ä¿¡æ¯ï¼Œè¿™ä¸€åˆ‡éƒ½å¸Œæœ›æœ‰ä¸ªä¸œè¥¿èƒ½ç›´æ¥å‘Šè¯‰Activityï¼Œè€Œä¸å†æ˜¯åœ¨Activityé‡Œå†åšåˆ¤æ–­ã€‚æ€æ ·æ‰èƒ½åšåˆ°å‘¢ï¼Ÿé‚£å°±å¾—é MVP äº†ã€‚**\n\n## MVP ##\n\n**MVP æ¨¡å¼æ‰€åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œå°±æ˜¯å°†ä¸šåŠ¡é€»è¾‘å’Œè§†å›¾é€»è¾‘æŠ½è±¡åˆ°æ¥å£ä¸­ã€‚**\n\næ€ä¹ˆç†è§£å‘¢ï¼Œæˆ‘ä»¬å°±æ ¹æ®æ­¤æ¬¡è¦å®ç°çš„ä¸‹è½½åŠŸèƒ½ï¼Œç”¨ä»£ç è¯´è¯ã€‚\n\n### å®šä¹‰Modelï¼ŒViewï¼ŒPresenter æ¥å£###\n\n#### Model Interface####\n\nModel æ¥å£å®šä¹‰æ‰€æœ‰éœ€è¦å®ç°çš„**ä¸šåŠ¡é€»è¾‘**ï¼Œåœ¨æˆ‘ä»¬çš„ä¸‹è½½ä»»åŠ¡ä¸­ï¼Œä¸šåŠ¡é€»è¾‘åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯ä¸‹è½½ï¼›å› æ­¤Model æ¥å£å¯ä»¥è¿™ä¹ˆå®šä¹‰ ï¼š\n\n```java\npublic interface IDownloadModel {\n    /**\n     * ä¸‹è½½æ“ä½œ\n     * @param url\n     */\n    void download(String url);\n}\n```\n\n#### View Interface####\n\nView æ¥å£å®šä¹‰æ‰€æœ‰éœ€è¦å®ç°çš„**è§†å›¾é€»è¾‘**ï¼Œåœ¨æˆ‘ä»¬çš„ä¸‹è½½ä»»åŠ¡ä¸­ï¼Œè§†å›¾é€»è¾‘åŒ…æ‹¬\n- æ˜¾ç¤ºProgressDialogï¼›\n- æ˜¾ç¤ºDialogå…·ä½“è¿›åº¦ï¼›\n- æ˜¾ç¤ºå…·ä½“çš„Viewï¼ˆè®¾ç½®å›¾ç‰‡ï¼‰ï¼›\n- æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼ˆToastæç¤ºï¼‰\n\nå› æ­¤Viewæ¥å£å¯ä»¥è¿™ä¹ˆå®šä¹‰ï¼š\n\n```java\npublic interface IDownloadView {\n    /**\n     * æ˜¾ç¤ºè¿›åº¦æ¡\n     * @param show\n     */\n    void showProgressBar(boolean show);\n\n    /**\n     * è®¾ç½®è¿›åº¦æ¡è¿›åº¦\n     * @param progress\n     */\n    void setProcessProgress(int progress);\n\n    /**\n     * æ ¹æ®æ•°æ®è®¾ç½®view\n     * @param result\n     */\n    void setView(String result);\n\n    /**\n     * è®¾ç½®è¯·æ±‚å¤±è´¥æ—¶çš„view\n     */\n    void showFailToast();\n}\n```\n#### Presenter Interface####\n\nPresenter æ¥å£ä½œä¸ºè¿æ¥Modelå’ŒViewçš„ä¸­é—´æ¡¥æ¢ï¼Œéœ€è¦å°†äºŒè€…è¿æ¥èµ·æ¥ï¼Œå› æ­¤ä»–éœ€è¦å®Œæˆä»¥ä¸‹å·¥ä½œï¼š\n- æ‰§è¡Œä¸‹è½½ä»»åŠ¡\n- ä¸‹è½½æˆåŠŸè¿”å›ä¸‹è½½ç»“æœ\n- ä¸‹è½½è¿‡ç¨‹è¿”å›ä¸‹è½½è¿›åº¦\n- ä¸‹è½½å¤±è´¥å›è°ƒ\n\nå› æ­¤ï¼ŒPresenter å°±å¯ä»¥è¿™ä¹ˆå®šä¹‰ï¼š\n\n```java\npublic interface IDowndownPresenter {\n    /**\n     * ä¸‹è½½\n     * @param url\n     */\n    void download(String url);\n\n    /**\n     * ä¸‹è½½æˆåŠŸ\n     * @param result\n     */\n    void downloadSuccess(String result);\n\n    /**\n     * å½“å‰ä¸‹è½½è¿›åº¦\n     * @param progress\n     */\n    void downloadProgress(int progress);\n\n    /**\n     * ä¸‹è½½å¤±è´¥\n     */\n    void downloadFail();\n}\n```\n### æ¥å£Modelï¼ŒViewï¼ŒPresenter å…·ä½“å®ç°###\n\nä¸Šé¢å®ç°äº†ï¼Œå„ä¸ªæ¥å£çš„å®šä¹‰ï¼Œä¸‹é¢æ¥çœ‹çœ‹ä»–ä»¬å…·ä½“çš„å®ç°ï¼š\n\n#### Model å…·ä½“å®ç°####\n\n```java\npublic class DownloadModel implements IDownloadModel {\n    private IDowndownPresenter mIDowndownPresenter;\n    private MyHandler mMyHandler = new MyHandler();\n\n    public DownloadModel(IDowndownPresenter IDowndownPresenter) {\n        mIDowndownPresenter = IDowndownPresenter;\n    }\n\n    @Override\n    public void download(String url) {\n        HttpUtil.HttpGet(url, new DownloadCallback(mMyHandler));\n    }\n\n    class MyHandler extends Handler {\n        @Override\n        public void handleMessage(Message msg) {\n            super.handleMessage(msg);\n            switch (msg.what) {\n                case 300:\n                    int percent = msg.arg1;\n                    if (percent < 100) {\n                        mIDowndownPresenter.downloadProgress(percent);\n                    } else {\n                        mIDowndownPresenter.downloadSuccess(Constants.LOCAL_FILE_PATH);\n                    }\n                    break;\n                case 404:\n                    mIDowndownPresenter.downloadFail();\n                    break;\n                default:\n                    break;\n            }\n        }\n    }\n}\n```\nåœ¨MVPæ¨¡å¼ä¸­ï¼ŒModelçš„å·¥ä½œå°±æ˜¯å®Œæˆå…·ä½“çš„ä¸šåŠ¡æ“ä½œï¼Œç½‘ç»œè¯·æ±‚ï¼ŒæŒä¹…åŒ–æ•°æ®å¢åˆ æ”¹æŸ¥ç­‰ä»»åŠ¡ã€‚åŒæ—¶Modelä¸­åˆä¸ä¼šåŒ…å«ä»»ä½•Viewã€‚\nè¿™é‡ŒModelçš„å…·ä½“å®ç°å¾ˆç®€å•ï¼Œå°†Httpä»»åŠ¡çš„ç»“æœè¿”å›åˆ°Handlerå½“ä¸­ï¼Œè€Œåœ¨Handlerä¸­çš„å®ç°åˆæ˜¯ç”±Presenterå®Œæˆã€‚\né‚£ä¹ˆPresenteræ¥å£åˆæ˜¯æ€æ ·å®ç°çš„å‘¢ï¼Ÿèµ¶ç´§æ¥çœ‹çœ‹\n\n#### Presenter å…·ä½“å®ç°####\n\n```java\npublic class DownloadPresenter implements IDowndownPresenter {\n    private IDownloadView mIDownloadView;\n    private IDownloadModel mIDownloadModel;\n\n\n    public DownloadPresenter(IDownloadView IDownloadView) {\n        mIDownloadView = IDownloadView;\n        mIDownloadModel = new DownloadModel(this);\n    }\n\n    @Override\n    public void download(String url) {\n        mIDownloadView.showProgressBar(true);\n        mIDownloadModel.download(url);\n    }\n\n    @Override\n    public void downloadSuccess(String result) {\n        mIDownloadView.showProgressBar(false);\n        mIDownloadView.setView(result);\n    }\n\n    @Override\n    public void downloadProgress(int progress) {\n        mIDownloadView.setProcessProgress(progress);\n    }\n\n    @Override\n    public void downloadFail() {\n        mIDownloadView.showProgressBar(false);\n        mIDownloadView.showFailToast();\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨DownloadPresenterçš„æ„é€ æ–¹æ³•ä¸­ï¼ŒåŒæ—¶å®ä¾‹åŒ–äº†Modelå’ŒViewï¼Œè¿™æ ·Presenterä¸­å°±åŒæ—¶åŒ…å«äº†ä¸¤è€…ï¼›\nè¿™æ ·ï¼›**åœ¨Presenterå…·ä½“å®ç°ä¸­ï¼Œä¸šåŠ¡ç›¸å…³çš„æ“ä½œç”±Modelå»å®Œæˆï¼ˆä¾‹å¦‚downloadï¼‰ï¼Œè§†å›¾ç›¸å…³çš„æ“ä½œç”±Viewå»å®Œæˆ\nï¼ˆå¦‚setViewç­‰ï¼‰**ã€‚Presenter ä½œä¸ºæ¡¥æ¢çš„ä½œç”¨å°±è¿™æ ·ä½“ç°å‡ºæ¥äº†ï¼Œå·§å¦™çš„å°†Viewå’ŒModelçš„å…·ä½“å®ç°è¿æ¥äº†èµ·æ¥ã€‚\n\n\n#### Viewå…·ä½“å®ç°####\n\næœ€åå†çœ‹ä¸€ä¸‹Viewæ¥å£çš„å…·ä½“å®ç°ï¼Œä¹Ÿå°±æ˜¯Activityçš„å®ç°ï¼š\n\n```java\npublic class MVPActivity extends AppCompatActivity implements IDownloadView {\n    private Context mContext;\n    private ImageView mImageView;\n    private ProgressDialog progressDialog;\n\n    private DownloadPresenter mDownloadPresenter;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mContext = this;\n        setContentView(R.layout.activity_mvp);\n        init();\n    }\n\n    private void init() {\n        mDownloadPresenter = new DownloadPresenter(this);\n        //view init\n        mImageView = (ImageView) findViewById(R.id.image);\n        findViewById(R.id.downloadBtn).setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                mDownloadPresenter.download(Constants.DOWNLOAD_URL);\n            }\n        });\n\n        findViewById(R.id.downloadBtn1).setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                mDownloadPresenter.download(Constants.DOWNLOAD_ERROR_URL);\n            }\n        });\n\n        progressDialog = new ProgressDialog(mContext);\n        progressDialog.setButton(DialogInterface.BUTTON_NEGATIVE, \"Cancle\", new DialogInterface.OnClickListener() {\n            @Override\n            public void onClick(DialogInterface dialog, int which) {\n                progressDialog.dismiss();\n            }\n        });\n        progressDialog.setCanceledOnTouchOutside(false);\n        progressDialog.setTitle(\"ä¸‹è½½æ–‡ä»¶\");\n        progressDialog.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);\n\n    }\n\n    @Override\n    public void showProgressBar(boolean show) {\n        if (show) {\n            progressDialog.show();\n        } else {\n            progressDialog.dismiss();\n        }\n    }\n\n    @Override\n    public void setProcessProgress(int progress) {\n        progressDialog.setProgress(progress);\n    }\n\n    @Override\n    public void setView(String result) {\n        Glide.with(mContext).load(result).into(mImageView);\n    }\n\n    @Override\n    public void showFailToast() {\n        Toast.makeText(mContext, \"Download fail !\", Toast.LENGTH_SHORT).show();\n    }\n}\n```\nåœ¨ç‚¹ä¸‹æŒ‰é’®æ‰§è¡Œå¼€å§‹ä¸‹è½½ä»»åŠ¡çš„æ—¶å€™ï¼ŒViewï¼ˆActivityï¼‰ä¸­æ²¡æœ‰å…·ä½“çš„å®ç°ï¼Œåªæ˜¯è°ƒç”¨äº†Presenterä¸­çš„downloadæ–¹æ³•ï¼Œè€ŒPresenterä¸­çš„downloadåˆä¼šå»è°ƒç”¨Modelçš„downloadæ–¹æ³•ï¼ŒModelåˆä¼šåœ¨æ ¹æ®å…·ä½“é€»è¾‘ï¼ˆåœ¨è¿™é‡Œå°±æ˜¯Httpè¯·æ±‚ï¼‰çš„çŠ¶æ€å»è°ƒç”¨Presenterä¸­çš„æ–¹æ³•ï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨handleMessageæ–¹æ³•ä¸­ï¼Œè°ƒç”¨mIDowndownPresenter.downloadProgress(percent)æ—¶ï¼Œå°±ä¼šå»è°ƒç”¨Presenterçš„å…·ä½“å®ç°\n\n```java\n    @Override\n    public void downloadProgress(int progress) {\n        mIDownloadView.setProcessProgress(progress);\n    }\n```\nè€Œä»–çš„å†…éƒ¨å®ç°åˆæ˜¯æ“ä½œå…·ä½“çš„Viewï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨Activityä¸­åˆå§‹åŒ–Presenterä¸­ä¼ é€’çš„thisï¼Œä¹Ÿå°±æ˜¯å½“å‰Activityï¼ˆViewï¼‰ï¼Œè¿™æ ·æœ€ç»ˆå›åˆ°äº†Activityä¸­çš„\n\n```java\n\n    @Override\n    public void setProcessProgress(int progress) {\n        progressDialog.setProgress(progress);\n    }\n```\næˆ‘ä»¬ä¸ºprogressDialog è®¾ç½®è¿›åº¦ã€‚\n\n\n\nè‡³æ­¤ï¼Œæˆ‘ä»¬å°±é€šè¿‡MVP çš„æ¨¡å¼å®ç°äº†æˆ‘ä»¬ä¹‹å‰æ‰€è®¾æƒ³çš„Activity\n\n- Buttonçš„clickæ–¹æ³•è´Ÿè´£å‘èµ·ä¸‹è½½ä»»åŠ¡ï¼Œä½†åˆä¸è´Ÿè´£å…·ä½“å®ç°ï¼Œè€Œæ˜¯ç”±Presenterè½¬æ¥ç»™Modelå»å®ç°\n- Activity ä»€ä¹ˆæ—¶å€™æ˜¾ç¤ºProgressDialogï¼Œä»€ä¹ˆæ—¶å€™æ˜¾ç¤ºToastç›´æ¥ç”±Presenterå‘Šè¯‰ä»–ï¼Œä»–åªåšä¸€ä¸ªViewæƒ³åšçš„äº‹æƒ…\n- Activityé‡Œæ²¡æœ‰ä»»ä½•é€»è¾‘å¤„ç†ï¼Œæ‰€æœ‰çš„é€»è¾‘åˆ¤æ–­éƒ½åœ¨Modelä¸­å®Œæˆäº†ã€‚\n\nè¿™å°±æ˜¯MVP ï¼ï¼ï¼\n\n## MVC VS MVP##\n\né€šè¿‡ä¸Šé¢çš„ä¸¤ç§å®ç°æ–¹æ¡ˆï¼Œç›¸ä¿¡æ¯ä¸ªäººéƒ½å·²ç»ç†è§£äº†MVCå’ŒMVPçš„åŒºåˆ«ï¼›ä¸‹é¢å°±å…¶å„è‡ªçš„ä¼˜ç¼ºç‚¹å†åšä¸€ä¸‹\næ€»ç»“ï¼›**å½“ç„¶ï¼Œè¿™é‡Œçš„ä¼˜ç¼ºç‚¹åªæ˜¯ç›¸å¯¹è€Œè¨€**ã€‚\n\n#### ä¼˜ç‚¹####\n\n\n![MVC](https://lc-mhke0kuv.cn-n1.lcfile.com/423fe583f67b01d47106.gif)\n\n\n![MVP](https://lc-mhke0kuv.cn-n1.lcfile.com/8de34d72fad5bc8d67e2.png)\n\n\nä¸Šé¢ä¸¤å¼ å›¾åˆ†åˆ«æ˜¯MVCå’ŒMVPæ¶æ„å›¾ã€‚ç›¸ä¿¡è®¸å¤šå’Œæˆ‘ä¸€æ ·å°è¯•å»å­¦ä¹ å’Œäº†è§£MVPæ¶æ„çš„åŒå­¦å¯¹è¿™ä¸¤å›¾ï¼ˆæˆ–ç±»ä¼¼çš„å›¾ï¼‰å¹¶ä¸é™Œç”Ÿã€‚\n\n**ç»“æ„æ›´åŠ æ¸…æ™°***\n\næˆ‘ä»¬å›è¿‡å¤´å†å»çœ‹MVCActivity çš„å®ç°ï¼Œæš‚ä¸”å°†æˆ‘ä»¬å¯¹Httpè¯·æ±‚çš„å°è£…å½’ç»“ä¸ºModel(M),é‚£ä¹ˆå‰©ä¸‹çš„å°±åªæœ‰Activityäº†,è€Œè¿™ä¸ªActivityå³å®ç°è§†å›¾é€»è¾‘ï¼Œåˆéœ€è¦å®ç°éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–æ—¢æ˜¯Controllerï¼ˆCï¼‰åˆæ˜¯Viewï¼ˆVï¼‰ã€‚Vå’ŒCçš„åˆ’åˆ†å®Œå…¨ä¸æ¸…æ™°ï¼›å› æ­¤ï¼Œä¼ ç»Ÿçš„ä»£ç ç»“æ„åªèƒ½å‹‰å¼ºç§°ä¸ºMV æˆ–è€…æ˜¯MCï¼Œå¦‚æœç®—ä¸Šxml çš„å¸ƒå±€æ–‡ä»¶ï¼Œæ‰èƒ½ç‰µå¼ºçš„ç§°ä¸ºMVC ç»“æ„ã€‚\n\nè€ŒMVP å°±ä¸åŒäº†ï¼ŒModelï¼ŒViewï¼ŒPresenterå„å¸å…¶èŒï¼Œäº’ç›¸æ­é…ï¼Œå®ç°äº†è§£è€¦ï¼Œå®Œå…¨è§£æ”¾äº†Activityï¼ˆæˆ–è€…æ˜¯Fragmentï¼‰ã€‚è¿™å°±æ˜¯MVP çš„ä¼˜åŠ¿ï¼Œä»£ç ç»“æ„æ›´åŠ æ¸…æ™°ã€‚å¯ä»¥è¿™æ ·è¯´ï¼ŒåŒä¸€ä¸ªæ¨¡å—çš„å®ç°ï¼Œç”šè‡³å…è®¸å‡ ä¸ªäººåˆ†å·¥å®Œæˆï¼›å‡è®¾æœ‰ä¸€ä¸ªéå¸¸å¤æ‚çš„Activityï¼Œå¦‚æœä½¿ç”¨MVP çš„æ¨¡å¼å¼€å‘ï¼›é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œå®šä¹‰å¥½MVPçš„æ¥å£ä¹‹åï¼Œå°±å¯ä»¥æœ‰äººä¸“é—¨å»åšModelï¼Œå¦ä¸€ä¸ªäººä¸“é—¨å»åšViewï¼›å†ç”±ä¸€ä¸ªäººå†™Presenterçš„ä»£ç ï¼Œå½“ç„¶è¿™éœ€è¦æå¼ºçš„ä»£ç è§„èŒƒå’Œåä½œèƒ½åŠ›ï¼›ä½†è¿™åœ¨ä¼ ç»Ÿçš„MVCæ¨¡å¼ä¸­æ ¹æœ¬æ˜¯æ— æ³•æƒ³è±¡çš„ï¼Œæ‰€æœ‰çš„ä¸œè¥¿éƒ½åœ¨ä¸€ä¸ªç±»é‡Œï¼Œä¸¤ä¸ªäººä¸€èµ·æ”¹ï¼Œæœ‰äº†å†²çªæ€ä¹ˆç©/(ã„’oã„’)/~~ã€‚\n\n**éœ€æ±‚å˜æ›´ï¼Œä¸å†æ˜¯å™©æ¢¦**\n\nå‡è®¾ç°åœ¨æœ‰æ–°çš„éœ€æ±‚ï¼Œäº§å“ç»ç†è®¤ä¸ºä¸‹è½½å¤±è´¥ååªæœ‰ä¸€ä¸ªToastæç¤ºå¤ªå•è°ƒäº†ï¼ˆè€Œä¸”ç”¨æˆ·æœ‰å¯èƒ½é”™è¿‡äº†è¿™Toastçš„æ˜¾ç¤ºï¼Œè€Œè¯¯ä»¥ä¸ºAPPå¤±å»äº†å“åº”ï¼‰ï¼Œå› æ­¤ï¼Œç°åœ¨å¸Œæœ›åœ¨ä¸‹è½½å¤±è´¥åå¼¹å‡ºä¸€ä¸ªDialogï¼Œå¯ä»¥é‡è¯•ä¸‹è½½ä»»åŠ¡ã€‚æ˜¯æƒ³ï¼Œå¦‚æœä»£ç ä½¿ç”¨ä¼ ç»Ÿçš„MVC ç»“æ„ï¼Œæ°å·§è¿™ä¸ªä»£ç ä¸æ˜¯ä½ å†™çš„ï¼Œæˆ–è€…è¯´å°±æ˜¯ä½ å†™çš„ï¼Œä½†æ˜¯ä½ å·²ç»å¿˜è®°äº†å…·ä½“çš„é€»è¾‘ï¼›é‚£ä¹ˆä¸ºäº†å®ç°è¿™ä¸ªéœ€æ±‚ä½ åˆå¾—å»é‡æ–°æ‹ä¸€éé€»è¾‘ï¼Œåˆ°æŸä¸ªç±»çš„xxxè¡Œè¿›è¡Œä¿®æ”¹ï¼›ä½†æ˜¯å¦‚æœä½¿ç”¨MVPå°±ä¸åŒäº†Viewæ¥å£å·²ç»å®šä¹‰å¥½äº†showFailToastå°±æ˜¯ç”¨æ¥æ˜¾ç¤ºé”™è¯¯æç¤ºçš„ï¼›å› æ­¤å³ä¾¿ä»£ç ä¸æ˜¯ä½ å†™çš„ï¼Œä½ éƒ½å¯ä»¥å¾ˆå¿«çš„æ‰¾åˆ°ï¼Œåº”è¯¥å»å“ªé‡Œæ”¹ï¼›è€Œçœå»å¾ˆå¤šæ—¶é—´ã€‚\n\n\n**æ›´å®¹æ˜“å†™å•å…ƒæµ‹è¯•**\n\nè¿™ä¸ªå°±ä¸å±•å¼€è¯´äº†ï¼Œæ€»ä¹‹å†™è¿‡å•å…ƒæµ‹è¯•çš„äººåº”è¯¥éƒ½æœ‰è¿™æ ·çš„ä½“ä¼šã€‚\n\n#### ç¼ºç‚¹####\n\nMVPè¿™ä¹ˆå¥½ï¼Œä¹Ÿä¸æ˜¯æ²¡æœ‰ç¼ºç‚¹ã€‚\n\n\n![](https://lc-mhke0kuv.cn-n1.lcfile.com/7e28a3b3f0bc414e469b.png)\n\nå¦‚å›¾ä¸­æ‰€ç¤ºï¼Œä½¿ç”¨MVP æ¶æ„ä¹‹åï¼Œå¤šå‡ºäº†è®¸å¤šç±»ï¼›è¿™æ˜¯å¿…ç„¶çš„ï¼›æ¯ä¸€ä¸ªViewï¼ˆActivityæˆ–Fragmentï¼‰éƒ½è‡³å°‘éœ€è¦å„è‡ªçš„Modelã€Presenterå’ŒViewæ¥å£ï¼Œåœ¨åŠ ä¸Šä»–ä»¬å„è‡ªçš„å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸€ä¸ªé¡µé¢éƒ½ä¼šæœ‰6ä¸ªjavaæ–‡ä»¶ï¼ˆç®—ä¸ŠFragmentæˆ–Activityï¼Œå› ä¸ºä»–å°±æ˜¯Viewçš„å®ç°ï¼‰ï¼Œè¿™æ ·ä¸€ä¸ªç¨æœ‰ç‚¹è§„æ¨¡çš„APPï¼Œç±»å°±ä¼šå˜å¾—å¼‚å¸¸çš„å¤šï¼Œè€Œæ¯ä¸€ä¸ªç±»çš„åŠ è½½åˆä¼šæ¶ˆè€—èµ„æºï¼›å› æ­¤ï¼Œç›¸è¾ƒäºMVCï¼Œè¿™ç®—æ˜¯MVPæœ€å¤§çš„ç¼ºç‚¹äº†å§ã€‚\n\nå½“ç„¶ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¯ä»¥é€šè¿‡æ³›å‹å‚æ•°ã€æŠ½è±¡çˆ¶ç±»çš„æ–¹å¼ï¼Œå°†ä¸€äº›å…¬ç”¨çš„ModelåŠPresenteræŠ½è±¡å‡ºæ¥ã€‚è¿™åº”è¯¥å°±æ˜¯ä½¿ç”¨MVPæ¶æ„çš„ç²¾é«“äº†ã€‚\n\n\n## æœ€å##\n\nä¸ªäººæ„Ÿè§‰ï¼Œä½¿ç”¨MVP æ¶æ„æ˜¯åˆ©å¤§äºå¼Šçš„ï¼›éšç€é¡¹ç›®è§„æ¨¡çš„å¢åŠ ï¼Œä»£ç é€»è¾‘çš„æ¸…æ™°æ‰æ˜¯æœ€é‡è¦çš„äº‹æƒ…ã€‚å†µä¸”Googleå®˜æ–¹ä¹Ÿå‡ºæ¨å‡ºäº†ä¸€ç³»åˆ—å…³äº[MVPçš„ä½¿ç”¨demo](https://github.com/googlesamples/android-architecture)ã€‚\nå› æ­¤ï¼Œè¿™ä¹Ÿæ˜¯å®˜æ–¹æå€¡å¤§å®¶ä½¿ç”¨çš„ã€‚å‡¡äº‹ï¼Œæœ‰åˆ©å¿…æœ‰å¼Šï¼›ç±»æ•°ç›®çš„å¢é•¿æ˜¯æ— æ³•é¿å…çš„äº‹æƒ…ï¼Œå› æ­¤å¦‚ä½•ä½¿ç”¨æ³›å‹å’ŒæŠ½è±¡ä¼˜åŒ–MVP çš„ç»“æ„å°±å˜æˆäº†æˆ‘ä»¬ç”¨å¥½\nMVPçš„å…³é”®äº†ã€‚\n\nå½“ç„¶ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸ºäº†MVPè€Œå»MVPï¼Œå¦‚æœé¡¹ç›®ç»“æ„ä¸æ˜¯å¾ˆåºå¤§ï¼Œä¸šåŠ¡ä¸æ˜¯å¾ˆå¤æ‚ï¼›é‚£ä¹ˆä¼ ç»Ÿçš„MVC æ¶æ„è¶³ä»¥ï¼Œè€Œä¸”ä¹Ÿæ–¹ä¾¿ï¼\n\n****\nå¹´å‰çš„æœ€åä¸€ä¸ªå·¥ä½œæ—¥äº†ï¼Œæˆ‘å±…ç„¶å†™äº†ä¸€ç¯‡å­¦ä¹ ç¬”è®°ï¼›ä»Šå¤©ä¸€å®šæ˜¯ä¸Šäº†å‡çš„ç­å„¿ï¼æ˜å¤©å›å®¶è¿‡å¹´ï¼ŒO(âˆ©_âˆ©)Oå“ˆå“ˆå“ˆ~ï¼æ¯ä¸€ä¸ªäººï¼Œæ–°å¹´å¿«ä¹ï¼\n\n\n\n","tags":["mvp/mvc"],"categories":["Android è¿›é˜¶"]},{"title":"ä»¿çŸ¥ä¹é¦–é¡µå­¦ä¹ CoordinateLayout","url":"%2F2016%2F12%2F22%2F%E4%BB%BF%E7%9F%A5%E4%B9%8E%E9%A6%96%E9%A1%B5%E5%AD%A6%E4%B9%A0CoordinateLayout%E7%94%A8%E6%B3%95%2F","content":"\n\n### å‰è¨€###\n\nç¬¬ä¸€æ¬¡æ¥è§¦CoordinateLayoutçš„æ—¶å€™æ·±æ·±çš„è¢«å…¶ç‚«é…·çš„ç‰¹æ•ˆæ‰€å¸å¼•ï¼›æƒ³ç€ä»€ä¹ˆæ—¶å€™åœ¨å®é™…é¡¹ç›®ä¸­å¯ä»¥ä½¿ç”¨ä¸€ä¸‹ï¼Œæ— å¥ˆå®é™…é¡¹ç›®å› è¡Œä¸šç‰¹ç‚¹ï¼Œå¹¶ä¸éœ€è¦ä½¿ç”¨åˆ°CoordinateLayoutè¿™ä¹ˆé«˜ç«¯çš„äº¤äº’ä½“éªŒï¼›æ‰€ä»¥æœ¬ç€å­¦ä¹ çš„æ€åº¦ï¼Œä¾¿ç”¨CoordinateLayoutæ¨¡ä»¿äº†ä¸€ä¸‹çŸ¥ä¹é¦–é¡µæ•ˆæœï¼Œè¿™ä¹Ÿæ˜¯ç°åœ¨æ˜é‡‘APPé¦–é¡µçš„æ•ˆæœï¼›è¿™ç§æ•ˆæœå…¶å®å¾ˆå‹å¥½ï¼Œèƒ½è®©ç”¨æˆ·æœ€å¤§é™åº¦çš„ä½¿ç”¨åˆ°æ‰‹æœºå±å¹•ã€‚\n\n\nå¥½äº†ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œå…ˆçœ‹çœ‹æ¨¡ä»¿æ•ˆæœã€‚\n\n<!--more-->\n\n\n![index](https://user-gold-cdn.xitu.io/2016/12/22/f9d16ce6e1191880092de3903be0e63f)\n\n\n![discovery](https://user-gold-cdn.xitu.io/2016/12/22/0fffb5a7fb23a754884ab7b13bb87c60)\n\n\n![message](https://user-gold-cdn.xitu.io/2016/12/22/bedd0f983f9217f3342c45094779718f)\n\n\n![userCenter](https://user-gold-cdn.xitu.io/2016/12/22/cce602916eb19ba376f1e429b96ceb6f)\n\n**è¿™é‡Œç”¨åˆ°çš„icon å¤§éƒ¨åˆ†æ¥æºäº[iconfont](http://www.iconfont.cn/)ã€‚**\n\n*ä½¿ç”¨æ¨¡æ‹Ÿå™¨æˆªå–gifè²Œä¼¼æ°¸è¿œéƒ½æ˜¯è¿™æ ·æ¨¡ç³Šä¸æ¸…*ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ç‚¹[github](https://github.com/REBOOTERS/ZhiHuIndex)æŸ¥çœ‹æºç ï¼Œå®é™…è¿è¡Œåœ¨æ‰‹æœºä¸Šæ•ˆæœä¼šæ¯”è¿™é‡Œå¥½ä¸€äº›ã€‚\n\n### ç»¼è¿°###\n\nCoordinateLayoutæ˜¯Android Design Support Libraryæä¾›çš„ä¸€ç§å¸ƒå±€æ–¹å¼ã€‚\n\n\næŸ¥çœ‹æºç æˆ‘ä»¬å¯ä»¥çœ‹åˆ° CoordinateLayoutç»§æ‰¿è‡ªViewGroupï¼Œæ˜¯ä¸€ä¸ªâ€œè¶…çº§å¼ºå¤§â€çš„FrameLayoutï¼ŒFrameLayout ç›¸ä¿¡å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰ï¼Œä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼ŒFrameLayoutå¯ä»¥è¯´æ˜¯è®©Androidå¸ƒå±€ä¸­æœ‰äº†â€œ**å±‚**â€çš„æ¦‚å¿µï¼Œé‚£ä¹ˆè¿™ä¸ªCoordinateLayoutåˆæœ‰ä»€ä¹ˆç¥å¥‡ä¹‹å¤„å‘¢ï¼Œä¸‹é¢æˆ‘ä»¬å°±å­¦ä¹ ä¸€ä¸‹ã€‚\n\n**Coordinate  æŒ‰ç…§å­—é¢æ„æ€ç†è§£ï¼Œå°±æ˜¯åè°ƒã€‚å®ƒå¯ä»¥æ–¹ä¾¿çš„å®ç°å¸ƒå±€å†…viewåè°ƒ**\n\né‚£ä¹ˆç©¶ç«Ÿæ˜¯æ€ä¹ˆä¸ªè°ƒèŠ‚æ³•å‘¢ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ã€‚\n\n### CoordinateLayout ä½¿ç”¨###\n\n#### ç»“åˆSnackbar####\n\nå…³äºCoordinateLayoutæœ€ç»å…¸çš„ä¾‹å­å°±æ˜¯å…¶ç»“åˆSnackbarçš„ä½¿ç”¨äº†ã€‚\n\n``` xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<android.support.design.widget.CoordinatorLayout\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n\n    <android.support.design.widget.FloatingActionButton\n        android:id=\"@+id/fab\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"end|bottom\"\n        android:layout_margin=\"16dp\"\n        android:src=\"@drawable/ic_done\" />\n\n</android.support.design.widget.CoordinatorLayout>\n\n```\n\n\n``` java\n@Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        findViewById(R.id.fab).setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n\n                Snackbar.make(view,\"FAB\",Snackbar.LENGTH_LONG)\n                        .setAction(\"cancel\", new View.OnClickListener() {\n                            @Override\n                            public void onClick(View v) {\n                                \n                            }\n                        })\n                        .show();\n            }\n        });\n    }\n\n```\n****\n\nä¸Šé¢è¿™ä»½ä»£ç åº”è¯¥æ˜¯å¾ˆå¤šäººå¯¹CoordinateLayoutçš„ç¬¬ä¸€å°è±¡ï¼Œè¿™ä¹Ÿæ˜¯å…³äºCoordinateLayoutæœ€ç›´è§‚çš„è§£é‡Šã€‚\n\nè¿™é‡Œå®ç°çš„æ•ˆæœå°±æ˜¯å¦‚ä¸Šé¢ç¬¬ä¸‰å¹…åŠ¨å›¾messageä¸­é‚£æ ·ï¼Œåº•éƒ¨å¼¹å‡ºä¸€ä¸ªSnackBarï¼ŒFloatingActionButtonè‡ªåŠ¨ä¸Šç§»ï¼›è¿™å°±æ˜¯æ‰€è°“çš„åè°ƒï¼Œåè°ƒFloatingActionButtonä¸Šç§»ï¼Œä¸è¢«é¡¶éƒ¨å¼¹å‡ºçš„SnackBaræ‰€é®æŒ¡ã€‚\n\nè¿™é‡Œå¦‚æœæ²¡æœ‰ä½¿ç”¨CoordinateLayoutä½œä¸ºæ ¹å¸ƒå±€ï¼Œè€Œæ˜¯ä½¿ç”¨LinearLayoutæˆ–RelativeLayoutç­‰ï¼Œå¦‚æœFloatingActionButtonè·ç¦»åº•éƒ¨å¤ªè¿‘ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šè¢«åº•éƒ¨å¼¹å‡ºçš„Snackbaræ‰€é®æŒ¡ã€‚\n\n#### ç»“åˆAppBarLayoutä½¿ç”¨####\n\nè¯´åˆ°CoordinateLayoutå°±ä¸å¾—ä¸æè¿™ä¸ªAppBarLayoutï¼Œä»–ä»¬ä¿©ç®€ç›´å°±æ˜¯å¤©ç”Ÿä¸€å¯¹ï¼ŒäºŒè€…ç»“åˆä½¿ç”¨ï¼Œé‚£ç”»é¢çœŸæ˜¯å¤ªç¾äº†ï¼Œæƒ³æƒ³éƒ½è§‰å¾—åˆºæ¿€ã€‚\n\nè¿™é‡Œçœ‹ä¸€ä¸‹æˆ‘ä»¬æ¨¡ä»¿é¦–é¡µé¡¶éƒ¨æœç´¢æ çš„ä»£ç ï¼š\n\n``` xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<android.support.design.widget.CoordinatorLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:id=\"@+id/coordinatorLayout\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".fragments.IndexFragment\">\n\n    <android.support.design.widget.AppBarLayout\n        android:id=\"@+id/index_app_bar\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:theme=\"@style/AppTheme.AppBarOverlay\">\n\n        <RelativeLayout\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"?attr/actionBarSize\"\n            android:background=\"@color/colorPrimary\"\n            app:layout_scrollFlags=\"scroll|enterAlways\">\n\n            <ImageView\n                android:id=\"@+id/live\"\n                android:layout_width=\"24dp\"\n                android:layout_height=\"24dp\"\n                android:layout_alignParentRight=\"true\"\n                android:layout_centerVertical=\"true\"\n                android:layout_marginRight=\"5dp\"\n                android:src=\"@drawable/live_button\" />\n\n            <RelativeLayout\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"match_parent\"\n                android:layout_margin=\"10dp\"\n                android:layout_toLeftOf=\"@id/live\"\n                android:background=\"@color/searchmenu\">\n\n                <ImageView\n                    android:id=\"@+id/search\"\n                    android:layout_width=\"24dp\"\n                    android:layout_height=\"24dp\"\n                    android:layout_centerVertical=\"true\"\n                    android:layout_marginLeft=\"10dp\"\n                    android:src=\"@drawable/ic_search\" />\n\n                <TextView\n                    android:layout_width=\"match_parent\"\n                    android:layout_height=\"wrap_content\"\n                    android:layout_centerVertical=\"true\"\n                    android:layout_marginLeft=\"10dp\"\n                    android:layout_toRightOf=\"@id/search\"\n                    android:text=\"æœç´¢è¯é¢˜ã€é—®é¢˜æˆ–äºº\"\n                    android:textSize=\"16sp\" />\n\n            </RelativeLayout>\n        </RelativeLayout>\n    </android.support.design.widget.AppBarLayout>\n\n        .......\n\n</android.support.design.widget.CoordinatorLayout>\n\n```\n***\nè¿™é‡Œæˆ‘ä»¬åœ¨AppBarLayoutå†…éƒ¨åµŒå¥—äº†ä¸€ä¸ªRelativeLayoutï¼Œåœ¨è¿™ä¸ªRelativeLayoutä¸­æˆ‘ä»¬æ¨¡ä»¿äº†é¡¶éƒ¨çš„æœç´¢æ çš„å¸ƒå±€æ•ˆæœï¼Œè¿™ä¸ªå¾ˆç®€å•ã€‚è¿™é‡Œæœ€æ ¸å¿ƒçš„ä¸œè¥¿å°±æ˜¯\n\n``` xml\napp:layout_scrollFlags=\"scroll|enterAlways\"\n```\n\nè¿™è¡Œä»£ç ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿè¿™ä¸ªapp:layout_scrollFlagsæœ‰ä¸‹é¢å‡ ä¸ªå€¼ï¼š\n\n* scroll: æ‰€æœ‰æƒ³æ»šåŠ¨å‡ºå±å¹•çš„viewéƒ½éœ€è¦è®¾ç½®è¿™ä¸ªflagï¼Œ æ²¡æœ‰è®¾ç½®è¿™ä¸ªflagçš„viewå°†è¢«å›ºå®šåœ¨å±å¹•é¡¶éƒ¨ã€‚\n\n* enterAlways: è®¾ç½®è¿™ä¸ªflagæ—¶ï¼Œå‘ä¸‹çš„æ»šåŠ¨éƒ½ä¼šå¯¼è‡´è¯¥viewå˜ä¸ºå¯è§ã€‚\n\n* enterAlwaysCollapsed: å½“ä½ çš„è§†å›¾å·²ç»è®¾ç½®minHeightå±æ€§åˆä½¿ç”¨æ­¤æ ‡å¿—æ—¶ï¼Œä½ çš„è§†å›¾åªèƒ½å·²æœ€å°é«˜åº¦è¿›å…¥ï¼Œåªæœ‰å½“æ»šåŠ¨è§†å›¾åˆ°è¾¾é¡¶éƒ¨æ—¶æ‰æ‰©å¤§åˆ°å®Œæ•´é«˜åº¦ã€‚\n\n* exitUntilCollapsed: æ»šåŠ¨é€€å‡ºå±å¹•ï¼Œæœ€åæŠ˜å åœ¨é¡¶ç«¯ã€‚\n\n* snap: è§†å›¾åœ¨æ»šåŠ¨æ—¶ä¼šæœ‰ä¸€ç§â€œå°±è¿‘åŸåˆ™â€ï¼Œæ€ä¹ˆè¯´å‘¢ï¼Œå°±æ˜¯å½“è§†å›¾å±•å¼€æ—¶ï¼Œå¦‚æœæ»‘åŠ¨ä¸­å±•   å¼€çš„å†…å®¹è¶…è¿‡è§†å›¾çš„75%,é‚£ä¹ˆè§†å›¾ä¾æ—§ä¼šä¿æŒå±•å¼€ï¼›å½“è§†å›¾å¤„äºå…³é—­æ—¶ï¼Œå¦‚æœæ»‘åŠ¨ä¸­å±•å¼€çš„éƒ¨åˆ†å°äºè§†å›¾çš„25%ï¼Œé‚£ä¹ˆè§†å›¾ä¼šä¿æŒå…³é—­ã€‚æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯ä¼šè®©åŠ¨ç”»æœ‰ä¸€ç§å¼¹æ€§çš„è§†è§‰æ•ˆæœã€‚\n\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†scroll å’Œ enterAlways ï¼Œå°±å¾ˆå®¹æ˜“çš„å®ç°äº†å‘ä¸‹æ»‘åŠ¨æ—¶é¡¶éƒ¨éšè—ï¼Œå‘ä¸‹æ»‘åŠ¨æ—¶é¡¶éƒ¨å‡ºç°çš„æ•ˆæœã€‚\n\n#### ç»“åˆTabLayoutä½¿ç”¨####\n\næ³¨æ„ï¼Œè¿™é‡Œæ‰€è¯´çš„TabLayoutæ˜¯android.support.design.widget.TabLayoutï¼Œä¸æ˜¯å¾ˆä¹…ä»¥å‰çš„é‚£ä¸ªTabLayoutã€‚\n\nä½¿ç”¨è¿™ä¸ªTabLayoutå¯ä»¥äº§ç”Ÿä¸€ç§æ»‘åŠ¨æ—¶tab æ‚¬åœçš„æ•ˆæœï¼Œè¿™é‡Œæˆ‘ä»¬æ¨¡ä»¿çš„æ—¶å€™ï¼Œç”¨äºç§ç§åŸå› æ²¡èƒ½ä½¿ç”¨TabLayoutçš„åŠ¨æ€æ•ˆæœï¼Œåªæ˜¯ç®€å•çš„ç»“åˆViewPagerä½¿ç”¨äº†ä¸€ä¸‹ï¼Œç¬¬äºŒä¸ªé¡µé¢discoveryå°±æ˜¯ä½¿ç”¨TabLayoutä½œä¸ºé¡¶éƒ¨çš„Indicatorä½¿ç”¨ï¼›è¿™ä¸ªå¾ˆç®€å•ï¼Œå°±ä¸å±•å¼€è¯´äº†ï¼›å…·ä½“å®ç°çœ‹æŸ¥çœ‹æºç ã€‚\n\n#### ç»“åˆCollapsingToolbarLayoutä½¿ç”¨####\n\nä¸ªäººæ„Ÿè§‰ï¼Œè¿™æ˜¯æ•´ä¸ªCoordinateLayoutä¸­æœ€æ‹‰é£çš„åŠ¨ç”»ç‰¹æ•ˆï¼Œä¸»è¦æ˜¯å®ç°ä¸€ç§â€œæŠ˜å â€çš„åŠ¨ç”»æ•ˆæœã€‚æˆ‘ä»¬åœ¨æ¨¡ä»¿ä¸ªäººä¸­å¿ƒçš„æ—¶å€™å°±æ˜¯ç”¨åˆ°äº†è¿™ä¸ªåŠŸèƒ½ï¼š\n\nçœ‹ä¸€ä¸‹ä¸ªäººä¸­å¿ƒçš„å¸ƒå±€æ–‡ä»¶ï¼š\n``` xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<android.support.design.widget.CoordinatorLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n\n    <android.support.design.widget.AppBarLayout\n        android:id=\"@+id/appbar\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"256dp\"\n        android:fitsSystemWindows=\"true\"\n        android:theme=\"@style/ThemeOverlay.AppCompat.Dark.ActionBar\">\n\n        <android.support.design.widget.CollapsingToolbarLayout\n            android:id=\"@+id/collapsing_toolbar\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"\n            android:fitsSystemWindows=\"true\"\n            app:contentScrim=\"?attr/colorPrimary\"\n            app:expandedTitleMarginEnd=\"64dp\"\n            app:expandedTitleMarginStart=\"48dp\"\n            app:layout_scrollFlags=\"scroll|exitUntilCollapsed|snap\">\n\n            <RelativeLayout\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"match_parent\"\n                android:background=\"@drawable/user_bg\"\n                app:layout_collapseMode=\"parallax\">\n\n                <de.hdodenhof.circleimageview.CircleImageView\n                    android:layout_width=\"68dp\"\n                    android:layout_height=\"68dp\"\n                    android:layout_centerInParent=\"true\"\n                    android:src=\"@drawable/profile\" />\n\n            </RelativeLayout>\n\n            <android.support.v7.widget.Toolbar\n                android:id=\"@+id/toolbar\"\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"?attr/actionBarSize\"\n                app:layout_collapseMode=\"pin\"\n                app:popupTheme=\"@style/ThemeOverlay.AppCompat.Light\" />\n\n        </android.support.design.widget.CollapsingToolbarLayout>\n\n    </android.support.design.widget.AppBarLayout>\n\n    <android.support.v4.widget.NestedScrollView\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        app:layout_behavior=\"@string/appbar_scrolling_view_behavior\">\n\n        <LinearLayout\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:orientation=\"vertical\"\n            android:paddingTop=\"10dp\">\n\n            <ImageView\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"match_parent\"\n                android:scaleType=\"fitStart\"\n                android:src=\"@drawable/fake\" />\n\n        </LinearLayout>\n\n    </android.support.v4.widget.NestedScrollView>\n\n    <android.support.design.widget.FloatingActionButton\n        android:id=\"@+id/btn\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_margin=\"16dp\"\n        android:clickable=\"true\"\n        android:src=\"@drawable/ic_edit\"\n        app:layout_anchor=\"@id/appbar\"\n        app:layout_anchorGravity=\"bottom|right|end\" />\n\n</android.support.design.widget.CoordinatorLayout>\n```\n\n***\n\n* é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨AppBarLayoutä¸­åµŒå¥—ä¸€ä¸ªCollapsingToolbarLayoutï¼Œå¹¶æŒ‡å®šå…¶\n\n```\napp:layout_scrollFlags=\"scroll|exitUntilCollapsed|snap\"\n```\nè¿™ä¸ªå±æ€§å‰é¢ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œä¸‰ç§å±æ€§ç»“åˆå°±å¯å®ç°æ»šåŠ¨ä¸­â€œæŠ˜å è§†å·®â€çš„æ•ˆæœäº†ã€‚\n\n* æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆåœ¨CollapsingToolbarLayoutæ”¾ç½®äº†ä¸€ä¸ªRelativeLayoutã€‚è¿™ä¸ªRelativeLayoutæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„è®¾ç½®ï¼›\n\n```\napp:layout_collapseMode=\"parallax\"\n```\nè¿™ä¸ªlayout_collapseModeå°±æ˜¯ç”¨æ¥è®¾ç½®æ•´ä¸ªRelativeLayoutçš„æŠ˜å æ•ˆæœçš„ï¼Œæœ‰ä¸¤ç§å–å€¼ï¼Œâ€œpinâ€ï¼šå›ºå®šæ¨¡å¼ï¼Œåœ¨æŠ˜å çš„æ—¶å€™æœ€åå›ºå®šåœ¨é¡¶ç«¯ï¼›â€œparallaxâ€ï¼šè§†å·®æ¨¡å¼ï¼Œåœ¨æŠ˜å çš„æ—¶å€™ä¼šæœ‰ä¸ªè§†å·®æŠ˜å çš„æ•ˆæœã€‚\n\n* æœ€åæ˜¯Toolbarï¼Œå¯ä»¥çœ‹åˆ°Toolbarçš„collapseModeè®¾ç½®ä¸ºpinï¼Œè¿™æ ·å‘ä¸Šæ»‘åŠ¨æ—¶ï¼Œå½“RelativeLayoutçš„å†…å®¹å®Œå…¨æŠ˜å åï¼ŒToolbarå°†æ˜¾ç¤ºåœ¨é¡¶éƒ¨ï¼›è€Œå‘ä¸‹æ»‘åŠ¨æ—¶ï¼ŒToolbarå°†æ¶ˆå¤±ï¼Œè€ŒRelativeLayoutçš„å†…å®¹ä¼šåŠ¨æ€çš„æŠ˜å å±•å¼€ï¼Œè€Œä¸”ç”±äºè®¾ç½®äº†snapï¼Œä¼šæœ‰ä¸€ç§è½»å¾®çš„å¼¹æ€§æ•ˆæœã€‚\n\n**è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°†AppBarLayoutçš„é«˜åº¦è®¾ç½®ä¸ºå›ºå®šå€¼**\n\nCoordinatorLayout è¿˜æä¾›äº†ä¸€ä¸ª layout_anchor çš„å±æ€§ï¼Œè¿åŒ layout_anchorGravity ä¸€èµ·ï¼Œå¯ä»¥ç”¨æ¥æ”¾ç½®ä¸å…¶ä»–è§†å›¾å…³è”åœ¨ä¸€èµ·çš„æ‚¬æµ®è§†å›¾ï¼ˆå¦‚ FloatingActionButtonï¼‰ã€‚\n\nè¿™é‡Œå¦‚æœæˆ‘ä»¬å°†floatingActionButtonè®¾ç½®ä¸ºï¼š\n\n```\nandroid:layout_gravity=\"bottom|right|end\"\n```\n\nFloatingActionButtonå°†ä½äºæ•´ä¸ªå±å¹•çš„å³ä¸‹è§’ã€‚\n\n### ä½¿ç”¨ç»†èŠ‚###\n\nè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨AppBarLayoutæ—¶ï¼Œä¸ºäº†å®ç°å…¶æ»šåŠ¨æ—¶çš„æ•ˆæœï¼Œåœ¨å…¶ä¸‹é¢å¿…é¡»æœ‰ä¸€ä¸ªå¯æ»šåŠ¨çš„Viewï¼Œå¹¶ä¸”éœ€è¦ä¸ºå…¶è®¾ç½®app:layout_behaviorå±æ€§ã€‚\n\næ¯”å¦‚æˆ‘ä»¬åœ¨ç»“åˆç»“åˆCollapsingToolbarLayoutä½¿ç”¨æ—¶ï¼Œ\nåœ¨AppBarLayoutçš„ä¸‹é¢æ”¾ç½®äº†ä¸€ä¸ªNestedScrollViewï¼Œå¹¶è®¾ç½®å…¶app:layout_behavior=\"@string/appbar_scrolling_view_behavior\"ã€‚\n\nè€Œåœ¨å…¶ä»–é¡µé¢ï¼Œæˆ‘ä»¬AppBarLayoutçš„ä¸‹é¢æ”¾ç½®äº†ViewPageræˆ–è€…æ˜¯FrameLayoutéƒ½è®¾ç½®äº†ç›¸åº”çš„å±æ€§ï¼›å…·ä½“å¯å‚è€ƒæºç ã€‚\n\n### Behavior###\n\nä¸Šé¢æˆ‘ä»¬æåˆ°äº†layout_behaviorï¼Œè¿™æ˜¯ä¸ªä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ\n\nè¿™é‡Œå°±ä¸å¾—ä¸è¯´è¿™ä¸ªBehavioräº†ï¼Œå¯ä»¥è¯´Behavioræ˜¯æ•´ä¸ªCoordinateLayoutæœ€æ ¸å¿ƒçš„ä¸œè¥¿ã€‚è¿˜è®°å¾—æˆ‘ä»¬æœ€å¼€å§‹çš„åˆ—å­å—ï¼ŸFloatingActionButtonä¼šéšç€Snackbarçš„å‡ºç°ï¼Œè‡ªåŠ¨çš„è°ƒèŠ‚è‡ªå·±çš„ä½ç½®ï¼Œè¿™æ˜¯æ€æ ·çš„å®ç°çš„å‘¢ï¼Ÿ\n\næˆ‘ä»¬é€šè¿‡è¿½è¸ªæŸ¥çœ‹ Snackbar çš„ show() è¿™ä¸ªæ–¹æ³•ï¼Œæœ€ç»ˆä¼šåœ¨Snackçš„æºç ä¸­æ‰¾åˆ°å¦‚ä¸‹å®ç°ï¼š\n\n``` java\nfinal void showView() {\n        if (mView.getParent() == null) {\n            final ViewGroup.LayoutParams lp = mView.getLayoutParams();\n\n            if (lp instanceof CoordinatorLayout.LayoutParams) {\n                // If our LayoutParams are from a CoordinatorLayout, we'll setup our Behavior\n                final CoordinatorLayout.LayoutParams clp = (CoordinatorLayout.LayoutParams) lp;\n\n                final Behavior behavior = new Behavior();\n                behavior.setStartAlphaSwipeDistance(0.1f);\n                behavior.setEndAlphaSwipeDistance(0.6f);\n                behavior.setSwipeDirection(SwipeDismissBehavior.SWIPE_DIRECTION_START_TO_END);\n                behavior.setListener(new SwipeDismissBehavior.OnDismissListener() {\n                    @Override\n                    public void onDismiss(View view) {\n                        view.setVisibility(View.GONE);\n                        dispatchDismiss(Callback.DISMISS_EVENT_SWIPE);\n                    }\n\n                    @Override\n                    public void onDragStateChanged(int state) {\n                        switch (state) {\n                            case SwipeDismissBehavior.STATE_DRAGGING:\n                            case SwipeDismissBehavior.STATE_SETTLING:\n                                // If the view is being dragged or settling, cancel the timeout\n                                SnackbarManager.getInstance().cancelTimeout(mManagerCallback);\n                                break;\n                            case SwipeDismissBehavior.STATE_IDLE:\n                                // If the view has been released and is idle, restore the timeout\n                                SnackbarManager.getInstance().restoreTimeout(mManagerCallback);\n                                break;\n                        }\n                    }\n                });\n                clp.setBehavior(behavior);\n                // Also set the inset edge so that views can dodge the snackbar correctly\n                clp.insetEdge = Gravity.BOTTOM;\n            }\n\n            mTargetParent.addView(mView);\n        }\n\n        \n    ......\n        \n    }\n```\n\n***\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“Snackæ‰§è¡Œshowæ–¹æ³•çš„æ—¶å€™ï¼Œä¼šç”Ÿæˆä¸€ä¸ªBehaviorå¯¹è±¡ï¼Œç„¶åå°†è¿™ä¸ªå¯¹è±¡setç»™CoordinateLayoutï¼Œè€ŒCoordinateLayoutä¼šæ ¹æ®è¿™ä¸ªBehavioræ‰§è¡ŒåŠ¨ä½œã€‚è¿™ä¸ªæ–¹æ³•ä¸‹é¢çœç•¥çš„ä»£ç å¤§ä½“ä¸Šå°±æ˜¯ä¸€ä¸ªTranslationå±æ€§åŠ¨ç”»çš„å®ç°ï¼Œè¿™é‡Œå°±ä¸å±•å¼€æ¥è¯´äº†ã€‚\n\nå›åˆ°æˆ‘ä»¬ä¹‹å‰æ‰€è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå¸¦æœ‰æ»šåŠ¨å±æ€§çš„viewè®¾ç½®layout_behaviorè¿™ä¸ªå±æ€§ï¼Œæˆ‘ä»¬ä¸ºå…¶è®¾ç½®çš„å€¼\n\n``` xml\napp:layout_behavior=\"@string/appbar_scrolling_view_behavior\"\n```\n\n```\n<string name=\"appbar_scrolling_view_behavior\" translatable=\"false\">android.support.design.widget.AppBarLayout$ScrollingViewBehavior</string>\n```\n***\n\næˆ‘ä»¬å¯ä»¥åœ¨AppBarLayoutçš„æºç ä¸­æ‰¾åˆ°è¿™ä¸ªScrollingViewBehaviorï¼Œå…¶æœ€ç»ˆä¹Ÿæ˜¯ç»§æ‰¿è‡ªBehaviorå®ç°äº†ç‰¹å®šçš„æ•ˆæœã€‚\n\nç°åœ¨æˆ–è®¸ä½ æœ‰ç–‘é—®ï¼Œè¿™ä¸ªç¥ç§˜çš„Behavioråˆ°åº•æ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼Ÿ\n\n#### Behavior æ ¸å¿ƒæ¦‚å¿µ####\n\nBehavior å°±æ˜¯è¡Œä¸ºï¼Œä»–å®šä¹‰äº†Viewçš„è¡Œä¸ºã€‚\n\nCoordinatorLayoutçš„å·¥ä½œåŸç†æ˜¯æœç´¢å®šä¹‰äº†CoordinatorLayout Behaviorçš„å­viewï¼Œä¸ç®¡æ˜¯é€šè¿‡åœ¨xmlä¸­ä½¿ç”¨app:layout_behavioræ ‡ç­¾è¿˜æ˜¯é€šè¿‡åœ¨ä»£ç ä¸­å¯¹viewç±»ä½¿ç”¨@DefaultBehaviorä¿®é¥°ç¬¦æ¥æ·»åŠ æ³¨è§£ã€‚å½“æ»šåŠ¨å‘ç”Ÿçš„æ—¶å€™ï¼ŒCoordinatorLayoutä¼šå°è¯•è§¦å‘é‚£äº›å£°æ˜äº†ä¾èµ–çš„å­viewã€‚\n\nBehavioræœ€åŸºç¡€çš„ä¸¤ä¸ªæ–¹æ³•æ˜¯ï¼šlayoutDependsOn() å’ŒonDependentViewChanged()ï¼›è¿™ä¸¤ä¸ªæ–¹æ³•çš„è¯´æ˜å¦‚ä¸‹ï¼š\n\n``` java\n public boolean layoutDependsOn(CoordinatorLayout parent, T child, \n                                            View dependency) {\n    boolean result;\n    //è¿”å›falseè¡¨ç¤ºchildä¸ä¾èµ–dependencyï¼Œtureè¡¨ç¤ºä¾èµ–\n    return result;    \n}\n\n```\n\n``` java\n/**\n* å½“dependencyå‘ç”Ÿæ”¹å˜æ—¶ï¼ˆä½ç½®ã€å®½é«˜ç­‰ï¼‰ï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°\n* è¿”å›trueè¡¨ç¤ºchildçš„ä½ç½®æˆ–è€…æ˜¯å®½é«˜è¦å‘ç”Ÿæ”¹å˜ï¼Œå¦åˆ™å°±è¿”å›false\n*/\n@Override\npublic boolean onDependentViewChanged(CoordinatorLayout parent, T child, View dependency) {\n     //childè¦æ‰§è¡Œçš„å…·ä½“åŠ¨ä½œ\n        return true;\n}\n```\n***\n\n#### FloatingActionButton çš„Behavior####\n\næˆ‘ä»¬ç”¨Android StudioæŸ¥çœ‹FloatingActionButtonçš„æºç ï¼Œä¼šå‘ç°ä»–åŒ…å«äº†ä¸€ä¸ªBehaviorçš„æ³¨è§£ï¼š\n\n``` java\n@CoordinatorLayout.DefaultBehavior(FloatingActionButton.Behavior.class)\npublic class FloatingActionButton extends VisibilityAwareImageButton {\n.....\n}\n```\n***\n\nè¿™é‡Œæˆ‘ä»¬çœ‹ä¸€ä¸‹FloatingActionButtonçš„æ³¨è§£å‚æ•°FloatingActionButton.Behavior.class æ˜¯æ€æ ·å®ç°çš„ã€‚é€šè¿‡æºç æˆ‘ä»¬å‘ç°è¿™ä¸ªFloatingActionButtonçš„Behaviorç»§æ‰¿è‡ªCoordinateLayoutçš„Behaviorï¼Œè€Œä¸”åªå®ç°äº†onDependentViewChangedæ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ï¼š\n\n``` java\npublic static class Behavior extends CoordinatorLayout.Behavior<FloatingActionButton> {\n        private static final boolean AUTO_HIDE_DEFAULT = true;\n\n        private Rect mTmpRect;\n        private OnVisibilityChangedListener mInternalAutoHideListener;\n        private boolean mAutoHideEnabled;\n\n        public Behavior() {\n            super();\n            mAutoHideEnabled = AUTO_HIDE_DEFAULT;\n        }\n\n        public Behavior(Context context, AttributeSet attrs) {\n            super(context, attrs);\n            TypedArray a = context.obtainStyledAttributes(attrs,\n                    R.styleable.FloatingActionButton_Behavior_Layout);\n            mAutoHideEnabled = a.getBoolean(\n                    R.styleable.FloatingActionButton_Behavior_Layout_behavior_autoHide,\n                    AUTO_HIDE_DEFAULT);\n            a.recycle();\n        }\n\n        @Override\n        public boolean onDependentViewChanged(CoordinatorLayout parent, FloatingActionButton child,\n                View dependency) {\n            if (dependency instanceof AppBarLayout) {\n                // If we're depending on an AppBarLayout we will show/hide it automatically\n                // if the FAB is anchored to the AppBarLayout\n                updateFabVisibilityForAppBarLayout(parent, (AppBarLayout) dependency, child);\n            } else if (isBottomSheet(dependency)) {\n                updateFabVisibilityForBottomSheet(dependency, child);\n            }\n            return false;\n        }\n\n      \n    }\n```\n***\nå¯ä»¥çœ‹åˆ°ä»–åœ¨onDependentViewChangedä¸­ç›´æ¥åˆ¤æ–­äº†å½“å‰ä¾èµ–çš„viewã€‚æˆ‘ä»¬åœ¨æ¨¡ä»¿ä¸ªäººä¸­å¿ƒæ—¶ï¼Œè®¾ç½®çš„FloatingActionButtonçš„dependencyå°±æ˜¯AppBarLayoutã€‚è€Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œä»–å°±ä¼šæ ¹æ®æ­¤æ‰§è¡Œç‰¹å®šçš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯updateFabVisibilityForAppBarLayout è¿™ä¸ªæ–¹æ³•ä¸­çš„å†…å®¹ã€‚\n\n#### è‡ªå®šä¹‰Behavior####\n\nå¥½äº†ï¼Œè¯´äº†è¿™ä¹ˆå¤šï¼Œä¸‹é¢æˆ‘ä»¬è¯´ä¸€ä¸‹è‡ªå®šä¹‰Behaviorã€‚æˆ‘ä»¬åœ¨æ¨¡ä»¿çŸ¥ä¹åº•éƒ¨ç”¨äºåˆ‡æ¢Fragmentçš„Tabæ—¶ï¼Œä¾¿ä½¿ç”¨äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„Behaviorã€‚\n\n##### BottomViewBehavior #####\n``` java\npublic class BottomViewBehavior extends CoordinatorLayout.Behavior<View> {\n    public BottomViewBehavior(Context context, AttributeSet attrs) {\n        super(context, attrs);\n    }\n\n    @Override\n    public boolean layoutDependsOn(CoordinatorLayout parent, View child, View dependency) {\n        return dependency instanceof AppBarLayout;\n    }\n\n    @Override\n    public boolean onDependentViewChanged(CoordinatorLayout parent, View child, View dependency) {\n        float translationY = Math.abs(dependency.getTop());\n        child.setTranslationY(translationY);\n        return true;\n    }\n\n}\n```\n***\n\nè¿™é‡Œæˆ‘ä»¬çš„æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯æˆ‘ä»¬çš„View è¦ä¾èµ–äºé¡¶éƒ¨çš„AppBarLayoutï¼Œè€Œç”¨å…¶è·ç¦»å±å¹•çš„è·ç¦»ï¼Œä½œä¸ºåº•éƒ¨ï¼ˆtab)ç›¸å¯¹äºå±å¹•çš„è·ç¦»ï¼Œè¿™æ ·å½“é¡¶éƒ¨çš„AppBarLayout æ»‘åŠ¨å‡ºå±å¹•æ—¶ï¼Œåº•éƒ¨ä¹Ÿå°†åšç›¸åº”çš„ä½ç§»ï¼Œå½“ç„¶è¿™é‡Œåº•éƒ¨tab çš„é«˜åº¦æ˜¯éœ€è¦åšé™åˆ¶çš„ï¼Œä¸èƒ½å¤§äºé¡¶éƒ¨AppBarLayoutçš„é«˜åº¦ã€‚\n\n``` xml\n<LinearLayout \n        android:id=\"@+id/bottom\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"48dp\"\n        android:layout_gravity=\"bottom\"\n        android:background=\"@color/white\"\n        android:orientation=\"horizontal\"  \n      app:layout_behavior=\"home.smart.fly.zhihuindex.behavior.BottomViewBehavior\">\n\n        <RadioGroup\n            android:id=\"@+id/tabs_rg\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"\n            android:orientation=\"horizontal\"\n            android:paddingLeft=\"5dp\"\n            android:paddingRight=\"5dp\">\n\n            <RadioButton\n                android:id=\"@+id/home_tab\"\n                android:layout_width=\"0dp\"\n                android:layout_height=\"match_parent\"\n                android:layout_weight=\"1\"\n                android:background=\"#00000000\"\n                android:button=\"@null\"\n                android:checked=\"true\"\n                android:drawableTop=\"@drawable/home_sel\"\n                android:gravity=\"center|bottom\"\n                android:paddingTop=\"5dp\" />\n\n            <RadioButton\n                android:id=\"@+id/explore_tab\"\n                android:layout_width=\"0dp\"\n                android:layout_height=\"match_parent\"\n                android:layout_weight=\"1\"\n                android:background=\"#00000000\"\n                android:button=\"@null\"\n                android:drawableTop=\"@drawable/explore_sel\"\n                android:gravity=\"center|bottom\"\n                android:paddingTop=\"5dp\" />\n\n            <RadioButton\n                android:id=\"@+id/notify_tab\"\n                android:layout_width=\"0dp\"\n                android:layout_height=\"match_parent\"\n                android:layout_weight=\"1\"\n                android:background=\"#00000000\"\n                android:button=\"@null\"\n                android:drawableTop=\"@drawable/notify_sel\"\n                android:gravity=\"center|bottom\"\n                android:paddingTop=\"5dp\" />\n\n            <RadioButton\n                android:id=\"@+id/user_tab\"\n                android:layout_width=\"0dp\"\n                android:layout_height=\"match_parent\"\n                android:layout_weight=\"1\"\n                android:background=\"#00000000\"\n                android:button=\"@null\"\n                android:drawableTop=\"@drawable/user_sel\"\n                android:gravity=\"center|bottom\"\n                android:paddingTop=\"5dp\" />\n        </RadioGroup>\n\n    </LinearLayout>\n```\n***\n\næˆ‘ä»¬å°†è‡ªå®šä¹‰çš„Behaviorè®¾ç½®ä¸ºè¿™ä¸ªbottomçš„app:layout_behaviorå°±å¯ä»¥å®ç°ç±»ä¼¼äºçŸ¥ä¹é¦–é¡µçš„é‚£ç§æ•ˆæœäº†ã€‚\n\n##### FabBehavior #####\n\nè¿™é‡Œæˆ‘ä»¬ç”¨åˆ°çš„FloatingActionButtonä¹Ÿå¯ä»¥è‡ªå®šä¹‰Behaviorã€‚\n\n```\npublic class FabBehavior extends CoordinatorLayout.Behavior<View> {\n    private static final Interpolator INTERPOLATOR = new FastOutSlowInInterpolator();\n    /**\n     * æ§ä»¶è·ç¦»coordinatorLayoutåº•éƒ¨è·ç¦»\n     */\n    private float viewDistance;\n    private boolean aninmating;\n\n    public FabBehavior(Context context, AttributeSet attrs) {\n        super(context, attrs);\n    }\n\n    @Override\n    public boolean onStartNestedScroll(CoordinatorLayout coordinatorLayout, View child, View directTargetChild, View target, int nestedScrollAxes) {\n\n        if(child.getVisibility() == View.VISIBLE&& viewDistance ==0){\n            //è·å–æ§ä»¶è·ç¦»çˆ¶å¸ƒå±€ï¼ˆcoordinatorLayoutï¼‰åº•éƒ¨è·ç¦»\n            viewDistance =coordinatorLayout.getHeight()-child.getY();\n        }\n\n        return (nestedScrollAxes & ViewCompat.SCROLL_AXIS_VERTICAL) != 0;//åˆ¤æ–­æ˜¯å¦ç«–ç›´æ»šåŠ¨\n    }\n\n    @Override\n    public void onNestedPreScroll(CoordinatorLayout coordinatorLayout, View child, View target, int dx, int dy, int[] consumed) {\n        //dyå¤§äº0æ˜¯å‘ä¸Šæ»šåŠ¨ å°äº0æ˜¯å‘ä¸‹æ»šåŠ¨\n\n        if (dy >=0&&!aninmating &&child.getVisibility()==View.VISIBLE) {\n            hide(child);\n        } else if (dy <0&&!aninmating &&child.getVisibility()==View.GONE) {\n            show(child);\n        }\n    }\n\n    private void hide(final View view) {\n        ViewPropertyAnimator animator = view.animate().translationY(viewDistance).setInterpolator(INTERPOLATOR).setDuration(200);\n\n        animator.setListener(new Animator.AnimatorListener() {\n            @Override\n            public void onAnimationStart(Animator animator) {\n                aninmating =true;\n            }\n\n            @Override\n            public void onAnimationEnd(Animator animator) {\n                view.setVisibility(View.GONE);\n                aninmating =false;\n            }\n\n            @Override\n            public void onAnimationCancel(Animator animator) {\n                show(view);\n            }\n\n            @Override\n            public void onAnimationRepeat(Animator animator) {\n            }\n        });\n        animator.start();\n    }\n\n    private void show(final View view) {\n        ViewPropertyAnimator animator = view.animate().translationY(0).setInterpolator(INTERPOLATOR).setDuration(200);\n        animator.setListener(new Animator.AnimatorListener() {\n            @Override\n            public void onAnimationStart(Animator animator) {\n                view.setVisibility(View.VISIBLE);\n                aninmating =true;\n            }\n\n            @Override\n            public void onAnimationEnd(Animator animator) {\n                aninmating =false;\n            }\n\n            @Override\n            public void onAnimationCancel(Animator animator) {\n                hide(view);\n            }\n\n            @Override\n            public void onAnimationRepeat(Animator animator) {\n            }\n        });\n        animator.start();\n    }\n}\n```\n***\nè¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰å»å®ç°layoutDependsOn() å’ŒonDependentViewChanged()è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå‰é¢æˆ‘ä»¬çœ‹FloatingActionButtonæºç çš„æ—¶å€™çŸ¥é“ä»–å·²ç»å®ç°äº†onDependentViewChangedï¼Œæˆ‘ä»¬è¿™é‡Œæˆ‘ä»¬ä»è‡ªèº«éœ€æ±‚å‡ºå‘ï¼Œå°±å…¶æ»‘åŠ¨æ—¶çš„ç‰¹æ€§ï¼Œåšäº†ä¸€ä¸ªæ»‘åŠ¨å±å¹•æ—¶FloatingActionButtonå¿«é€Ÿä»åº•éƒ¨å¼¹å‡ºæˆ–éšè—çš„Behaviorã€‚ç»“åˆæ³¨é‡Šï¼Œä»£ç å¾ˆå®¹æ˜“ç†è§£ã€‚\n\nå¥½äº†ï¼Œè¿™å°±æ˜¯æ‰€æœ‰å…³äºCoordinateLayoutçš„ä¸œè¥¿äº†ï¼Œå¯ä»¥çœ‹åˆ°Behavioræ˜¯è¿™ä¸ªæ§ä»¶çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯æœ€éš¾ç†è§£çš„ä¸œè¥¿ã€‚è‡ªå®šä¹‰Behaviorå¯ä»¥è®©æˆ‘ä»¬çš„æ»‘åŠ¨åŠ¨ç”»æœ‰æ— é™çš„å¯èƒ½ã€‚\n\n### æ€»ç»“###\n\nå…³äºè¿™ä¸ªæ¨¡ä»¿çŸ¥ä¹é¦–é¡µçš„å®ç°ï¼Œæœ€åˆçœŸçš„åªæ˜¯æƒ³ç ”ç©¶ä¸€ä¸‹â€œé¦–é¡µâ€æ˜¯æ€ä¹ˆå®ç°çš„ã€‚ç»“æœéšç€Demoçš„å±•å¼€ï¼ŒåŠ ä¸Šè½»å¾®å¼ºè¿«ç—‡çš„ä½œç¥Ÿï¼Œä¾¿æˆäº†ç°åœ¨è¿™ä¸ªæ ·å­ã€‚\n\nåˆ°è¿™é‡Œï¼Œä¸å¾—ä¸è¯´ä¸€ä¸‹ï¼Œä¸ªäººæ„Ÿè§‰ï¼ŒçœŸæ­£çš„çŸ¥ä¹é¦–é¡µåº”è¯¥æ˜¯æ²¡æœ‰ä½¿ç”¨CoordinateLayoutï¼›å› ä¸ºæŒ‰ç°åœ¨è¿™ç§Activity+n*Fragment çš„å¥—è·¯ï¼Œä½¿ç”¨CoordinateLayoutå®Œå…¨æ˜¯ç»™è‡ªå·±æ·»ä¹±ï¼Œå› ä¸ºCoordinateLayoutæ˜¯æ»‘åŠ¨ç‰¹æ€§æ˜¯æ— æ³•åµŒå¥—ä½¿ç”¨çš„ï¼ˆæˆ–è€…è¯´å¾ˆå¤æ‚ï¼Œæˆ‘æ²¡å‘ç°ï¼‰ï¼Œå½“æˆ‘åœ¨æœ€å¤–å±‚çš„Activityä¸­ä½¿ç”¨äº†CoordinateLayoutåï¼Œå†…éƒ¨çš„Fragmentä¸­å†æ¬¡ä½¿ç”¨CoordinateLayoutæ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ„æƒ³ä¸åˆ°çš„å„ç§bugï¼Œæ‰€ä»¥ä½ ä¼šå‘ç°æˆ‘ä»¬æ¨¡æ‹Ÿçš„ä¸ªäººä¸­å¿ƒæ˜¯æœ‰é—®é¢˜çš„ï¼Œè¿™é‡Œå°±æ˜¯åµŒå¥—CoordinateLayoutåå¤–éƒ¨çš„CoordinateLayoutå¤±æ•ˆäº†ï¼Œå¯¼è‡´åº•éƒ¨çš„Behaviorä¹Ÿå¤±æ•ˆã€‚\n\nä¸è¿‡åœ¨æ•´ä¸ªæ¨¡ä»¿çš„è¿‡ç¨‹ï¼Œä¹Ÿç®—æ˜¯å¯¹CoordinateLayoutçš„ä¸€æ¬¡æ·±å…¥äº†è§£å§ï¼Œé¡ºä¾¿ä¹Ÿå¯¹SwipeRefreshLayoutçš„å†…å®¹å’ŒTween Animationçš„ä½¿ç”¨åšäº†ä¸€æ¬¡å·©å›ºã€‚é¦–é¡µRecycleView itemä¸­ä»¿ç…§Toolbarçš„å¼¹å‡ºèœå•ï¼ŒçœŸçš„æ˜¯è€—è´¹äº†ä¸å°‘æ—¶é—´ã€‚\n\n***æºç åœ°å€***\n\nå¥½äº†ï¼ŒæŒ‰ç…§æƒ¯ä¾‹å†æ¬¡ç»™å‡º[github](https://github.com/REBOOTERS/ZhiHuIndex)åœ°å€ï¼Œæ¬¢è¿star&forkã€‚\n\n\n****\n\n## åè¯##\n\nä¹‹å‰å­¦ä¹ CoordinateLayoutæ¨¡ä»¿çŸ¥ä¹é¦–é¡µçš„æ•ˆæœï¼Œæ–­æ–­ç»­ç»­çš„å¤§æ¦‚ç”¨äº†ä¸€å‘¨æ—¶é—´ï¼›ç°åœ¨å›è¿‡å¤´æ¥å†çœ‹ï¼Œå…¶å®å…³äºCoordinateLayoutçš„ä½¿ç”¨å¾ˆç®€å•ï¼Œç”šè‡³æœ‰äº›æ— èŠï¼›å› ä¸ºapp:layout_scrollFlagså’Œ app:layout_collapseMode è¿™ä¸¤ä¸ªå±æ€§çš„å¯é€‰å€¼éƒ½ä¹Ÿå°±é‚£ä¹ˆå‡ ä¸ªï¼›è¿™å…¶å®æ˜¯ä¸€ç§å±€é™æ€§ï¼Œå¤§å®¶åœ¨åº”ç”¨ä¸­ä½¿ç”¨è¿™ä¸ªä¸œè¥¿ï¼Œäº§ç”Ÿçš„æ»‘åŠ¨è§†å·®æ•ˆæœå‡ ä¹å°±æ˜¯ç›¸ä¼¼çš„ï¼Œå”¯ä¸€å°±æ˜¯é¢œè‰²åŠä¸»é¢˜é£æ ¼çš„å·®å¼‚ï¼›è¿™å¾ˆå®¹æ˜“è®©ç”¨æˆ·äº§ç”Ÿå®¡ç¾ç–²åŠ³ï¼›å”¯ä¸€å˜åŒ–çš„å°±æ˜¯Behaviorï¼Œè¿™æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰çš„ä¸œè¥¿ï¼Œå› æ­¤è¿™ä¹Ÿæ˜¯æœ€éš¾æŒæ¡çš„ä¸œè¥¿ã€‚çŸ¥ä¹é¦–é¡µä»¥åŠæ˜é‡‘é¦–é¡µçš„æ•ˆæœæ¯”æˆ‘åœ¨è¿™é‡Œå®ç°çš„è¦æ›´åŠ æŸ”å’Œèˆ’æœï¼Œè‡³äºå…¶æ˜¯å¦ä½¿ç”¨äº†CoordinateLayoutå°±ä¸å¾—è€ŒçŸ¥äº†ã€‚\n\n\n\n\n\n\n\n\n","tags":["Android åŠ¨ç”»"],"categories":["Android è¿›é˜¶"]},{"title":"æˆ‘ä»¬çœŸçš„éœ€è¦ä½¿ç”¨RxJava+Retrofitå—ï¼Ÿ","url":"%2F2016%2F12%2F12%2F%E7%9C%9F%E7%9A%84%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8RxJava%2BRetrofit%E5%90%97%2F","content":"\n\n\n## å‰è¨€ ##\n\nå¯ä»¥è¯´RxJava+Retrofitæ˜¯æ•´ä¸ª2016å¹´Android å¼€å‘åœˆå†…æœ€å—å…³æ³¨çš„çš„ç»„åˆã€‚å„å¤§Androidè®ºå›ä¸Šæœ‰å¤§é‡ä»¥RxJava+Retrofit+xxx ä¸ºæ ‡é¢˜çš„æ–‡ç« ï¼Œæ­¤ç±»æ–‡ç« ä¹Ÿå¤‡å—å¤§å®¶çš„å…³æ³¨ã€‚è¿™ä¸ªç»„åˆä»¿ä½›å·²ç»æˆä¸ºäº†Androidå¼€å‘çš„å¿…å¤‡ç»„ä»¶ï¼Œé¡¹ç›®é‡Œæ²¡ä½¿ç”¨è¿™ä¸ªç»„åˆå¥½åƒè‡ªå·±éƒ½outäº†ä¼¼çš„ã€‚\n\nå¹³å¿ƒè€Œè®ºï¼ŒRxJavaå’ŒRetrofit ç›¸è¾ƒäºä»¥å¾€çš„å„ç§æ¡†æ¶ï¼ˆå¦‚ AsyncHttpClientï¼ŒVolleyç­‰ )å­¦ä¹ å’Œä½¿ç”¨èµ·æ¥ä¼šæœ‰ä¸€äº›éš¾åº¦ï¼›RxJava å¼ºå¤§è€Œåˆåºå¤§çš„æ“ä½œç¬¦ï¼ŒRetrofité‡‡ç”¨æ³¨è§£é£æ ¼å®šä¹‰æ¥å£ï¼Œéƒ½ä¼šè®©åˆå­¦è€…èŠ±è´¹ä¸å°‘åŠŸå¤«ï¼Œç»•ä¸å°‘åœˆå­ï¼Œè¸©å¤§é‡çš„å‘ã€‚æ—¢ç„¶è¿™æ ·ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰äººæ€€ç–‘ï¼Œæˆ‘ä»¬çœŸçš„éœ€è¦å­¦ä¹ RxJavaå’ŒRetrofitå—ï¼Ÿ\n\nä»»æ„ä¸€æ¬¾éœ€è¦è”ç½‘çš„APPï¼Œæœ€å…¸å‹çš„å¥—è·¯å°±æ˜¯è¯·æ±‚åç«¯æ•°æ®ï¼Œè§£ææ•°æ®è¿›è¡ŒUIæ›´æ–°ï¼›å“åº”ç”¨æˆ·æ“ä½œï¼Œå†æ¬¡è¯·æ±‚æ•°æ®ï¼Œæ›´æ–°UIã€‚è¿™é‡Œæˆ‘ä»¬å°±ä»æœ€åŸºç¡€çš„ç½‘ç»œè¯·æ±‚å‡ºå‘ï¼Œå¸¦ç€ç–‘é—®ï¼Œé€æ­¥äº†è§£ä¸€ä¸‹Retrofitçš„å‰ç”Ÿä»Šä¸–ï¼Œçœ‹ä¸€çœ‹RxJavaå’ŒRetrofitçš„ä»·å€¼æ‰€åœ¨ã€‚\n\n<!--more-->\n\n## Android Http ##\n\n### æœ€åŸºç¡€çš„å®ç°æ–¹å¼ ###\n\nåˆå­¦Androidå¼€å‘æ—¶ï¼Œè¿˜åœ¨ä¸Šå¤§å­¦ï¼Œé‚£ä¼šå„¿è¿˜ä¸çŸ¥æœ‰AsyncHttpClientï¼ŒVolleyï¼ŒOKHttp è¿™ä¹ˆæ–¹ä¾¿çš„æ¡†æ¶å­˜åœ¨äºè¿™ä¸ªä¸–ç•Œä¸Šï¼›ä¸€ä¸ªç®€å•çš„ç½‘ç»œè¯·æ±‚é€šå¸¸è¦å†™ä¸€å¤§æ®µä»£ç ã€‚\n\n#### ä½¿ç”¨HttpURLConnectionå®ç°ç½‘ç»œè¯·æ±‚#### \n\n\n``` java\nclass MyTask extends AsyncTask<String, Void, String> {\n\n        @Override\n        protected String doInBackground(String... params) {\n            InputStream mInputStream = null;\n            HttpURLConnection connection = getHttpUrlConnection(params[0]);\n            String result = \"\";\n            try {\n                connection.connect();\n                int statusCode = connection.getResponseCode();\n                String response = connection.getResponseMessage();\n                mInputStream = connection.getInputStream();\n                InputStreamReader inputStreamReader = new InputStreamReader(mInputStream);\n                BufferedReader reader = new BufferedReader(inputStreamReader);\n                StringBuffer sb = new StringBuffer();\n                String line;\n                while ((line = reader.readLine()) != null) {\n                    sb.append(line + \"\\n\");\n                }\n\n                result = \"StatusCode: \" + statusCode + \"\\n\"\n                        + \"Response\" + response + \"\\n\"\n                        + sb.toString();\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n            return result;\n        }\n\n        @Override\n        protected void onPostExecute(String s) {\n            super.onPostExecute(s);\n            tv.setText(s);\n        }\n    }\n\n    private HttpURLConnection getHttpUrlConnection(String url) {\n        HttpURLConnection connection = null;\n        try {\n            URL mUrl = new URL(url);\n            connection = (HttpURLConnection) mUrl.openConnection();\n            connection.setConnectTimeout(20000);\n            connection.setReadTimeout(40000);\n            connection.setRequestMethod(\"GET\");\n            connection.setRequestProperty(\"Content-Type\", \"application/json\");\n            connection.setRequestProperty(\"Accept\", \"application/json\");\n            connection.setRequestProperty(\"Charset\", \"utf-8\");\n            connection.setRequestProperty(\"Content-Length\", \"0\");\n\n        } catch (MalformedURLException e) {\n            e.printStackTrace();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n\n        return connection;\n    }\n```\n\n```java\nnew MyTask().execute(BASE_URL);\n```\n\nè¿™æ®µä»£ç çš„é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯å°†ç½‘ç»œè¯·æ±‚çš„ç»“æœæ˜¾ç¤ºåœ¨ä¸€ä¸ªTextViewä¸Šã€‚å¾ˆå¤§ä¸€éƒ¨åˆ†çš„å†…å®¹éƒ½æ˜¯åœ¨æ‰§è¡ŒHttpURLConnection ç›¸å…³çš„é…ç½®åŠåˆå§‹åŒ–å·¥ä½œã€‚\n\nè®°å¾—ç¬¬ä¸€æ¬¡é€šè¿‡ç½‘ç»œè¯·æ±‚æŠŠæ•°æ®æ˜¾ç¤ºçš„Androidæ¨¡æ‹Ÿå™¨ï¼ˆé‚£æ—¶å€™è¿˜æ˜¯ç©·å­¦ç”Ÿï¼Œä¹°ä¸èµ·Androidæ‰‹æœºï¼‰çš„å±å¹•ä¸Šæ—¶ï¼Œè™½ç„¶åªæ˜¯ä¸€å¤§å †åˆ«äººçœ‹ä¸æ‡‚çš„jsonå­—ç¬¦ä¸²ï¼Œä½†æ˜¯æ„Ÿè§‰è‡ªå·±å°±è¦ä¸Šå¤©äº†ï¼Œç°åœ¨æƒ³æƒ³çœŸæ˜¯ã€‚ã€‚ã€‚ã€‚ã€‚\n\nå³ä¾¿æ˜¯è¿™ä¹ˆé•¿çš„ä¸€æ®µä»£ç ï¼Œè¿˜æ²¡æœ‰åŒ…å«ç½‘ç»œè¯·æ±‚å¼‚å¸¸çš„å†…å®¹ï¼Œå¦‚æœåŠ ä¸Šç½‘ç»œè¯·æ±‚å¤±è´¥å¤„ç†çš„é€»è¾‘ï¼Œå°†ä½¿å¾—æ•´ä¸ªä»£ç ç»“æ„æ›´åŠ è‡ƒè‚¿åºå¤§ã€‚\n\n### ç½‘ç»œè¯·æ±‚æ¡†æ¶çš„æ¶Œç°###\n\nä¸€æ¬¾è”ç½‘çš„APPè‡³å°‘ä¼šæœ‰åå‡ æ¬¡çš„ç½‘ç»œè¯·æ±‚ï¼Œæ›´å¤šçš„å°±æ— æ³•ä¼°è®¡äº†ã€‚å› æ­¤ï¼Œæ¯ä¸€æ¬¡çš„ç½‘ç»œè¯·æ±‚ä¸å¯èƒ½åƒä¸Šé¢é‚£æ ·å†™ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å°è£…ï¼Œå°†ä¸€äº›å›ºå®šçš„æ“ä½œç»Ÿä¸€å¤„ç†ï¼›å½“ç„¶å·²ç»æœ‰è®¸å¤šå¤§ç¥æ¯”æˆ‘æ—©æƒ³åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œä¾¿å‡ºç°äº†è®¸å¤šå¯¹ç½‘ç»œè¯·æ±‚è¿›è¡Œå°è£…çš„åº“ã€‚\n\n- AsyncHttpClientï¼ˆåº•å±‚åŸºäºHttpClientï¼‰\n- afinalï¼ˆFinalHttpï¼ŒåŒæ ·æ˜¯åŸºäºHttpClientå°è£…ï¼‰\n- xUtils (åŸºäºafinal)\n- Volleyï¼ˆGoogleå®˜æ–¹å‡ºå“ï¼‰\n- okHttp\n- NoHttp (ä¸ªäººå¼€å‘)\n\nè¿™é‡Œåˆ—å‡ºçš„å‡ ä¸ªåº“å½“ä¸­ï¼Œä¸ªäººä½¿ç”¨AsyncHttpClientè¾ƒå¤šï¼ŒAsyncHttpClient çš„ç¡®éå¸¸å¥½ç”¨ï¼Œä½†æ˜¯åæ¥ä¼´éšç€Android sdk 23 ä¸­HttpClientçš„åºŸå¼ƒä¹Ÿé€æ¸è¢«é—å¿˜ã€‚\nafinalå’ŒxUtils éƒ½æ²¡æœ‰åœ¨å®é™…é¡¹ç›®ä¸­æ²¡ç”¨è¿‡ï¼Œä¸åšè¯„ä»·ã€‚\n\nVolleyä½œä¸ºGoogleå®˜æ–¹åœ¨2013å¹´I/O å¤§ä¼šä¸Šæ¨å‡ºçš„åº“ï¼Œç›¸è¾ƒäºAsyncHttpClient æ›´å¼ºå¤§ã€‚\n\nä¸‹é¢ç®€å•åˆ—ä¸¾ä¸€ä¸ªä½¿ç”¨Volleyè¿›è¡Œgetè¯·æ±‚çš„demoã€‚\n\n#### Volley ç®€å•ä½¿ç”¨####\n\næ·»åŠ ä¾èµ–ï¼š\n\n```\ncompile 'com.mcxiaoke.volley:library:1.0.19'\n```\n\n``` java\nprotected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mContext = this;\n        queue = Volley.newRequestQueue(mContext);\n        setContentView(R.layout.activity_http_volley_demo);\n        tv = (TextView) findViewById(R.id.editText);\n\n        final StringRequest request = new StringRequest(Request.Method.GET, BASE_URL,\n                new ResponseSuccessListener(), new ResponseFailListener());\n        findViewById(R.id.volley).setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                queue.add(request);\n            }\n        });\n\n    }\n\n    private class ResponseSuccessListener implements com.android.volley.Response.Listener<String> {\n\n        @Override\n        public void onResponse(String response) {\n            tv.setText(response);\n        }\n    }\n\n    private class ResponseFailListener implements Response.ErrorListener {\n\n        @Override\n        public void onErrorResponse(VolleyError error) {\n            Toast.makeText(mContext, error.toString(), Toast.LENGTH_SHORT).show();\n        }\n    }\n```\n\n\n\nè¿™æ®µä»£ç å’Œä¸Šé¢çš„åŠŸèƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯å°†ç½‘ç»œè¯·æ±‚çš„ç»“æœæ˜¾ç¤ºåœ¨TextViewã€‚ä½†æ˜¯é€šè¿‡Volleyå¯¹httpè¯·æ±‚è¿›è¡Œä¸€æ¬¡å°è£…åï¼Œæˆ‘ä»¬ä¸å†å…³æ³¨ç½‘ç»œè¯·æ±‚çš„å…·ä½“ç»†èŠ‚ï¼Œè€Œæ˜¯å°†é‡ç‚¹æ”¾åœ¨äº†å¯¹è¯·æ±‚ç»“æœçš„å¤„ç†ä¸Šï¼›ç½‘ç»œè¯·æ±‚æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å¾ˆå¤šå¥½çš„åº”å¯¹ã€‚\n\nè€Œä¸”åœ¨Volleyä¸­ï¼Œå¼‚æ­¥ç½‘ç»œè¯·æ±‚çš„å›è°ƒæ–¹æ³•å·²ç„¶å¤„äºUIçº¿ç¨‹ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨å›è°ƒæ–¹æ³•ä¸­è¿›è¡ŒUIæ›´æ–°äº†ã€‚\n\nå¯ä»¥è¯´ï¼Œä½¿ç”¨Volleyå·²ç»å¯ä»¥éå¸¸æ–¹ä¾¿çš„å¤„ç†Android ç½‘ç»œè¯·æ±‚çš„ç›¸å…³å†…å®¹äº†ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰OKHttpå’ŒRetrofitçš„å‡ºç°å‘¢?ä»–ä»¬çš„ä¼˜åŠ¿åˆåœ¨å“ªé‡Œå‘¢ï¼Ÿ\n\n#### OKHttp ç®€å•ä»‹ç»####\n\nokHttp æ˜¯ç”±square æ¨å‡ºçš„ä¸€ä¸ªç½‘ç»œè¯·æ±‚åº“ï¼ŒåŒ…æ‹¬Retrofitä¹Ÿæ˜¯ç”±å…¶å¼€å‘ï¼Œè¿™é‡Œä¸ºsquareç‚¹ä¸ªèµã€‚\n\nä½¿ç”¨ä¹‹å‰åŠ å…¥ä¾èµ–\n\n```\n    compile 'com.squareup.okhttp3:okhttp:3.4.1'\n    compile 'com.squareup.okio:okio:1.11.0'\n```\n\n**okHttp ç½‘ç»œè¯·æ±‚å®ç°**\n\n\n\n```\nfindViewById(R.id.get).setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                tv.setText(\"\");\n                loading.setVisibility(View.VISIBLE);\n                client = new OkHttpClient();\n                Request.Builder builder = new Request.Builder()\n                        .url(BASE_URL)\n                        .method(\"GET\", null);\n\n                request = builder.build();\n                Call mCall = client.newCall(request);\n                mCall.enqueue(new MyCallback());\n            }\n        });\n\nprivate class MyCallback implements Callback {\n\n        @Override\n        public void onFailure(Call call, IOException e) {\n            Message msg = new Message();\n            msg.what = 100;\n            msg.obj = e;\n            handler.sendMessage(msg);\n        }\n\n        @Override\n        public void onResponse(Call call, Response response) throws IOException {\n            Message msg = new Message();\n            msg.what = 200;\n            msg.obj = response.body().string();\n            handler.sendMessage(msg);\n        }\n    }\n\nclass MyHandler extends Handler {\n        @Override\n        public void handleMessage(Message msg) {\n            super.handleMessage(msg);\n            loading.setVisibility(View.GONE);\n            switch (msg.what) {\n                case 100:\n                    Object e = msg.obj;\n                    Toast.makeText(mContext, e.toString(), Toast.LENGTH_SHORT).show();\n                    break;\n                case 200:\n                    String response = (String) msg.obj;\n                    tv.setText(response);\n                    break;\n                case 300:\n                    int percent = msg.arg1;\n                    Log.e(\"llll\", \"the percent is \" + percent);\n                    if (percent < 100) {\n                        progressDialog.setProgress(percent);\n                    } else {\n                        progressDialog.dismiss();\n                        Glide.with(mContext).load(FILE_PATH).into(imageView);\n                    }\n                    break;\n                default:\n                    break;\n            }\n        }\n    }\n```\n\n\n**è¿™é‡Œå¿…é¡»äº†è§£çš„æ˜¯ï¼ŒokHttpçš„å›è°ƒæ–¹æ³•ï¼Œå¹¶ä¸å¤„äºUI çº¿ç¨‹ä¸­ï¼Œå¯¹ç½‘ç»œè¯·æ±‚ç»“æœå¦‚æœæ¶‰åŠUI çº¿ç¨‹çš„æ“ä½œï¼Œéœ€è¦ä½¿ç”¨Handler**ã€‚è¿™ä¹ˆçœ‹æ¥ï¼ŒokHttp è²Œä¼¼åè€Œä¸å¦‚Volleyäº†ã€‚å…¶å®ä¸ç„¶ï¼Œokhttpçš„å°è£…å¥—è·¯å’ŒVolleyï¼ŒAsyncHttpä¸æ˜¯ä¸€ä¸ªçº§åˆ«çš„ï¼Œä¸èƒ½å’Œåä¸¤è€…ä½œæ¯”è¾ƒï¼Œokhttp å’ŒHttpClientã€HttpUriConneciton æ‰æ˜¯ä¸€ä¸ªçº§åˆ«çš„äº§ç‰©ï¼Œç›¸è¾ƒäºè¿™ä¸¤è€…ï¼Œokhttpæ˜¾ç„¶å¼ºå¤§äº†è®¸å¤šã€‚\n\næ‰€ä»¥ï¼ŒOKHttpä¸ä»…ä»…å¯ä»¥ç”¨äºAndroidå¼€å‘ï¼ŒJavaå¼€å‘ä¹Ÿæ˜¯OKçš„ã€‚\n\n## Retrofit ##\n\n> A type-safe HTTP client for Android and Java\n> \n> ä¸€ä¸ªé’ˆå¯¹Androidå’ŒJavaç±»å‹å®‰å…¨çš„httpå®¢æˆ·ç«¯\n\nä¸Šé¢è¿™å¥è¯ï¼Œå°±æ˜¯Squireå¯¹Retrofitçš„è¯´æ˜ï¼Œè¨€ç®€æ„èµ…ã€‚Retrofitå…¶å®æ˜¯å¯¹okhttp åšäº†è¿›ä¸€æ­¥çš„å°è£…ï¼Œæœ‰äº†okhttp çš„åŸºç¡€ï¼Œä½¿ç”¨Retrofitä¼šå¾ˆå®¹æ˜“ã€‚\n\nä¸‹é¢å°±æ¥çœ‹çœ‹ï¼Œä½¿ç”¨Retrofitåšç½‘ç»œè¯·æ±‚åˆæ˜¯ä¸€ç§æ€æ ·çš„ä½“éªŒã€‚\n\nè¿™é‡Œä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨\n\n>https://api.github.com/\n\nä½œä¸ºç½‘ç»œè¯·æ±‚çš„æ¥å£åŸºåœ°å€\n\nä½¿ç”¨ä¹‹å‰åŠ å…¥ä¾èµ–ï¼š\n\n``` \ncompile 'com.squareup.retrofit2:retrofit:2.1.0'\n\n```\n\n**å®šä¹‰æ¥å£**\n\n``` java\npublic interface GithubService {\n\n    @GET(\"users/{user}\")\n    Call<ResponseBody> getUserString(@Path(\"user\") String user);\n\n}\n```\n\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨httpä¸­çš„get æ–¹æ³•è·å–usersè¿™ä¸ªæ¥å£ä¸‹ï¼Œå½“å‰userçš„å…·ä½“ä¿¡æ¯ï¼Œå‚æ•°ä¸ºå½“å‰useråã€‚è¿”å›å†…å®¹ä¸ºHttpè¯·æ±‚çš„ResponseBodyã€‚\n\n**Retrofit è¿”å›ResponseBody**\n\n```java\nprivate void SimpleRetrofit() {\n        OkHttpClient.Builder httpClient = new OkHttpClient.Builder();\n        Retrofit.Builder builder = new Retrofit.Builder()\n                .baseUrl(BASE_URL);\n        Retrofit retrofit = builder.client(httpClient.build()).build();\n        GithubService simpleService = retrofit.create(GithubService.class);\n        Call<ResponseBody> call = simpleService.getUserString(name);\n        call.enqueue(new Callback<ResponseBody>() {\n            @Override\n            public void onResponse(Call<ResponseBody> call, Response<ResponseBody> response) {\n                loading.dismiss();\n                try {\n                    String result = response.body().string();\n                    Gson gson = new Gson();\n                    GithubUserBean bean = gson.fromJson(result, GithubUserBean.class);\n                    setUserView(bean);\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n            }\n\n            @Override\n            public void onFailure(Call<ResponseBody> call, Throwable t) {\n                loading.dismiss();\n            }\n        });\n    }\n\nprivate void setUserView(GithubUserBean user) {\n        if (user != null) {\n            viewShell.removeAllViews();\n            View view = LayoutInflater.from(mContext).inflate(R.layout.user_item_layout, null);\n            TextView title = (TextView) view.findViewById(R.id.title);\n            TextView id = (TextView) view.findViewById(R.id.userId);\n            TextView creteaTime = (TextView) view.findViewById(R.id.createTime);\n            TextView updateTime = (TextView) view.findViewById(R.id.updateTime);\n            TextView bio = (TextView) view.findViewById(R.id.bio);\n            ImageView avatar = (ImageView) view.findViewById(R.id.avatar);\n\n            title.setText(\"Name: \" + user.getLogin());\n            bio.setText(\"Bio: \" + user.getBio());\n            id.setText(\"Id: \" + String.valueOf(user.getId()));\n            creteaTime.setText(\"createTime: \" + user.getCreated_at());\n            updateTime.setText(\"updateTime: \" + user.getUpdated_at());\n            Glide.with(mContext).load(user.getAvatar_url()).into(avatar);\n\n            viewShell.addView(view);\n        } else {\n            Toast.makeText(mContext, \"result is null\", Toast.LENGTH_SHORT).show();\n        }\n    }\n```\n\n**GitHubUserBean** ä¸ºç½‘ç»œè¯·æ±‚ç»“æœjsonæ•°æ®æ‰€å¯¹åº”çš„å®ä½“ç±»ã€‚\n\né€šè¿‡è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬åœ¨æœ€ç»ˆçš„å›è°ƒæ–¹æ³•é‡Œå¯ä»¥å‹å¥½çš„å¤„ç†è¯·æ±‚ç»“æœï¼Œå¤±è´¥æ—¶onFailureæ–¹æ³•æ‰§è¡Œã€‚æˆåŠŸæ—¶ï¼ŒonResponseæ–¹æ³•æ‰§è¡Œï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œç”¨Gsonè§£æè¿”å›çš„æ•°æ®ï¼Œå¹¶è¿›è¡ŒUIæ›´æ–°æ“ä½œï¼ˆsetUserView(bean))ï¼Œ\n\nè¿™é‡Œæˆ‘ä»¬è¿™æ ·åšæœ‰äº›å•°å—¦ï¼ŒGsonè½¬æ¢çš„æ–¹å¼éƒ½æ˜¯ç±»ä¼¼ï¼Œå”¯ä¸€ä¸åŒçš„åªæ˜¯æ¯æ¬¡ç½‘ç»œè¯·æ±‚ç»“æœå¯¹åº”çš„å®ä½“ç±»ï¼›å› æ­¤æˆ‘ä»¬å¯ä»¥å€ŸåŠ©å¼ºå¤§çš„Retrofitå¸®åŠ©æˆ‘ä»¬å®ŒæˆGsonè½¬æ¢çš„æ­¥éª¤ã€‚å½“ç„¶ï¼Œå¦‚æœåœ¨ä½ æ‰€åœ¨çš„å¼€å‘ç¯å¢ƒä¸­ï¼Œæ¥å£è¿”å›çš„å¹¶ä¸æ˜¯jsonæ ¼å¼çš„æ•°æ®ï¼Œä¹Ÿæ²¡æœ‰é—®é¢˜çš„ã€‚\n\n\n![convert](https://lc-mhke0kuv.cn-n1.lcfile.com/12c4ecd081399a08d6ca.png)\n\nä¸Šå›¾æ˜¯Retrofitå®˜ç½‘å¯¹å¯è½¬æ¢ç±»å‹ç»™å‡ºçš„ä»‹ç»ã€‚æœ‰è¿™ä¹ˆå¤šç§ï¼Œå½“ç„¶äº†å¦‚æœä½ ä»¬å®¶æœåŠ¡å™¨è¿”å›çš„æ•°æ®æ ¼å¼æ¯”è¾ƒç¥å¥‡ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è½¬æ¢ç±»ã€‚\n\nå¥½äº†ï¼Œè¨€å½’æ­£ä¼ ï¼Œè¿™é‡Œè¿˜æ˜¯ä»¥Json æ ¼å¼æ•°æ®ä¸ºä¾‹ã€‚\n\næ·»åŠ ä¾èµ–ï¼š\n\n```\ncompile 'com.squareup.retrofit2:converter-gson:2.1.0'\n```\n\n**æ³¨æ„è¿™é‡Œconverter-gson çš„ç‰ˆæœ¬å·ï¼Œè¦å’Œä¹‹å‰Retrofitçš„ç‰ˆæœ¬å·ä¿æŒä¸€è‡´ã€‚**\n\næˆ‘ä»¬é‡æ–°å®šä¹‰æ¥å£ï¼š\n\n``` java\npublic interface GithubService {\n    @GET(\"users/{user}\")\n    Call<GithubUserBean> getUser(@Path(\"user\") String user);\n\n}\n```\nè¿™é‡Œæˆ‘ä»¬ç”¨GithubUserBeanå–ä»£ResponseBodyï¼Œç›´æ¥å°†å…¶ä½œä¸ºè¿”å›ç±»å‹ã€‚\n\n**Retrofit è¿”å›å¯¹è±¡**\n\n``` java\nprivate void LazyRetrofit() {\n        OkHttpClient.Builder httpClient = new OkHttpClient.Builder();\n        Retrofit.Builder builder = new Retrofit.Builder()\n                .baseUrl(BASE_URL)\n                .addConverterFactory(GsonConverterFactory.create());\n        Retrofit retrofit = builder.client(httpClient.build()).build();\n        GithubService service = retrofit.create(GithubService.class);\n        Call<GithubUserBean> call = service.getUser(name);\n        call.enqueue(new Callback<GithubUserBean>() {\n            @Override\n            public void onResponse(Call<GithubUserBean> call, Response<GithubUserBean> response) {\n                GithubUserBean bean = response.body();\n                setUserView(bean);\n                loading.dismiss();\n            }\n\n            @Override\n            public void onFailure(Call<GithubUserBean> call, Throwable t) {\n                loading.dismiss();\n            }\n        });\n    }\n```\n\nè¿™é‡Œçš„å®ç°æ–¹å¼å’Œä¸Šé¢åŸºæœ¬ç›¸ä¼¼ï¼Œåªæ˜¯å¤šäº†ä¸€è¡Œ\n\n```java\n.addConverterFactory(GsonConverterFactory.create());\n```\n\nè¿™æ ·ï¼Œæˆ‘ä»¬åœ¨onResponseä¸­è·å¾—å°±æ˜¯å¯¹è±¡ï¼Œä¸å†éœ€è¦åšé¢å¤–çš„è½¬æ¢å·¥ä½œï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚\n\n**Retrofit ç®€å•å°è£…**\n\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒRetrofitä½¿ç”¨æœ‰ç€ä¸€å®šçš„å¥—è·¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†Retrofitåˆå§‹åŒ–ç›¸å…³å¾—å†…å®¹åšä¸€æ¬¡ç®€å•çš„å°è£…ã€‚\n\n``` java\npublic class GenServiceUtil {\n    private static final String BASE_URL = \"https://api.github.com/\";\n\n    private static OkHttpClient.Builder httpClient = new OkHttpClient.Builder();\n\n    private static Retrofit.Builder builder = new Retrofit.Builder()\n            .baseUrl(BASE_URL)\n            .addConverterFactory(GsonConverterFactory.create());\n\n    private static Retrofit retrofit = builder.client(httpClient.build()).build();\n\n    public static <S> S createService(Class<S> serviceClass) {\n        return retrofit.create(serviceClass);\n    }\n\n}\n\nprivate void EasyRetrofit() {\n        GithubService service = GenServiceUtil.createService(GithubService.class);\n        Call<GithubUserBean> call = service.getUser(name);\n        call.enqueue(new Callback<GithubUserBean>() {\n            @Override\n            public void onResponse(Call<GithubUserBean> call, Response<GithubUserBean> response) {\n                GithubUserBean bean = response.body();\n                loading.dismiss();\n                setUserView(bean);\n            }\n\n            @Override\n            public void onFailure(Call<GithubUserBean> call, Throwable t) {\n                loading.dismiss();\n            }\n        });\n    }\n\n```\n\næˆ‘ä»¬åªéœ€ä¼ å…¥å®šä¹‰å¥½çš„å€Ÿå£ï¼Œä¼šä½¿ä»£ç ç®€ä»‹è®¸å¤šã€‚çœ‹åˆ°è¿™é‡Œå¯ä»¥å‘ç°ï¼ŒRetrofitçš„ç¡®å¾ˆå‰å®³ï¼Œé‚£ä¸ºä»€ä¹ˆåˆè¦å°†ä»–å’ŒRxJavaç»“åˆåœ¨ä¸€èµ·å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹ã€‚\n\n## RxJava+Retrofit ##\n\nå…³äºä»€ä¹ˆæ˜¯RxJavaï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œä¸äº†è§£çš„çœ‹ä»¥çœ‹çœ‹[è¿™é‡Œ](http://www.jianshu.com/p/ce9574619697)ã€‚è¿™é‡Œæˆ‘ä»¬å°±çœ‹çœ‹å°†RxJava å’Œæˆ‘ä»¬ä¹‹å‰çš„å†…å®¹ç»“åˆåœ¨ä¸€èµ·ä¼šæœ‰æ€æ ·çš„æ•ˆæœã€‚\n\né¦–å…ˆï¼ŒåŠ å…¥ä¾èµ–\n\n```\n    compile 'io.reactivex:rxjava:1.1.7'\n    compile 'io.reactivex:rxandroid:1.2.1'\n```\n\n### RxJava+Retrofit å®ç°###\n\n``` java\nprivate void RxRetrofit() {\n        GithubService service = GenServiceUtil.createService(GithubService.class);\n        final Call<GithubUserBean> call = service.getUser(name);\n        final Observable myObserable = Observable.create(new Observable.OnSubscribe<GithubUserBean>() {\n            @Override\n            public void call(Subscriber<? super GithubUserBean> subscriber) {\n                Response<GithubUserBean> bean = null;\n                try {\n                    bean = call.execute();\n                    subscriber.onNext(bean.body());\n\n                } catch (IOException e) {\n                    e.printStackTrace();\n                    subscriber.onError(e);\n                }\n\n                subscriber.onCompleted();\n            }\n        });\n\n        myObserable\n                .subscribeOn(Schedulers.io())\n                .observeOn(AndroidSchedulers.mainThread())\n                .map(new Func1<GithubUserBean, GithubUserBean>() {\n                    @Override\n                    public GithubUserBean call(GithubUserBean o) {\n                        if (TextUtils.isEmpty(o.getBio())) {\n                            o.setBio(\"nothing !\");\n                        }\n                        return o;\n                    }\n                })\n                .subscribe(new Subscriber<GithubUserBean>() {\n                    @Override\n                    public void onCompleted() {\n                        loading.dismiss();\n                    }\n\n                    @Override\n                    public void onError(Throwable e) {\n                        loading.dismiss();\n                    }\n\n                    @Override\n                    public void onNext(GithubUserBean o) {\n                        setUserView(o);\n                    }\n                });\n\n    }\n```\n\nè¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š\n\n- RxJava æœ¬èº«æœ€å¤§çš„ç‰¹å®šå°±æ˜¯å¼‚æ­¥ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬Retrofitæ‰§è¡Œç½‘ç»œè¯·æ±‚çš„æ—¶å€™ï¼Œä½¿ç”¨äº†executeï¼ˆåŒæ­¥è¯·æ±‚ï¼‰ï¼Œè€Œä¸å†æ˜¯enqueueã€‚\n- RxJava å¯ä»¥ä½¿ç”¨subscribeOnå’ŒobserveOnå®Œç¾å¤„ç†Observeableå’ŒSubscribeçš„æ‰§è¡Œçº¿ç¨‹é—®é¢˜ã€‚\n- è¿™é‡Œä½¿ç”¨RxJavaä¸­mapæ“ä½œç¬¦ï¼Œå¯¹è¿”å›å†…å®¹ä¸­çš„ä¸ºnullæˆ–â€œâ€ çš„å¯¹è±¡åšäº†ç®€å•çš„å¤„ç†ã€‚\n\næˆ‘ä»¬å¼•å…¥RxJavaå®ç°äº†åŒæ ·çš„åŠŸèƒ½ï¼Œå´ä½¿å¾—ä»£ç é‡å¢åŠ äº†å¾ˆå¤šã€‚ä¸ç¦è¦é—®ï¼ŒRxJavaçš„ä»·å€¼åˆ°åº•åœ¨å“ªé‡Œå‘¢ï¼Ÿ\n\n### RxJava + Retrofit åˆ°åº•å¥½åœ¨å“ªé‡Œ ###\n\nå¥½äº†ï¼Œä¸ºäº†è¯´æ˜ä¸ºé¢˜ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ¥å£\n\n``` java\npublic interface GithubService {\n\n    @GET(\"users/{user}\")\n    Call<GithubUserBean> getUser(@Path(\"user\") String user);\n\n    @GET(\"users/{user}/followers\")Observable<List<UserFollowerBean>> followers(@Path(\"user\") String usr);\n\n}\n```\nå½“ç„¶è¿™é‡Œä¾æ—§éœ€è¦æ·»åŠ ä¾èµ–ï¼š\n\n```\ncompile 'com.squareup.retrofit2:adapter-rxjava:2.1.0'\n````\nåŒæ—¶åœ¨Serviceçš„å°è£…æ–¹æ³•ä¸­æ·»åŠ \n\n```\n.addCallAdapterFactory(RxJavaCallAdapterFactory.create())\n```\n\nè¿™æ ·ï¼ŒRxJavaå°±å’ŒRetrofitå®Œç¾çš„å…³è”åœ¨äº†ä¸€èµ·ã€‚\n\næˆ‘ä»¬åœ¨æ¥å£ä¸­ï¼Œå®šä¹‰followers()æ–¹æ³•ç›´æ¥è¿”å›äº†Observableï¼Œå› ä¸ºObservableæ˜¯RxJavaçš„æºå¤´ï¼Œè€Œä¸”Retrofitå¯ä»¥å¾ˆå¥½çš„æ”¯æŒRxJavaï¼Œè¿™æ ·å°±éå¸¸æ–¹ä¾¿äº†ã€‚\n\n\n```java\n    private void RxRetrofitList() {\n        GithubService service = GenServiceUtil.createService(GithubService.class);\n        Observable<List<UserFollowerBean>> myObserve = service.followers(name);\n        myObserve\n                .subscribeOn(Schedulers.io())\n                .observeOn(AndroidSchedulers.mainThread())\n                .subscribe(new Subscriber<List<UserFollowerBean>>() {\n                    @Override\n                    public void onCompleted() {\n                        loading.dismiss();\n                    }\n\n                    @Override\n                    public void onError(Throwable e) {\n                        loading.dismiss();\n                        e.printStackTrace();\n                    }\n\n                    @Override\n                    public void onNext(List<UserFollowerBean> userFollowerBeen) {\n                        setFollowersView(userFollowerBeen);\n                    }\n                });\n\n    }\n```\n\n\n\nåœ¨æ¥å£ä¸­è¿”å›çš„å†…å®¹å°±æ˜¯Observableï¼Œå› æ­¤ä¸ç”¨å†åƒä¹‹å‰ä¸€æ ·å•ç‹¬å®šä¹‰Observableï¼›åœ¨onNext æ–¹æ³•ä¸­ï¼Œæ¥æ”¶åˆ°è¿”å›çš„å¯¹è±¡ï¼Œæ›´æ–°UIã€‚ è¿™é‡Œå¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨RxJava,å•ç‹¬ä½¿ç”¨Retrofitå®ç°è¿™ä¸ªè¿‡ç¨‹æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼› RxJavaçœ‹ä¼¼æ²¡æœ‰ä»·å€¼ï¼›ä½†æ˜¯å‡è®¾ç°åœ¨å‡ºç°å¦‚ä¸‹ä¹‹ä¸€çš„æƒ…æ™¯\n\n- éœ€è¦å¯¹è¿”å›çš„userFollowerBeen è¿™ä¸ªlist è¿›è¡ŒæŒ‰ç”¨æˆ·åä»å°åˆ°å¤§çš„æ’åº\n- éœ€è¦å¯¹è¿”å›çš„userFollowerBeen è¿™ä¸ªlist è¿›è¡ŒæŒ‰ç”¨æˆ·IDä»å°åˆ°å¤§çš„æ’åº\n- å¦‚æœè¿”å›çš„userFollowerBeen è¿™ä¸ªlist ä¸­ï¼ŒæŸä¸€é¡¹çš„å¤´åƒåœ°å€ä¸ºç©ºï¼Œåˆ™ä¸æ˜¾ç¤ºè¯¥é¡¹\n\n.....\n\nè¿™ç§æƒ…æ™¯åœ¨å®é™…å¼€å‘ä¸­å¤ªå¸¸è§äº†ï¼Œè¯•æƒ³å¦‚æœæ²¡æœ‰RxJavaï¼›é‚£ä¹ˆæ¯ä¸€æ¬¡éœ€æ±‚çš„å˜æ›´éƒ½æ„å‘³ç€æˆ‘ä»¬éœ€è¦å»ä¿®æ”¹setFollowersViewè¿™ä¸ªæ–¹æ³•ï¼Œéœ€æ±‚ä¸€æ—¦å˜æ›´ï¼Œå°±å»ä¿®æ”¹è¿™ä¸ªæ–¹æ³•ï¼Œè¿™æ ·ä¼šä¸å¯é¿å…çš„äº§ç”Ÿå„ç§bugã€‚é‚£æœ‰æ²¡æœ‰åŠæ³•ä¸å»ä¿®æ”¹è¿™ä¸ªæ–¹æ³•å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦å¼ºå¤§çš„RxJavaäº†ã€‚\n\nè¿™é‡Œæˆ‘ä»¬å°±çœ‹çœ‹å¦‚ä½•åœ¨ä¸ä¿®æ”¹setFollowersViewçš„å‰æä¸‹ï¼Œå®ç°å¯¹ç”¨æˆ·åä»å°åˆ°å¤§çš„æ’åºï¼š\n\n```java\n    private void RxRetrofitList() {\n        GithubService service = GenServiceUtil.createService(GithubService.class);\n        Observable<List<UserFollowerBean>> myObserve = service.followers(name);\n        myObserve\n                .subscribeOn(Schedulers.io())\n                .observeOn(AndroidSchedulers.mainThread())\n                .map(new Func1<List<UserFollowerBean>, List<UserFollowerBean>>() {\n                    @Override\n                    public List<UserFollowerBean> call(List<UserFollowerBean> userFollowerBeen) {\n                        for (UserFollowerBean bean : userFollowerBeen) {\n                            String name = \"\";\n                            name = bean.getLogin().substring(0, 1).toUpperCase() + bean.getLogin().substring(1, bean.getLogin().length());\n                            bean.setLogin(name);\n                        }\n                        return userFollowerBeen;\n                    }\n                })\n                .map(new Func1<List<UserFollowerBean>, List<UserFollowerBean>>() {\n                    @Override\n                    public List<UserFollowerBean> call(List<UserFollowerBean> userFollowerBean) {\n                        Collections.sort(userFollowerBean, new Comparator<UserFollowerBean>() {\n                            @Override\n                            public int compare(UserFollowerBean o1, UserFollowerBean o2) {\n                                return o1.getLogin().compareTo(o2.getLogin());\n                            }\n                        });\n                        return userFollowerBean;\n                    }\n                })\n                .subscribe(new Subscriber<List<UserFollowerBean>>() {\n                    @Override\n                    public void onCompleted() {\n                        loading.dismiss();\n                    }\n\n                    @Override\n                    public void onError(Throwable e) {\n                        loading.dismiss();\n                        e.printStackTrace();\n                    }\n\n                    @Override\n                    public void onNext(List<UserFollowerBean> userFollowerBeen) {\n                        setFollowersView(userFollowerBeen);\n                    }\n                });\n\n    }\n```\n\n*RxJava é“¾å¼é£æ ¼çš„ä»£ç *\n\n**åœ¨ä»£ç ä¸­æˆ‘ä»¬ä½¿ç”¨RxJavaçš„map æ“ä½œç¬¦ï¼Œå¯¹è¿”å›æ•°æ®åšäº†ä¸¤æ¬¡å¤„ç†ï¼Œé¦–å…ˆå°†æ‰€æœ‰ç”¨æˆ·åçš„é¦–å­—æ¯è½¬æ¢ä¸ºå¤§å†™å­—æ¯ï¼›ç„¶åå¯¹æ•´ä¸ªlistæŒ‰ç…§ç”¨æˆ·åä»å°åˆ°å¤§æ’åºã€‚å› ä¸ºç”¨æˆ·åä¸­åŒæ—¶åŒ…å«ä»¥å¤§å°å†™å­—æ¯æ‰“å¤´çš„å†…å®¹ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä¸€æ¬¡è½¬æ¢å¤§å†™çš„æ“ä½œã€‚**\n\n\nåŒæ ·æ˜¯éšç€éœ€æ±‚å˜æ›´ï¼Œä¿®æ”¹ä»£ç ï¼›ä½†æ˜¯ä½ ä¼šå‘ç°ï¼Œä½¿ç”¨RxJavaçš„æ–¹å¼ï¼Œä¼šé™ä½å‡ºç°bugçš„æ¦‚ç‡ï¼Œè€Œä¸”å°±ç®—æ˜¯ä¸åŒçš„äººå»æ”¹ï¼Œä¹Ÿä¼šæ¯”è¾ƒæ–¹ä¾¿ç»´æŠ¤ã€‚\n\nçœ‹åˆ°äº†å§ï¼Œè¿™å°±æ˜¯RxJavaçš„ä¼˜ç‚¹ï¼Œå½“ç„¶è¿™ä¸ªä¾‹å­ä¹Ÿåªæ˜¯å†°å±±ä¸€è§’ã€‚è¿™é‡Œæåˆ°çš„mapæ“ä½œç¬¦åªæ˜¯RxJavaåºå¤§æ“ä½œç¬¦é›†åˆä¸­çš„ä¸€å‘˜ï¼Œæ›´ç‰¹åˆ«çš„æ˜¯ï¼ŒRxJavaçš„æ“ä½œç¬¦è¿˜æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œè¿™æ ·è®©æˆ‘ä»¬çš„ä»£ç æœ‰äº†æ— é™çš„å¯èƒ½ï¼›RxJavaçš„å­˜åœ¨ä¸ä»…ä»…åœ¨äºç½‘ç»œè¯·æ±‚ï¼Œå¯ä»¥ç”¨åœ¨åˆ«çš„æ–¹é¢ï¼›RxJavaå…¶å®æ˜¯ä½“ç°äº†ä¸€ç§æ€è·¯ï¼Œæ‰€æœ‰å¯¹æ•°æ®çš„æ“ä½œéƒ½åœ¨æµä¸Šå®Œæˆï¼Œå°†æœ€ç»ˆçš„ç»“æœè¿”å›ç»™è§‚å¯Ÿè€…ã€‚**åŒæ—¶ï¼Œå¦‚æœè¿”å›çš„followers åˆ—è¡¨æœ‰ä»»ä½•å¼‚å¸¸ï¼ŒRxJavaçš„onError æ–¹æ³•ä¼šæ‰§è¡Œï¼Œè¿™å°±æ–¹ä¾¿æˆ‘ä»¬å»å¤„ç†å¼‚å¸¸æ•°æ®äº†ã€‚**\n\n## æ€»ç»“##\n\né€šç¯‡é€šè¿‡å¯¹Android ç½‘ç»œè¯·æ±‚å„ç§å®ç°çš„æ€»ç»“ï¼Œå¯ä»¥çœ‹åˆ° ç›¸å¯¹äºVolleyï¼ŒAsyncHttpClient ç­‰åº“ï¼ŒRxJava+Retrofit çš„ä¼˜åŠ¿å¹¶éç‰¹åˆ«æ˜¾è‘—ï¼›åœ¨æ‰§è¡Œæ•ˆç‡åŠåŠŸèƒ½ä¸Šå¹¶æ— å¤§çš„äº®ç‚¹ï¼›å¯¹Volleyè¿›è¡Œè‰¯å¥½çš„å°è£…åŒæ ·å¯ä»¥å®ç°ç±»ä¼¼Retrofitè‡ªåŠ¨è½¬Gsonçš„åŠŸèƒ½ï¼›RxJava+Retrofit ç»“åˆä¼šè®©æˆ‘ä»¬å†™ä»£ç çš„æ–¹å¼æ›´åŠ æœ‰æ¡ç†ï¼Œè™½ç„¶ä»£ç é‡ä¼šå¢å¤šï¼Œä½†é€»è¾‘çš„æ¸…æ™°æ‰æ˜¯æœ€é‡è¦çš„ä¸æ˜¯å—ï¼Ÿæ‰€ä»¥ï¼ŒRxJava+Retrofit ç»„åˆä¸å¤±ä¸ºä¸€ç§å¥½çš„é€‰æ‹©ã€‚\n\næ‰€ä»¥ï¼Œèµ¶ç´§æ‹¥æŠ±RxJava+Retrofitå§ï¼\n\n***\n\næ–‡ä¸­æ‰€æœ‰æºç åœ°å€[github](https://github.com/REBOOTERS/My-MVP)\n\n","tags":["RxJavaï¼ŒRetrofit"],"categories":["Android è¿›é˜¶ï¼ŒAndroid ä¸‰æ–¹æ¡†æ¶"]},{"title":"Android åŠ¨ç”»æ€»ç»“","url":"%2F2016%2F10%2F19%2FAndroid%20%E5%8A%A8%E7%94%BB%E6%80%BB%E7%BB%93%2F","content":"\n\nåœ¨æ—¥å¸¸çš„Androidå¼€å‘ä¸­ï¼Œç»å¸¸ä¼šä½¿ç”¨åˆ°åŠ¨ç”»ï¼Œè¿™é‡Œå°±å¯¹Androidå¼€å‘ä¸­çš„åŠ¨ç”»åšä¸€ä¸‹æ€»ç»“ã€‚\n\n## Android åŠ¨ç”»åˆ†ç±»\n\næ€»çš„æ¥è¯´ï¼ŒAndroidåŠ¨ç”»å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œæœ€åˆçš„**ä¼ ç»ŸåŠ¨ç”»**å’ŒAndroid3.0 ä¹‹åå‡ºç°çš„**å±æ€§åŠ¨ç”»**ï¼›\nä¼ ç»ŸåŠ¨ç”»åˆåŒ…æ‹¬ å¸§åŠ¨ç”»ï¼ˆFrame Animationï¼‰å’Œè¡¥é—´åŠ¨ç”»ï¼ˆTweened Animationï¼‰ã€‚\n\n\n## ä¼ ç»ŸåŠ¨ç”»\n### å¸§åŠ¨ç”»\n\nå¸§åŠ¨ç”»æ˜¯æœ€å®¹æ˜“å®ç°çš„ä¸€ç§åŠ¨ç”»ï¼Œè¿™ç§åŠ¨ç”»æ›´å¤šçš„ä¾èµ–äºå®Œå–„çš„UIèµ„æºï¼Œä»–çš„åŸç†å°±æ˜¯å°†ä¸€å¼ å¼ å•ç‹¬çš„å›¾ç‰‡è¿è´¯çš„è¿›è¡Œæ’­æ”¾ï¼Œ\nä»è€Œåœ¨è§†è§‰ä¸Šäº§ç”Ÿä¸€ç§åŠ¨ç”»çš„æ•ˆæœï¼›æœ‰ç‚¹ç±»ä¼¼äºæŸäº›è½¯ä»¶åˆ¶ä½œgifåŠ¨ç”»çš„æ–¹å¼ã€‚\n\n\n\n![frame.gif](http://upload-images.jianshu.io/upload_images/1115031-b52487cb6b97f911.gif?imageMogr2/auto-orient/strip)\n\nå¦‚ä¸Šå›¾ä¸­çš„äº¬ä¸œåŠ è½½åŠ¨ç”»ï¼Œä»£ç è¦åšçš„äº‹æƒ…å°±æ˜¯æŠŠä¸€å¹…å¹…çš„å›¾ç‰‡æŒ‰é¡ºåºæ˜¾ç¤ºï¼Œé€ æˆåŠ¨ç”»çš„è§†è§‰æ•ˆæœã€‚\n\n<!--more-->\n\n**äº¬ä¸œåŠ¨ç”»å®ç°**\n\n```\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<animation-list xmlns:android=\"http://schemas.android.com/apk/res/android\">\n    <item\n        android:drawable=\"@drawable/a_0\"\n        android:duration=\"100\" />\n    <item\n        android:drawable=\"@drawable/a_1\"\n        android:duration=\"100\" />\n    <item\n        android:drawable=\"@drawable/a_2\"\n        android:duration=\"100\" />\n</animation-list>\n```\n```\nprotected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_frame_animation);\n        ImageView animationImg1 = (ImageView) findViewById(R.id.animation1);\n        animationImg1.setImageResource(R.drawable.frame_anim1);\n        AnimationDrawable animationDrawable1 = (AnimationDrawable) animationImg1.getDrawable();\n        animationDrawable1.start();\n    }\n```\n*å¯ä»¥è¯´ï¼Œå›¾ç‰‡èµ„æºå†³å®šäº†è¿™ç§æ–¹å¼å¯ä»¥å®ç°æ€æ ·çš„åŠ¨ç”»*\n\n*åœ¨æœ‰äº›ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¿˜ä¼šçœ‹åˆ°androidï¼šoneshot=\"false\" ï¼Œè¿™ä¸ªoneshot çš„å«ä¹‰å°±æ˜¯åŠ¨ç”»æ‰§è¡Œä¸€æ¬¡ï¼ˆtrueï¼‰è¿˜æ˜¯å¾ªç¯æ‰§è¡Œå¤šæ¬¡ã€‚*\n\nè¿™é‡Œå…¶ä»–å‡ ä¸ªåŠ¨ç”»å®ç°æ–¹å¼éƒ½æ˜¯ä¸€æ ·ï¼Œæ— éå°±æ˜¯å›¾ç‰‡èµ„æºçš„å·®å¼‚ã€‚\n\n### è¡¥é—´åŠ¨ç”»\n\nè¡¥é—´åŠ¨ç”»åˆå¯ä»¥åˆ†ä¸ºå››ç§å½¢å¼ï¼Œåˆ†åˆ«æ˜¯ **alphaï¼ˆæ·¡å…¥æ·¡å‡ºï¼‰ï¼Œtranslateï¼ˆä½ç§»ï¼‰ï¼Œscaleï¼ˆç¼©æ”¾å¤§å°ï¼‰ï¼Œrotateï¼ˆæ—‹è½¬ï¼‰**ã€‚\nè¡¥é—´åŠ¨ç”»çš„å®ç°ï¼Œä¸€èˆ¬ä¼šé‡‡ç”¨xml æ–‡ä»¶çš„å½¢å¼ï¼›ä»£ç ä¼šæ›´å®¹æ˜“ä¹¦å†™å’Œé˜…è¯»ï¼ŒåŒæ—¶ä¹Ÿæ›´å®¹æ˜“å¤ç”¨ã€‚\n\n#### XML å®ç°\n\né¦–å…ˆï¼Œåœ¨res/anim/ æ–‡ä»¶å¤¹ä¸‹å®šä¹‰å¦‚ä¸‹çš„åŠ¨ç”»å®ç°æ–¹å¼\n\n**alpha_anim.xml åŠ¨ç”»å®ç°**\n\n```\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<alpha xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:duration=\"1000\"\n    android:fromAlpha=\"1.0\"\n    android:interpolator=\"@android:anim/accelerate_decelerate_interpolator\"\n    android:toAlpha=\"0.0\" />\n```\n**scale.xml åŠ¨ç”»å®ç°**\n```\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<scale xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:duration=\"1000\"\n    android:fromXScale=\"0.0\"\n    android:fromYScale=\"0.0\"\n    android:pivotX=\"50%\"\n    android:pivotY=\"50%\"\n    android:toXScale=\"1.0\"\n    android:toYScale=\"1.0\"/>\n```\nç„¶åï¼Œåœ¨Activityä¸­ \n\n```\nAnimation animation = AnimationUtils.loadAnimation(mContext, R.anim.alpha_anim);\nimg = (ImageView) findViewById(R.id.img);\nimg.startAnimation(animation);\n```\nè¿™æ ·å°±å¯ä»¥å®ç°ImageView alpha é€æ˜å˜åŒ–çš„åŠ¨ç”»æ•ˆæœã€‚\n\nä¹Ÿå¯ä»¥ä½¿ç”¨set æ ‡ç­¾å°†å¤šä¸ªåŠ¨ç”»ç»„åˆï¼ˆä»£ç æºè‡ªAndroid SDK APIï¼‰\n\n```\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<set xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:interpolator=\"@[package:]anim/interpolator_resource\"\n    android:shareInterpolator=[\"true\" | \"false\"] >\n    <alpha\n        android:fromAlpha=\"float\"\n        android:toAlpha=\"float\" />\n    <scale\n        android:fromXScale=\"float\"\n        android:toXScale=\"float\"\n        android:fromYScale=\"float\"\n        android:toYScale=\"float\"\n        android:pivotX=\"float\"\n        android:pivotY=\"float\" />\n    <translate\n        android:fromXDelta=\"float\"\n        android:toXDelta=\"float\"\n        android:fromYDelta=\"float\"\n        android:toYDelta=\"float\" />\n    <rotate\n        android:fromDegrees=\"float\"\n        android:toDegrees=\"float\"\n        android:pivotX=\"float\"\n        android:pivotY=\"float\" />\n    <set>\n        ...\n    </set>\n</set>\n```\nå¯ä»¥çœ‹åˆ°ç»„åˆåŠ¨ç”»æ˜¯å¯ä»¥åµŒå¥—ä½¿ç”¨çš„ã€‚\n\nå„ä¸ªåŠ¨ç”»å±æ€§çš„å«ä¹‰ç»“åˆåŠ¨ç”»è‡ªèº«çš„ç‰¹ç‚¹åº”è¯¥å¾ˆå¥½ç†è§£ï¼Œå°±ä¸ä¸€ä¸€é˜è¿°äº†ï¼›è¿™é‡Œä¸»è¦è¯´ä¸€ä¸‹**interpolator** å’Œ **pivot**ã€‚\n\n>Interpolator ä¸»è¦ä½œç”¨æ˜¯å¯ä»¥æ§åˆ¶åŠ¨ç”»çš„å˜åŒ–é€Ÿç‡ ï¼Œå°±æ˜¯åŠ¨ç”»è¿›è¡Œçš„å¿«æ…¢èŠ‚å¥ã€‚\n\nAndroid ç³»ç»Ÿå·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›Interpolator ï¼Œæ¯”å¦‚ accelerate_decelerate_interpolatorï¼Œaccelerate_interpolatorç­‰ã€‚æ›´å¤šçš„interpolator åŠå…¶å«ä¹‰å¯ä»¥åœ¨Android SDK ä¸­æŸ¥çœ‹ã€‚åŒæ—¶è¿™ä¸ªInterpolatorä¹Ÿæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œè¿™ä¸ªåé¢è¿˜ä¼šæåˆ°ã€‚\n\n\n>pivot å†³å®šäº†å½“å‰åŠ¨ç”»æ‰§è¡Œçš„å‚è€ƒä½ç½®\n\npivot è¿™ä¸ªå±æ€§ä¸»è¦æ˜¯åœ¨translate å’Œ scale åŠ¨ç”»ä¸­ï¼Œè¿™ä¸¤ç§åŠ¨ç”»éƒ½ç‰µæ‰¯åˆ°view çš„â€œç‰©ç†ä½ç½®â€œå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå‚è€ƒç‚¹ã€‚è€ŒpivotXå’ŒpivotYå°±å…±åŒå†³å®šäº†è¿™ä¸ªç‚¹ï¼›å®ƒçš„å€¼å¯ä»¥æ˜¯floatæˆ–è€…æ˜¯ç™¾åˆ†æ¯”æ•°å€¼ã€‚\n\n\næˆ‘ä»¬ä»¥pivotXä¸ºä¾‹ï¼Œ\n\n|pivotXå–å€¼|å«ä¹‰|\n|---|:-----:|\n|10|è·ç¦»åŠ¨ç”»æ‰€åœ¨viewè‡ªèº«å·¦è¾¹ç¼˜10åƒç´ |\n|10%|è·ç¦»åŠ¨ç”»æ‰€åœ¨viewè‡ªèº«å·¦è¾¹ç¼˜ çš„è·ç¦»æ˜¯æ•´ä¸ªviewå®½åº¦çš„10%|\n|10%p|è·ç¦»åŠ¨ç”»æ‰€åœ¨viewçˆ¶æ§ä»¶å·¦è¾¹ç¼˜çš„è·ç¦»æ˜¯æ•´ä¸ªviewå®½åº¦çš„10%|\n\npivotY ä¹Ÿæ˜¯ç›¸åŒçš„åŸç†ï¼Œåªä¸è¿‡å˜æˆçš„çºµå‘çš„ä½ç½®ã€‚å¦‚æœè¿˜æ˜¯ä¸æ˜ç™½å¯ä»¥å‚è€ƒ[æºç ](https://github.com/REBOOTERS/AndroidAnimationExercise)ï¼Œåœ¨Tweened Animationä¸­ç»“åˆseekbarçš„æ»‘åŠ¨è§‚å¯Ÿrotateçš„å˜åŒ–ç†è§£ã€‚\n\n\n\n![rotate1.gif](http://upload-images.jianshu.io/upload_images/1115031-743288fa3be134ea.gif?imageMogr2/auto-orient/strip)\n\n#### Java Code  å®ç°\n\næœ‰æ—¶å€™ï¼ŒåŠ¨ç”»çš„å±æ€§å€¼å¯èƒ½éœ€è¦åŠ¨æ€çš„è°ƒæ•´ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨xml å°±ä¸åˆé€‚äº†ï¼Œéœ€è¦ä½¿ç”¨javaä»£ç å®ç°\n\n```\nprivate void RotateAnimation() {\n        animation = new RotateAnimation(-deValue, deValue, Animation.RELATIVE_TO_SELF,\n                pxValue, Animation.RELATIVE_TO_SELF, pyValue);\n        animation.setDuration(timeValue);\n\n        if (keep.isChecked()) {\n            animation.setFillAfter(true);\n        } else {\n            animation.setFillAfter(false);\n        }\n        if (loop.isChecked()) {\n            animation.setRepeatCount(-1);\n        } else {\n            animation.setRepeatCount(0);\n        }\n\n        if (reverse.isChecked()) {\n            animation.setRepeatMode(Animation.REVERSE);\n        } else {\n            animation.setRepeatMode(Animation.RESTART);\n        }\n        img.startAnimation(animation);\n    }\n```\n**è¿™é‡Œanimation.setFillAfterå†³å®šäº†åŠ¨ç”»åœ¨æ’­æ”¾ç»“æŸæ—¶æ˜¯å¦ä¿æŒæœ€ç»ˆçš„çŠ¶æ€ï¼›animation.setRepeatCountå’Œanimation.setRepeatMode å†³å®šäº†åŠ¨ç”»çš„é‡å¤æ¬¡æ•°åŠé‡å¤æ–¹å¼ï¼Œå…·ä½“ç»†èŠ‚å¯æŸ¥çœ‹æºç ç†è§£ã€‚**\n\nå¥½äº†ï¼Œä¼ ç»ŸåŠ¨ç”»çš„å†…å®¹å°±è¯´åˆ°è¿™é‡Œäº†ã€‚\n\n\n## å±æ€§åŠ¨ç”»\n\nå±æ€§åŠ¨ç”»ï¼Œé¡¾åæ€ä¹‰å®ƒæ˜¯å¯¹äºå¯¹è±¡å±æ€§çš„åŠ¨ç”»ã€‚å› æ­¤ï¼Œæ‰€æœ‰è¡¥é—´åŠ¨ç”»çš„å†…å®¹ï¼Œéƒ½å¯ä»¥é€šè¿‡å±æ€§åŠ¨ç”»å®ç°ã€‚\n\n### å±æ€§åŠ¨ç”»å…¥é—¨\n\né¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ç”¨å±æ€§åŠ¨ç”»å®ç°ä¸Šé¢è¡¥é—´åŠ¨ç”»çš„æ•ˆæœ\n\n```\n    private void RotateAnimation() {\n        ObjectAnimator anim = ObjectAnimator.ofFloat(myView, \"rotation\", 0f, 360f);\n        anim.setDuration(1000);\n        anim.start();\n    }\n\n    private void AlpahAnimation() {\n        ObjectAnimator anim = ObjectAnimator.ofFloat(myView, \"alpha\", 1.0f, 0.8f, 0.6f, 0.4f, 0.2f, 0.0f);\n        anim.setRepeatCount(-1);\n        anim.setRepeatMode(ObjectAnimator.REVERSE);\n        anim.setDuration(2000);\n        anim.start();\n    }\n```\nè¿™ä¸¤ä¸ªæ–¹æ³•ç”¨å±æ€§åŠ¨ç”»çš„æ–¹å¼åˆ†åˆ«å®ç°äº†æ—‹è½¬åŠ¨ç”»å’Œæ·¡å…¥æ·¡å‡ºåŠ¨ç”»ï¼Œå…¶ä¸­setDurationã€setRepeatModeåŠsetRepeatCountå’Œè¡¥é—´åŠ¨ç”»ä¸­çš„æ¦‚å¿µæ˜¯ä¸€æ ·çš„ã€‚\n\nå¯ä»¥çœ‹åˆ°ï¼Œå±æ€§åŠ¨ç”»è²Œä¼¼å¼ºå¤§äº†è®¸å¤šï¼Œå®ç°å¾ˆæ–¹ä¾¿ï¼ŒåŒæ—¶åŠ¨ç”»å¯å˜åŒ–çš„å€¼ä¹Ÿæœ‰äº†æ›´å¤šçš„é€‰æ‹©ï¼ŒåŠ¨ç”»æ‰€èƒ½å‘ˆç°çš„ç»†èŠ‚ä¹Ÿæ›´å¤šã€‚\n\nå½“ç„¶å±æ€§åŠ¨ç”»ä¹Ÿæ˜¯å¯ä»¥ç»„åˆå®ç°çš„\n\n```\n                ObjectAnimator alphaAnim = ObjectAnimator.ofFloat(myView, \"alpha\", 1.0f, 0.5f, 0.8f, 1.0f);\n                ObjectAnimator scaleXAnim = ObjectAnimator.ofFloat(myView, \"scaleX\", 0.0f, 1.0f);\n                ObjectAnimator scaleYAnim = ObjectAnimator.ofFloat(myView, \"scaleY\", 0.0f, 2.0f);\n                ObjectAnimator rotateAnim = ObjectAnimator.ofFloat(myView, \"rotation\", 0, 360);\n                ObjectAnimator transXAnim = ObjectAnimator.ofFloat(myView, \"translationX\", 100, 400);\n                ObjectAnimator transYAnim = ObjectAnimator.ofFloat(myView, \"tranlsationY\", 100, 750);\n                AnimatorSet set = new AnimatorSet();\n                set.playTogether(alphaAnim, scaleXAnim, scaleYAnim, rotateAnim, transXAnim, transYAnim);\n//                set.playSequentially(alphaAnim, scaleXAnim, scaleYAnim, rotateAnim, transXAnim, transYAnim);\n                set.setDuration(3000);\n                set.start();\n```\nå¯ä»¥çœ‹åˆ°è¿™äº›åŠ¨ç”»å¯ä»¥åŒæ—¶æ’­æ”¾ï¼Œæˆ–è€…æ˜¯æŒ‰åºæ’­æ”¾ã€‚\n\n### å±æ€§åŠ¨ç”»æ ¸å¿ƒåŸç†\n\nåœ¨ä¸Šé¢å®ç°å±æ€§åŠ¨ç”»çš„æ—¶å€™ï¼Œæˆ‘ä»¬åå¤çš„ä½¿ç”¨åˆ°äº†ObjectAnimator  è¿™ä¸ªç±»ï¼Œè¿™ä¸ªç±»ç»§æ‰¿è‡ªValueAnimatorï¼Œä½¿ç”¨è¿™ä¸ªç±»å¯ä»¥å¯¹ä»»æ„å¯¹è±¡çš„**ä»»æ„å±æ€§**è¿›è¡ŒåŠ¨ç”»æ“ä½œã€‚è€ŒValueAnimatoræ˜¯æ•´ä¸ªå±æ€§åŠ¨ç”»æœºåˆ¶å½“ä¸­æœ€æ ¸å¿ƒçš„ä¸€ä¸ªç±»ï¼›è¿™ç‚¹ä»ä¸‹é¢çš„å›¾ç‰‡ä¹Ÿå¯ä»¥çœ‹å‡ºã€‚\n\n\n![valueanimator.png](http://upload-images.jianshu.io/upload_images/1115031-80301bbb0ae884b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n \nå±æ€§åŠ¨ç”»æ ¸å¿ƒåŸç†ï¼Œæ­¤å›¾æ¥è‡ªäºAndroid SDK API æ–‡æ¡£ã€‚\n\n>å±æ€§åŠ¨ç”»çš„è¿è¡Œæœºåˆ¶æ˜¯é€šè¿‡ä¸æ–­åœ°å¯¹å€¼è¿›è¡Œæ“ä½œæ¥å®ç°çš„ï¼Œè€Œåˆå§‹å€¼å’Œç»“æŸå€¼ä¹‹é—´çš„åŠ¨ç”»è¿‡æ¸¡å°±æ˜¯ç”±ValueAnimatorè¿™ä¸ªç±»æ¥è´Ÿè´£è®¡ç®—çš„ã€‚å®ƒçš„å†…éƒ¨ä½¿ç”¨ä¸€ç§æ—¶é—´å¾ªç¯çš„æœºåˆ¶æ¥è®¡ç®—å€¼ä¸å€¼ä¹‹é—´çš„åŠ¨ç”»è¿‡æ¸¡ï¼Œæˆ‘ä»¬åªéœ€è¦å°†åˆå§‹å€¼å’Œç»“æŸå€¼æä¾›ç»™ValueAnimatorï¼Œå¹¶ä¸”å‘Šè¯‰å®ƒåŠ¨ç”»æ‰€éœ€è¿è¡Œçš„æ—¶é•¿ï¼Œé‚£ä¹ˆValueAnimatorå°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆä»åˆå§‹å€¼å¹³æ»‘åœ°è¿‡æ¸¡åˆ°ç»“æŸå€¼è¿™æ ·çš„æ•ˆæœã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒValueAnimatorè¿˜è´Ÿè´£ç®¡ç†åŠ¨ç”»çš„æ’­æ”¾æ¬¡æ•°ã€æ’­æ”¾æ¨¡å¼ã€ä»¥åŠå¯¹åŠ¨ç”»è®¾ç½®ç›‘å¬å™¨ç­‰ã€‚\n\nä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼Œé€šè¿‡durationã€startPropertyValueå’ŒendPropertyValue ç­‰å€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰åŠ¨ç”»è¿è¡Œæ—¶é•¿ï¼Œåˆå§‹å€¼å’Œç»“æŸå€¼ã€‚ç„¶åé€šè¿‡startæ–¹æ³•å¼€å§‹åŠ¨ç”»ã€‚\né‚£ä¹ˆValueAnimator åˆ°åº•æ˜¯æ€æ ·å®ç°ä»åˆå§‹å€¼å¹³æ»‘è¿‡æ¸¡åˆ°ç»“æŸå€¼çš„å‘¢ï¼Ÿè¿™ä¸ªå°±æ˜¯ç”±TypeEvaluator å’ŒTimeInterpolator å…±åŒå†³å®šçš„ã€‚\n\nå…·ä½“æ¥è¯´ï¼Œ**TypeEvaluator å†³å®šäº†åŠ¨ç”»å¦‚ä½•ä»åˆå§‹å€¼è¿‡æ¸¡åˆ°ç»“æŸå€¼ã€‚**\n**TimeInterpolator å†³å®šäº†åŠ¨ç”»ä»åˆå§‹å€¼è¿‡æ¸¡åˆ°ç»“æŸå€¼çš„èŠ‚å¥ã€‚**\n\nè¯´çš„é€šä¿—ä¸€ç‚¹ï¼Œä½ æ¯å¤©æ—©æ™¨å‡ºé—¨å»å…¬å¸ä¸Šç­ï¼ŒTypeEvaluatorå†³å®šäº†ä½ æ˜¯åå…¬äº¤ã€ååœ°é“è¿˜æ˜¯éª‘è½¦ï¼›è€Œå½“ä½ å†³å®šéª‘è½¦åï¼ŒTimeInterpolatorå†³å®šäº†ä½ ä¸€è·¯ä¸Šéª‘è¡Œçš„æ–¹å¼ï¼Œä½ å¯ä»¥åŒ€é€Ÿçš„ä¸€è·¯éª‘åˆ°å…¬å¸ï¼Œä½ ä¹Ÿå¯ä»¥å‰åŠç¨‹éª‘å¾—é£å¿«ï¼ŒååŠç¨‹éª‘å¾—æ…¢æ‚ æ‚ ã€‚\n\nå¦‚æœï¼Œè¿˜æ˜¯ä¸ç†è§£ï¼Œé‚£ä¹ˆå°±çœ‹ä¸‹é¢çš„ä»£ç å§ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹ä¸‹é¢çš„è¿™ä¸¤ä¸ªgifåŠ¨ç”»ï¼Œä¸€ä¸ªå°çƒåœ¨å±å¹•ä¸Šä»¥ y=sin(x) çš„æ•°å­¦å‡½æ•°è½¨è¿¹è¿è¡Œï¼ŒåŒæ—¶å°çƒçš„é¢œè‰²å’ŒåŠå¾„ä¹Ÿå‘ç”Ÿç€å˜åŒ–ï¼Œå¯ä»¥å‘ç°ï¼Œä¸¤å¹…å›¾åŠ¨ç”»å˜åŒ–çš„èŠ‚å¥ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚\n\n\n\n![anim1.gif](http://upload-images.jianshu.io/upload_images/1115031-741c714c3ef5fa84.gif?imageMogr2/auto-orient/strip)\n\n\n![anim2.gif](http://upload-images.jianshu.io/upload_images/1115031-dbbb2e4aca44b0e7.gif?imageMogr2/auto-orient/strip)\n\n*å¦‚æœä¸è€ƒè™‘å±æ€§åŠ¨ç”»ï¼Œè¿™æ ·çš„ä¸€ä¸ªåŠ¨ç”»çº¯ç²¹çš„ä½¿ç”¨Canvas+Handlerçš„æ–¹å¼ç»˜åˆ¶ä¹Ÿæ˜¯æœ‰å¯èƒ½å®ç°çš„ã€‚ä½†æ˜¯ä¼šå¤æ‚å¾ˆå¤šï¼Œè€Œä¸”åŠ ä¸Šå„ç§çº¿ç¨‹ï¼Œä¼šå¸¦æ¥å¾ˆå¤šæ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚*\n\nè¿™é‡Œå°±é€šè¿‡è‡ªå®šä¹‰å±æ€§åŠ¨ç”»çš„æ–¹å¼çœ‹çœ‹è¿™ä¸ªåŠ¨ç”»æ˜¯å¦‚ä½•å®ç°çš„ã€‚\n\n### å±æ€§åŠ¨ç”»è‡ªå®šä¹‰å®ç°\nè¿™ä¸ªåŠ¨ç”»æœ€å…³é”®çš„ä¸‰ç‚¹å°±æ˜¯ è¿åŠ¨è½¨è¿¹ã€å°çƒåŠå¾„åŠé¢œè‰²çš„å˜åŒ–ï¼›æˆ‘ä»¬å°±ä»è¿™ä¸‰ä¸ªæ–¹é¢å±•å¼€ã€‚æœ€åæˆ‘ä»¬åœ¨ç»“åˆInterpolatorè¯´ä¸€ä¸‹TimeInterpolatorçš„æ„ä¹‰ã€‚\n\n##### ç”¨TypeEvaluator ç¡®å®šè¿åŠ¨è½¨è¿¹\n\nå‰é¢è¯´äº†ï¼ŒTypeEvaluatorå†³å®šäº†åŠ¨ç”»å¦‚ä½•ä»åˆå§‹å€¼è¿‡æ¸¡åˆ°ç»“æŸå€¼ã€‚è¿™ä¸ªTypeEvaluatoræ˜¯ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°è¿™ä¸ªæ¥å£ã€‚\n\n```\npublic class PointSinEvaluator implements TypeEvaluator {\n\n    @Override\n    public Object evaluate(float fraction, Object startValue, Object endValue) {\n        Point startPoint = (Point) startValue;\n        Point endPoint = (Point) endValue;\n        float x = startPoint.getX() + fraction * (endPoint.getX() - startPoint.getX());\n\n        float y = (float) (Math.sin(x * Math.PI / 180) * 100) + endPoint.getY() / 2;\n        Point point = new Point(x, y);\n        return point;\n    }\n}\n```\n\nPointSinEvaluator ç»§æ‰¿äº†TypeEvaluatorç±»ï¼Œå¹¶å®ç°äº†ä»–å”¯ä¸€çš„æ–¹æ³•evaluateï¼›è¿™ä¸ªæ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°fraction ä»£è¡¨å½“å‰åŠ¨ç”»å®Œæˆçš„**ç™¾åˆ†æ¯”**ï¼Œè¿™ä¸ªå€¼æ˜¯å¦‚ä½•å˜åŒ–çš„åé¢è¿˜ä¼šæåˆ°ï¼›ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°ä»£è¡¨åŠ¨ç”»çš„**åˆå§‹å€¼å’Œç»“æŸå€¼**ã€‚è¿™é‡Œæˆ‘ä»¬çš„é€»è¾‘å¾ˆç®€å•ï¼Œxçš„å€¼éšç€fraction ä¸æ–­å˜åŒ–ï¼Œå¹¶æœ€ç»ˆè¾¾åˆ°ç»“æŸå€¼ï¼›yçš„å€¼å°±æ˜¯å½“å‰xå€¼æ‰€å¯¹åº”çš„sin(x) å€¼ï¼Œç„¶åç”¨x å’Œ y äº§ç”Ÿä¸€ä¸ªæ–°çš„ç‚¹ï¼ˆPointå¯¹è±¡ï¼‰è¿”å›ã€‚\n\nè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªPointSinEvaluator ç”Ÿæˆå±æ€§åŠ¨ç”»çš„å®ä¾‹äº†ã€‚\n\n```\n        Point startP = new Point(RADIUS, RADIUS);//åˆå§‹å€¼ï¼ˆèµ·ç‚¹ï¼‰\n        Point endP = new Point(getWidth() - RADIUS, getHeight() - RADIUS);//ç»“æŸå€¼ï¼ˆç»ˆç‚¹ï¼‰\n        final ValueAnimator valueAnimator = ValueAnimator.ofObject(new PointSinEvaluator(), startP, endP);\n        valueAnimator.setRepeatCount(-1);\n        valueAnimator.setRepeatMode(ValueAnimator.REVERSE);\n        valueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n            @Override\n            public void onAnimationUpdate(ValueAnimator animation) {\n                currentPoint = (Point) animation.getAnimatedValue();\n                postInvalidate();\n            }\n        });\n```\nè¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†åŠ¨ç”»è½¨è¿¹çš„å®šä¹‰ï¼Œç°åœ¨åªè¦è°ƒç”¨valueAnimator.start() æ–¹æ³•ï¼Œå°±ä¼šç»˜åˆ¶å‡ºä¸€ä¸ªæ­£å¼¦æ›²çº¿çš„è½¨è¿¹ã€‚\n\n##### é¢œè‰²åŠåŠå¾„åŠ¨ç”»å®ç°\n\nä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œä½¿ç”¨ObjectAnimator  å¯ä»¥å¯¹ä»»æ„å¯¹è±¡çš„ä»»æ„å±æ€§è¿›è¡ŒåŠ¨ç”»æ“ä½œï¼Œè¿™å¥è¯æ˜¯ä¸å¤ªä¸¥è°¨çš„ï¼Œè¿™ä¸ªä»»æ„å±æ€§è¿˜éœ€è¦æœ‰get å’Œ set  æ–¹æ³•ã€‚\n\n```\npublic class PointAnimView extends View {\n\n    /**\n     * å®ç°å…³äºcolor çš„å±æ€§åŠ¨ç”»\n     */\n    private int color;\n    private float radius = RADIUS;\n   \n\t.....\n\n}\n```\nè¿™é‡Œåœ¨æˆ‘ä»¬çš„è‡ªå®šä¹‰viewä¸­ï¼Œå®šä¹‰äº†ä¸¤ä¸ªå±æ€§color å’Œ radiusï¼Œå¹¶å®ç°äº†ä»–ä»¬å„è‡ªçš„get set æ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å±æ€§åŠ¨ç”»çš„ç‰¹ç‚¹å®ç°å°çƒé¢œè‰²å˜åŒ–çš„åŠ¨ç”»å’ŒåŠå¾„å˜åŒ–çš„åŠ¨ç”»ã€‚\n\n```\n        ObjectAnimator animColor = ObjectAnimator.ofObject(this, \"color\", new ArgbEvaluator(), Color.GREEN,\n                Color.YELLOW, Color.BLUE, Color.WHITE, Color.RED);\n        animColor.setRepeatCount(-1);\n        animColor.setRepeatMode(ValueAnimator.REVERSE);\n\n\n        ValueAnimator animScale = ValueAnimator.ofFloat(20f, 80f, 60f, 10f, 35f,55f,10f);\n        animScale.setRepeatCount(-1);\n        animScale.setRepeatMode(ValueAnimator.REVERSE);\n        animScale.setDuration(5000);\n        animScale.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n            @Override\n            public void onAnimationUpdate(ValueAnimator animation) {\n                radius = (float) animation.getAnimatedValue();\n            }\n        });\n\n```\n\nè¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ObjectAnimator  å®ç°å¯¹color å±æ€§çš„å€¼æŒ‰ç…§ArgbEvaluator è¿™ä¸ªç±»çš„è§„å¾‹åœ¨ç»™å®šçš„é¢œè‰²å€¼ä¹‹é—´å˜åŒ–ï¼Œè¿™ä¸ªArgbEvaluator å’Œæˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„PointSinEvaluatorä¸€æ ·ï¼Œéƒ½æ˜¯å†³å®šåŠ¨ç”»å¦‚ä½•ä»åˆå§‹å€¼è¿‡æ¸¡åˆ°ç»“æŸå€¼çš„ï¼Œåªä¸è¿‡è¿™ä¸ªç±»æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„ï¼Œæˆ‘ä»¬ç›´æ¥æ‹¿æ¥ç”¨å°±å¯ä»¥ï¼Œä»–å¯ä»¥å®ç°å„ç§é¢œè‰²é—´çš„è‡ªç”±è¿‡æ¸¡ã€‚\n\nå¯¹radius è¿™ä¸ªå±æ€§ä½¿ç”¨äº†ValueAnimatorï¼Œä½¿ç”¨äº†å…¶ofFloatæ–¹æ³•å®ç°äº†ä¸€ç³»åˆ—floatå€¼çš„å˜åŒ–ï¼›åŒæ—¶ä¸ºå…¶æ·»åŠ äº†åŠ¨ç”»å˜åŒ–çš„ç›‘å¬å™¨ï¼Œåœ¨å±æ€§å€¼æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†å˜åŒ–çš„ç»“æœèµ‹ç»™radiusï¼Œè¿™æ ·å°±å®ç°äº†åŠå¾„åŠ¨æ€çš„å˜åŒ–ã€‚\n\n**è¿™é‡Œradius ä¹Ÿå¯ä»¥ä½¿ç”¨å’Œcolorç›¸åŒçš„æ–¹å¼ï¼Œåªéœ€è¦æŠŠArgbEvaluator æ›¿æ¢ä¸ºFloatEvaluatorï¼ŒåŒæ—¶ä¿®æ”¹åŠ¨ç”»çš„å˜åŒ–å€¼å³å¯ï¼›ä½¿ç”¨æ·»åŠ ç›‘å¬å™¨çš„æ–¹å¼ï¼Œåªæ˜¯ä¸ºäº†ä»‹ç»ç›‘å¬å™¨çš„ä½¿ç”¨æ–¹æ³•è€Œå·²**\n\nå¥½äº†ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»å®šä¹‰å‡ºäº†æ‰€æœ‰éœ€è¦çš„åŠ¨ç”»ï¼Œå‰é¢è¯´è¿‡ï¼Œå±æ€§åŠ¨ç”»ä¹Ÿæ˜¯å¯ä»¥ç»„åˆä½¿ç”¨çš„ã€‚å› æ­¤ï¼Œåœ¨åŠ¨ç”»å¯åŠ¨çš„æ—¶å€™ï¼ŒåŒæ—¶æ’­æ”¾è¿™ä¸‰ä¸ªåŠ¨ç”»ï¼Œå°±å¯ä»¥å®ç°å›¾ä¸­çš„æ•ˆæœäº†ã€‚\n\n```\n        animSet = new AnimatorSet();\n        animSet.play(valueAnimator).with(animColor).with(animScale);\n        animSet.setDuration(5000);\n        animSet.setInterpolator(interpolatorType);\n        animSet.start();\n```\n\nPointAnimView  æºç \n\n```\npublic class PointAnimView extends View {\n\n    public static final float RADIUS = 20f;\n\n    private Point currentPoint;\n\n    private Paint mPaint;\n    private Paint linePaint;\n\n    private AnimatorSet animSet;\n    private TimeInterpolator interpolatorType = new LinearInterpolator();\n\n    /**\n     * å®ç°å…³äºcolor çš„å±æ€§åŠ¨ç”»\n     */\n    private int color;\n    private float radius = RADIUS;\n\n    public PointAnimView(Context context) {\n        super(context);\n        init();\n    }\n\n\n    public PointAnimView(Context context, AttributeSet attrs) {\n        super(context, attrs);\n        init();\n    }\n\n    public PointAnimView(Context context, AttributeSet attrs, int defStyleAttr) {\n        super(context, attrs, defStyleAttr);\n        init();\n    }\n\n\n    public int getColor() {\n        return color;\n    }\n\n    public void setColor(int color) {\n        this.color = color;\n        mPaint.setColor(this.color);\n    }\n\n    public float getRadius() {\n        return radius;\n    }\n\n    public void setRadius(float radius) {\n        this.radius = radius;\n    }\n\n    private void init() {\n        mPaint = new Paint(Paint.ANTI_ALIAS_FLAG);\n        mPaint.setColor(Color.TRANSPARENT);\n\n        linePaint = new Paint(Paint.ANTI_ALIAS_FLAG);\n        linePaint.setColor(Color.BLACK);\n        linePaint.setStrokeWidth(5);\n    }\n\n    @Override\n    protected void onDraw(Canvas canvas) {\n        if (currentPoint == null) {\n            currentPoint = new Point(RADIUS, RADIUS);\n            drawCircle(canvas);\n//            StartAnimation();\n        } else {\n            drawCircle(canvas);\n        }\n\n        drawLine(canvas);\n    }\n\n    private void drawLine(Canvas canvas) {\n        canvas.drawLine(10, getHeight() / 2, getWidth(), getHeight() / 2, linePaint);\n        canvas.drawLine(10, getHeight() / 2 - 150, 10, getHeight() / 2 + 150, linePaint);\n        canvas.drawPoint(currentPoint.getX(), currentPoint.getY(), linePaint);\n\n    }\n\n    public void StartAnimation() {\n        Point startP = new Point(RADIUS, RADIUS);\n        Point endP = new Point(getWidth() - RADIUS, getHeight() - RADIUS);\n        final ValueAnimator valueAnimator = ValueAnimator.ofObject(new PointSinEvaluator(), startP, endP);\n        valueAnimator.setRepeatCount(-1);\n        valueAnimator.setRepeatMode(ValueAnimator.REVERSE);\n        valueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n            @Override\n            public void onAnimationUpdate(ValueAnimator animation) {\n                currentPoint = (Point) animation.getAnimatedValue();\n                postInvalidate();\n            }\n        });\n\n//\n        ObjectAnimator animColor = ObjectAnimator.ofObject(this, \"color\", new ArgbEvaluator(), Color.GREEN,\n                Color.YELLOW, Color.BLUE, Color.WHITE, Color.RED);\n        animColor.setRepeatCount(-1);\n        animColor.setRepeatMode(ValueAnimator.REVERSE);\n\n\n        ValueAnimator animScale = ValueAnimator.ofFloat(20f, 80f, 60f, 10f, 35f,55f,10f);\n        animScale.setRepeatCount(-1);\n        animScale.setRepeatMode(ValueAnimator.REVERSE);\n        animScale.setDuration(5000);\n        animScale.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {\n            @Override\n            public void onAnimationUpdate(ValueAnimator animation) {\n                radius = (float) animation.getAnimatedValue();\n            }\n        });\n\n\n        animSet = new AnimatorSet();\n        animSet.play(valueAnimator).with(animColor).with(animScale);\n        animSet.setDuration(5000);\n        animSet.setInterpolator(interpolatorType);\n        animSet.start();\n\n    }\n\n    private void drawCircle(Canvas canvas) {\n        float x = currentPoint.getX();\n        float y = currentPoint.getY();\n        canvas.drawCircle(x, y, radius, mPaint);\n    }\n\n\n    public void setInterpolatorType(int type ) {\n        switch (type) {\n            case 1:\n                interpolatorType = new BounceInterpolator();\n                break;\n            case 2:\n                interpolatorType = new AccelerateDecelerateInterpolator();\n                break;\n            case 3:\n                interpolatorType = new DecelerateInterpolator();\n                break;\n            case 4:\n                interpolatorType = new AnticipateInterpolator();\n                break;\n            case 5:\n                interpolatorType = new LinearInterpolator();\n                break;\n            case 6:\n                interpolatorType=new LinearOutSlowInInterpolator();\n                break;\n            case 7:\n                interpolatorType = new OvershootInterpolator();\n            default:\n                interpolatorType = new LinearInterpolator();\n                break;\n        }\n    }\n\n\n    @TargetApi(Build.VERSION_CODES.KITKAT)\n    public void pauseAnimation() {\n        if (animSet != null) {\n            animSet.pause();\n        }\n    }\n\n\n    public void stopAnimation() {\n        if (animSet != null) {\n            animSet.cancel();\n            this.clearAnimation();\n        }\n    }\n}\n```\n\n#### TimeInterpolator ä»‹ç»\n\nInterpolatorçš„æ¦‚å¿µå…¶å®æˆ‘ä»¬å¹¶ä¸é™Œç”Ÿï¼Œåœ¨è¡¥é—´åŠ¨ç”»ä¸­æˆ‘ä»¬å°±ä½¿ç”¨åˆ°äº†ã€‚ä»–å°±æ˜¯ç”¨æ¥æ§åˆ¶åŠ¨ç”»å¿«æ…¢èŠ‚å¥çš„ï¼›è€Œåœ¨å±æ€§åŠ¨ç”»ä¸­ï¼ŒTimeInterpolator ä¹Ÿæ˜¯ç±»ä¼¼çš„ä½œç”¨ï¼›TimeInterpolator ç»§æ‰¿è‡ªInterpolatorã€‚æˆ‘ä»¬å¯ä»¥ç»§æ‰¿TimerInterpolator ä»¥è‡ªå·±çš„æ–¹å¼æ§åˆ¶åŠ¨ç”»å˜åŒ–çš„èŠ‚å¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Android ç³»ç»Ÿæä¾›çš„Interpolatorã€‚\n\nä¸‹é¢éƒ½æ˜¯ç³»ç»Ÿå¸®æˆ‘ä»¬å®šä¹‰å¥½çš„ä¸€äº›Interpolatorï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡setInterpolator è®¾ç½®ä¸åŒçš„Interpolatorã€‚\n\n\n![ç³»ç»Ÿè‡ªå¸¦Interpolator](http://upload-images.jianshu.io/upload_images/1115031-9e26dde319ebaae7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„Interpolatorå°±å†³å®šäº† å‰é¢æˆ‘ä»¬æåˆ°çš„fractionã€‚å˜åŒ–çš„èŠ‚å¥å†³å®šäº†åŠ¨ç”»æ‰€æ‰§è¡Œçš„ç™¾åˆ†æ¯”ã€‚ä¸å¾—ä¸è¯´ï¼Œè¿™ä¹ˆValueAnimatorçš„è®¾è®¡çš„ç¡®æ˜¯å¾ˆå·§å¦™ã€‚\n\n#### XML å±æ€§åŠ¨ç”»####\n\nè¿™é‡Œæä¸€ä¸‹ï¼Œå±æ€§åŠ¨ç”»å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨xmlæ–‡ä»¶çš„æ–¹å¼å®ç°ï¼Œä½†æ˜¯å±æ€§åŠ¨ç”»çš„å±æ€§å€¼ä¸€èˆ¬ä¼šç‰µæ‰¯åˆ°å¯¹è±¡å…·ä½“çš„å±æ€§ï¼Œæ›´å¤šæ˜¯é€šè¿‡ä»£ç åŠ¨æ€è·å–ï¼Œæ‰€ä»¥xmlæ–‡ä»¶çš„å®ç°ä¼šæœ‰äº›ä¸æ–¹ä¾¿ã€‚\n\n```\n<set android:ordering=\"sequentially\">\n    <set>\n        <objectAnimator\n            android:propertyName=\"x\"\n            android:duration=\"500\"\n            android:valueTo=\"400\"\n            android:valueType=\"intType\"/>\n        <objectAnimator\n            android:propertyName=\"y\"\n            android:duration=\"500\"\n            android:valueTo=\"300\"\n            android:valueType=\"intType\"/>\n    </set>\n    <objectAnimator\n        android:propertyName=\"alpha\"\n        android:duration=\"500\"\n        android:valueTo=\"1f\"/>\n</set>\n```\nä½¿ç”¨æ–¹å¼ï¼š\n```\nAnimatorSet set = (AnimatorSet) AnimatorInflater.loadAnimator(myContext,\n    R.anim.property_animator);\nset.setTarget(myObject);\nset.start();\n```\nxml æ–‡ä»¶ä¸­çš„æ ‡ç­¾ä¹Ÿå’Œå±æ€§åŠ¨ç”»çš„ç±»ç›¸å¯¹åº”ã€‚\n```\n ValueAnimator --- <animator> \n ObjectAnimator --- <objectAnimator> \n AnimatorSet --- <set> \n```\nè¿™äº›å°±æ˜¯å±æ€§åŠ¨ç”»çš„æ ¸å¿ƒå†…å®¹ã€‚ç°åœ¨ä½¿ç”¨å±æ€§åŠ¨ç”»çš„ç‰¹æ€§è‡ªå®šä¹‰åŠ¨ç”»åº”è¯¥ä¸æ˜¯éš¾äº‹äº†ã€‚å…¶ä½™ä¾¿ç­¾çš„å«ä¹‰ï¼Œç»“åˆä¹‹å‰çš„å†…å®¹åº”è¯¥ä¸éš¾ç†è§£äº†ã€‚\n\n## ä¼ ç»ŸåŠ¨ç”» VS å±æ€§åŠ¨ç”» \n\nç›¸è¾ƒäºä¼ ç»ŸåŠ¨ç”»ï¼Œå±æ€§åŠ¨ç”»æœ‰å¾ˆå¤šä¼˜åŠ¿ã€‚é‚£æ˜¯å¦æ„å‘³ç€å±æ€§åŠ¨ç”»å¯ä»¥å®Œå…¨æ›¿ä»£ä¼ ç»ŸåŠ¨ç”»å‘¢ã€‚å…¶å®ä¸ç„¶ï¼Œä¸¤ç§åŠ¨ç”»éƒ½æœ‰å„è‡ªçš„ä¼˜åŠ¿ï¼Œå±æ€§åŠ¨ç”»å¦‚æ­¤å¼ºå¤§ï¼Œä¹Ÿä¸æ˜¯æ²¡æœ‰ç¼ºç‚¹ã€‚\n\n\n\n![è¡¥é—´åŠ¨ç”»ç‚¹å‡»äº‹ä»¶](http://upload-images.jianshu.io/upload_images/1115031-6864a7fffbc80884.gif?imageMogr2/auto-orient/strip)\n\n\n\n![å±æ€§åŠ¨ç”»ç‚¹å‡»äº‹ä»¶](http://upload-images.jianshu.io/upload_images/1115031-10bb818b5584da5e.gif?imageMogr2/auto-orient/strip)\n\n\n* ä»ä¸Šé¢ä¸¤å¹…å›¾æ¯”è¾ƒå¯ä»¥å‘ç°ï¼Œè¡¥é—´åŠ¨ç”»ä¸­ï¼Œè™½ç„¶ä½¿ç”¨translateå°†å›¾ç‰‡ç§»åŠ¨äº†ï¼Œä½†æ˜¯ç‚¹å‡»åŸæ¥çš„ä½ç½®ï¼Œä¾æ—§å¯ä»¥å‘ç”Ÿç‚¹å‡»äº‹ä»¶ï¼Œè€Œå±æ€§åŠ¨ç”»å´ä¸æ˜¯ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ç¡®å®šï¼Œå±æ€§åŠ¨ç”»æ‰æ˜¯çœŸæ­£çš„å®ç°äº†viewçš„ç§»åŠ¨ï¼Œè¡¥é—´åŠ¨ç”»å¯¹viewçš„ç§»åŠ¨æ›´åƒæ˜¯åœ¨ä¸åŒåœ°æ–¹ç»˜åˆ¶äº†ä¸€ä¸ªå½±å­ï¼Œå®é™…çš„å¯¹è±¡è¿˜æ˜¯å¤„äºåŸæ¥çš„åœ°æ–¹ã€‚\n\n* å½“æˆ‘ä»¬æŠŠåŠ¨ç”»çš„repeatCountè®¾ç½®ä¸ºæ— é™å¾ªç¯æ—¶ï¼Œå¦‚æœåœ¨Activityé€€å‡ºæ—¶æ²¡æœ‰åŠæ—¶å°†åŠ¨ç”»åœæ­¢ï¼Œå±æ€§åŠ¨ç”»ä¼šå¯¼è‡´Activityæ— æ³•é‡Šæ”¾è€Œå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œè€Œè¡¥é—´åŠ¨ç”»å´æ²¡æœ‰é—®é¢˜ã€‚å› æ­¤ï¼Œä½¿ç”¨å±æ€§åŠ¨ç”»æ—¶åˆ‡è®°åœ¨Activityæ‰§è¡Œ onStop æ–¹æ³•æ—¶é¡ºä¾¿å°†åŠ¨ç”»åœæ­¢ã€‚ï¼ˆå¯¹è¿™ä¸ªæ€€ç–‘çš„åŒå­¦å¯ä»¥è‡ªå·±é€šè¿‡åœ¨åŠ¨ç”»çš„Update  å›è°ƒæ–¹æ³•æ‰“å°æ—¥å¿—çš„æ–¹å¼è¿›è¡ŒéªŒè¯ï¼‰ã€‚\n\n* xml æ–‡ä»¶å®ç°çš„è¡¥é—´åŠ¨ç”»ï¼Œå¤ç”¨ç‡æé«˜ã€‚åœ¨Activityåˆ‡æ¢ï¼Œçª—å£å¼¹å‡ºæ—¶ç­‰æƒ…æ™¯ä¸­æœ‰ç€å¾ˆå¥½çš„æ•ˆæœã€‚\n\n* ä½¿ç”¨å¸§åŠ¨ç”»æ—¶éœ€è¦æ³¨æ„ï¼Œä¸è¦ä½¿ç”¨è¿‡å¤šç‰¹åˆ«å¤§çš„å›¾ï¼Œå®¹æ˜“å¯¼è‡´å†…å­˜ä¸è¶³ã€‚\n\n\nå¥½äº†ï¼Œå…³äºAndroid åŠ¨ç”»çš„æ€»ç»“å°±åˆ°è¿™é‡Œã€‚\n\næœ€å æœ‰å…´è¶£çš„åŒå­¦å¯æŸ¥çœ‹[github æºç ](https://github.com/REBOOTERS/AndroidAnimationExercise)æ¬¢è¿star & fork\n*********","tags":["è‡ªå®šä¹‰View"],"categories":["Android è¿›é˜¶"]},{"title":"ç†è§£Androidä¸­çš„æ³¨è§£ä¸åå°„","url":"%2F2016%2F09%2F24%2F%E7%90%86%E8%A7%A3Android%E4%B8%AD%E7%9A%84%E6%B3%A8%E8%A7%A3%E4%B8%8E%E5%8F%8D%E5%B0%84%2F","content":"\n## å‰è¨€##\n\næœ€è¿‘ä¸€æ®µæ—¶é—´åœ¨ç ”ç©¶EventBuså’ŒRetrofit çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½é‡åˆ°äº†**æ³¨è§£**è¿™ä¸ªæ¦‚å¿µã€‚ç”±äºåœ¨å­¦ä¹ Javaçš„æ—¶å€™å¯¹è¿™æ–¹é¢æ²¡æœ‰æ·±å…¥äº†è§£è¿‡ï¼Œæ‰€ä»¥çœ‹èµ·ç›¸å…³çš„ä»£ç æ¥ï¼Œæ€»ä¼šæœ‰ç‚¹ä¸çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œè¿™é‡Œå°±æ³¨è§£å’Œåå°„çš„ä½¿ç”¨åšä¸€ä¸‹æ€»ç»“ã€‚\n\n*è¿™é‡Œæˆ‘ä»¬å…ˆä»åå°„è¯´èµ·ï¼Œäº†è§£äº†åå°„çš„æ„ä¹‰åŠç”¨æ³•åï¼Œæˆ‘ä»¬åœ¨çœ‹çœ‹æ³¨è§£çš„ä½¿ç”¨ï¼Œæœ€åå™è¿°ä¸€ä¸‹åœ¨Androidå¼€å‘ä¸­æ˜¯æ€æ ·ç»“åˆä½¿ç”¨æ³¨è§£ä¸åå°„ã€‚*\n\n<!--more-->\n\n## åå°„##\n\n\n### Javaåå°„ï¼ˆReflectionï¼‰å®šä¹‰###\n\nJavaåå°„æœºåˆ¶æ˜¯æŒ‡åœ¨**è¿è¡ŒçŠ¶æ€**ä¸­\n\n**å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½çŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›**\n**å¯¹äºä»»ä½•ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»ä½•ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ï¼›**\n\nè¿™æ ·åŠ¨æ€è·å–æ–°çš„ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½å°±å«åšåå°„ã€‚\n\næ¯”å¦‚åƒä¸‹é¢ï¼š\n\n```\n           //è·å–ç±»\n        Class c = Class.forName(\"java.lang.String\");\n        // è·å–æ‰€æœ‰çš„å±æ€§\n        Field[] fields = c.getDeclaredFields();\n        StringBuffer sb = new StringBuffer();\n        sb.append(Modifier.toString(c.getModifiers()) + \" class \" + c.getSimpleName() + \"{\\n\");\n        // éå†æ¯ä¸€ä¸ªå±æ€§\n        for (Field field : fields) {\n            sb.append(\"\\t\");// ç©ºæ ¼\n            sb.append(Modifier.toString(field.getModifiers()) + \" \");// è·å¾—å±æ€§çš„ä¿®é¥°ç¬¦ï¼Œä¾‹å¦‚publicï¼Œstaticç­‰ç­‰\n            sb.append(field.getType().getSimpleName() + \" \");// å±æ€§çš„ç±»å‹çš„åå­—\n            sb.append(field.getName() + \";\\n\");// å±æ€§çš„åå­—+å›è½¦\n        }\n        sb.append(\"}\\n\");\n        System.out.println(sb);\n```\nå°±å¯ä»¥è·å¾— **String** ï¼Œè¿™ä¸ªæˆ‘ä»¬å¸¸ç”¨ç±»çš„æ‰€æœ‰å±æ€§ï¼š\n\n\n ![string_property](http://img.blog.csdn.net/20160902224548933)\n\nå†æ¯”å¦‚ï¼š\n\n```\n       //è·å–ç±»\n        Class c = Class.forName(\"java.lang.String\");\n        // è·å–æ‰€æœ‰çš„æ–¹æ³•\n        Method[] ms = c.getDeclaredMethods();\n        //éå†è¾“å‡ºæ‰€æœ‰æ–¹æ³•\n        for (Method method : ms) {\n            //è·å–æ–¹æ³•æ‰€æœ‰å‚æ•°\n            Parameter[] parameters = method.getParameters();\n            String params = \"\";\n            if (parameters.length > 0) {\n                StringBuffer stringBuffer = new StringBuffer();\n                for (Parameter parameter : parameters) {\n                    stringBuffer.append(parameter.getType().getSimpleName() + \" \" + parameter.getName() + \",\");\n                }\n                //å»æ‰æœ€åä¸€ä¸ªé€—å·\n                params = stringBuffer.substring(0, stringBuffer.length() - 1);\n            }\n            System.err.println(Modifier.toString(method.getModifiers())\n                    + \" \" + method.getReturnType().getSimpleName()\n                    + \" \" + method.getName()\n                    + \" (\" +params  + \")\");\n        }\n```\n\nå¯ä»¥è·å¾—String ç±»çš„æ‰€æœ‰æ–¹æ³•ï¼ˆå›¾ç‰‡åªæˆªå–äº†éƒ¨åˆ†æ–¹æ³•ï¼Œå®é™…æœ‰å¾ˆå¤šå°±ä¸å ç¯‡å¹…äº†ï¼‰ï¼š\n\n![string_method](http://img.blog.csdn.net/20160902224713217)\n\n \n### Javaåå°„æœºåˆ¶API###\n\n\n\n#### ä¸»è¦çš„å‡ ä¸ªç±»####\n\nJavaä¸­æœ‰å…³åå°„çš„ç±»æœ‰ä»¥ä¸‹è¿™å‡ ä¸ªï¼š\n\n|ç±»|ç”¨é€”|\n|--|:--:|\n|java.lang.Class|ç¼–è¯‘åçš„classæ–‡ä»¶çš„å¯¹è±¡|\n|java.lang.reflect.Constructor|æ„é€ æ–¹æ³•|\n|java.lang.reflect.Field|ç±»çš„æˆå‘˜å˜é‡ï¼ˆå±æ€§ï¼‰|\n|java.lang.reflect.Method|ç±»çš„æˆå‘˜æ–¹æ³•|\n|java.lang.reflect.Modifier|åˆ¤æ–­æ–¹æ³•ç±»å‹|\n|**java.lang.annotation.Annotation**|**ç±»çš„æ³¨è§£**|\n\n#### å…·ä½“å®ç°####\n\nä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç±» TestClass\n\n```\npublic class TestClass {\n    private String address;\n    private String port;\n    private int number;\n\n   public void printInfo() {\n        System.out.println(\"info is \" + address + \":\" + port);\n    }        \n    private void myMethod(int number,String sex) {\n\n    }\n\n    public String getPort() {\n        return port;\n    }\n\n    public void setPort(String port) {\n        this.port = port;\n    }\n\n    public String getAddress() {\n        return address;\n    }\n\n    public void setAddress(String address) {\n        this.address = address;\n    }\n\n    public int getNumber() {\n        return number;\n    }\n\n    public void setNumber(int number) {\n        this.number = number;\n    }\n\n\n}\n```\n\nè¿™ä¸ªç±»å¾ˆç®€å•ï¼ŒåŒ…å«ä¸‰ä¸ªæˆå‘˜å˜é‡addressï¼Œportå’Œnumberï¼Œä»¥åŠå®ƒä»¬å„è‡ªçš„get,setæ–¹æ³•ã€‚\nä¸¤ä¸ªè‡ªå®šä¹‰çš„æ–¹æ³•printInfo()å’ŒmyMethod()ã€‚\n\nä¸‹é¢æˆ‘ä»¬å°±çœ‹ä¸€ä¸‹å¦‚ä½•é€šè¿‡åå°„ï¼Œè·å–è¿™ä¸ªTestClassçš„æ‰€æœ‰**â€œä¿¡æ¯â€**\n\n* 1.è·å–Class\nå…³äºClassçš„è·å–æœ‰ä¸‰ç§å†™æ³•ï¼š\n```\n//è·å–ç±»çš„ä¸‰ç§æ–¹æ³•:\nClass c = Class.forName(\"java.lang.String\");  //è¿™é‡Œä¸€å®šè¦ç”¨å®Œæ•´çš„åŒ…å\nClass c1=String.class;\nString str = new String();\nClass c2=str.getClass();\n```\nè¿™é‡Œè·å–çš„c,c1ä»¥åŠc2éƒ½æ˜¯ç›¸ç­‰çš„ã€‚ä¸€èˆ¬åœ¨åå°„ä¸­ä¼šç”¨ç¬¬ä¸€ç§å†™æ³•ã€‚\n\n* 2.è·å–ç±»çš„å±æ€§ï¼ˆæˆå‘˜å˜é‡ï¼‰\n\n```\nField[] fields = c.getDeclaredFields();\n```\nè¿™é‡Œè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ ï¼ŒåŒ…å«æ‰€æœ‰çš„å±æ€§ã€‚è·å–åˆ°çš„æ¯ä¸€ä¸ªå±æ€§Filedï¼ŒåŒ…å«ä¸€ç³»åˆ—çš„æ–¹æ³•å¯ä»¥è·å–åŠä¿®æ”¹ä»–çš„å†…å®¹ã€‚\nå¦‚ä¸‹æ‰€ç¤ºï¼š\n```\n// éå†æ¯ä¸€ä¸ªå±æ€§\n        for (Field field : fields) {\n            sb.append(\"\\t\");// ç©ºæ ¼\n            sb.append(Modifier.toString(field.getModifiers()) + \" \");// è·å¾—å±æ€§çš„ä¿®é¥°ç¬¦ï¼Œä¾‹å¦‚publicï¼Œstaticç­‰ç­‰\n            sb.append(field.getType().getSimpleName() + \" \");// å±æ€§çš„ç±»å‹çš„åå­—\n            sb.append(field.getName() + \";\\n\");// å±æ€§çš„åå­—+å›è½¦\n        }\n```\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°TestClassçš„æ‰€æœ‰å±æ€§ï¼š\n\n![test_p](http://img.blog.csdn.net/20160902225142207)\n \n\n* 3.è·å–ç±»çš„æ–¹æ³•\n```\n// è·å–æ‰€æœ‰çš„æ–¹æ³•\nMethod[] ms = c.getDeclaredMethods();\n```\nå’Œå±æ€§ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥é€šè¿‡ä¸€ç³»åˆ—çš„æ–¹æ³•è·å–åˆ°æ–¹æ³•çš„**è¿”å›å€¼ç±»å‹ï¼Œåç§°ä»¥åŠå‚æ•°**ã€‚ä¸‹é¢çš„è¡¨æ ¼ä¸­æ€»ç»“äº†ä¸€äº›å…³é”®æ–¹æ³•ï¼š\n\n![reflection](http://img.blog.csdn.net/20160902225331083)\n\n ç±»ä¼¼çš„è·å–åˆ°TestClassçš„æ‰€æœ‰æ–¹æ³•ï¼š\n\n![test_method](http://img.blog.csdn.net/20160902225358568)\n  \n  è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œè·å–çš„TestClassçš„å±æ€§å’Œæ–¹æ³•åŒæˆ‘ä»¬å®šä¹‰çš„æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚\n\nè¿™é‡Œæˆ‘ä»¬é¡ºä¾¿è°ƒç”¨ä¸€ä¸‹TestClassçš„printInfoæ–¹æ³•ï¼š\n```\nnew TestClass().printInfo();\n```\nç”¨äºæ‰€æœ‰å±æ€§æ²¡æœ‰åšåˆå§‹åŒ–ï¼Œæ‰€ä»¥å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n\n![null](http://img.blog.csdn.net/20160902225523803)\n \n\nå¯ä»¥çœ‹åˆ°ï¼Œåˆ©ç”¨åå°„æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„å»â€œåç¼–è¯‘â€ä¸€ä¸ªclassã€‚é‚£ä¹ˆæˆ‘ä»¬ç”¨åå°„è¿™ä¹ˆåšçš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸è¦ç€æ€¥ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹æ³¨è§£\n\n## Java æ³¨è§£ï¼ˆAnnotationï¼‰##\n### ä»€ä¹ˆæ˜¯æ³¨è§£###\n> å…³äºæ³¨è§£çš„å®šä¹‰ç½‘ä¸Šæœ‰å¾ˆå¤šè¯´æ³•ï¼Œå°±ä¸å†èµ˜è¿°ã€‚è¿™é‡Œæˆ‘ä»¬å°±è¯´ä¸¤ç‚¹\n\n\n**Annotationï¼ˆæ³¨è§£ï¼‰å°±æ˜¯Javaæä¾›äº†ä¸€ç§æºç¨‹åºä¸­çš„å…ƒç´ å…³è”ä»»ä½•ä¿¡æ¯æˆ–è€…ä»»ä½•å…ƒæ•°æ®ï¼ˆmetadataï¼‰çš„é€”å¾„å’Œæ–¹æ³•ã€‚**\n\n**Annotationæ˜¯è¢«åŠ¨çš„å…ƒæ•°æ®ï¼Œæ°¸è¿œä¸ä¼šæœ‰ä¸»åŠ¨è¡Œä¸º**\n\næ—¢ç„¶æ˜¯è¢«åŠ¨æ•°æ®ï¼Œå¯¹äºé‚£äº›å·²ç»å­˜åœ¨çš„æ³¨è§£ï¼Œæ¯”å¦‚Override,æˆ‘ä»¬åªèƒ½çœ‹çœ‹è€Œå·²ï¼Œå¹¶ä¸çŸ¥é“å®ƒå…·ä½“çš„å·¥ä½œæœºåˆ¶æ˜¯ä»€ä¹ˆï¼›æ‰€ä»¥æƒ³è¦ç†è§£æ³¨è§£ï¼Œå°±ç›´æ¥ä»è‡ªå®šä¹‰æ³¨è§£å¼€å§‹ã€‚\n\n### è‡ªå®šä¹‰æ³¨è§£###\n\n```\n@Retention(RetentionPolicy.RUNTIME)\n@Target({ElementType.FIELD})\n@Documented\n@Inherited\npublic @interface Bind {\n    int value() default 1;\n    boolean canBeNull() default false;\n}\n```\nè¿™å°±æ˜¯è‡ªå®šä¹‰æ³¨è§£çš„å½¢å¼ï¼Œæˆ‘ä»¬ç”¨@interface è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæ³¨è§£ï¼ŒAnnotationåªæœ‰æˆå‘˜å˜é‡ï¼Œæ²¡æœ‰æ–¹æ³•ã€‚Annotationçš„æˆå‘˜å˜é‡åœ¨Annotationå®šä¹‰ä¸­ä»¥â€œæ— å½¢å‚çš„æ–¹æ³•â€å½¢å¼æ¥å£°æ˜ï¼Œå…¶æ–¹æ³•åå®šä¹‰äº†è¯¥æˆå‘˜å˜é‡çš„åå­—ï¼Œå…¶è¿”å›å€¼å®šä¹‰äº†è¯¥æˆå‘˜å˜é‡çš„ç±»å‹ã€‚æ¯”å¦‚ä¸Šé¢çš„valueå’ŒcanBeNullã€‚\n\n### å…ƒæ³¨è§£###\n\nå¯ä»¥çœ‹åˆ°è‡ªå®šä¹‰æ³¨è§£é‡Œä¹Ÿä¼šæœ‰æ³¨è§£å­˜åœ¨ï¼Œç»™è‡ªå®šä¹‰æ³¨è§£ä½¿ç”¨çš„æ³¨è§£å°±æ˜¯å…ƒæ³¨è§£ã€‚\n\n#### @Rentention Rentention####\n\n@Rentention Rententionç”¨æ¥æ ‡è®°è‡ªå®šä¹‰æ³¨è§£çš„æœ‰æ•ˆèŒƒå›´ï¼Œä»–çš„å–å€¼æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š\n\n**RetentionPolicy.SOURCE: ** åªåœ¨æºä»£ç ä¸­ä¿ç•™ ä¸€èˆ¬éƒ½æ˜¯ç”¨æ¥å¢åŠ ä»£ç çš„ç†è§£æ€§æˆ–è€…å¸®åŠ©ä»£ç æ£€æŸ¥ä¹‹ç±»çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„Override;\n\n**RetentionPolicy.CLASS: ** é»˜è®¤çš„é€‰æ‹©ï¼Œèƒ½æŠŠæ³¨è§£ä¿ç•™åˆ°ç¼–è¯‘åçš„å­—èŠ‚ç classæ–‡ä»¶ä¸­ï¼Œä»…ä»…åˆ°å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œè¿è¡Œæ—¶æ˜¯æ— æ³•å¾—åˆ°çš„ï¼›\n\n**RetentionPolicy.RUNTIME: **ï¼Œæ³¨è§£ä¸ä»… èƒ½ä¿ç•™åˆ°classå­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œè¿˜èƒ½åœ¨è¿è¡Œé€šè¿‡åå°„è·å–åˆ°ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ã€‚\n\n#### @Target####\n@TargetæŒ‡å®šAnnotationç”¨äºä¿®é¥°å“ªäº›ç¨‹åºå…ƒç´ ã€‚\n@Targetä¹ŸåŒ…å«ä¸€ä¸ªåä¸ºâ€valueâ€œçš„æˆå‘˜å˜é‡ï¼Œè¯¥valueæˆå‘˜å˜é‡ç±»å‹ä¸ºElementType[ ]ï¼ŒElementTypeä¸ºæšä¸¾ç±»å‹ï¼Œå€¼æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š\n\n* ElementType.TYPEï¼šèƒ½ä¿®é¥°ç±»ã€æ¥å£æˆ–æšä¸¾ç±»å‹\n* ElementType.FIELDï¼šèƒ½ä¿®é¥°æˆå‘˜å˜é‡\n* ElementType.METHODï¼šèƒ½ä¿®é¥°æ–¹æ³•\n* ElementType.PARAMETERï¼šèƒ½ä¿®é¥°å‚æ•°\n* ElementType.CONSTRUCTORï¼šèƒ½ä¿®é¥°æ„é€ å™¨\n* ElementType.LOCAL_VARIABLEï¼šèƒ½ä¿®é¥°å±€éƒ¨å˜é‡\n* ElementType.ANNOTATION_TYPEï¼šèƒ½ä¿®é¥°æ³¨è§£\n* ElementType.PACKAGEï¼šèƒ½ä¿®é¥°åŒ…\n\n*ä½¿ç”¨äº†@Documentedçš„å¯ä»¥åœ¨javadocä¸­æ‰¾åˆ°*\n*ä½¿ç”¨äº†@Interitedè¡¨ç¤ºæ³¨è§£é‡Œçš„å†…å®¹å¯ä»¥è¢«å­ç±»ç»§æ‰¿ï¼Œæ¯”å¦‚çˆ¶ç±»ä¸­æŸä¸ªæˆå‘˜ä½¿ç”¨äº†ä¸Šè¿°@From(value)ï¼ŒFromä¸­çš„valueèƒ½ç»™å­ç±»ä½¿ç”¨åˆ°ã€‚*\n\nå¥½äº†ï¼Œå…³äºæ³¨è§£å°±è¯´è¿™ä¹ˆå¤šã€‚\n\n## åå°„&æ³¨è§£çš„ä½¿ç”¨##\n\n\n### å±æ€§å€¼ä½¿ç”¨æ³¨è§£###\n\nä¸‹é¢æˆ‘ä»¬é¦–å…ˆè‡ªå®šä¹‰ä¸¤ä¸ªæ³¨è§£ï¼šBindPort å’Œ BindAddress\n\n```\n@Retention(RetentionPolicy.RUNTIME)\n@Target(ElementType.FIELD)\npublic @interface BindPort {\n    String value() default \"8080\";\n}\n```\næŒ‡å®šBindPort å¯ä»¥ä¿ç•™åˆ°**è¿è¡Œæ—¶**ï¼Œå¹¶ä¸”å¯ä»¥ä¿®é¥°æˆå‘˜å˜é‡ï¼ŒåŒ…å«ä¸€ä¸ªæˆå‘˜å˜é‡é»˜è®¤å€¼ä¸ºâ€8080â€œã€‚\n```\n@Retention(RetentionPolicy.RUNTIME)\n@Target(ElementType.FIELD)\npublic @interface BindAddress {\n    String value() default \"127.0.0.0\";\n}\n```\nè¿™ä¸ªå’Œä¸Šé¢ç±»ä¼¼ï¼Œåªæ˜¯é»˜è®¤å€¼ä¸º\"127.0.0.0\"ã€‚\n\nåŒæ—¶ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¹‹å‰çš„TestClass \n\n```\npublic class TestClass {\n    @BindAddress()\n    String address;\n    @BindPort()\n    private String port;\n\n    private int number;\n\n    public void printInfo() {\n        System.out.println(\"info is \" + address + \":\" + port);\n    }\n   \n   ........\n\n\n}\n```\nè¿™é‡Œæˆ‘ä»¬å°†åŸå…ˆçš„address å’Œ port ä¸¤ä¸ªå˜é‡åˆ†åˆ«ç”¨è¿™é‡Œå®šä¹‰çš„æ³¨è§£è¿›è¡Œä¿®é¥°ï¼Œç”±äºæˆ‘ä»¬åœ¨å®šä¹‰æ³¨è§£æ—¶æœ‰é»˜è®¤å€¼ï¼Œæ‰€ä»¥è¿™é‡Œçš„æ³¨è§£å¯ä»¥ä¸å†™å‚æ•°ã€‚\n\n#### ä½¿ç”¨åå°„è·å–æ³¨è§£ä¿¡æ¯####\n\nå‰é¢å·²ç»è¯´äº†ï¼Œ**Annotationæ˜¯è¢«åŠ¨çš„å…ƒæ•°æ®ï¼Œæ°¸è¿œä¸ä¼šæœ‰ä¸»åŠ¨è¡Œä¸º**ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡ä½¿ç”¨åå°„ï¼Œæ‰èƒ½è®©æˆ‘ä»¬çš„æ³¨è§£äº§ç”Ÿæ„ä¹‰ã€‚\n\né€šè¿‡åå°„å¯ä»¥è·å–Classçš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå› æ­¤è·å–æ³¨è§£ä¿¡æ¯ä¹Ÿä¸åœ¨è¯ä¸‹ã€‚æˆ‘ä»¬çœ‹ä»£ç ï¼š\n\n```\n\t    //è·å–ç±»\n        Class c = Class.forName(className);\n        //å®ä¾‹åŒ–ä¸€ä¸ªTestClasså¯¹è±¡\n        TestClass tc= (TestClass) c.newInstance();\n\n        // è·å–æ‰€æœ‰çš„å±æ€§\n        Field[] fields = c.getDeclaredFields();\n\n        for (Field field : fields) {\n            if(field.isAnnotationPresent(BindPort.class)){\n                BindPort port = field.getAnnotation(BindPort.class);\n                field.setAccessible(true);\n                field.set(tc,port.value());\n            }\n\n            if (field.isAnnotationPresent(BindAddress.class)) {\n                BindAddress address = field.getAnnotation(BindAddress.class);\n                field.setAccessible(true);        \n                field.set(tc,address.value());\n            }\n\n        }\n\n        tc.printInfo();\n```\næˆ‘ä»¬è¿è¡Œç¨‹åºå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n\n![output](http://img.blog.csdn.net/20160902230814464)\n \n\nä¸Šé¢ä»£ç çš„é€»è¾‘å¾ˆç®€å•ï¼š\n\n**é¦–å…ˆéå†å¾ªç¯æ‰€æœ‰çš„å±æ€§ï¼Œå¦‚æœå½“å‰å±æ€§è¢«æŒ‡å®šçš„æ³¨è§£æ‰€ä¿®é¥°ï¼Œé‚£ä¹ˆå°±å°†å½“å‰å±æ€§çš„å€¼ä¿®æ”¹ä¸ºæ³¨è§£ä¸­æˆå‘˜å˜é‡çš„å€¼ã€‚**\n\nä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ‰¾åˆ°è¢«BindPortä¿®é¥°çš„å±æ€§ï¼Œç„¶åå°†BindPortä¸­valueçš„å€¼èµ‹ç»™è¯¥å±æ€§ã€‚\n\nè¿™é‡ŒsetAccessible(true)çš„ä½¿ç”¨æ—¶å› ä¸ºï¼Œæˆ‘ä»¬åœ¨å£°æ˜portå˜é‡æ—¶ï¼Œå…¶ç±»å‹ä¸ºprivateï¼Œä¸ºäº†ç¡®ä¿å¯ä»¥è®¿é—®è¿™ä¸ªå˜é‡ï¼Œé˜²æ­¢ç¨‹åºå‡ºç°å¼‚å¸¸ã€‚\n\n>ç†è®ºä¸Šæ¥è¯´ï¼Œè¿™æ ·åšæ˜¯ä¸å®‰å…¨çš„ï¼Œä¸ç¬¦åˆé¢å‘å¯¹è±¡çš„æ€æƒ³ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†è¯´æ˜æ³¨è§£å’Œåå°„ä¸¾ä¾‹ã€‚\n>\n>ä½†æ˜¯ï¼Œä½ ä¹Ÿä¼šå‘ç°ï¼Œåå°„ç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§åœ¨è¿è¡Œæ—¶æ”¹å˜å¯¹è±¡çš„æ–¹æ³•ã€‚\n\nå¥½äº†ï¼Œä¸‹é¢æˆ‘ä»¬ç»§ç»­ä¿®æ”¹TestClass \n```\npublic class TestClass {\n    @BindAddress(\"http://www.google.com.cn\")\n    String address;\n    @BindPort(\"8888\")\n    private String port;\n\n    private int number;\n\n    public void printInfo() {\n        System.out.println(\"info is \" + address + \":\" + port);\n    }\n    .......\n}\n```\n\næˆ‘ä»¬ä¸ºæ³¨è§£è®¾å®šäº†å‚æ•°ï¼Œå†æ¬¡è¿è¡Œï¼Œç›¸ä¿¡ä½ å·²ç»çŒœåˆ°ç»“æœäº†ã€‚\n\n![output1](http://img.blog.csdn.net/20160902231316528)\n \nè¿™æ—¶å€™ç”±äºæˆ‘ä»¬åœ¨ç»™æˆå‘˜å˜é‡è®¾å®šæ³¨è§£æ—¶ï¼Œå†™äº†å‚æ•°ï¼Œåå°„æ—¶ä¹Ÿå–åˆ°äº†ç›¸åº”çš„å€¼ã€‚\n\n\n\n### æ–¹æ³•ä½¿ç”¨æ³¨è§£###\n\nä¸Šé¢å¯¹äºç±»å±æ€§ï¼ˆæˆå‘˜å˜é‡ï¼‰è®¾å®šæ³¨è§£ï¼Œå¯èƒ½è¿˜ä¸èƒ½è®©æ„Ÿå—åˆ°æ³¨è§£&åå°„çš„ä¼˜åŠ¿ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ç±»çš„æ–¹æ³•ä½¿ç”¨æ³¨è§£ä¼šæ€æ ·ã€‚\n\næˆ‘ä»¬è¿˜æ˜¯å…ˆå®šä¹‰ä¸€ä¸ªæ³¨è§£\n\n```\n@Retention(RetentionPolicy.RUNTIME)\n@Target(ElementType.METHOD)\npublic @interface BindGet {\n    String value() default \"\";\n}\n```\næœ‰æ•ˆèŒƒå›´è‡³è¿è¡Œæ—¶ï¼Œé€‚ç”¨äºæ–¹æ³•ã€‚\n\nå†æ¬¡ä¿®æ”¹TestClass å¦‚ä¸‹ï¼š\n\n```\npublic class TestClass {\n    @BindAddress(\"http://www.google.com.cn\")\n    String address;\n    @BindPort(\"8888\")\n    private String port;\n\n    private int number;\n\n    @BindGet(\"mike\")\n    void getHttp(String param){\n        String url=\"http://www.baidu.com/?username\"+param;\n        System.err.println(\"get------->\"+url);\n    }\n\n    ...........\n}\n```\n\næˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªåä¸ºgetHttpçš„æ–¹æ³•ï¼Œè€Œä¸”è¿™ä¸ªæ–¹æ³•ç”±@BindGetæ³¨è§£ã€‚\n\nç„¶åçœ‹åå°„çš„ä½¿ç”¨ï¼š\n\n```\n\t//è·å–ç±»\n        Class c = Class.forName(className);\n        TestClass tc= (TestClass) c.newInstance();\n\t\n\t// è·å–æ‰€æœ‰çš„æ–¹æ³•\n        Method[] ms = c.getDeclaredMethods();\n\n        for (Method method : ms) {\n           if(method.isAnnotationPresent(BindGet.class)){\n               BindGet bindGet = method.getAnnotation(BindGet.class);\n               String param=bindGet.value();\n               method.invoke(tc, param);\n           }\n        }\n```\n\nè¿™é‡Œçš„é€»è¾‘å’Œå¯¹å±æ€§çš„è§£æç›¸ä¼¼ï¼Œä¾æ—§æ˜¯åˆ¤æ–­å½“å‰æ–¹æ³•æ˜¯å¦è¢«æŒ‡å®šçš„æ³¨è§£ï¼ˆBindGetï¼‰æ‰€ä¿®é¥°ï¼Œ\nå¦‚æœæ˜¯çš„è¯ï¼Œå°±ä½¿ç”¨**æ³¨è§£ä¸­çš„å‚æ•°**ä½œä¸º**å½“å‰æ–¹æ³•çš„å‚æ•°**å»è°ƒç”¨ä»–è‡ªå·±ã€‚\n\nè¿™æ ·ï¼Œæˆ‘ä»¬åœ¨è¿è¡Œç¨‹åºæ—¶ï¼Œé€šè¿‡åå°„å°±å›å»ä¸»åŠ¨è°ƒç”¨getæ–¹æ³•ï¼Œå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n\n![output2](http://img.blog.csdn.net/20160902231615406)\n\n \nè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ³¨è§£åŠ¨æ€çš„å®ç°usernameå‚æ•°çš„ä¿®æ”¹ï¼Œç”šè‡³getæ–¹æ³•æ•´ä¸ªhttp urlåœ°å€çš„ä¿®æ”¹ã€‚\n(å‡è®¾æˆ‘ä»¬è¿™é‡Œçš„get æ–¹æ³•æ˜¯åšç½‘ç»œè¯·æ±‚ï¼‰\n\n\nåˆ°è¿™é‡Œï¼Œä½ åº”è¯¥å·²ç»æ˜ç™½äº†å¦‚ä½•ä½¿ç”¨åå°„è·å–æ³¨è§£çš„ä¿¡æ¯ï¼Œä½†ä½ ä¸€å®šä¼šå›°æƒ‘è¿™ä¹ˆåšæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ\n\n**â€åŠ¨æ€â€œ**ï¼Œ**â€åŠ¨æ€â€œ**ï¼Œ**â€åŠ¨æ€â€œ**\n\nè¿™å°±æ˜¯ä½¿ç”¨æ³¨è§£å’Œåå°„æœ€å¤§çš„æ„ä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€çš„è®¿é—®å¯¹è±¡ã€‚\n\nè¯´äº†è¿™ä¹ˆå¤šï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹ï¼Œåœ¨Androidå¼€å‘ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°çš„æ³¨è§£å’Œåå°„ã€‚\n \n## Android ä¸­çš„æ³¨è§£&åå°„##\n\n### Butterknife###\n\nå¦‚æœä½ æ˜¯ä¸€ä¸ªAndroidå¼€å‘è€…ï¼Œç›¸ä¿¡åœ¨ä½¿ç”¨Butterknifeæ’ä»¶ä¹‹å‰ï¼Œä½ ä¸€å®šå†™äº†æ— æ•°æ¬¡çš„findViewByIdã€‚\n\nç„¶è€Œï¼Œå¦‚æœä½¿ç”¨äº†Butterknife æ’ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ŒæˆfindViewByIdçš„å·¥ä½œï¼Œç”šè‡³æ˜¯setOnClickListener çš„å·¥ä½œã€‚\n```\npublic class ButtferknifeDemoActivity extends AppCompatActivity {\n    @BindView(R.id.textView)\n    TextView textView;\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_buttferknife);\n        ButterKnife.bind(this);\n        textView.setText(\"I'm not null\");\n\n    }\n}\n```\n\nä¸Šé¢çš„ä»£ç ï¼Œåº”è¯¥ä¸é™Œç”Ÿã€‚è¯•æƒ³å¦‚æœä½ çš„activity_bufferknife å¸ƒå±€æ–‡ä»¶ä¸­æœ‰å¾ˆå¤šæ§ä»¶æ—¶ï¼Œè¿™æ ·åšä¸çŸ¥é“å¯ä»¥çœå¤šå°‘æ—¶é—´äº†\n\næˆ‘ä»¬çœ‹ä¸€ä¸‹BindViewçš„æ³¨è§£å®šä¹‰ï¼š\n\n```\n@Retention(CLASS) @Target(FIELD)\npublic @interface BindView {\n  /** View ID to which the field will be bound. */\n  @IdRes int value();\n}\n```\nè¿™ä¸ªæ³¨è§£ç”¨äºä¿®é¥°å˜é‡ï¼Œæœ‰æ•ˆèŒƒå›´ä¹Ÿæ˜¯é™å®šåˆ°äº†CLASS(å³ç¼–è¯‘é˜¶æ®µï¼‰ï¼Œå¹¶æ²¡æœ‰åˆ°è¿è¡Œæ—¶ã€‚\næˆ‘ä»¬åœ¨Butterknifeï¼ˆ8.4.0ï¼‰çš„éƒ¨åˆ†æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼š\n```\n /** Simpler version of {@link View#findViewById(int)} which infers the target type. */\n  @SuppressWarnings({ \"unchecked\", \"UnusedDeclaration\" }) // Checked by runtime cast. Public API.\n  @CheckResult\n  public static <T extends View> T findById(@NonNull View view, @IdRes int id) {\n    return (T) view.findViewById(id);\n  }\n```\næˆ‘ä»¬å¯ä»¥çŒœåˆ°çš„ï¼Œç¼–è¯‘æ—¶æœ€ç»ˆçš„å®ç°å¿…ç„¶æ˜¯åˆ°è¿™é‡Œï¼Œå®ç°view.findViewById(id)ã€‚\n\n**åœ¨è¿™é‡Œï¼Œæ³¨è§£å’Œåå°„çš„ç»“åˆï¼Œä½¿æˆ‘ä»¬å¯ä»¥é¿å…åšå¾ˆå¤šé‡å¤çš„å·¥ä½œã€‚**\n\n### Retrofit 2.0 ###\n\nç¬¬ä¸€æ¬¡ä½¿ç”¨Retrofitçš„æ—¶å€™ï¼Œå®Œå…¨è¢«æ¥å£å®šä¹‰çš„æ–¹å¼æè’™åœˆäº†ï¼Œå®Œå…¨æä¸æ‡‚å•Šã€‚\n\n```\npublic interface UserBasicService {\n\n    @GET(\"users/{user}\")\n    Call<ResponseBody> getUsers(@Path(\"user\") String uses);\n}\n```\n\nä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™ï¼Ÿå‚æ•°æ˜¯æ€ä¹ˆä¼ é€’çš„ï¼Ÿ@ æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå¸¦ç€æ›¾ç»çš„è¿™äº›ç–‘é—®ï¼Œæˆ‘ä»¬é¦–å…ˆçœ‹çœ‹è¿™é‡Œçš„ä¸¤ä¸ªæ³¨è§£ã€‚\n\nè¿™é‡Œä½¿ç”¨äº†ä¸¤ä¸ªæ³¨è§£GET å’ŒPath ,æˆ‘ä»¬çœ‹ä¸€ä¸‹ï¼š\n\n**GET**\n\n```\n/** Make a GET request. */\n@Documented\n@Target(METHOD)\n@Retention(RUNTIME)\npublic @interface GET {\n  /**\n   * A relative or absolute path, or full URL of the endpoint. This value is optional if the first\n   * parameter of the method is annotated with {@link Url @Url}.\n   * <p>\n   * See {@linkplain retrofit2.Retrofit.Builder#baseUrl(HttpUrl) base URL} for details of how\n   * this is resolved against a base URL to create the full endpoint URL.\n   */\n  String value() default \"\";\n}\n```\n\n**Path**\n```\n@Documented\n@Retention(RUNTIME)\n@Target(PARAMETER)\npublic @interface Path {\n  String value();\n\n  /**\n   * Specifies whether the argument value to the annotated method parameter is already URL encoded.\n   */\n  boolean encoded() default false;\n}\n```\n\nè¿™ä¸¤ä¸ªæ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸéƒ½å»¶ç»­åˆ°äº† RUNTIMEï¼Œå³è¿è¡Œæ—¶ã€‚GETç”¨äºæ–¹æ³•ï¼ŒPathç”¨äºå‚æ•°ã€‚è¿™ç‚¹å’Œæˆ‘ä»¬å®šä¹‰getUsersï¼ˆï¼‰æ–¹æ³•æ˜¯ä¸€è‡´çš„ã€‚\n\nå…³äºRetrofitä¸­åå°„å’Œæ³¨è§£çš„ä½¿ç”¨ï¼Œæ¶‰åŠåˆ°åŠ¨æ€ä»£ç†çš„ç›¸å…³æ¦‚å¿µï¼Œè¿™é‡Œå°±ä¸å±•å¼€æ¥è¯´ã€‚æ€»çš„æ€è·¯å°±æ˜¯é€šè¿‡æ³¨è§£ä¸­ä½¿ç”¨çš„å‚æ•°ï¼ŒåŠ¨æ€çš„ç”ŸæˆRequestæœ‰OKHttpå»è°ƒç”¨ã€‚è¿™ä¸ªä»¥åä¼šåšæ·±å…¥åˆ†æï¼Œè¿™é‡Œåªæ˜¯äº†è§£æ³¨è§£å’Œåå°„ç”¨æ³•ã€‚\n\nå¥½äº†ï¼Œå…³äºæ³¨è§£å’Œåå°„çš„ä½¿ç”¨æ–¹æ³•åŠæ„ä¹‰å°±æš‚æ—¶æ€»ç»“åˆ°è¿™é‡Œã€‚\n\n## åè¯##\n\nä»¥åˆé€‚çš„æ–¹å¼ä½¿ç”¨åå°„ï¼Œä¼šè®©æˆ‘ä»¬å†™ä»£ç çš„æ–¹å¼æ›´åŠ çµæ´»ã€‚åå°„ä½¿ç”¨ä¸å½“ï¼Œåè€Œä¼šé€‚å¾—å…¶åï¼Œä¼šå¯¹æ€§èƒ½é€ æˆå½±å“ã€‚\n\nä½†æ˜¯EventBusï¼ŒRetrofit çš„å¦‚æ­¤ç«çˆ†ï¼Œè®©æˆ‘ä»¬æœ‰ç†ç”±ç›¸ä¿¡ï¼Œå¯¹æ€§èƒ½çš„å½±å“ä¹Ÿè®¸æ²¡é‚£ä¹ˆå¤§ï¼Œæˆ–è€…è¯´é¢å¯¹ç°å¦‚ä»Šç¡¬ä»¶é…ç½®å ªæ¯”ç”µè„‘çš„æ‰‹æœºï¼Œè¿™ç‚¹å½±å“ä¹Ÿè®¸å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚\n\næ‰€ä»¥å…³äºåå°„çš„ä½¿ç”¨è¿˜æ˜¯ä»è€…è§ä»æ™ºè€…è§æ™ºå§ã€‚\n\n***\n\n\n\n","tags":["æ³¨è§£ï¼Œåå°„"],"categories":["Android è¿›é˜¶"]},{"title":"EventBus 3.0 ç›¸è§æ¨æ™š","url":"%2F2016%2F07%2F23%2FEventBus%203.0%20%E7%9B%B8%E8%A7%81%E6%81%A8%E6%99%9A%2F","content":"\n## ä¸ºä»€ä¹ˆè¦ç”¨EventBusï¼Ÿå®ƒæ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ##\n\n### EventBusæ˜¯ä»€ä¹ˆ###\n\nEventBusæ˜¯ä¸€ä¸ªAndroidç«¯ä¼˜åŒ–çš„publish/subscribeæ¶ˆæ¯æ€»çº¿ï¼Œç®€åŒ–äº†åº”ç”¨ç¨‹åºå†…å„ç»„ä»¶é—´ã€ç»„ä»¶ä¸åå°çº¿ç¨‹é—´çš„é€šä¿¡ã€‚\n\nè¿™æ ·ä¸€ä¸ªç®€å•çš„æ¦‚å¿µï¼Œå¯èƒ½è®©ä½ ä¸è¶³ä»¥æ„Ÿå—åˆ°EventBusçš„é­…åŠ›ã€‚æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸‹ä¸‹é¢è¿™äº›æƒ…å†µã€‚\n\n<!--more-->\n\n*  ä½¿ç”¨è´­ç‰©ç±»APPæ—¶ï¼Œæˆ‘ä»¬åœ¨å•†å“è¯¦æƒ…é¡µå°†å•†å“åŠ å…¥è´­ç‰©è½¦æ—¶ï¼Œåº•éƒ¨tabæ çš„è´­ç‰©è½¦tabå³ä¸Šè§’çš„å°æ•°å­—ä¹ŸåŒæ­¥å‘ç”Ÿäº†å˜åŒ–ã€‚\n\né¢å¯¹è¿™æ ·çš„éœ€æ±‚ï¼Œä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯åœ¨è¯¦æƒ…é¡µä¸­æä¾›ä¸€ä¸ªæ¥å£ï¼Œåœ¨tabæ æ‰€åœ¨çš„Activityï¼ˆæˆ–è€…æ˜¯Fragmentï¼‰ä¸­æ³¨å†Œè¿™ä¸ªæ¥å£ï¼Œå½“ç‚¹å‡»äº‹ä»¶å‘ç”Ÿæ˜¯ï¼Œå›è°ƒè¿™ä¸ªæ¥å£ï¼Œæ›´æ–°tabæ çš„å†…å®¹ã€‚ç”šè‡³æœ‰æ—¶å€™ï¼Œç”±äºActivity+å¤šä¸ªfragment çš„ç»„åˆï¼Œå¯èƒ½éœ€è¦å¤šä¸ªæ¥å£ç»è¿‡å±‚å±‚ä¼ é€’æ‰èƒ½å®ç°æŸäº›åœ¨äº§å“ç»ç†çœ‹æ¥å¾ˆç®€å•çš„UIæ›´æ–°ã€‚\n\n*  å¤§éƒ¨åˆ†APPåœ¨ç”¨æˆ·å®Œæˆç”¨æˆ·ç™»å½•æ“ä½œåï¼Œéœ€è¦åœ¨è¿”å›ç•Œé¢åŒæ­¥æ›´æ–°ç”¨æˆ·ä¿¡æ¯ã€‚\n\nè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨è¿”å›ç•Œé¢çš„onActivityResultæ–¹æ³•ä¸­ï¼Œé€šè¿‡requestCodeåŠresultCodeåšå‡ºç§ç§åˆ¤æ–­ï¼Œæœ€ååœ¨ç¡®è®¤ç”¨æˆ·ç™»å½•æˆåŠŸçš„æƒ…å†µä¸‹ï¼Œè¯·æ±‚ç”¨æˆ·ä¿¡æ¯å®ŒæˆUIçš„æ›´æ–°ï¼Œè¿™ç§ä½“éªŒå…¶å®æ˜¯éå¸¸ä¸å¥½ï¼Œä½œä¸ºä¸€ä¸ªç”¨æˆ·å¸Œæœ›çš„æ˜¯ç™»å½•æˆåŠŸçš„åŒæ—¶å®Œæˆç”¨æˆ·ä¿¡æ¯çš„æ›´æ–°ã€‚\n\nå½“ç„¶ä¸Šé¢ä¸¤ç§æƒ…å†µï¼Œç”¨BroadcastReceiverå®ç°ï¼Œä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ï¼Œè‚¯èƒ½ä¼šç›¸å¯¹ç®€å•ä¸€äº›ï¼Œä½†æ˜¯ä»æ•´ä½“æ€§èƒ½æ¥è¯´ï¼Œè¿™æ ·æ˜¯ä¸å¥½çš„ã€‚\n\nè€ŒEventBusçš„å‡ºç°ï¼Œå¾ˆå¥½çš„è§£å†³äº†è¿™äº›è®©æˆ‘ä»¬å¤´ç–¼çš„é—®é¢˜ã€‚é¦–å…ˆå°±ç”¨ä¸€ä¸ªç®€å•çš„åˆ—å­æ¥å®ç°ä¸€ä¸‹ç”¨æˆ·ç™»å½•ä¿¡æ¯**å¼‚æ­¥**æ›´æ–°çš„æƒ…å†µã€‚\n\n\n## EventBus 3.0 ä½¿ç”¨Demo##\n\nè¿™é‡Œç”¨ä¸¤ä¸ªActivityç®€å•çš„æ¨¡æ‹Ÿå¸¸è§çš„ç”¨æˆ·ç™»å½•ã€‚\n\n\n### ç”¨æˆ·ä¿¡æ¯ç•Œé¢###\n\n\n```\npublic class FirstActivity extends AppCompatActivity {\n    private Button btn;\n    private Context mContext;\n    //User Info\n    private TextView userName;\n    private ImageView usreImg;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mContext = this;\n        EventBus.getDefault().register(mContext);\n        InitView();\n\n\n    }\n\n    private void InitView() {\n        setContentView(R.layout.activity_first);\n        userName = (TextView) findViewById(R.id.userName);\n        usreImg = (ImageView) findViewById(R.id.userImg);\n        btn = (Button) findViewById(R.id.button);\n        btn.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                startActivity(new Intent(mContext, SecondActivity.class));\n            }\n        });\n    }\n\n\n    @Subscribe\n    public void onUserEvent(UserEvent event) {\n        userName.setText(\"ç”¨æˆ·å:\" + event.nameStr);\n        Glide.with(mContext).load(event.imgUrl).into(usreImg);\n\n    }\n\n    @Override\n    protected void onDestroy() {\n        EventBus.getDefault().unregister(mContext);\n        super.onDestroy();\n    }\n}\n```\n### ç”¨æˆ·ç™»å½•ç•Œé¢###\n\n```\npublic class SecondActivity extends AppCompatActivity {\n    private Context mContext;\n    private Button btn;\n    private EditText name;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mContext=this;\n        setContentView(R.layout.activity_second);\n        name = (EditText) findViewById(R.id.name);\n        findViewById(R.id.button).setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                //æµ‹è¯•æ•°æ®\n                String userImg = \"http://img5.imgtn.bdimg.com/it/u=3774008831,1558972780&fm=21&gp=0.jpg\";\n                //è¿™é‡Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿æµ‹è¯•,éšä¾¿å†™çš„ç™»å½•é€»è¾‘\n                String userName=\"\";\n                if(!TextUtils.isEmpty(name.getText().toString())){\n                    userName = name.getText().toString();\n                    UserEvent userEvent = new UserEvent(userName, userImg);\n                    EventBus.getDefault().post(userEvent);\n                }else {\n                    //ä¸å†å‘é€äº‹ä»¶Event\n                    Toast.makeText(mContext,\"ç™»å½•å¤±è´¥\",Toast.LENGTH_SHORT).show();\n                }\n\n                finish();\n            }\n        });\n\n    }\n}\n```\n### UserEvent ç±»###\n\n```\npublic class UserEvent {\n    public final String nameStr;\n    public final String imgUrl;\n\n    public UserEvent(String nameStr, String imgUrl) {\n        this.nameStr = nameStr;\n        this.imgUrl = imgUrl;\n    }\n}\n```\n\nè¿™é‡Œå¯ä»¥çœ‹åˆ°æ²¡æœ‰Handlerï¼Œæ²¡æœ‰onActivityResultçš„åˆ¤æ–­ï¼Œæ²¡æœ‰æ²¡æœ‰ä»»ä½•æ¥å£ã€‚å°±å®ç°äº†å¦‚gifå›¾ä¸­æ‰€ç¤ºæ•ˆæœã€‚\n\næ¥ä¸‹æ¥ï¼Œå°±æ€»ç»“ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨EventBus3.0 ã€‚\n\n## EventBus 3.0 ä½¿ç”¨æ­¥éª¤##\n\n1.é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†EventBusæ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚åœ¨AndroidStudioä¸­æˆ‘ä»¬å¯ä»¥åœ¨gradleé‡Œé¢ç›´æ¥é…ç½®å³å¯ã€‚\n\n```\ncompile 'org.greenrobot:eventbus:3.0.0'\n```\n\n2.åˆ›å»ºä¸€ä¸ªäº‹ä»¶ç±»ï¼ˆè¿™ä¸ªç±»ä¼¼äºJavaBean)ï¼Œå°±æ˜¯ä¸Šé¢çš„UserEventç±»ã€‚\n\nè¿™é‡Œçš„Demoåªæ˜¯ä¸¾ä¾‹è¯´æ˜ç®€å•ç”¨æ³•ï¼Œå®é™…ä¸­å¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºä¸åŒçš„äº‹ä»¶ç±»\n\n3.æ³¨å†Œ\n\n```\n  EventBus.getDefault().register(mContext);\n```\n\n4.è®¢é˜…ï¼ˆå“åº”äº‹ä»¶æ–¹æ³•ï¼‰\n\n```\n@Subscribe\n    public void onUserEvent(UserEvent event) {\n        userName.setText(\"ç”¨æˆ·å:\" + event.nameStr);\n        Glide.with(mContext).load(event.imgUrl).into(usreImg);\n\n    }\n```\n\nè¿™é‡Œçš„æ³¨è§£@Subscribe å¾ˆå…³é”®ï¼Œè¡¨æ˜è¿™ä¸ªæ–¹æ³•ä¸ºè®¢é˜…è€…ï¼Œè¿™ä¸ªæ–¹æ³•çš„åå­—ä¹Ÿå·²ç»ä¸åœ¨é‡è¦äº†ï¼ˆç›¸å¯¹äºä»¥å‰çš„ç‰ˆæœ¬æ¥è¯´ï¼‰ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œæˆ‘ä»¬å®ç°äº†UIæ›´æ–°ã€‚\n\n5.åˆ†å‘äº‹ä»¶\n\n```\nUserEvent userEvent = new UserEvent(userName, userImg);\n                    EventBus.getDefault().post(userEvent);\n```\n\n6.è§£é™¤æ³¨å†Œ\n\n```\nEventBus.getDefault().unregister(mContext);\n```\n\n\n\n\n\n\n\n\n\n\n","tags":["è§‚å¯Ÿè€…æ¨¡å¼"],"categories":["Android ä¸‰æ–¹æ¡†æ¶"]},{"title":"æˆ‘çš„å°‘å¹´æ—¶ä»£","url":"%2F2016%2F06%2F06%2F%E6%88%91%E7%9A%84%E5%B0%91%E5%B9%B4%E6%97%B6%E4%BB%A3%2F","content":"\n#### è‰é¸£çš„å¤å­£ æˆ‘æƒ³é‡è§ä½ ####\n     \n2006å¹´çš„å¤å¤©ï¼Œéƒ­ç„¶è¯»é«˜ä¸€ã€‚\n\nåœ¨åæ¥è®¸è®¸å¤šå¤šçš„æ—¥å­é‡Œï¼Œå›å¿†èµ·é‚£ä¸ªå¤å¤©ï¼Œéƒ­ç„¶æ€»æ˜¯ç¬‘ç€è¯´ï¼Œé‚£æ˜¯æœ€æœ€å¿«ä¹çš„é’æ˜¥æ—¶å…‰ã€‚\n\näºŒä¸­æ˜¯å¿é‡Œçš„é‡ç‚¹é«˜ä¸­ï¼Œæ¯å¹´åˆä¸­æ¯•ä¸šåèƒ½è¸è¿›äºŒä¸­æ ¡é—¨çš„äººï¼Œåœ¨å†…å¿ƒæ·±å¤„æ€»æœ‰ç€å‡ åˆ†æ‚²å£®ä¸è«åçš„éª„å‚²ã€‚è€Œä¸€ä¸Šé«˜ä¸­ï¼Œå°±ç›´æ¥è¿›å…¥å®éªŒç­çš„äººï¼Œæ›´æ˜¯è®¸å¤šäººçœ¼é‡Œç¥ä¸€æ ·çš„å­˜åœ¨ï¼Œå°±åƒéƒ­ç„¶ï¼Œåˆä¸­ä¸‰å¹´ï¼Œå§‹ç»ˆæ˜¯é‚£ä¸ªå…¨å¹´çº§è€ƒç¬¬ä¸€çš„äººï¼Œæ²¡æœ‰äººå»å«‰å¦’ï¼Œå°±åƒä½ ä¸ä¼šå«‰å¦’é©¬äº‘èµšçš„æ¯”ä½ å¤šä¸€æ ·ã€‚æ‰€ä»¥å‘¢ï¼Œä»–èƒ½è¿›å…¥å®éªŒç­åœ¨æˆ‘ä»¬ä¸€ç¾¤åˆä¸­åŒå­¦çœ¼ä¸­æ˜¯ç†æ‰€å½“ç„¶ï¼Œåå€’æ˜¯äº¦å®‰æ²¡èƒ½è¿›å®éªŒç­è®©æˆ‘ä»¬ä¸€ç¾¤äººå¾ˆæ˜¯è¯§å¼‚ï¼Œå› ä¸ºäº¦å®‰è™½ç„¶ä¸å¦‚éƒ­ç„¶ä¸€æ ·é‚£ä¹ˆç¨³å®šçš„å§‹ç»ˆå¾…åœ¨å…¨å¹´çº§ç¬¬ä¸€çš„å®åº§ä¸Šï¼Œä½†åˆä¸­ä¸‰å¹´ä¸‹æ¥ä¹Ÿæ²¡è·Œå‡ºè¿‡å¹´çºªå‰äº”ã€‚\n\né‚£ä¸ªæ—¶å€™ï¼Œåˆšä½æ ¡çš„æˆ‘ä»¬ï¼Œæ¯å‘¨äº”éƒ½ä¼šä¸€èµ·åè½¦å›å®¶ï¼›æ¯æ¬¡åœ¨è½¦ä¸Šå’Œäº¦å®‰åŒå±å…­ç­çš„â€œç‹—åœ£â€éƒ½ä¼šè¯´ï¼Œä¸€å®šæ˜¯å“ªä¸ªæœ‰é’±äººå®¶ç»™å­¦æ ¡å¡äº†é’±æŠŠè‡ªå·±å®¶çš„å­©å­ç¡¬å¡è¿›äº†å®éªŒç­ï¼ŒæŒ¤æ‰äº†åŸæœ¬å±äºäº¦å®‰çš„åé¢ï¼Œå¯¹æ­¤ï¼Œæˆ‘ä»¬å‡ ä¸ªäººéƒ½æ˜¯ä¹‰æ„¤å¡«è†ºã€‚åå€’æ˜¯äº¦å®‰è‡ªå·±è§‰å¾—æ²¡ä»€ä¹ˆï¼ŒæŒ‰ç…§å¥¹çš„è¯å°±æ˜¯ï¼Œåªè¦è‡ªå·±åŠªåŠ›ï¼Œè¿˜æ€•è€ƒä¸ä¸Šè‡ªå·±å¿ƒç›®ä¸­çš„å¤§å­¦ï¼Œåœ¨å“ªé‡Œéƒ½æ— æ‰€è°“ã€‚\n\n\n\n![](http://upload-images.jianshu.io/upload_images/1115031-8a3ae7cb4ba9086f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n<!--more-->\n\nâ€œç‹—åœ£â€æ˜¯è·Ÿæˆ‘ä»å°ä¸€å—ç”¨å°¿å’Œç¨€æ³¥ç©è¿‡å®¶å®¶çš„å‘å°ï¼Œæˆ‘ä»¬ä»å°å­¦å¼€å§‹å°±ä¸€ç›´åœ¨ä¸€ä¸ªç­ï¼Œæ¯å¤©ä¸€èµ·ä¸Šå­¦ï¼Œä¸€èµ·æ”¾å­¦ï¼Œå¤å¤©ä¸€èµ·åˆ°æ²³é‡Œæ¸¸æ³³ï¼Œå†¬å¤©ä¸€èµ·åˆ°å±±ä¸Šè¿½é‡å…”ï¼Œåœ¨å­¦æ ¡é‡Œä¸€èµ·æ‰“æ¶ï¼Œå½“ç„¶æœ‰æ—¶å€™ä¹Ÿæ˜¯ä¸€èµ·è¢«æ‰“ã€‚ç›´åˆ°é«˜ä¸­ï¼Œæˆ‘ä»¬è¢«åˆ†åˆ°äº†ä¸åŒçš„ç­é‡Œã€‚â€œç‹—åœ£â€å¹¶ä¸å§“ç‹—ï¼Œå­¦ç”Ÿè¯ä¸Šå§“åé‚£ä¸€æ å†™çš„æ˜¯æé¸¿ç››ã€‚å°å­¦çš„æ—¶å€™ï¼Œæœ‰ä¸€æ¬¡æ”¾å­¦åå»æ²³è¾¹æ¸¸æ³³ï¼Œå°ä¼™ä¼´ä»¬èŠå¤©ï¼Œä¸çŸ¥ä¸ºä½•å°±èŠåˆ°äº†å˜˜å˜˜çš„è¯é¢˜ä¸Šï¼Œå¤§å®¶éƒ½åœ¨è‡ªå·±è¯´å¯ä»¥å˜˜çš„å¤šè¿œå¤šé«˜ï¼Œç”šè‡³æœ‰äº›äººéƒ½å¼€å§‹æ¯”åˆ’ä¸Šäº†ï¼Œç‹—åœ£ä¹Ÿæ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚ä¸€åœºå°å°çš„è¾ƒé‡æ…¢æ…¢å¼€å§‹ï¼Œæœ€ç»ˆç‹—åœ£ä»¥å¾®å¼±çš„åŠ£åŠ¿çš„è´¥ç»™äº†å¦å¤–ä¸€ä½å˜˜çš„æ¯”ä»–æ›´è¿œçš„å°ä¼™ä¼´ã€‚ä¹Ÿè®¸æ˜¯å¿ƒæœ‰ä¸ç”˜ï¼Œç‹—åœ£å¿½ç„¶é—®å¤§å®¶è¯´ï¼Œä½ ä»¬çŸ¥é“ç‹—æ˜¯æ€ä¹ˆå˜˜å˜˜çš„å—ï¼Ÿé‚£ä¸ªæ—¶å€™ï¼Œå® ç‰©ä¸åƒç°åœ¨è¿™ä¹ˆçš„æµè¡Œï¼Œä¸€èˆ¬äººå¾ˆå°‘èƒ½çœ‹è§å°ç‹—å°çŒ«ï¼Œè¡—åŠé¢†å±…å®¶é‡Œå…»çŒ«ç‹—çš„äººä¹Ÿä¸å¤šï¼Œæ‰€ä»¥çœŸçš„æ˜¯æ²¡åƒè¿‡ç‹—è‚‰ï¼Œä¹Ÿæ²¡æ€ä¹ˆè§è¿‡ç‹—è·‘ã€‚\n\nåœ¨å¤§éƒ¨åˆ†äººçš„ä¸–ç•Œè§‚é‡Œï¼Œå¯¹äºå˜˜å˜˜è¿™ä»¶äº‹ï¼ŒåŸºæœ¬ä¸Šéƒ½åœç•™åœ¨ç«™ç€è¿˜æ˜¯è¹²ç€çš„åŒºåˆ«ä¸Šï¼Œè„‘è¢‹é‡Œå®Œå…¨æ²¡æœ‰å¦å¤–ä¸€ç§å§¿åŠ¿ã€‚å½“ç„¶ï¼Œä¹Ÿæ˜¯æœ‰äººçœ‹åˆ°è¿‡çš„ï¼Œæˆ‘ç»å¸¸å»ç‹—åœ£å®¶ç©ï¼Œæœ‰æ—¶å€™å°±ä¼šçœ‹è§ä»–ä»¬å®¶é‚£æ¡çœ‹é—¨çš„å“ˆå·´ç‹—å¯¹ç€å—å¢™å˜˜å˜˜æ—¶çš„æ ·å­ã€‚æˆ‘ä»¬å‡ ä¸ªå°ä¼™ä¼´å½¼æ­¤çœ‹äº†ä¸€çœ¼ï¼Œæ€€æ£ç€å¥½å¥‡çš„å¿ƒæƒ…å¿ƒç…§ä¸å®£çš„æ‘‡äº†æ‘‡å¤´ã€‚ç‹—åœ£è¿˜ç‰¹æ„çœ‹äº†æˆ‘ä¸€çœ¼ï¼Œç„¶åå¾®å¾®ä¸€ç¬‘ï¼Œä»¿ä½›æ˜¯åœ¨æ„Ÿè°¢æˆ‘å¾ˆè¯†æ—¶åŠ¡çš„æ²¡æœ‰ç ´åä»–æƒ³è¦è¡¨æ¼”çš„æ¬²æœ›ã€‚åªæ˜¯æ¥ä¸‹æ¥ä»–æ‰€åšçš„ä¸€åˆ‡ï¼Œå½»åº•æˆä¸ºäº†ä»–æ­¤ç”Ÿæœ€ä¸æ„¿å›é¦–çš„äº‹æƒ…ã€‚ä»–å•è„šç«™ç«‹ï¼Œå¦ä¸€åªè„šè€·æ‹‰çš„åŠç©ºï¼Œå¼¯ç€è…°å¾ˆæœ‰èŠ‚å¥çš„å“†å—¦äº†ä¸¤ä¸‹ï¼Œæ­¤åˆ»çš„ä½ å¯ä»¥è„‘è¡¥ä¸€ä¸‹é‚£ä¸ªç”»é¢ï¼Œå®Œå…¨å°±æ˜¯ä¸€æ¡ç‹—çš„å§¿æ€ã€‚é‚£ä¸€ç¬é—´ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„å°ä¼™ä¼´éƒ½ç¬‘å–·äº†ï¼Œè€Œæ˜ç™½è¿‡æ¥çš„ç‹—åœ£åœ¨æ²³è¾¹æ°”æ„¤å´åˆæ— å¯å¥ˆä½•çš„è¿½æ‰“ç€æˆ‘ä»¬ã€‚æé¸¿ç››å› ä¸ºä¸€å‡ºçœŸå®ç‰ˆçš„ã€Šäººä¸è‡ªç„¶ã€‹å°±æˆäº†å°ä¼™ä¼´ä»¬å£ä¸­çš„ç‹—ï¼Œè€Œåæ¥ä¸ºäº†å«ç€é¡ºæºœï¼Œç‹—åœ£å°±æˆäº†ä¼´éšä»–å¤šå¹´çš„å¤–å·ã€‚\n\n\n![](http://upload-images.jianshu.io/upload_images/1115031-414d7c5dde950ba4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\né‚£ä¸ªå¤å¤©ï¼Œè¿‡çš„å¾ˆå¿«ã€‚æˆ‘ä»¬å‡ ä¸ªä¸€èµ·è¸å…¥äºŒä¸­æ ¡é—¨çš„åŒå­¦å’Œèƒ½è”ç³»ä¸Šçš„åˆä¸­åŒç­åŒå­¦ä»¥åŠè€å¸ˆä¸€èµ·è¿›è¡Œäº†ä¸€æ¬¡é‡ç‚Šã€‚ç”·åŒå­¦è´Ÿè´£ç”Ÿç«æ•é±¼ï¼Œåœ¨å°æ ‘æ—æ­èµ·å¸ç¯·ï¼Œå¥³åŒå­¦è´Ÿè´£æ´—èœï¼Œåšé¥­ã€‚åœ¨é‚£ä¸ªè‰é¸£çš„å¤å­£ï¼Œæˆ‘ä»¬è°ˆç€ç†æƒ³ï¼Œæ†§æ†¬ç€ç¾å¥½çš„æœªæ¥ã€‚æ‰€æœ‰åŒå­¦å’Œè€å¸ˆéƒ½ä¸€è‡´è®¤ä¸ºï¼Œéƒ­ç„¶åªè¦åŠ æŠŠåŠ²ï¼Œå°†æ¥è€ƒè¿›æ¸…åæˆ–è€…åŒ—å¤§æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå†µä¸”äºŒä¸­æ¯å¹´éƒ½ä¼šæœ‰å­¦ç”Ÿè¿›è¿™ä¸¤æ‰€åæ ¡ï¼Œå¸ˆèµ„åŠ›é‡å®Œå…¨ä¸æ˜¯é—®é¢˜ã€‚éƒ­ç„¶ç‰¹æ„çš„æ„Ÿè°¢äº†å¤§å®¶çš„æ”¯æŒï¼Œå¹¶ä¸”è¯´ä¸€å®šä¼šä¸è´Ÿä¼—æœ›ã€‚æˆ‘ä»¬å‡ ä¸ªäºŒä¸­çš„åŒå­¦ä¹Ÿæ˜¯å½¼æ­¤çº¦å®šï¼Œè¿™ä¸‰å¹´ä¹Ÿè¦äº’ç›¸å¸®åŠ©ï¼Œèµ„æºå…±äº«ã€‚åœ¨åæ¥æ—¥å­é‡Œï¼Œå‚åŠ è¿‡å¾ˆå¤šå¤§å¤§å°å°å„ç§å½¢å¼çš„èšä¼šï¼Œå´å†ä¹Ÿæ²¡æœ‰è¿‡å½“å¹´çš„é‚£ä»½å¿«ä¹ï¼Œå†ä¹Ÿæ²¡æœ‰è¿‡åƒå½“å¹´é‚£èˆ¬è®©è‡ªå·±å……æ»¡åŠ›é‡çš„æ—¶åˆ»ã€‚\n\n#### æ«å¶å°†æ•…äº‹æŸ“è‰² ç»“å±€æˆ‘çœ‹é€####\n\né«˜ä¸­çš„è¯¾ç¨‹ï¼Œæ¯”èµ·ä»¥å¾€ï¼Œä»è´¨å’Œé‡ä¸Šéƒ½æœ‰äº†å¾ˆå¤§çš„è·¨è¶Šã€‚å°¤å…¶æ˜¯ç‰©ç†ï¼Œå˜å¾—æ›´åŠ çš„æŠ½è±¡å’Œéš¾ä»¥ç†è§£ã€‚æ›´ç¥å¥‡çš„æ˜¯ï¼Œæˆ‘é‡ä¸Šäº†ä¸€ä½å¥‡è‘©çš„ç‰©ç†è€å¸ˆï¼Œè€Œä¸”ä¸ä»–ç»“ä¸‹äº†ä¸è§£ä¹‹ç¼˜ã€‚è¿™ä½è€å¸ˆç¬¬ä¸€æ¬¡ç»™å…¨ç­åšè‡ªæˆ‘ä»‹ç»çš„æ—¶å€™ï¼Œæœ‰ä¸¤ä»¶äº‹ç»™æˆ‘ç•™ä¸‹äº†æ·±åˆ»çš„å°è±¡ï¼Œä¸€ä»¶äº‹æ˜¯ä»–çš„åå­—ï¼Œå¼ å‘è´¢ã€‚åœ¨æˆ‘ä»¬é‚£ä¸ªåœ°æ–¹ï¼Œæ¯ä¸ªå°å­©çš„åå­—éƒ½æ˜¾å¾—å¾ˆâ€œé€šä¿—â€ï¼Œæ¯”å¦‚æˆ‘æœ‰ä¸ªè¡¨å¼Ÿçš„åå­—å«åšèµµé•¿å¯¿ï¼Œå°å­¦çš„éŸ³ä¹è€å¸ˆå«æé›ªè²ï¼Œæ€»ä¹‹éƒ½æ˜¯çˆ¶æ¯ç”¨å¿ƒè‰¯è‹¦ï¼Œå¸Œæœ›å„¿å¥³ä»¬ä»¥åå¯ä»¥æ´»çš„ç²¾å½©ï¼Œæ´»çš„æ¼‚äº®ï¼Œæ´»çš„æœ‰æ»‹æœ‰å‘³ã€‚\n\n\nä¸€ä»¶äº‹æ˜¯ä»–çš„ç€è£…ï¼Œå°½ç®¡ä»å°çˆ¸å¦ˆå’Œè€å¸ˆéƒ½å‘Šè¯‰æˆ‘ä»¬ä¸åº”è¯¥éšæ„çš„å¯¹åˆ«äººçš„ç©¿ç€ç›¸è²Œè¯„å¤´è®ºè¶³ï¼Œå¯æ˜¯å¼ å‘è´¢è€å¸ˆé‚£æ—¶çš„ç€è£…åœ¨åæ¥å¾ˆé•¿çš„æ—¥å­é‡Œæ·±æ·±åœ°å½±å“äº†æˆ‘çš„å®¡ç¾è§‚ã€‚é‚£æ—¶çš„å¼ è€å¸ˆå…¶å®ä¹Ÿå¾ˆå¹´è½»ï¼Œä¹Ÿè®¸æ˜¯åˆšåˆšä»å“ªä¸ªå¸ˆèŒƒé™¢æ ¡æ¯•ä¸šæ²¡å‡ å¹´ï¼Œè®²è¯¾å¾ˆæœ‰æ¿€æƒ…ã€‚ä½†æ˜¯ä»–ä¸Šçš„ç¬¬ä¸€å ‚è¯¾ç»“æŸåï¼Œå…¨ç­åŒå­¦éƒ½åœ¨è®¨è®ºä»–ä¸ºä»€ä¹ˆæ¢³ç€ä¸€ä¸ªä¸­åˆ†çš„å‘å‹ï¼Œä¸Šèº«ç©¿ç€ä¸€æ¬¾å¾ˆæœ‰å‹çš„å°è¥¿è£…ï¼Œä¸‹èº«å´ç©¿ç€ä¸€ä»¶æ´—çš„å‘ç™½çš„ç‰›ä»”è£¤å’Œä¸€åŒå¸ƒé‹ã€‚å¯¹ä»–èº«ä¸Šè¿™äº›ä¸œè¥¿ï¼Œæ²¡æœ‰ä»»ä½•çš„é„™è§†ï¼Œå› ä¸ºé‚£æ—¶å€™ç­é‡Œå¤§éƒ¨åˆ†äººç©¿çš„éƒ½æ˜¯å¦ˆå¦ˆåšçš„å¸ƒé‹ï¼Œå¾ˆå¤šäººç©¿çš„ç‰›ä»”è£¤ç”šè‡³æ˜¯åœ¨å±è‚¡ä¸Šæ‰“äº†å¥½å‡ å±‚è¡¥ä¸çš„ã€‚æˆ‘ä»¬è¯§å¼‚çš„ä»…ä»…æ˜¯ä»–è¿™ç§æ­é…ï¼Œå½“æ—¶è¿˜æœ‰åŒå­¦è¯´ï¼Œä¹Ÿè®¸å¯èƒ½æ˜¯è€å¸ˆä»Šå¤©çš®é‹åˆšå¥½åäº†ï¼Œè£¤å­æ´—äº†æ²¡å¹²ï¼Œæ‰€ä»¥åªèƒ½æš‚æ—¶å‡‘åˆã€‚åªæ˜¯ï¼Œåœ¨åæ¥å°†è¿‘æ•´æ•´ä¸€å­¦æœŸè¿™æ ·çš„è£…æ‰®åï¼Œæˆ‘ä»¬å½»åº•è¢«æ‰“è´¥äº†ã€‚\n\næ˜¯çš„ï¼Œè¿™å°±æ˜¯å¼ è€å¸ˆï¼Œæ°¸è¿œçš„ä¸­åˆ†å°è¥¿è£…ï¼Œç‰›ä»”è£¤å’Œå¸ƒé‹ã€‚è¿™æ ·çš„è£…æ‰®ï¼Œç›´åˆ°åå¹´åçš„ä»Šå¤©ï¼Œæˆ‘ä¾æ—§æ— æ³•ç†è§£é‚£æ˜¯æ—¶å°šè¿˜æ˜¯åˆ«çš„ä»€ä¹ˆã€‚ä»–çš„è¯¾ä¹Ÿæ˜¯å¦‚åŒä»–çš„è¡£å“ä¸€æ ·ç³Ÿç³•ï¼Œè™½ç„¶æ¯æ¬¡æ€»æ˜¯å¾ˆæœ‰æ¿€æƒ…çš„è®²ç€ï¼Œä»ä»–æ¯æ¬¡å‡†å¤‡çš„é‚£ä¹ˆå¤šèµ„æ–™ï¼Œå¯ä»¥æƒ³è±¡è¯¾ä¸‹çš„ä»–æ˜¯å¤šä¹ˆåŠªåŠ›çš„æƒ³æŠŠä¸€ä¸ªäººæ°‘æ•™å¸ˆçš„å·¥ä½œåšå¥½ï¼Œåªæ˜¯æ¯æ¬¡éƒ½æ˜¯è®©æˆ‘ä»¬ååœ¨å‰æ’çš„è¿™äº›åŒå­¦æ·¹æ²¡åœ¨æ— ç”¨çš„å”¾æ²«å’Œæ— å°½çš„ç²‰ç¬”ç°é‡Œã€‚\n\n\n![](http://upload-images.jianshu.io/upload_images/1115031-3143dba1686d2da8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\né«˜äºŒæ—¶æ–‡ç†ç§‘åˆ†ç­ï¼Œæƒ³ç€ç»ˆäºå¯ä»¥è§£è„±äº†ï¼Œåªæ˜¯å‘½è¿å†ä¸€æ¬¡å®‰æ’æˆ‘ä»¬ç›¸é‡ï¼Œé«˜ä¸­ä¸‰å¹´ç‰©ç†è¯¾å§‹ç»ˆéƒ½æ˜¯ä»–å¸¦ï¼Œå¹¸å¥½æœ‰äº¦å®‰ï¼Œåˆ†ç­ååˆšå¥½å’Œæˆ‘åœ¨ä¸€ä¸ªç­ï¼Œæ‰€ä»¥å¹³æ—¶å°±ä¼šå¯¹æˆ‘åŠ ä»¥è¾…å¯¼ï¼Œæ‰ä½¿æˆ‘çš„ç‰©ç†è€ƒè¯•æˆç»©æ€»èƒ½ç»´æŒåœ¨ä¸€ä¸ªèƒ½è®©è‡ªå·±æ»¡æ„çš„æ°´å¹³ã€‚æˆ‘ä¸çŸ¥é“åæ¥çš„æ—¥å­é‡Œå¼ è€å¸ˆçš„è¡£å“ä¼šä¸ä¼šæœ‰æ‰€æå‡ï¼Œä½†æ˜¯æœ‰ä¸€ä»¶äº‹æˆ‘æ•¢ç¡®å®šï¼Œä»–çš„è¯¾ä¼šè¶Šè®²çº¦å¥½ï¼Œå› ä¸ºä»–æ˜¯ä¸€ä¸ªåŠªåŠ›æƒ³æŠŠè¿™ä»¶äº‹åšå¥½çš„äººã€‚\n\nåˆ†ç­åï¼Œæ‰€æœ‰äººä¼¼ä¹ä¸€ä¸‹å­å°±è¿›å…¥äº†å¤‡æˆ˜é«˜è€ƒçš„çŠ¶æ€ã€‚å¤§å®¶éƒ½æ²¡æœ‰äº†ç©çš„å¿ƒæ€ï¼ŒæŠŠä¸å¾—æŠŠæ‰€æœ‰çš„æ—¶é—´éƒ½ç”¨åœ¨å­¦ä¹ è¿™ä»¶äº‹æƒ…ä¸Šã€‚å‘¨æœ«å›å®¶çš„å…¬äº¤è½¦ä¸Šä¹Ÿåªå‰©ä¸‹æˆ‘å’Œäº¦å®‰äº†ï¼Œæˆ‘ä¿©éƒ½æ˜¯ç‰¹åˆ«æ‹å®¶çš„å­©å­ï¼Œçºµç„¶æ—¶é—´å®è´µä¹Ÿæƒ³å›å®¶çœ‹ä¸€çœ¼çˆ¸å¦ˆï¼Œåƒä¸€å£å¦ˆå¦ˆåšçš„é¥­ã€‚å…¶ä»–äººç¾å…¶åæ›°è¦æŠ“ç´§æ—¶é—´å¤ä¹ ï¼Œä½†æ˜¯çœŸæ­£æŠŠæ—¶é—´èŠ±åœ¨å­¦ä¹ ä¸Šçš„å¯èƒ½ä¹Ÿåªæœ‰éƒ­ç„¶äº†ï¼Œç‹—åœ£è‡ªä»é«˜äºŒçš„æ—¶å€™æ‰¾äº†ä¸ªå¥³æœ‹å‹ï¼Œåœ¨åŠ ä¸Šåˆ†äº†ç­çš„ç¼˜æ•…ï¼Œå°±æ…¢æ…¢ä»æˆ‘ä»¬çš„è§†çº¿é‡Œæ¶ˆå¤±äº†ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬çš„å‹è°Šä¾æ—§åœ°ä¹…å¤©é•¿ï¼Œå¶å°”åœ¨å•æ‰€é‡Œé‡è§äº†ï¼Œä¹Ÿä¼šè°ƒä¾ƒä»–å‡ å¥é‡è‰²è½»å‹ï¼Œè€Œä½œä¸ºæ–‡ç§‘ç”Ÿçš„ä»–ï¼Œæ€»èƒ½å¼•ç»æ®å…¸çš„è®©æˆ‘å“‘å£æ— è¨€ï¼Œè€Œæˆ‘ä¹Ÿåªèƒ½å›æ•¬å‡ å¥ä»–æ°¸è¿œéƒ½ä¸ä¼šç†è§£çš„ç”Ÿç‰©å­¦ä¸“æœ‰æœ¯è¯­ã€‚\n\nå¤©å¤–æœ‰å¤©ï¼Œäººä¸Šæœ‰äººï¼Œéƒ­ç„¶è™½ç„¶ä¸èƒ½åƒåˆä¸­é‚£èˆ¬ç¨³åå…¨å¹´çº§ç¬¬ä¸€çš„å®åº§ï¼Œä½†æ¯æ¬¡æ¨¡æ‹Ÿè€ƒè¯•ä»æ¥æ˜¯æ²¡æœ‰è·Œå‡ºè¿‡å‰ååã€‚ä¾æ—§åƒç¥ä¸€æ ·å­˜åœ¨äºå‡ ä¸ªå°ä¼™ä¼´çš„å†…å¿ƒå½“ä¸­ã€‚ä»–æ€»ä¼šæŠŠå®éªŒç­è€å¸ˆå‘çš„å¤ä¹ èµ„æ–™åˆ†äº«ç»™æˆ‘ä»¬ï¼Œæ¯æ¬¡æœ‰ä¸æ‡‚çš„é—®é¢˜æ‰¾ä»–ï¼Œä¹Ÿä¼šæ¯«ä¸çŠ¹è±«çš„å¸®æˆ‘ä»¬è§£ç­”ï¼Œä¸€å¦‚ä»å‰ï¼Œä½ åœ¨ä»–çš„è„¸ä¸Šçœ‹ä¸åˆ°æ²®ä¸§çš„è¡¨æƒ…ï¼Œä»–æ€»æ˜¯åƒä¸ªå­©å­ä¸€æ ·ï¼Œæ•´å¤©éƒ½å¾ˆå¼€å¿ƒã€‚\n\n07å¹´å†¬å¤©ï¼Œæ­£å¼çš„è¿›å…¥äº†é«˜è€ƒå€’è®¡æ—¶ï¼Œæ¯ä¸ªé«˜ä¸‰æ¯•ä¸šç­æ•™å®¤åé¢é»‘æ¿æŠ¥ä¸Šéƒ½ä¼šæœ‰ç”¨çº¢è‰²çš„ç²‰ç¬”æç»˜çš„è·ç¦»é«˜è€ƒè¿˜æœ‰XXå¤©çš„å¤§å­—ï¼Œå¹¶ä¸”ç”±ç­é•¿è´Ÿè´£æ¯å¤©è¿›è¡Œæ›´æ–°ã€‚é‚£æ˜¯ä¸€æ®µå¾ˆç‰¹åˆ«çš„æ—¶å…‰ï¼Œåªæœ‰ç»å†çš„é‚£æ ·ä¸€æ®µå²æœˆï¼Œä½ æ‰å¯èƒ½çœŸæ­£åœ°æ˜ç™½æ‰€è°“çš„è€ƒåœºå¦‚æˆ˜åœºæ„å‘³ç€ä»€ä¹ˆã€‚åæ¥ä¸Šå¤§å­¦åŒ…æ‹¬å·¥ä½œæ—¶ï¼Œæ¯æ¬¡å’Œåˆ«äººèŠåˆ°é«˜ä¸‰æ—¶ä¸ºé«˜è€ƒå¥‹æˆ˜çš„æ—¥å­ï¼Œæ¯ä¸ªäººçœ¼é‡Œæ€»ä¼šæ˜¾ç°å‡ºæ— å°½çš„è‡ªè±ªï¼Œé‚£æ˜¯å¸¦ç€æ±—æ°´ä¸è‰°è¾›çš„é’æ˜¥å²æœˆã€‚è®¸å¤šäººè¯´é‚£æ˜¯ä¸€æ®µä½ å†ä¹Ÿæ— æ³•ä½“éªŒçš„æ—¥å­ï¼Œåœ¨æ¼«é•¿çš„äººç”Ÿé“è·¯ä¸Šï¼Œä¹Ÿè®¸ä½ è¦è€ƒç ”ï¼Œä¸ºäº†å‡ºå›½è¦è€ƒGRE,è€ƒæ‰˜ç¦â€¦â€¦ï¼Œè¦é¢å¯¹æ–°çš„æŒ‘æˆ˜ï¼Œä½†å†ä¹Ÿä¸èƒ½åƒé«˜ä¸‰é‚£å¹´é‚£ä¹ˆçš„æŠ•å…¥ï¼Œé‚£ä¹ˆçš„å¿ƒæ— æ—éª›ã€‚å› ä¸ºéšç€å¹´é¾„å’Œé˜…å†çš„å¢é•¿ï¼Œæˆ‘ä»¬æ˜ç™½å¾ˆå¤šäº‹çš„é€‰æ‹©ä¸æ˜¯å”¯ä¸€ï¼Œæˆ‘ä»¬æ˜¯æœ‰é€€è·¯çš„ã€‚è€Œä¸”ï¼Œåœ¨æ´»ç€è¿™ä»¶äº‹æƒ…ä¸Šï¼Œæ°¸è¿œéƒ½æ²¡æœ‰ä¸€åŠ³æ°¸é€¸ã€‚\n\né‚£æ—¶å€™å¼€å§‹ï¼Œæˆ‘å’Œäº¦å®‰å›å®¶çš„æ¬¡æ•°ä¹Ÿä»æ¯å‘¨ä¸€æ¬¡ï¼Œå˜æˆäº†æ¯æœˆå›ä¸€æ¬¡ã€‚è¿™ä¹Ÿæ˜¯å„è‡ªçˆ¶æ¯çš„è¦æ±‚ã€‚æŒ‰ç…§äº¦å®‰å¥¹çˆ¸çš„è¯´æ³•å°±æ˜¯ï¼Œèµ·è·‘çº¿ä¸Šæœ‰æ²¡æœ‰è¾“ï¼Œå·²ç»ä¸é‡è¦äº†ï¼Œä½†æ˜¯ä¸€å®šä¸èƒ½è¾“åœ¨æœ€åå†²åˆºçš„é˜¶æ®µã€‚æœˆæœ«å›å®¶çš„é‚£å¤©æ˜¯æˆ‘ä»¬ä¿©æ¯ä¸ªæœˆæœ€å¼€å¿ƒçš„æ—¥å­ï¼Œä¸ä»…æ˜¯å› ä¸ºå¯ä»¥å›å®¶åƒåˆ°å¦ˆå¦ˆåšçš„é¥­ï¼Œæ›´æ˜¯å› ä¸ºå›å®¶çš„è·¯ä¸Šå¯ä»¥å»éŸ³åƒåº—é‡Œå¬æ­Œï¼Œé‚£æ—¶è™½ç„¶MP3å·²ç»å¾ˆæ™®åŠï¼Œä½†æ˜¯å¯¹äºé‚£ä¸ªæ—¶å€™æˆ‘ä»¬ï¼Œé‚£ä¾ç„¶æ˜¯å¥¢ä¾ˆå“ã€‚æ‰€ä»¥å¬æ­Œçš„å”¯ä¸€é€”å¾„å°±æ˜¯å»è·¯è¾¹çš„éŸ³åƒåº—é‡Œæ‰“ç€æŒ‘é€‰ç£å¸¦çš„å¹Œå­åœ¨é‚£é‡Œèµ–ä¸€ä¸ªå°æ—¶ï¼Œå¬å¬æœ€æ–°çš„æµè¡Œæ­Œæ›²ã€‚\n\n\n![](http://upload-images.jianshu.io/upload_images/1115031-4c743623cf910440.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\næˆ‘å’Œäº¦å®‰åˆ°ç°åœ¨éƒ½å¯ä»¥æŠŠã€Šé’èŠ±ç“·ã€‹çš„æ­Œè¯å®Œå®Œæ•´æ•´çš„å†™ä¸‹æ¥ï¼Œé‚£æ˜¯æˆ‘ä»¬åœ¨é‚£æ®µæ—¶é—´å¬å¾—æœ€å¤šçš„æ­Œã€‚åœ¨ä½œä¸ºå‘¨æ°ä¼¦æ­Œè¿·çš„è¿™ä¹ˆå¤šå¹´é‡Œï¼Œè§‰å¾—ã€Šé’èŠ±ç“·ã€‹æ˜¯ä»–ä¸­å›½é£ç±»å‹æ­Œæ›²çš„å·…å³°ä¹‹ä½œï¼ŒåŒæ—¶ä¹Ÿæ˜¯æ–¹æ–‡å±±æ­Œè¯åˆ›ä½œçš„å·…å³°ä¹‹ä½œã€‚ä»å°åˆ°å¤§å­¦äº†é‚£ä¹ˆè¢«å¼ºè¿«èƒŒè¯µå…¨æ–‡è€Œå¦‚ä»Šæ—©å·²å¿˜å¾—ä¸€å¹²äºŒå‡€çš„æ‰€è°“çš„ç»å…¸ä¹‹ä½œï¼Œä¹Ÿæ²¡æœ‰è®©æˆ‘æ„Ÿå—åˆ°ä»»ä½•å¤è¯—è¯ä½œå“çš„ç¾å¦™ï¼Œæ²¡æœ‰æ¿€å‘å¯¹è¯­æ–‡å­¦ä¹ çš„å…´è¶£ï¼Œåè€Œæ˜¯ä¸€ç¯‡æ­Œè¯ã€‚\n\n#### æ—¶é—´è¢«å®‰æ’ï¼Œæ¼”ä¸€åœºæ„å¤–####\n\n08å¹´çš„å…ƒæ—¦ï¼Œå­¦æ ¡ç ´å¤©è’çš„å†³å®šæ”¾å‡ï¼Œè¿™å¯¹äºæ†‹äº†ä¸€æ•´ä¸ªå†¬å¤©çš„æ‰€æœ‰é«˜ä¸‰å…šæ¥è¯´å®Œå…¨å°±æ˜¯ä¸€ä¸ªæƒŠå–œï¼ŒåŒ…æ‹¬è€å¸ˆã€‚æˆ‘å’Œäº¦å®‰å†³å®šè¿˜æ˜¯å›å®¶ï¼Œå› ä¸ºè§‰å¾—åæ­£åœ¨å®¶é‡Œä¹Ÿèƒ½å­¦ä¹ ï¼Œåœ¨å­¦æ ¡å­¦ä¸‰å¤©åè€Œä¸ä¼šæœ‰ä»€ä¹ˆæ•ˆæœã€‚éƒ­ç„¶æœ¬æ¥å°±æ˜¯é‚£ç§å–œæ¬¢å®‰é™çš„äººï¼Œå­¦æ ¡æ”¾å‡äººå°‘äº†åˆšå¥½å¯ä»¥æ”¾æ¾ä¸€ä¸‹èº«å¿ƒï¼Œæ‰€ä»¥å†³å®šä¸å›å®¶ã€‚ç‹—åœ£ä¹Ÿå†³å®šä¸å›å®¶ï¼Œè™½ç„¶å’Œæˆ‘ä»¬ä¸€å†å¼ºè°ƒè¦å®‰å¿ƒå¤ä¹ ï¼Œäº‰å–ä¸‹æ¬¡æ¨¡æ‹Ÿè€ƒèƒ½è¿›å¹´çºªå‰åï¼Œä½†æˆ‘å’Œäº¦å®‰éƒ½çŸ¥é“ä»–ç•™åœ¨å­¦æ ¡ä¸è¿‡æ˜¯ä¸ºäº†é™ªä»–çš„å¥³æœ‹å‹ï¼Œäº¦å®‰æ›´æ˜¯æ— æƒ…çš„å˜²ç¬‘ç‹—åœ£è¿™æ˜¯åª³å¦‡è¿˜æ²¡å¨¶å‘¢ï¼Œå°±å¿˜äº†å¨˜ã€‚\n\n*å¦‚æœæ—¶å…‰èƒ½å¤Ÿå€’æµï¼ŒçœŸçš„æƒ³å›åˆ°08å¹´çš„å…ƒæ—¦ï¼ŒæŠŠéƒ­ç„¶å’Œç‹—åœ£æƒ³å°½ä¸€åˆ‡åŠæ³•çš„æ‹‰å›å®¶ï¼Œå…å¾—ä»–ä»¬æ‰¿å—ä¹‹åçš„ä¸€åˆ‡*\n\næ”¾å®Œå‡å›æ¥çš„é‚£å¤©ä¸‹åˆï¼Œå¸¦ç€éƒ­ç„¶å¾ˆå–œæ¬¢åƒè‘±èŠ±æ²¹é¥¼å»ä»–ä»¬å®¿èˆæ‰¾ä»–ï¼Œè¿™æ˜¯è¿‡å…ƒæ—¦æ—¶æ¯å®¶éƒ½ä¼šåšçš„å¥½ä¸œè¥¿ï¼Œæƒ³è®©æ²¡å›å®¶çš„ä»–è§£è§£é¦‹ï¼Œå¯å´æ²¡æœ‰æ‰¾åˆ°ä»–ï¼ŒåŒå®¿èˆçš„å®¤å‹å‘Šè¯‰æˆ‘è¯´ä»–å›å®¶äº†ï¼Œè®©æˆ‘å¾ˆæ˜¯è¯§å¼‚ã€‚å†å»æ‰¾ç‹—åœ£ï¼Œä¹Ÿæ˜¯åŒæ ·çš„ç»“æœï¼Œè®©æˆ‘åœ¨å†…å¿ƒéšéšæœ‰ä¸€ä¸çš„ä¸å®‰ã€‚æ™šè‡ªä¹ è¯¾é—´ä¼‘æ¯çš„æ—¶å€™ï¼Œæˆ‘å¼€ç©ç¬‘çš„é—®äº¦å®‰ï¼Œâ€œä½ è¯´éƒ­ç„¶å’Œç‹—åœ£ä¸ä¼šæ˜¯ç§å¥”äº†å§â€ã€‚äº¦å®‰é„™è§†çš„çœ‹äº†æˆ‘ä¸€çœ¼è¯´ï¼Œæ€ä¹ˆå¯èƒ½ã€‚å¯æˆ‘ä»¬ä¿©å¿ƒé‡Œéƒ½æœ‰äº›ä¸å®‰ï¼Œå°¤å…¶æ˜¯å¯¹éƒ­ç„¶ã€‚ç¬¬äºŒå¤©æˆ‘ç‰¹æ„å»å®éªŒç­æ‰¾éƒ­ç„¶ï¼Œç»“æœè¢«å‘ŠçŸ¥ä¸€æ•´å¤©éƒ½æ²¡æ¥ä¸Šè¯¾ï¼Œå»ç‹—åœ£å®¿èˆä¹Ÿæ˜¯è¢«å‘ŠçŸ¥ä¸€ç›´æ²¡å›æ¥ï¼Œä¸¤ä¸ªäººå°±åƒçªç„¶å¤±è¸ªäº†ä¸€æ ·ã€‚\n\n\n![](http://upload-images.jianshu.io/upload_images/1115031-c57d1886a18687a3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\nå°±åƒæš´é£é›¨æ¥ä¸´ä¹‹å‰ï¼Œå¤©ç©ºä¼šå˜å¾—é˜´äº‘å¯†å¸ƒï¼Œå½“æˆ‘ä»¬å†…å¿ƒçƒ¦èºæ—¶ï¼ŒçœŸçš„ä¼šæœ‰äº‹æƒ…å‘ç”Ÿã€‚åˆ°äº†ç¬¬ä¸‰å¤©æ—©ä¸Šæ•´ä¸ªé«˜ä¸‰å…šéƒ½åœ¨è¯´ä¸€ä»¶äº‹ï¼Œå®éªŒç­çš„å­¦ç”ŸæŠŠå¹´çº§ä¸»ä»»æ‰“äº†ã€‚é‚£æ®µæ—¶é—´å¤§çº¦æœ‰ä¸€ä¸ªæ˜ŸæœŸï¼Œéƒ½æ²¡æœ‰çœ‹åˆ°éƒ­ç„¶å’Œç‹—åœ£ã€‚å†æ¬¡çœ‹åˆ°ä»–ä¿©çš„æ—¶å€™ï¼Œå®Œå…¨éƒ½è®¤ä¸å‡ºäº†ï¼Œä¸çŸ¥é“ä¸€ä¸ªäººç»å†äº†ä»€ä¹ˆæ‰ä¼šå˜æˆé‚£ä¸ªæ ·å­ï¼Œç‹—åœ£å˜å¾—çœŸåƒä¸€æ¡ç‹—ä¸€æ ·ï¼Œè“¬å¤´å¢é¢ã€‚è€Œéƒ­ç„¶å‘¢ï¼Œæ›´æ˜¯åƒä¸€ä¸‹å­è€äº†åå²ä¼¼çš„ï¼Œçœ‹ä¸åˆ°é‚£ç†Ÿæ‚‰çš„ç¬‘å®¹ã€‚ç›´åˆ°é‚£å¹´é«˜è€ƒç»“æŸï¼Œæˆ‘å§‹ç»ˆä¸çŸ¥é“å…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆï¼ŒåªçŸ¥é“ä¸€ç¾¤å­¦ç”ŸæŠŠå¹´çºªä¸»ä»»æ‰“ä¼¤äº†ï¼Œè¿˜ä½äº†é™¢ï¼Œè¿™ç¾¤å­¦ç”Ÿé‡ŒåŒ…æ‹¬éƒ­ç„¶å’Œç‹—åœ£ã€‚\n\nåæ¥ï¼Œé«˜è€ƒå‰çš„é‚£æ®µæ—¥å­é‡Œå‘ç”Ÿå¾ˆå¤šäº‹ï¼Œéƒ­ç„¶å’Œç‹—åœ£çš„çˆ¶æ¯æ¥è¿‡å­¦æ ¡å¥½å‡ æ¬¡ï¼Œæ¯æ¬¡éƒ½æ˜¯ç›´æ¥å»è¡Œæ”¿æ¥¼ï¼Œä¹Ÿä¸çŸ¥é“å…·ä½“è¯´äº†äº›ä»€ä¹ˆã€‚æƒ³å¿…ä»¥å¾€ï¼Œä»–ä»¬ä¿©éƒ½å˜å¾—å¼‚å¸¸çš„æ²‰é»˜ï¼Œè„¸ä¸Šå¾ˆå°‘å†æœ‰ç¬‘å®¹ã€‚å¤§å®¶å¶å°”åœ¨è·¯ä¸Šç¢°è§ï¼Œä¸€èµ·èŠå¤©çš„æ—¶å€™ï¼Œäº¦å®‰è®²ç¬‘è¯ï¼Œä»–ä»¬ä¿©ä¹Ÿæ˜¯å¼ºé¢œæ¬¢ç¬‘ã€‚éƒ­ç„¶åœ¨åæ¥çš„ä¸¤æ¬¡æ¨¡æ‹Ÿè€ƒè¯•ä¸­ï¼Œæˆç»©ä¸€è½åƒä¸ˆï¼Œç›´æ¥è¢«å…¶ä»–ç­é‡Œæˆç»©æ¯”ä»–å¥½çš„é¡¶æ›¿äº†ä»–åœ¨å®éªŒç­çš„ä½ç½®ï¼Œè¢«åˆ†åˆ°äº†ä¸€ä¸ªæ™®é€šç­ã€‚ç‹—åœ£å‘¢ï¼Œä¹Ÿå˜æˆäº†å•èº«ç‹—ã€‚å¯¹äºéƒ­ç„¶çš„æ€¥é€Ÿé™¨è½ï¼Œæˆ‘å’Œäº¦å®‰éƒ½æ˜¯çœ‹åœ¨çœ¼é‡Œï¼Œæ€¥åœ¨å¿ƒé‡Œï¼Œè€Œä»–æ€»æ˜¯åˆ»æ„èº²é¿æˆ‘ä»¬ï¼Œæƒ³è¦æ‰¾ä»–å¥½å¥½èŠèŠå¾ˆå›°éš¾ã€‚è€Œç‹—åœ£ä¹Ÿæ˜¯åƒåœ¨æ ¡å›­é‡Œæ¶ˆå¤±äº†ä¼¼å¾—ï¼Œå¾ˆéš¾çœ‹è§ä»–çš„èº«å½±ã€‚å»å®¿èˆæ‰¾ä»–ï¼Œä¸æ˜¯åœ¨ç¡è§‰å°±æ˜¯äººä¸åœ¨å®¿èˆã€‚äººåœ¨å¿™ç¢Œçš„æ—¶å€™ï¼Œæ—¶é—´æ€»æ˜¯ä¼šè¿‡çš„ç‰¹åˆ«å¿«ï¼Œè¿‡å®Œå¹´å›æ¥ä¸€ç™¾å¤šå¤©çš„æ—¥å­è½¬ç¬å³é€ï¼Œé«˜è€ƒç»ˆäºæ¥ä¸´ã€‚æˆ‘æ¸…æ¥šçš„è®°å¾—ï¼Œå½“å¹´è€ƒå®Œæœ€åä¸€é—¨è‹±è¯­ï¼Œäº¤å·åä»æ•™å®¤é‡Œå‡ºæ¥çš„é‚£ä¸€åˆ»ï¼Œå¹¶æ²¡æœ‰ä¸€ç§è§£è„±çš„æ„Ÿè§‰ï¼Œå†…å¿ƒåè€Œæ˜¾å¾—ç‰¹åˆ«çš„å¹³é™ï¼Œæç„¶é—´æœ‰ç‚¹ä¸çŸ¥æ‰€æªç½¢äº†ã€‚\n\n\n\näº¦å®‰è¯´ï¼Œé«˜è€ƒç»“æŸåä¸€å®šè¦å›å®¶å¥½å¥½ç¡ä¸Šä¸€æ˜ŸæœŸï¼ŒæŠŠè¿™åŠå¹´ç¼ºçš„è§‰éƒ½è¦è¡¥å›æ¥ã€‚\n\n\n![](http://upload-images.jianshu.io/upload_images/1115031-aa37e8820139a681.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\né«˜è€ƒç»“æŸåï¼Œç­‰åˆ†æ•°çš„é‚£æ®µæ—¥å­ä¹Ÿæ˜¯å……æ»¡ç…ç†¬ï¼Œå°¤å…¶æ˜¯å¯¹äºç‹—åœ£ï¼Œæœ€åä¸¤æ¬¡æ¨¡æ‹Ÿè€ƒçš„åˆ†æ•°è·³è·ƒæŒºå¤§ï¼Œè®©ä»–å¯¹è‡ªå·±çš„çŠ¶æ€ä¹Ÿæ˜¯æœ‰äº›æ€€ç–‘ï¼Œè€Œä¸”æ–‡ç§‘è€ƒè¯•ä¸åƒç†ç§‘ï¼Œæœ‰å¤ªå¤šçš„ä¸ç¡®å®šã€‚é‚£æ—¶å€™çš„æˆ‘ä»¬éƒ½æ²¡æœ‰æ‰‹æœºï¼Œæ›´åˆ«æä¸Šç½‘äº†ã€‚æ‰€ä»¥æŸ¥æˆç»©çš„å”¯ä¸€é€”å¾„å°±æ˜¯æ‰“æœ‰çº¿ç”µè¯ã€‚\n\næˆç»©å…¬å¸ƒçš„é‚£å¤©ï¼Œæˆ‘å’Œç‹—åœ£æ—©æ—©çš„æ¥åˆ°äº†é•‡ä¸Šçš„å°è¶…å¸‚ï¼Œæƒ³ç”¨é‚£é‡Œçš„å”¯ä¸€çš„å…¬ç”¨ç”µè¯æŸ¥æˆç»©ï¼Œå»çš„è·¯ä¸Šç‹—åœ£è¿˜è·Ÿæˆ‘è¯´ï¼Œè¦è®©ä»–å…ˆæŸ¥ï¼Œä¸è®¸è·Ÿä»–æŠ¢ï¼Œç»“æœåˆ°äº†é‚£åˆå¼€å§‹çŠ¹è±«ï¼Œè®©æˆ‘å…ˆæŸ¥ï¼›æˆ‘çš„æˆç»©æ¯”å‡ æ¬¡æ¨¡æ‹Ÿè€ƒè¯•è¿˜é«˜ç‚¹ï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯æœ‰ç‚¹åº†å¹¸è‡ªå·±æœ‰ç‚¹å°å°çš„è¶…å¸¸å‘æŒ¥ã€‚è½®åˆ°ç‹—åœ£çš„æ—¶å€™ï¼Œå§‹ç»ˆåœ¨é‚£é‡Œç£¨ç£¨å”§å”§ï¼Œæœ€åè¿˜æ˜¯æˆ‘å¸®ä»–æŸ¥ï¼Œå½“æˆ‘æŒ‰ä¸‹å…æé”®åˆ†æ•°ä»ç”µè¯æœºé‡ŒæŠ¥å‡ºæ¥çš„é‚£ä¸€åˆ»ï¼Œæˆ‘åœ¨ç‹—åœ£è„¸ä¸Šå†æ¬¡çœ‹åˆ°äº†é‚£ä»½ä¹…è¿çš„çº¯çœŸç¬‘å®¹ã€‚\n\n\n\næˆ‘å’Œäº¦å®‰å¾ˆå¤šæ¬¡éƒ½é—®è¿‡ç‹—åœ£å’Œéƒ­ç„¶é‚£æ¬¡åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Œåªæ˜¯ä»–ä»¬ä¿©æ°¸è¿œéƒ½æ˜¯è½¬ç§»è¯é¢˜ï¼Œé¿è€Œä¸è°ˆã€‚é‚£å¤©å›å»çš„è·¯ä¸Šï¼Œç‹—åœ£ç»ˆäºæŠŠä¸€åˆ‡éƒ½å‘Šè¯‰äº†æˆ‘ã€‚äº‹æƒ…å…¶å®å¾ˆç®€å•ï¼Œå‡ ä¸ªç”·ç”Ÿåœ¨å®¿èˆé‡Œçœ‹é»„è‰²æ‚å¿—è¢«æ°å¥½æŸ¥å¯çš„å¹´çº§ä¸»ä»»å‘ç°ï¼Œå¹´çºªä¸»ä»»è¦æ²¡æ”¶ä¹¦ï¼Œå‡ ä¸ªäººç¢äºé¢å­ä¸æ„¿æ„æŠŠä¹¦äº¤å‡ºæ¥ï¼Œä¸»ä»»ä¸€å¼€å§‹ä¸çŸ¥é“æ˜¯è‰²æƒ…æ‚å¿—ï¼Œæƒ³æ²¡æ”¶æ²¡æˆåŠŸï¼Œåè€Œæ¿€å‘ä»–çš„å¥½å¥‡å¿ƒï¼Œæ­»æ´»éƒ½è¦è®©å‡ ä¸ªäººæŠŠä¹¦äº¤å‡ºæ¥ï¼Œå‡ ä¸ªç”·ç”Ÿä¸æ„¿æ„ã€‚ä¸€æ¥äºŒå»ä¾¿å‘ç”Ÿäº†è‚¢ä½“å†²çªï¼Œå…¶å®è°éƒ½æ²¡æœ‰æƒ³ç€åŠ¨æ‰‹å»æ‰“äººï¼Œæ¯•ç«Ÿæ˜¯è€å¸ˆã€‚åªæ˜¯åœ¨æ··ä¹±ä¸­ä¸çŸ¥è°æ¨äº†ä¸€æŠŠï¼Œå¹´çºªä¸»ä»»å¤´æ’åœ¨äº†çª—æˆ·çš„æ£±è§’ä¸Šæµäº†è¡€ï¼Œå‡ ä¸ªäººèµ¶ç´§æ‰¶ç€å¹´çº§ä¸»ä»»å»äº†æ ¡åŒ»é™¢ï¼Œè€Œè¿™æ¬¡æ„å¤–å°±æ…¢æ…¢å‘é…µæˆäº†å‡ ä¸ªå­¦ç”ŸæŠŠå¹´çºªä¸»ä»»æ‰“ä¼¤äº†è¿™æ ·ä¸€ä»¶äº‹æƒ…ã€‚å‡ºäº‹ä¹‹åï¼Œå‡ ä¸ªå­¦ç”Ÿçš„å®¶é•¿éƒ½è¢«å«åˆ°äº†å­¦æ ¡ï¼Œæ ¡æ–¹å¯¹äºè¿™ä»¶äº‹å¾ˆæ˜¯æ„¤æ€’ï¼Œä¸€å¼€å§‹è¯´æ˜¯è¦å¼€é™¤è¿™å‡ ä¸ªå­¦ç”Ÿï¼Œåæ¥å‡ ä¸ªå®¶é•¿å„ç§æ±‚æƒ…ï¼Œæœ€ç»ˆæ‰å†³å®šç•™æ ¡å¯Ÿçœ‹ã€‚ç‹—åœ£è¯´ï¼Œè¿™ä»¶äº‹æœ€å¯¹ä¸èµ·çš„äººæ˜¯è‡ªå·±çš„çˆ¶æ¯ï¼Œåœ¨å‡ºäº‹çš„é‚£æ®µæ—¶é—´çˆ¶æ¯ä¼¼ä¹ä¸€ä¸‹å­è€äº†è®¸å¤šï¼Œæ‰€ä»¥ï¼Œè¿™æ¬¡é«˜è€ƒè‡ªå·±ä¸€å®šè¦è€ƒå¥½ï¼Œå†ä¹Ÿä¸èƒ½è®©ä»–ä»¬å¤±æœ›ã€‚\n\n08å¹´ç§‹å¤©ï¼Œæˆ‘å’Œäº¦å®‰å»äº†åŒ—äº¬ä¸Šå¤§å­¦ï¼Œç‹—åœ£é€‰æ‹©å»äº†è¥¿å®‰ï¼Œéƒ­ç„¶å»äº†å—æ–¹ä¸€åº§ä¸çŸ¥åçš„é™¢æ ¡ã€‚æˆ‘ä»¬æ‰€æœ‰äººå¯¹ä¸ºä»–æ„Ÿåˆ°æƒ‹æƒœï¼Œè¿™æœ¬ä¸è¯¥æ˜¯å±äºä»–çš„å‘½è¿ï¼Œä»–å¯æ˜¯å½“å¹´æˆ‘ä»¬å¿ƒä¸­çš„ç¥å•Šã€‚å—ç¾æ´²çš„è´è¶ç…½ä¸€ä¸‹ç¿…è†€ï¼Œé€šè¿‡ç§ç§å› ç´ ï¼Œå°±å¯èƒ½å¼•èµ·äºšæ´²åœ°åŒºçš„ä¸€é˜µå°é£ï¼Œæœ‰äº›å°äº‹ï¼Œä¼šç»™æˆ‘ä»¬åŸæœ¬å¹³é™çš„ç”Ÿæ´»å¸¦æ¥ä¸€äº›æ³¢æŠ˜ã€‚\n\n![](http://upload-images.jianshu.io/upload_images/1115031-971f7671a9f30df9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\nåœ¨åæ¥å¾ˆå¤šçš„æ—¥å­é‡Œï¼Œæˆ‘æ€»ä¼šå»å¹»æƒ³ï¼Œå¦‚æœå½“å¹´çš„ä¸€åˆ‡éƒ½æ²¡æœ‰å‘ç”Ÿï¼Œç°åœ¨çš„éƒ­ç„¶ä¼šæ˜¯ä»€ä¹ˆæ ·å­ã€‚å¾ˆå¤šæ—¶å€™ï¼Œéƒ½è§‰å¾—è¿™å°±æ˜¯å‘½è¿ï¼Œç”Ÿæ´»ä¸­æ€»æœ‰äº›æˆ‘ä»¬æ— èƒ½ä¸ºåŠ›çš„äº‹æƒ…ã€‚ä»ã€Šé‚£äº›å¹´ï¼Œæˆ‘ä»¬ä¸€èµ·è¿½è¿‡çš„å¥³å­©ã€‹åˆ°ã€Šè‡´æˆ‘ä»¬ç»ˆå°†é€å»çš„é’æ˜¥ã€‹ï¼Œå†åˆ°åæ¥çš„ã€ŠåŒ†åŒ†é‚£å¹´ã€‹ï¼Œä»»ä½•ä¸€ä¸ªæ•…äº‹ï¼Œä½†å‡¡æ¶‰åŠåˆ°é’æ˜¥ï¼Œæ€»ä¼šæˆ–å¤šæˆ–å°‘çš„ç»™æˆ‘ä»¬å¸¦æ¥äº›è®¸å…±é¸£ã€‚ä½†æ€»æ˜¯å°‘ä¸€äº›æ„ŸåŒèº«å—çš„æˆåˆ†ï¼Œç›´åˆ°ã€Šæˆ‘çš„å°‘å¥³æ—¶ä»£ã€‹çš„å‡ºç°ã€‚å½“æ—çœŸå¿ƒä¸ºäº†è®©å¾å¤ªå®‡å˜å›ä»å‰çš„å¾å¤ªå®‡ï¼Œä¸é¡¾ç–¼ç—›çš„ç©¿ç€æ—±å†°é‹è·‘å‘ç»ˆç‚¹æ—¶ï¼Œæˆ‘ç¬é—´å°±æƒ³åˆ°äº†éƒ­ç„¶ã€‚é‚£æ—¶çš„éƒ­ç„¶æ²¡æœ‰å¾å¤ªå®‡å¹¸è¿ï¼Œæ²¡æœ‰é‡è§ä»–çš„â€œæ—çœŸå¿ƒâ€ã€‚å¹´å°‘çš„æˆ‘ä»¬ï¼Œæ€»ä¼šçŠ¯é”™ï¼Œæ€»ä¼šåœ¨æˆé•¿çš„é“è·¯ä¸Šè¯¯å…¥æ­§é€”ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬åªæ˜¯ä¸å°å¿ƒè¿·å¤±äº†æ–¹å‘ï¼Œä¸§å¤±äº†ä¿¡å¿ƒï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬çœŸçš„éœ€è¦æœ‰ä¸ªäººèƒ½è®©æˆ‘ä»¬é‡æ–°å›åˆ°æ­£ç¡®çš„è½¨é“ã€‚\n\n2016å¹´çš„å¤å¤©ï¼Œéƒ­ç„¶æ¥åŒ—äº¬ç©ï¼Œæ™šä¸Šæˆ‘ä»¬åœ¨ç°‹è¡—åƒå°é¾™è™¾ï¼ŒèŠèµ·å³å°†åˆ°æ¥çš„é«˜è€ƒï¼Œéƒ­ç„¶è¯´ï¼Œå½“å¹´é«˜è€ƒå¤±åˆ©çœŸçš„ä»¥ä¸ºè¿™è¾ˆå­å°±è¿™ä¹ˆå®Œäº†ï¼Œåˆ°äº†å¤§å­¦æ…¢æ…¢å‘ç°ï¼Œäººç”Ÿä¸æ­¢çœ¼å‰çš„è‹Ÿä¸”ï¼Œè¿˜æœ‰è¯—ä¸è¿œæ–¹çš„è‹Ÿä¸”ã€‚æˆ‘è¯´ï¼Œé ï¼Œä½ æ˜¯ä¸æ˜¯å–é†‰äº†ã€‚æˆ‘ä»¬ä¿©ä¸€èµ·å¼€å§‹å“ˆå“ˆå¤§ç¬‘ã€‚\n\n\n***\n\n\n\n\n\n\n","tags":["ç”Ÿæ´»ï¼Œç†æƒ³"],"categories":["è¯—ä¸è¿œæ–¹"]},{"title":"Android View äº‹ä»¶åˆ†å‘è®°å½•","url":"%2F2016%2F05%2F07%2FAndroid%20View%E4%BA%8B%E4%BB%B6%E8%AE%B0%E5%BD%95%2F","content":"\n# Viewåˆæ¢ #\n\n\n> ä¸€ç›´ä»¥æ¥å¯¹Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶å¾ˆæ™•ï¼Œä»Šå¤©å°±åœ¨è¿™é‡Œæ¢³ç†ä¸€ä¸‹\n\n\n<!--more-->\n\n## MyView ##\n\n### é¦–å…ˆç»§æ‰¿Viewç±»ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªMyViewã€‚å¹¶åœ¨åˆå§‹åŒ–æ—¶æ‰“å°Viewç±»æ˜¯å¦å¯ç‚¹å‡»ï¼Œè¿™é‡Œä»Viewç‚¹å‡»äº‹ä»¶åˆ†å‘çš„è§’åº¦å‡ºå‘ï¼Œæ‰€ä»¥ä¸è€ƒè™‘ç»˜åˆ¶ï¼Œæµ‹é‡ç›¸å…³æ–¹æ³•çš„å®ç°ã€‚ ###\n\n    public class MyView extends View {\n    String TAG = \"Activity\";\n\n    public MyView(Context context) {\n        super(context);\n        init();\n    }\n\n\n    public MyView(Context context, AttributeSet attrs) {\n        super(context, attrs);\n        init();\n    }\n\n    public MyView(Context context, AttributeSet attrs, int defStyleAttr) {\n        super(context, attrs, defStyleAttr);\n        init();\n    }\n\n    private void init() {\n        Log.e(TAG, \"the View clickable is \" + isClickable());\n    }\n\n}\n\nå°†æ•´ä¸ªMyViewæ”¾ç½®åˆ°å¸ƒå±€æ–‡ä»¶ä¸­ï¼Œçœ‹Logæ—¥å¿—ã€‚\n\n    <engineer.test.MyView\n        android:id=\"@+id/myview\"\n        android:layout_width=\"150dp\"\n        android:layout_height=\"150dp\"\n        android:layout_centerInParent=\"true\"\n        android:background=\"#ff00ff\" />\n\n\n**å¯ä»¥çœ‹åˆ°ï¼ŒViewç±»é»˜è®¤æ˜¯ä¸å¯ç‚¹å‡»çš„ã€‚**\n\n## ç›‘å¬Viewçš„Touchäº‹ä»¶ ##\n\n> è¿™é‡Œé¦–å…ˆæ˜ç¡®MotionEventä¸­äº‹ä»¶æ‰€å¯¹åº”çš„å€¼\n\n    public static final int ACTION_DOWN= 0;\n    public static final int ACTION_UP= 1;\n    public static final int ACTION_MOVE= 2\n\n\n> ç»™MyViewè®¾ç½®OnTouchListenerï¼Œå¹¶æ‰“å°äº‹ä»¶æ—¥å¿—\n\n    myView = (MyView) findViewById(R.id.myview);\n        myView.setOnTouchListener(new View.OnTouchListener() {\n            @Override\n            public boolean onTouch(View v, MotionEvent event) {\n                Log.e(TAG, \"myview_onTouch---->\"+event.getAction());\n                return false;\n            }\n        });\n\nç‚¹å‡»ä¸€ä¸‹MyViewçœ‹æ—¥å¿—ï¼š\n\n\n\n**å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œåªæœ‰ACTION_DOWNäº‹ä»¶å‘ç”Ÿ**\n\n> ç»™MyViewè®¾ç½®OnClickListenerï¼Œå¹¶æ‰“å°æ—¥å¿—\n\n    myView.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                Log.e(TAG, \"the View clickable is \" + myView.isClickable());\n                Log.e(TAG, \"myview_onClick\");\n            }\n        });\n\nç‚¹å‡»ä¸€ä¸‹MyViewçœ‹æ—¥å¿—ï¼š\n\n**å¯ä»¥çœ‹åˆ°ï¼Œè®¾ç½®ClickListenerä¹‹åï¼š**\n\n*  MyViewç›´æ¥ç”±ä¸€ä¸ªä¸å¯ç‚¹å‡»çš„æ§ä»¶å˜æˆäº†å¯ç‚¹å‡»æ§ä»¶ï¼ŒisClickableè¿”å›trueã€‚\n*  ACTION_DOWNå’ŒACTION_UPäº‹ä»¶éƒ½å‘ç”Ÿäº†ã€‚\n*  Touchäº‹ä»¶å…ˆäºClickäº‹ä»¶å‘ç”Ÿã€‚\n\n\næˆ‘ä»¬çœ‹åˆ°TouchListenerçš„onTouchæ–¹æ³•æ˜¯æœ‰è¿”å›å€¼ï¼Œè€Œä¸”é»˜è®¤è¿”å›ä¸ºfalseï¼Œæˆ‘ä»¬å°†å…¶æ”¹ä¸ºtrueï¼Œç„¶åç‚¹å‡»MyViewçœ‹æ—¥å¿—ï¼š\n\n\n**å¯ä»¥çœ‹åˆ°ï¼Œå¤šæ¬¡ç‚¹å‡»MyViewåï¼ŒClickæ–¹æ³•æ²¡æœ‰æ‰§è¡Œï¼Œå³onTouchäº‹ä»¶è¿”å›trueæ—¶ï¼Œç›¸å½“äºå±è”½äº†clickäº‹ä»¶çš„å‘ç”Ÿ**\n\n## Viewæºç åˆ†æ ##\n\næ ¹æ®ä¸Šé¢æ‰€è·å¾—çš„ä¸€ç³»åˆ—ç»“è®ºï¼Œæˆ‘ä»¬å»çœ‹Viewä¸­å…³äºäº‹ä»¶åˆ†å‘çš„ä¸¤ä¸ªæ–¹æ³•dispatchTouchEventå’ŒonTouchEventã€‚\n\n\n\n> é¦–å…ˆçœ‹dispatchTouchEventï¼Œå› ä¸ºé¦–å…ˆæ‰§è¡Œçš„ä¹Ÿæ˜¯è¿™ä¸ªæ–¹æ³•\n\n### API æ³¨é‡Š ###\n\n> /**\n     * Pass the touch screen motion event down to the target view, or this\n     * view if it is the target.\n     *\n     * @param event The motion event to be dispatched.\n     * \n     * @return True if the event was handled by the view, false otherwise.\n     */\n\nä»æ³¨é‡Šå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›trueå°±æ˜¯å½“å‰viewè¦å¤„ç†æ­¤æ¬¡äº‹ä»¶ã€‚\n\n### dispatchTouchEventæºç ï¼ˆæˆªå–ä¸»è¦å†…å®¹ï¼‰ ###\n\n    public boolean dispatchTouchEvent(MotionEvent event) {      \n        boolean result = false;        \n        if (onFilterTouchEventForSecurity(event)) {\n            //noinspection SimplifiableIfStatement\n            ListenerInfo li = mListenerInfo;\n            if (li != null && li.mOnTouchListener != null\n                    && (mViewFlags & ENABLED_MASK) == ENABLED\n                    && li.mOnTouchListener.onTouch(this, event)) {\n                result = true;\n            }\n\n            if (!result && onTouchEvent(event)) {\n                result = true;\n            }\n        }\n\n        \n        return result;\n    }\n\n**å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œé»˜è®¤çš„è¿”å›å€¼é»˜è®¤æ˜¯false**\n\n* é¦–å…ˆï¼ŒonFilterTouchEventForSecurityæ–¹æ³•æ£€æµ‹ï¼Œç‚¹å‡»äº‹ä»¶æ˜¯å¦ç¡®å®å‘ç”Ÿåœ¨å½“å‰viewä¸Šï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œviewå°±ä¼šå¤„ç†å½“å‰ç‚¹å‡»äº‹ä»¶ï¼Œå¦åˆ™çš„è¯å°±ç›´æ¥è¿”å›falseä¸å»å¤„ç†æ­¤æ¬¡äº‹ä»¶ã€‚\n* æ¥ç€ï¼Œå½“viewçš„touchListenerä¸ä¸ºnull,ä¸”Viewæ˜¯enableï¼Œå¹¶ä¸”touchListenerçš„onTouchæ–¹æ³•è¿”å›trueæ—¶ï¼Œresult=true,è¿™æ ·ä¸‹é¢çš„ifè¯­å¥ä¸­onTouchEventæ–¹æ³•å°±ä¸ä¼šæ‰§è¡Œï¼Œè¿™æ ·onClickæ–¹æ³•å°±ä¸ä¼šè°ƒç”¨äº†ï¼Œè¿™ä¹Ÿå’Œä¹‹å‰æµ‹è¯•çš„ç»“æœä¸€è‡´ã€‚\n\nä½†æ˜¯**æ­£å¸¸æƒ…å†µä¸‹ï¼ŒonTouchæ–¹æ³•æ˜¯è¿”å›false**çš„ï¼Œæ‰€ä»¥ä¸‹é¢å°±ä¼šæ‰§è¡Œåˆ°onTouEventæ–¹æ³•ä¸­å»äº†ã€‚\n\n\n### onTouchEventæºç ï¼ˆæˆªå–ï¼‰ ###\n\n    public boolean onTouchEvent(MotionEvent event) {\n        final float x = event.getX();\n        final float y = event.getY();\n        final int viewFlags = mViewFlags;\n        final int action = event.getAction();\n\n\n        //viewä¸æ˜¯enableæ—¶ï¼Œä¹Ÿä¼šæ¶ˆè€—touchäº‹ä»¶ï¼Œåªæ˜¯å°±æ­¤è¿”å›ï¼Œä¸ä¼šè¿›å…¥\n        //åˆ°performClick()æ–¹æ³•ä¸­\n        if ((viewFlags & ENABLED_MASK) == DISABLED) {\n            if (action == MotionEvent.ACTION_UP && (mPrivateFlags & PFLAG_PRESSED) != 0) {\n                setPressed(false);\n            }\n            // A disabled view that is clickable still consumes the touch\n            // events, it just doesn't respond to them.\n            return (((viewFlags & CLICKABLE) == CLICKABLE\n                    || (viewFlags & LONG_CLICKABLE) == LONG_CLICKABLE)\n                    || (viewFlags & CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE);\n        }\n\n        if (mTouchDelegate != null) {\n            if (mTouchDelegate.onTouchEvent(event)) {\n                return true;\n            }\n        }\n\n        if (((viewFlags & CLICKABLE) == CLICKABLE ||\n                (viewFlags & LONG_CLICKABLE) == LONG_CLICKABLE) ||\n                (viewFlags & CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE) {\n            switch (action) {\n                case MotionEvent.ACTION_UP:\n                    boolean prepressed = (mPrivateFlags & PFLAG_PREPRESSED) != 0;\n                    if ((mPrivateFlags & PFLAG_PRESSED) != 0 || prepressed) {\n                        // take focus if we don't have it already and we should in\n                        // touch mode.\n                        boolean focusTaken = false;\n                        if (isFocusable() && isFocusableInTouchMode() && !isFocused()) {\n                            focusTaken = requestFocus();\n                        }\n                            // Only perform take click actions if we were in the pressed state\n                            if (!focusTaken) {\n                                // Use a Runnable and post this rather than calling\n                                // performClick directly. This lets other visual state\n                                // of the view update before click actions start.\n                                if (mPerformClick == null) {\n                                    mPerformClick = new PerformClick();\n                                }\n                                if (!post(mPerformClick)) {\n                                    performClick();\n                                }\n                            }\n                    }\n                    break;\n            }\n            //switchå®Œæ¯•åï¼Œæœ€ç»ˆä¼šè¿”å›true\n            return true;\n        }\n        //å¦‚æœclickï¼Œlongclickä»¥åŠcontextClickableéƒ½ä¸ºfalseæ—¶ï¼Œè¿”å›false\n        return false;\n    }\n\n\n\n**å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªæ­£å¸¸çš„veiwï¼ˆå³enableæ—¶ï¼‰ï¼Œå­˜åœ¨ç‚¹å‡»äº‹ä»¶æ—¶ï¼Œåœ¨ACTION_UPçš„æ—¶å€™ï¼Œæœ€ç»ˆä¼šè¿›å…¥performclick()è¿™ä¸ªæ–¹æ³•ä¸­å»**\n\nå¯ä»¥å†çœ‹ä¸€ä¸‹ï¼Œperformanceclickæ–¹æ³•çš„å®ç°\n\n    public boolean performClick() {\n        final boolean result;\n        final ListenerInfo li = mListenerInfo;\n        if (li != null && li.mOnClickListener != null) {\n            playSoundEffect(SoundEffectConstants.CLICK);\n            li.mOnClickListener.onClick(this);\n            result = true;\n        } else {\n            result = false;\n        }\n\n        sendAccessibilityEvent(AccessibilityEvent.TYPE_VIEW_CLICKED);\n        return result;\n    }\n\næœ€ç»ˆä¼šæ‰§è¡ŒonClickListenerä¸­çš„onClickæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å¹³å¸¸æˆ‘ä»¬å»å®ç°çš„é‚£ä¸ªæ–¹æ³•ã€‚\n\n**åŒæ—¶ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°å¯ä»¥clickable,longclickableä»¥åŠcontextclickableä¸­åªè¦æœ‰ä¸€ä¸ªä¸ºtrueï¼Œé‚£ä¹ˆåœ¨switchæœ€åä¹Ÿä¼šè¿”å›trueï¼Œè¿™æ ·è¿”å›åˆ°ä¸Šé¢çš„dispatchTouchEventæ–¹æ³•ï¼Œè¿”å›resultä¹Ÿä¸ºtrueï¼Œå³å®Œæ•´çš„æ¶ˆè€—ï¼ˆå¤„ç†ï¼‰äº†æ­¤æ¬¡touchäº‹ä»¶**ã€‚\n\nè¿™é‡Œå¯ä»¥è‡ªå·±å»çœ‹ä¸€ä¸‹æºç ï¼Œæ•´ä½“ç»“æ„ä¸Šå°±æ˜¯ä¸€æ—¦è¿›å…¥ifè¯­å¥å†…éƒ¨ï¼Œswitchæ‰§è¡Œå®Œæ¯•åï¼Œreturn trueï¼›\n\n***å½“ç„¶ï¼Œå¦‚æœclickable,longclickableä»¥åŠcontextclickableè¿™ä¸‰ä¸ªéƒ½ä¸ºfalseæ—¶ï¼Œå°±ä¸ä¼šè¿›å…¥ifè¯­å¥ï¼Œç›´æ¥è¿”å›ä¸ºfalseï¼ŒdispatchTouchEventæ–¹æ³•çš„è¿”å›ä¹Ÿä¸ºfalseï¼Œå³è¡¨ç¤ºæ²¡æœ‰å¤„ç†æ­¤æ¬¡touchäº‹ä»¶***\n\n\nå¥½äº†ï¼Œè¿™æ ·ç»ˆäºç†æ¸…äº†View(ä¸åŒ…æ‹¬ViewGroup)çš„äº‹ä»¶åˆ†å‘æœºåˆ¶ã€‚\n\n> æœ€ç»ˆå¾—å‡ºä¸‹é¢ç»“è®ºï¼š\n\n**Viewæ¥æ”¶åˆ°Touchäº‹ä»¶æ—¶å„ä¸ªæ–¹æ³•æ‰§è¡Œé¡ºåº**\n\nonTouch-->onTouchEvent-->onClick  \n\n**onTouché»˜è®¤è¿”å›falseï¼Œè¿”å›trueæ—¶åç»­äº‹ä»¶æ— æ³•æ‰§è¡Œ**\n\n**dispatchTouchEventè¿”å›trueè¡¨ç¤ºå¤„ç†äº†touchäº‹ä»¶ï¼Œè¿”å›ç»“æœå—onTouchEventæ–¹æ³•å½±å“**\n\n**onTouchEventè¿”å›trueè¡¨ç¤ºå·²æ¶ˆè€—touchäº‹ä»¶ï¼Œå¦åˆ™çš„è¯ä¸æ¶ˆè€—ã€‚**\n\n**view enableå±æ€§çš„trueå’Œfalseï¼Œä¸èƒ½å®Œå…¨å†³å®štouchäº‹ä»¶çš„ä¼ é€’ï¼Œè¿˜å¾—è€ƒè™‘å…¶listener**\n\n\n\n***","tags":["Android Touch äº‹ä»¶åˆ†å‘"],"categories":["Android åŸºç¡€"]},{"title":"2016 booklist","url":"%2F2016%2F03%2F01%2F2016-booklist%2F","content":"\n- å¤§ä»²é©¬-åŸºç£å±±ä¼¯çˆµ Done\n- éŸ©å¯’-One ç³»åˆ— Done\n- éƒ­æ•¬æ˜-å¤è‡³æœªè‡³ Done\n- å´æ‰¿æ©-è¥¿æ¸¸è®° Done","tags":["è¯»ä¹¦"]},{"title":"ä½ çš„ç”Ÿæ´»ä¼šå˜æˆä»€ä¹ˆæ ·å­","url":"%2F2013%2F08%2F19%2F%E4%BD%A0%E7%9A%84%E7%94%9F%E6%B4%BB%E4%BC%9A%E5%8F%98%E6%88%90%E4%BB%80%E4%B9%88%E6%A0%B7%E5%AD%90%2F","content":"\n\nåœ¨åŒ—äº¬ä¸Šå­¦å››å¹´ï¼Œæ¯•ä¸šåæ‰å‘ç°ï¼ŒåŸæ¥è¿™é‡ŒçœŸçš„å¾ˆçƒ­ã€‚\n\né‚£å¤©åœ¨å¾®åšä¸Šçœ‹åˆ°ä¸€ä¸ªæ®µå­ï¼Œæ„Ÿè§‰æŒºæç¬‘ã€‚è¯´æ˜¯æŸå¸‚é«˜è€ƒçŠ¶å…ƒå¡«æŠ¥å¿—æ„¿ï¼Œæ‰€å¡«çš„ç¬¬ä¸€å¿—æ„¿æ˜¯â€œåŒ—äº¬æœ‰ç©ºè°ƒå¤§å­¦â€ï¼Œå…¶åä¾æ¬¡æ‰æ˜¯xxå¤§å­¦ï¼ˆä¼ è¯´ä¸­çš„å›½å†…åç‰Œå¤§å­¦ï¼‰ã€‚è¿™å½“ç„¶åªæ˜¯è°ƒä¾ƒåŒ—äº¬çš„å¤©æ°”ï¼Œæ•…äº‹çš„çœŸå‡å€’æ˜¯å…¶æ¬¡ã€‚ä½†åŒ—äº¬çš„çƒ­çœŸæ˜¯å¿«åˆ°è®©äººæ— æ³•å¿å—çš„åœ°æ­¥äº†ã€‚\n\n<!--more-->\n\nå¤œé‡Œå®åœ¨æ˜¯å¤ªçƒ­ï¼ŒèšŠå­åˆå¤šï¼Œæ‰€ä»¥å†³å®šæ”¾å¼ƒæ—©ç¡ï¼Œ23:00çˆ¬èµ·æ¥ï¼Œæ‰“å¼€ç”µè„‘å¼€å§‹ç»§ç»­çœ‹ã€Šnikitaã€‹ã€‚MaggieQæ‰“æ¶çš„èº«å½±ä¾æ—§é‚£ä¹ˆæ€§æ„Ÿï¼Œè™½ç„¶é±¼å°¾çº¹å·²ç»çˆ¬ä¸Šäº†çœ¼è§’ï¼Œåªæ˜¯æƒ…èŠ‚çš„å‘å±•çœŸæ˜¯è®©æˆ‘åˆæœ‰äº†ç¡æ„ï¼Œå¯æ˜¯æˆ‘èººä¸‹ä¹‹ååœ¨æ±—æ°´å’ŒèšŠå­çš„æ‘§æ®‹ä¸‹åˆä¸€æ¬¡çˆ¬äº†èµ·æ¥ã€‚ç‚¹å¼€æ–°æµªä½“è‚²ï¼Œæ—¶é—´æ‰æ˜¯å…­æœˆä»½ï¼Œæ¬§æ´²äº”å¤§è”èµ›æ­£åœ¨ä¼‘æ¯ï¼Œä¹Ÿæ²¡å•¥çƒèµ›å¯çœ‹ã€‚ç»§ç»­çç‚¹ï¼Œæ‰“å¼€äº†å¥½ä¹…æ²¡ä¸Šçš„äººäººï¼Œå†³å®šå»çœ‹çœ‹é‚£äº›å¥½ä¹…æ²¡è§çš„åŒå­¦ä»¬ç°åœ¨éƒ½æ˜¯ä»€ä¹ˆæ ·å­äº†ã€‚çœ‹åˆ°çš„ç¬¬ä¸€æ¡çŠ¶æ€æ˜¯å…³äºå°æ—¶ä»£åæ§½çš„æ—¥å¿—ï¼Œæˆ‘ç‚¹è¿›å»å¤§æ¦‚çœ‹äº†å‡ çœ¼å°±å‰æ‰äº†ï¼Œéƒ½æ˜¯ä¸€äº›è½¦è½±è¾˜è¯ï¼Œæ— éæ˜¯å¯¹ç”µå½±é‡Œå„ç§ç‚«å¯Œçš„ä¸æ»¡ä¸å«‰å¦’ã€‚åªæ˜¯ï¼Œæˆ‘ä¸æ˜ç™½å½“åˆã€ŠæŠ˜çº¸æ—¶ä»£ã€‹å‡ºç‰ˆçš„æ—¶å€™ï¼Œæ²¡æœ‰äººå‡ºæ¥è¯´å°è¯´ç‚«å¯Œï¼Œè€Œä¸€éƒ¨ç”µå½±çš„å´å¼•èµ·äº†é‚£ä¹ˆé’ˆé”‹ç›¸å¯¹çš„ç½‘ç»œéª‚æˆ˜ã€‚ç¬¬ä¸€æ¬¡çœ‹ã€Šå°æ—¶ä»£ã€‹æ˜¯å¤§ä¸‰é‚£å¹´çš„å›½åº†èŠ‚ï¼Œé‚£æ—¶å€™æ‰¾äº†ä¸€ä¸ªå…¼èŒï¼Œæ¯å¤©å·®ä¸å¤šè¦åä¸‰ä¸ªå°æ—¶çš„åœ°é“ï¼Œè¶ç€æ— èŠå°±ç”¨æ‰‹æœºå¼€å§‹çœ‹è¿™éƒ¨åœ¨æ‰‹æœºSDå¡é‡Œæ”¾äº†å¿«åŠå¹´çš„ç”µå­ä¹¦ã€‚å…¶å®ï¼Œç¬¬ä¸€æ¬¡çœ‹åˆ°æˆ‘å‡ ä¹æ²¡æ€ä¹ˆè®°ä½æ•…äº‹æƒ…èŠ‚ï¼Œåªæ˜¯æ·±åˆ»çš„è®°ä½äº†å››ä¸ªå¥³ä¸»äººå…¬çš„åå­—â€œé¡¾é‡Œï¼Œæ—è§ï¼Œå—æ¹˜ï¼Œå”å®›å¦‚â€ã€‚è¿˜æœ‰å¦‚å¦‚é‚£å¥å‰½æ‚çš„â€œçœ‹çœ‹çœ‹ï¼æˆ‘çš„å¥¶æœ‰ä»€ä¹ˆå¥½çœ‹çš„ï¼â€ã€‚æ›¾ç»ä¸€åº¦ä»¥ä¸ºï¼Œåœ¨ä¸Šæµ·ï¼Œäººä»¬è¿‡å¾—å°±æ˜¯é‚£æ ·çš„ç”Ÿæ´»ã€‚LV,GUCCI,å“ˆæ ¹è¾¾æ–¯â€¦â€¦è¿™äº›ä¸œè¥¿åœ¨ä»–ä»¬çš„ç”Ÿæ´»ä¸­ï¼Œå°±å¦‚æˆ‘ä»¬æ¯å¤©è¦å–çš„ä¸€æ¬¡æ€§å¡‘æ–™è¢‹ï¼Œé›ªç³•ä¸€èˆ¬å¹³å‡¡ã€‚åæ¥ï¼Œæˆ‘æ˜ç™½å…¶å®ä¸æ˜¯é‚£æ ·ï¼Œå°è¯´é‡Œçš„é‚£äº›ä¸œè¥¿å«åšå¥¢ä¾ˆå“ã€‚å¤§å››æ¯•ä¸šçš„æ—¶å€™ï¼Œç»ˆäºç­‰åˆ°äº†ã€Šåˆºé‡‘æ—¶ä»£ã€‹ï¼Œä½œä¸ºç»“å±€å°å››å†æ¬¡å»¶ç»­äº†ä»¥å¾€çš„é£æ ¼ï¼Œé™¤äº†æ—è§ä¹‹å¤–çš„æ‰€æœ‰äººç«Ÿç„¶åœ¨ä¸Šæµ·é‚£åœºè‘—åçš„é™å®‰åŒºå¤§ç«ä¸­ä¸§ç”Ÿäº†ã€‚æ­»äº¡æ€»æ˜¯èƒ½å¼•èµ·äººä»¬æ— é™çš„éæƒ³å’Œè¿½å¿†ï¼Œæˆ‘æ—¶å¸¸åœ¨æƒ³å¦‚æœå°è¯´é‡Œçš„é‚£äº›ä¸»äººå…¬ä»¬æ²¡æœ‰æ­»ï¼Œåæ¥ä¼šæ€æ ·ã€‚æˆ‘å–œæ¬¢å°æ—¶ä»£é‡Œçš„é‚£äº›äººä¸è®°ä»‡ï¼Œæ— è®ºä»Šå¤©è¯´äº†ä»€ä¹ˆæˆ–åšäº†ä»€ä¹ˆï¼Œåˆ°äº†æ˜å¤©ï¼Œä¾æ—§ä¼šå¼€ç€ç©ç¬‘åšå½¼æ­¤æœ€å¥½çš„ä¾é ã€‚\n\n \n\né¼ æ ‡ç»§ç»­æ»šåŠ¨ï¼Œçœ‹åˆ°çš„ä¸€æ¡çŠ¶æ€è®©æˆ‘åœäº†ä¸‹æ¥ã€‚å€’ä¸æ˜¯å†…å®¹æœ‰å¤šä¹ˆçš„å¸å¼•äººï¼Œè€Œæ˜¯ä¸‹é¢çš„å®šä½ä¿¡æ¯â€œåœ¨åŒ—çº¬40.44Â° è¥¿ç»79.92Â°â€ã€‚è€Œå‘è¿™æ¡çŠ¶æ€çš„äººæˆ‘è®¤è¯†ï¼Œå¤§ä¸€æ—¶æˆ‘ä»¬æ›¾æ˜¯åŒä¸€ä¸ªç¤¾å›¢çš„ã€‚æˆ‘ä»¬ç¤¾å›¢å«â€œçœŸçˆ±è¡ŒåŠ¨éƒ¨â€ï¼Œå…¶å®å°±æ˜¯å¿—æ„¿è€…ç¤¾å›¢çš„åˆ«ç§°ã€‚ç°åœ¨æƒ³æ¥ï¼Œé‚£æ—¶çš„å¥¹çœŸçš„æ¯«æ— ç‰¹åˆ«ä¹‹å¤„ï¼Œæ²¡æœ‰å€¾å›½å€¾åŸçš„å®¹è²Œï¼Œä¹Ÿæ²¡æœ‰å¯ä»¥å€¾å€’ä¼—ç”Ÿçš„æ°”è´¨ï¼ŒåªçŸ¥é“å¥¹å­¦ä¹ å¾ˆå¥½ï¼Œæ˜¯ä»–ä»¬ä¸“ä¸šçš„ç¬¬ä¸€åã€‚åœ¨åæ¥å¤šæ¬¡çš„å…±äº‹ä¸­ä¹Ÿæ²¡å‘ç°ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ã€‚åªæ˜¯æ­¤åˆ»çš„å¥¹ï¼Œèº«å¤„å¤§æ´‹å½¼å²¸çš„Carnegie Mellon Universityé‡Œæ‹ä¸‹æ¥ä¸€å¼ å¼ åœ¨æˆ‘çœ‹æ¥å®Œå…¨å¯ä»¥ç§’æ€å›½å†…äºŒæµå¥³æ˜æ˜Ÿçš„å†™çœŸç…§ï¼Œå®Œå…¨ä¸€å‰¯å¥³ç¥çš„å§¿æ€ã€‚ç‚¹åˆ°å¥¹çš„ä¸»é¡µç»§ç»­çœ‹ï¼Œå¥¹æ¥åˆ°è¿™ä¸ªå›½åº¦å·²ç„¶æœ‰ä¸€å¹´çš„æ—¶é—´äº†ã€‚ä¸ªäººç›¸å†Œé‡Œæ˜¯å„ç§å„æ ·å¥¹åœ¨å¼‚å›½çš„ç”Ÿæ´»å­¦ä¹ è®°å½•ã€‚çœ‹ç€é‚£äº›åœ¨å¥¹ç¿çƒ‚ç¬‘è„¸ä¸‹æ˜ è¡¬çš„å›½å¤–å¤§å­¦é£å…‰ï¼Œæˆ‘æœ‰é‚£ä¹ˆä¸€ä¸çš„ç¾¡æ…•å«‰å¦’æ²¡æœ‰æ¨ã€‚é‚£ä¸€åˆ»æˆ‘çªç„¶åœ¨æƒ³ï¼Œä¸ºä»€ä¹ˆå½¼æ­¤çš„ç”Ÿæ´»ç›¸å·®è¿™ä¹ˆå¤§ã€‚å€’ä¸æ˜¯çœŸçš„æƒ³åƒå¥¹é‚£æ ·ç•™å­¦åœ¨å¤–ï¼Œä½“éªŒå¼‚å›½çš„ç”Ÿæ´»ã€‚ä»å°åˆ°å¤§åœ¨æˆ‘çš„æ¢¦æƒ³é‡Œä»æ¥æ²¡æœ‰å‡ºå›½è¿™ä¸ªå­—çœ¼ã€‚æˆ‘åªæ˜¯å¯¹è‡ªå·±ç°åœ¨çš„çŠ¶æ€æœ‰äº›ä¸æ»¡ã€‚çªç„¶è§‰å¾—ä¸€ä»¶äº‹æƒ…ï¼Œåšäº†ï¼Œå¤±è´¥äº†ï¼Œæ€»æ¯”æ‡’å¾—å»åšæˆ–æ‡’å¾—å»æƒ³å¼ºï¼â€œæ‡’â€æ˜¯æ¯”â€œæ€•â€æ›´ç³Ÿç³•çš„ä¸€ç§çŠ¶æ€ã€‚\n\næœ‰æ®µæ—¶é—´ï¼Œæˆ‘ä¸€ç›´æœ‰ä¸€ç§çŸ›ç›¾çš„æƒ³æ³•ã€‚ä¸Šå­¦æ—¶ï¼Œè€å¸ˆæ•™è‚²è¯´è¦é€šè¿‡è‡ªå·±çš„åŠªåŠ›æ”¹å˜å‘½è¿ï¼Œäºæ˜¯æˆ‘ä»¬å¬è€å¸ˆçš„è¯ï¼ŒåŠªåŠ›å­¦ä¹ ï¼Œå†³å®šç”¨çŸ¥è¯†æ”¹å˜å‘½è¿ã€‚æˆ‘ä»¬ä¸æ€•è‰°è¾›ï¼Œä¸æŠ›å¼ƒï¼Œä¸æ”¾å¼ƒï¼Œä¸ºäº†æ‰€è°“çš„æ¢¦æƒ³å¥‹æ–—ã€‚åªæ˜¯ï¼Œåœ¨æŸä¸€ä¸ªç¬é—´æˆ‘ä¼šæƒ³ï¼Œæˆ‘ä»¬è¿™ä¹ˆæ‹¼å‘½åˆ°åº•æ˜¯åœ¨æ”¹å˜å‘½è¿ï¼Œè¿˜æ˜¯è¯´ä¸€åˆ‡æ—©å·²å‘½ä¸­æ³¨å®šï¼Œæˆ‘ä»¬æ‰€åšçš„ä¸€åˆ‡ï¼Œæ— è®ºæ˜¯ä¸æ€•å¤±è´¥çš„å°è¯•ï¼Œè¿˜æ˜¯å¤§å½»å¤§æ‚Ÿçš„é‡å¤´å†æ¥â€¦â€¦ï¼Œéƒ½åªä¸è¿‡æ˜¯æŒ‰ç…§å‘½è¿æ—©å·²å®‰æ’å¥½çš„è½¨è¿¹åœ¨å‰è¡Œã€‚\n\næ¯å½“æ— èŠçš„æ—¶å€™æˆ‘éƒ½ä¼šåˆ°å¥¹çš„äººäººä¸»é¡µä¸Šçœ‹çœ‹ï¼Œé™¤äº†æ¬£èµä¸€ä¸‹å¥³ç¥åœ¨å¼‚å›½çš„é£é‡‡ä¹‹å¤–ã€‚è¿˜ä¼šæé†’è‡ªå·±ï¼Œå…¶å®ç”Ÿæ´»ä¸­çš„å¾ˆå¤šäº‹æƒ…æ˜¯æˆ‘ä»¬æ— æ³•æ§åˆ¶çš„ï¼Œä»˜å‡ºäº†ä¸ä¸€å®šæœ‰æ”¶è·ï¼Œä½†æ˜¯ä¸ä»˜å‡ºï¼Œå°±ä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚åœ¨æˆ‘ä»¬æˆé•¿çš„é“è·¯ä¸Šï¼Œæœºé‡æ˜¯ä¸€ä»¶å¾ˆè¦çš„äº‹æƒ…ã€‚\n\nçœ‹ä¸æ¸…è¿œæ–¹æ¨¡ç³Šçš„äº‹ï¼Œå°±åšå¥½æ‰‹è¾¹æ¸…æ¥šçš„äº‹ã€‚è¿™æ˜¯æˆ‘æ—©å°±æ˜ç™½çš„é“ç†ï¼Œåªæ˜¯åœ¨çº·çº·æ‰°æ‰°çš„æ‚ä¹±ç”Ÿæ´»ä¸­è¢«æˆ‘é—å¿˜äº†ã€‚æ‰€ä»¥ï¼Œæ— è®ºç”Ÿæ´»æ€æ ·ï¼Œæ€»åº”è¯¥æœ‰ä¸€äº›ä¸ä¼šè¢«æŠ›å¼ƒçš„åŸåˆ™å’Œä¿¡å¿µä¸€ç›´è¢«é“­è®°ç€ã€‚å°±åƒå¥³ç¥ä¸€æ ·ï¼Œä¸æ˜¯ç”¨æ¥å¨¶å›å®¶å½“è€å©†çš„ï¼Œå½“ç„¶ä¹Ÿä¸ä¸€å®šå¨¶å¾—åˆ°ï¼Œä½†ä¾æ—§ä¼šè¢«æ€€å¿µå¾ˆä¹…å¾ˆä¹…ï¼Œå› ä¸ºï¼Œåœ¨è¿™ä¸ªä¸–ç•Œä¸Šæœ‰ä¸€ç§å§‘å¨˜æ˜¯ç”¨æ¥åŠ±å¿—çš„ï¼Œæ¯”å¦‚å¥³ç¥ï¼é‚£ä¸æ˜¯YYï¼Œæ˜¯ä¸€ç§å¯ä»¥è®©æˆ‘ä»¬åœ¨è¿·èŒ«æˆ–æ— å¥ˆæ—¶ä¾æ—§èƒ½å¤Ÿå‹‡å¾€ç›´å‰çš„ä¿¡å¿µå’ŒåŠ›é‡ã€‚\n\n \n\n \n\nä¸Šé¢çš„å†…å®¹æ˜¯æˆ‘åœ¨ä¸‰ä¸ªæœˆä¹‹å‰å†™çš„ã€‚ç°åœ¨æƒ³æ¥ï¼Œé‚£çœŸæ˜¯ä¸€æ®µæ— æ³•å½¢å®¹çš„æ—¥å­ã€‚\n\nåœ¨è¿‡å»çš„è¿™ä¸ªå¤å¤©æœ€ç‚çƒ­çš„æ—¶å€™ï¼Œä¸çŸ¥æ€çš„ï¼Œæˆ‘è¯¯ä»¥ä¸ºè‡ªå·±å¾—äº†æŠ‘éƒç—‡ã€‚å¯¹ç”Ÿæ´»æœ‰ä¸€äº›æ¶ˆæã€‚æˆ‘ç”¨äº†ä¸€ä¸ªæ²¡æœ‰ç­”æ¡ˆçš„é—®é¢˜æŠŠQQç©ºé—´åŠ å¯†äº†ã€‚æˆ‘æ€•è‡ªå·±ä¼šè¯´ä¸€äº›ç–¯ç‹‚çš„è¯ã€‚å…å¾—é€ æˆä¸€äº›å¤§å®¶çš„è¯¯è§£ã€‚å¼€å§‹é€ƒé¿è®¸å¤šä¸œè¥¿ã€‚ç°åœ¨æƒ³æ¥ï¼Œé‚£å®Œå…¨æ˜¯å¯¹å®‰äºç°çŠ¶çš„çƒ¦èºä¸ä¸å®‰ã€‚æˆ‘ä¸æ˜¯å´”æ°¸å…ƒï¼ŒæŠ‘éƒç—‡æ˜¯ä¸€ç§é«˜çº§çš„ç—…ï¼Œåƒæˆ‘è¿™ç§å‡¡äººå¾—ä¸èµ·ã€‚\n\nä¹æœˆåˆå¼€å­¦çš„æ—¶å€™ï¼Œæˆ‘æ¥äº†ä¸¤ä¸ªç”µè¯ã€‚ä¸€ä¸ªæ˜¯é‚£ä¸ªç¡ç¥æ‰“æ¥çš„ï¼Œä»–å¼€å§‹æ–°çš„å¤§å­¦ç”Ÿæ´»ã€‚ä¸€æƒ³åˆ°åœ¨å¤§å­¦é‡Œç•™äº†é‚£ä¹ˆå¤šçš„é—æ†¾ï¼Œå¯¹ç°åœ¨çš„ä»–å®Œå…¨æ˜¯å«‰å¦’å•Šã€‚ä¸€ä¸ªæ˜¯å’Œæˆ‘å°æ—¶å€™æ’’äº†å°¿å’Œæ³¥ç©çš„å‘å°æ‰“æ¥çš„ã€‚ä»–è¯´ä»–ç¦»å©šäº†ï¼Œæ‰“ç®—æ¥åŒ—äº¬æ‰“å·¥ï¼Œé—®æˆ‘å¹²å•¥å¥½ã€‚æˆ‘å°½æˆ‘æ‰€èƒ½çš„ç»™ä»–è®²äº†ä¸€äº›åŒ—äº¬çš„ç°çŠ¶å’Œéœ€è¦é¢å¯¹çš„å‹åŠ›ä»¥åŠä¸€äº›å»ºè®®ã€‚ç„¶ååœ¨ä»–çš„æ„Ÿæ¿€ä¸å°½ä¸­æŒ‚äº†ç”µè¯ã€‚10å¹´å¤§äºŒå¯’å‡å›å®¶çš„æ—¶å€™ï¼Œè¿˜å–äº†ä»–ä»¬çš„å–œé…’ï¼Œå½“åˆçœ‹ç€é‚£ä¹ˆå¹¸ç¦çš„ä¸€å¯¹æ€ä¹ˆå°±ç¦»äº†å‘¢ã€‚åŸæ¥ï¼Œæœ‰äº›äººåœ¨ä¸€èµ·äº†ï¼Œå´æ²¡èµ°åˆ°æœ€åã€‚çœŸå¿ƒå¸Œæœ›æ‰€æœ‰å¤©ä¸‹æœ‰æƒ…äººç”Ÿç”Ÿä¸–ä¸–ç›¸äº²ç›¸çˆ±ã€‚\n\nå¥½å¥‡å¿ƒå°±åƒé­”æ³•ä¸€æ ·ï¼Œæˆ‘ç”¨äº†ä¸€ä¸ªå‘¨æœ«ä¸¤å¤©çš„æ—¶é—´çœ‹å®Œäº†è¢«ç½‘å‹ä»¬è¤’è´¬ä¸ä¸€çš„ä¸¤éƒ¨ã€Šå°æ—¶ä»£ã€‹ã€‚æƒ³çœ‹çœ‹åˆ°åº•æœ‰å¤šçƒ‚æˆ–è€…è¯´å¤šå¥½ã€‚é™¤å»åˆ«çš„ä¸è¯´ï¼Œå°±å•ä»å°è¯´ç¿»æ‹ç”µå½±æ¥è¯´ï¼Œå€¼å¾—ä¸€çœ‹ã€‚æ¯”ã€Šå¥‹æ–—ã€‹ç”µå½±ç‰ˆæ‹çš„å¥½ã€‚è§‰å¾—ã€Šé’æœ¨æ—¶ä»£ã€‹é‡Œæœ€åæ‰“é›ªä»—çš„æƒ…æ™¯æ˜¯é‚£ä¹ˆçš„æ¸©é¦¨ï¼Œæ— è®ºå½¼æ­¤é—´æœ‰æ€æ ·çš„æ·±ä»‡å¤§æ¨æˆ–é˜´è°‹ç®—è®¡ï¼Œé‚£ä¸€åˆ»çš„ä»–ä»¬æ˜¯é‚£ä¹ˆçš„å•çº¯ï¼Œå•çº¯çš„ç©é—¹ã€‚ä¸€æƒ³åˆ°åæ¥ï¼Œä»–ä»¬è¦é¢å¯¹çš„ä¸€åˆ‡ï¼Œæ„Ÿè§‰å°å››æŒºæ®‹å¿çš„ã€‚\n\nè¿™é‡Œçš„ç§‹å¤©æ˜¯ä¸€å¹´ä¸­é£æ™¯æœ€å¥½çš„æ—¶åˆ»ã€‚å¤§è¡—ä¸Šåˆ°å¤„éƒ½æ˜¯æˆ´ç€å¢¨é•œã€ç©¿ç€é£è¡£å’Œç´§èº«ç‰›ä»”è£¤çš„å§‘å¨˜ä»¬ï¼Œé£ä¸€å¹ï¼Œçœ‹ç€é‚£åœ¨é£ä¸­å‡Œä¹±çš„é•¿å‘å„ä¸ªéƒ½æ˜¯å¥³ç‹çš„èŒƒå„¿ã€‚æ¯”èµ·å¤å¤©é‚£è®©äººæ— æ³•ç›´è§†çš„å°çŸ­è£™â€¦â€¦ï¼Œç°åœ¨çš„é£æ™¯æ˜¯å¤šä¹ˆçš„å¥½ã€‚è¿™ä¸ªå­£èŠ‚çš„å¤©æ°”ä¸å†·ä¸çƒ­ï¼Œæ—¶è€Œè¿˜åˆ®ç‚¹å„¿å¤§é£ï¼Œç„¶ååœ¨æŸä¸ªæ—©æ™¨ä¸€è§‰é†’æ¥ï¼Œå‘ç°æ ‘ä¸Šçš„å¶å­éƒ½æ²¡æœ‰äº†ã€‚\n\né‚£äº›æ›¾ç»åœ¨QQç©ºé—´å¾ˆæ´»è·ƒçš„æœ‹å‹ä»¬ï¼Œéƒ½ä¸çŸ¥ä¸è§‰çš„æ¶ˆå¤±äº†ã€‚åªå‰©ä¸‹é‚£ä¹ˆå‡ ä¸ªäººå¶å°”ä¸Šæ¥å–˜å£æ°”ï¼Œè¯æ˜è‡ªå·±è¿˜æ´»ç€ã€‚è¿™æ ·ä¹Ÿå¥½ï¼Œæ¯ä¸ªäººçš„å†…å¿ƒæ·±å¤„æ€»æ˜¯æ¸´æœ›æœ‰ä¸€ç‰‡å®é™åœ°æ–¹ï¼Œç°åœ¨çš„è¿™é‡Œå¾ˆå¥½ã€‚\n\næˆ‘ä¾æ—§å–œæ¬¢çœ‹ã€Šå¥‹æ–—ã€‹ï¼Œæ— è®ºæ˜¯å°è¯´è¿˜æ˜¯ç”µè§†å‰§ã€‚æ€»è§‰å¾—é‚£ä¸ªæ•…äº‹æ˜¯é‚£ä¹ˆçš„æœ‰æ„æ€ï¼Œæ€»è§‰å¾—ç±³è±æ˜¯è¿™ä¸ªä¸–ç•Œä¸Šæœ€å¥½çš„å§‘å¨˜ï¼\n\n â€œå¹´è½»çš„æ—¶å€™ï¼Œä¸è¯¥ä»€ä¹ˆéƒ½ä¸æƒ³ï¼Œä¹Ÿä¸èƒ½æƒ³å¤ªå¤šã€‚æƒ³å¾—å¤ªå¤šä¼šæ¯äº†ä½ ï¼Œæˆ‘ç›¸ä¿¡è¿™è¯â€¦â€¦æˆåŠŸè·¯ä¸Šæœ€å¿ƒé…¸çš„æ˜¯è¦è€å¾—ä½å¯‚å¯ã€ç†¬å¾—ä½å­¤ç‹¬ï¼Œæ€»æœ‰é‚£ä¹ˆä¸€æ®µè·¯æ˜¯ä½ ä¸€ä¸ªäººåœ¨èµ°ï¼Œä¸€ä¸ªäººåšå¼ºå’Œå‹‡æ•¢ã€‚ä¹Ÿè®¸è¿™ä¸ªè¿‡ç¨‹è¦æŒç»­å¾ˆä¹…ï¼Œä½†å¦‚æœä½ æŒºè¿‡å»äº†ï¼Œæœ€åçš„æˆåŠŸå°±å±äºä½ ã€‚â€ã€Šä¸­å›½åˆä¼™äººã€‹é‡Œè¿™å¥è¯çœŸæ˜¯è¯´çš„å¤ªå¥½äº†ã€‚\n\næ—¶é—´ï¼Œä»ä¸æ›¾ç»™äºˆæˆ‘ä»¬æ¯«æ— é¡¾å¿Œçš„ä»»æ€§ï¼Œç”Ÿæ´»ï¼Œä¹Ÿä»ä¸æ›¾å¸¦ç»™æˆ‘ä»¬æ»¡æ˜¯ç»æœ›çš„ææƒ§ï¼Œå›å¿†ï¼Œæ›´æ˜¯ä»ä¸æ›¾ç•™ç»™æˆ‘ä»¬é¢“åºŸèŒ«ç„¶çš„ç†ç”±ã€‚äººä¸èƒ½æ€»æ˜¯æ´»åœ¨å›å¿†é‡Œã€‚æˆ‘ä»¬æ‰€ç»å†æ‰€æœ‰äº‹æƒ…éƒ½æ˜¯æœ‰æ„ä¹‰çš„ã€‚\n\n \n\nç”Ÿæ´»ï¼Œä¼šå˜æˆæˆ‘ä»¬æƒ³è±¡çš„æ ·å­ï¼\n\n\n","tags":["ç”Ÿæ´»ï¼Œç†æƒ³"],"categories":["è¯—ä¸è¿œæ–¹"]},{"title":"å¾ˆä¹…å¾ˆä¹…ä¹‹å‰","url":"%2F2013%2F02%2F19%2F%E5%BE%88%E4%B9%85%E5%BE%88%E4%B9%85%E4%B9%8B%E5%89%8D%2F","tags":["ç”Ÿæ´»ï¼Œç†æƒ³"],"categories":["è¯—ä¸è¿œæ–¹"]}]